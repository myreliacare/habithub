<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Charlie's Habit Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 700;
            background: #3d2f31;
            min-height: 100vh;
            padding: 16px;
            color: #4a3a3c;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .section-nav {
            margin-bottom: 24px;
        }

        .section-dropdown {
            width: 100%;
            background: #EBE0D6;
            border: 1px solid #7ba886;
            color: #4a3a3c;
            padding: 12px 16px;
            font-size: 1rem;
            font-family: inherit;
            font-weight: 700;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%237ba886' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
            text-align: left;
        }

        .section-dropdown:focus {
            outline: none;
            border-color: #7ba886;
            box-shadow: 0 0 0 2px rgba(123, 168, 134, 0.2);
        }

        .section-dropdown option {
            background: #EBE0D6;
            color: #4a3a3c;
            padding: 12px;
            text-align: left;
        }

        .hub-tab {
            display: none;
        }

        .hub-tab.active {
            display: block;
        }

        .section {
            background: #EBE0D6;
            border: 1px solid #7ba886;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #7ba886;
            margin-bottom: 20px;
        }

        .bingo-section {
            background: #EBE0D6;
            border: 1px solid #7ba886;
            padding: 16px 12px;
            margin-bottom: 24px;
        }

        h1 {
            text-align: center;
            color: #4a3a3c;
            margin-bottom: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .main-title {
            text-align: center;
            color: #7ba886;
            margin-bottom: 16px;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            line-height: 1.2;
        }

        .subtitle {
            text-align: center;
            color: #7a6668;
            margin-bottom: 16px;
            font-size: 0.8rem;
        }

        .date-display {
            text-align: center;
            color: #7a6668;
            margin-bottom: 20px;
            font-size: 0.8rem;
        }

        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            margin-bottom: 20px;
            background: #EBE0D6;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .bingo-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 8px 4px;
            background: #E0D5CB;
            color: #4a3a3c;
            position: relative;
            line-height: 1.2;
            font-weight: 600;
        }

        .bingo-cell.completed {
            background: #7ba886;
            color: #4a3a3c;
        }


        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .controls .btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 20px;
            font-size: 0.85rem;
        }

        .stats {
            text-align: center;
            padding: 16px;
            background: #EBE0D6;
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }

        .stats-item {
            color: #7a6668;
            font-size: 0.85rem;
        }

        .stats-item span {
            color: #7ba886;
            font-size: 1.5rem;
            display: block;
            margin-bottom: 4px;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #EBE0D6;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            text-align: center;
            display: none;
            z-index: 1000;
            border: 1px solid #4a4a4a;
        }

        .celebration.show {
            display: block;
        }

        .celebration h2 {
            color: #7ba886;
            margin-bottom: 12px;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .celebration p {
            color: #7a6668;
            margin-bottom: 24px;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #7ba886;
            position: fixed;
            left: 50%;
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .resource-category {
            margin-bottom: 1px;
        }

        .resource-header {
            background: #EBE0D6;
            padding: 16px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
            border: 1px solid #e8d5d8;
        }

        .resource-header:hover {
            background: #333;
        }

        .resource-name {
            color: #4a3a3c;
            font-size: 1rem;
            font-weight: 700;
        }

        .resource-arrow {
            color: #7a6668;
            transition: transform 0.2s;
        }

        .resource-category.active .resource-arrow {
            transform: rotate(180deg);
            color: #7ba886;
        }

        .resource-content {
            display: none;
            background: #EBE0D6;
            padding: 16px 20px;
            border: 1px solid #e8d5d8;
            border-top: none;
        }

        .resource-category.active .resource-content {
            display: block;
        }

        .resource-item {
            background: #EBE0D6;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .resource-item-content {
            flex: 1;
        }

        .resource-item-title {
            color: #4a3a3c;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .resource-item-link {
            color: #7ba886;
            font-size: 0.85rem;
            word-break: break-all;
            text-decoration: none;
            display: block;
            margin-bottom: 6px;
        }

        .resource-item-link:hover {
            text-decoration: underline;
        }

        .resource-item-note {
            color: #7a6668;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .add-resource-btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            margin-top: 12px;
            font-family: inherit;
        }

        .add-resource-btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .empty-state {
            text-align: center;
            color: #7a6668;
            padding: 20px;
        }

        .add-event-btn {
            width: 100%;
            margin-top: 12px;
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .add-event-btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .event-form {
            display: none;
            background: #EBE0D6;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid #e8d5d8;
        }

        .event-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #7a6668;
            font-size: 0.85rem;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            background: #EBE0D6;
            border: 1px solid #d4b5b8;
            color: #4a3a3c;
            padding: 10px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-actions button[type="submit"] {
            border-color: #7ba886;
            color: #7ba886;
            background: transparent;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-actions button[type="submit"]:hover {
            background: #7ba886;
            color: #4a3a3c;
        }

        .video-item {
            background: #EBE0D6;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .video-content {
            flex: 1;
        }

        .video-title {
            color: #4a3a3c;
            font-size: 0.95rem;
            margin-bottom: 6px;
        }

        .video-link {
            color: #7ba886;
            font-size: 0.85rem;
            word-break: break-all;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }

        .video-link:hover {
            text-decoration: underline;
        }

        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .video-tag {
            background: #EBE0D6;
            color: #7a6668;
            padding: 4px 10px;
            font-size: 0.75rem;
            border: 1px solid #d4b5b8;
        }

        .todo-item {
            background: #EBE0D6;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 3px solid #7ba886;
        }

        .todo-item.completed {
            opacity: 0.6;
            border-left-color: #444;
        }

        .todo-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            cursor: pointer;
            accent-color: #7ba886;
        }

        .todo-content {
            flex: 1;
        }

        .todo-text {
            color: #4a3a3c;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #7a6668;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
        }

        .prompt-question {
            background: #EBE0D6;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 3px solid #7ba886;
        }

        .prompt-label {
            font-size: 0.75rem;
            color: #7a6668;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .prompt-text {
            color: #4a3a3c;
            font-size: 1.125rem;
            line-height: 1.5;
            font-style: italic;
            font-weight: 600;
        }

        .answer-box {
            background: #EBE0D6;
            padding: 20px;
            margin-bottom: 20px;
        }

        .answer-person {
            font-size: 0.75rem;
            color: #7ba886;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .answer-text {
            color: #4a3a3c;
            line-height: 1.6;
            font-size: 0.95rem;
            white-space: pre-wrap;
        }

        @media (max-width: 768px) {
            .bingo-grid {
                max-width: 100%;
                gap: 2px;
            }

            .bingo-cell {
                aspect-ratio: auto;
                min-height: 80px;
                font-size: 0.7rem;
                padding: 6px 3px;
                line-height: 1.2;
            }

            .controls {
                flex-direction: column;
            }

            .controls .btn {
                width: 100%;
                min-width: unset;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }

            .bingo-section {
                padding: 12px;
            }

            .main-title {
                font-size: 1.5rem;
            }

            .bingo-grid {
                gap: 2px;
                margin-bottom: 12px;
            }

            .bingo-cell {
                aspect-ratio: auto;
                min-height: 70px;
                font-size: 0.68rem;
                padding: 5px 2px;
                line-height: 1.2;
            }

            .controls {
                gap: 8px;
            }

            .controls .btn {
                padding: 8px 12px;
                font-size: 0.75rem;
            }

            .stats {
                padding: 12px;
                gap: 12px;
            }

            .stats-item {
                font-size: 0.75rem;
            }

            .stats-item span {
                font-size: 1.2rem;
            }
        }

        /* Habits Editor Modal */
        .habits-modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8); z-index: 2000;
            display: none; align-items: center; justify-content: center;
            padding: 20px;
        }
        .habits-modal-overlay.visible { display: flex; }
        .habits-modal {
            background: #EBE0D6; border: 1px solid rgba(123, 168, 134, 0.4);
            width: 100%; max-width: 500px; max-height: 85vh;
            overflow-y: auto; padding: 24px;
        }
        .habits-modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 12px;
            border-bottom: 1px solid rgba(123, 168, 134, 0.2);
        }
        .habits-modal-title { font-size: 1.1rem; color: #f2ebe0; }
        .habits-modal-close {
            background: transparent; border: none; color: #a3b899;
            font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1;
        }
        .habits-modal-close:hover { color: #f2ebe0; }
        .habits-list { margin-bottom: 20px; max-height: 400px; overflow-y: auto; }
        .habit-item {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 12px; margin-bottom: 6px;
            background: rgba(20, 20, 20, 0.4);
            border-left: 2px solid #7ba886;
        }
        .habit-item input {
            flex: 1; background: transparent; border: none;
            color: #f2ebe0; font-size: 0.9rem; font-family: inherit;
            padding: 4px 0;
        }
        .habit-item input:focus { outline: none; }
        .habit-delete {
            background: transparent; border: none;
            color: rgba(163, 184, 153, 0.5); cursor: pointer;
            font-size: 1rem; padding: 4px 8px;
        }
        .habit-delete:hover { color: #a3b899; }
        .add-habit-row {
            display: flex; gap: 8px; margin-bottom: 16px;
        }
        .add-habit-row input {
            flex: 1; background: rgba(20, 20, 20, 0.5);
            border: 1px solid rgba(123, 168, 134, 0.3); color: #f2ebe0;
            padding: 10px 12px; font-size: 0.9rem; font-family: inherit;
        }
        .add-habit-row input:focus { outline: none; border-color: rgba(123, 168, 134, 0.5); }
        .add-habit-row input::placeholder { color: rgba(242, 235, 224, 0.4); }
        .add-habit-btn {
            background: #7ba886; border: none; color: #1c1c1c;
            padding: 10px 16px; cursor: pointer; font-size: 0.9rem; font-family: inherit;
        }
        .add-habit-btn:hover { background: #a3b899; }
        .habits-modal-actions {
            display: flex; gap: 10px; justify-content: flex-end;
            padding-top: 16px; border-top: 1px solid rgba(123, 168, 134, 0.2);
        }
        .habits-save-btn {
            background: #7ba886; border: none; color: #1c1c1c;
            padding: 10px 20px; cursor: pointer; font-size: 0.85rem; font-family: inherit;
        }
        .habits-save-btn:hover { background: #a3b899; }
        .habits-cancel-btn {
            background: transparent; border: 1px solid rgba(123, 168, 134, 0.4);
            color: #a3b899; padding: 10px 20px; cursor: pointer;
            font-size: 0.85rem; font-family: inherit;
        }
        .habits-cancel-btn:hover { border-color: rgba(123, 168, 134, 0.6); }
        .habit-count { font-size: 0.75rem; color: rgba(242, 235, 224, 0.5); margin-bottom: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="btn" style="margin-bottom: 24px;">&larr; Back to Home</a>
        
        <div class="section-nav">
            <select id="sectionDropdown" onchange="switchTabFromDropdown()" class="section-dropdown">
                <option value="bingo">Bingo Card</option>
                <option value="resources">Resources</option>
                <option value="videos">Video Hub</option>
                <option value="todos">To-Do List</option>
                <option value="prompt">Daily Prompt</option>
            </select>
        </div>

        <!-- BINGO TAB -->
        <div id="bingo-tab" class="hub-tab active">
            <div class="bingo-section">
                <h1>The Ultimate</h1>
                <div class="main-title">DAILY HABITS<br>BINGO</div>
                <p class="subtitle">Click squares to mark complete &bull; Get 4 in a row to win</p>
                <div class="date-display" id="dateDisplay"></div>
                
                <div class="bingo-grid" id="bingoGrid"></div>
                
                <div class="controls">
                    <button class="btn" onclick="resetBoard()">Reset Today</button>
                    <button class="btn" onclick="shuffleBoard()">Shuffle Habits</button>
                    <button class="btn" onclick="openHabitsEditor()">Edit Habits</button>
                </div>

                <div class="stats">
                    <div class="stats-item">
                        <span id="completedCount">0</span>
                        Complete
                    </div>
                    <div class="stats-item">
                        <span id="bingoCount">0</span>
                        Bingos
                    </div>
                </div>
            </div>
        </div>

        <!-- RESOURCES TAB -->
        <div id="resources-tab" class="hub-tab">
            <div class="section">
                <h2 class="section-title">Habit Resources</h2>
                
                <div class="event-form" id="resourceForm">
                    <form onsubmit="addResource(event)">
                        <input type="hidden" id="resourceCategory" name="category">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Upload Image/Video (optional)</label>
                            <input type="file" name="file" accept="image/*,video/*" id="resourceFile" onchange="handleResourceUpload()">
                            <div style="text-align: center; color: #7a6668; margin: 8px 0; font-size: 0.85rem;">&mdash; OR &mdash;</div>
                        </div>
                        <div class="form-group">
                            <label>Link (optional)</label>
                            <input type="url" name="link" id="resourceLink">
                        </div>
                        <div class="form-group">
                            <label>Notes (optional)</label>
                            <textarea name="note" rows="3"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideAddResourceForm()">Cancel</button>
                            <button type="submit" class="btn">Save Resource</button>
                        </div>
                    </form>
                </div>
                
                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'meditate')">
                        <span class="resource-name">Meditate</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="meditate-content">
                        <div id="meditate-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('meditate')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'exercise')">
                        <span class="resource-name">Exercise</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="exercise-content">
                        <div id="exercise-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('exercise')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'meals')">
                        <span class="resource-name">Healthy Meals</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="meals-content">
                        <div id="meals-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('meals')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'journal')">
                        <span class="resource-name">Journal</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="journal-content">
                        <div id="journal-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('journal')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'read')">
                        <span class="resource-name">Read</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="read-content">
                        <div id="read-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('read')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'walk')">
                        <span class="resource-name">Walk / Podcasts</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="walk-content">
                        <div id="walk-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('walk')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'guitar')">
                        <span class="resource-name">Guitar</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="guitar-content">
                        <div id="guitar-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('guitar')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'learn')">
                        <span class="resource-name">Learn Something New</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="learn-content">
                        <div id="learn-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('learn')">+ Add Resource</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIDEOS TAB -->
        <div id="videos-tab" class="hub-tab">
            <div class="section">
                <h2 class="section-title">Video Hub</h2>
                <button class="add-event-btn" onclick="toggleVideoForm()">Add Video</button>
                
                <div class="event-form" id="videoForm">
                    <form onsubmit="addVideo(event)">
                        <div class="form-group">
                            <label>Video Title</label>
                            <input type="text" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Upload Video from Phone</label>
                            <input type="file" name="video" accept="video/*" id="videoFile" onchange="handleVideoUpload()">
                            <div style="text-align: center; color: #7a6668; margin: 8px 0; font-size: 0.85rem;">&mdash; OR &mdash;</div>
                        </div>
                        <div class="form-group">
                            <label>Video Link (TikTok, YouTube, etc)</label>
                            <input type="url" name="link" id="videoLink">
                        </div>
                        <div class="form-group">
                            <label>Tags (comma separated)</label>
                            <input type="text" name="tags" placeholder="motivation, exercise, meditation">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="toggleVideoForm()">Cancel</button>
                            <button type="submit" class="btn">Save Video</button>
                        </div>
                    </form>
                </div>

                <div id="videosList" style="margin-top: 20px;">
                    <div class="empty-state">No videos yet. Add your first motivational video!</div>
                </div>
            </div>
        </div>

        <!-- TO-DO LIST TAB -->
        <div id="todos-tab" class="hub-tab">
            <div class="section">
                <h2 class="section-title">To-Do List</h2>
                <button class="add-event-btn" onclick="toggleTodoForm()">Add To-Do</button>
                
                <div class="event-form" id="todoForm">
                    <form onsubmit="addTodo(event)">
                        <div class="form-group">
                            <label>To-Do Item</label>
                            <input type="text" name="todo" required placeholder="What needs to be done?">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="toggleTodoForm()">Cancel</button>
                            <button type="submit" class="btn">Add To-Do</button>
                        </div>
                    </form>
                </div>

                <div id="todosList" style="margin-top: 20px;">
                    <div class="empty-state">No to-dos yet. Add your first task!</div>
                </div>
            </div>
        </div>

        <!-- PROMPT TAB -->
        <div id="prompt-tab" class="hub-tab">
            <div class="section">
                <h2 class="section-title">Today's Prompt</h2>
                
                <div class="prompt-question">
                    <div class="prompt-label">Question of the Day</div>
                    <div class="prompt-text" id="promptQuestionHub"></div>
                </div>

                <div class="event-form active">
                    <form onsubmit="saveAnswer(event)">
                        <div class="form-group">
                            <label id="answerLabel">Your Answer</label>
                            <textarea name="answer" rows="6" required id="answerInput"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn">Save Answer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <h2>BINGO!</h2>
        <p>Amazing work! You got 4 in a row!</p>
        <button class="btn" onclick="closeCelebration()">Continue</button>
    </div>

    <!-- Habits Editor Modal -->
    <div class="habits-modal-overlay" id="habitsModalOverlay" onclick="closeHabitsEditor(event)">
        <div class="habits-modal" onclick="event.stopPropagation()">
            <div class="habits-modal-header">
                <div class="habits-modal-title">Edit My Habits</div>
                <button class="habits-modal-close" onclick="closeHabitsEditor()">&times;</button>
            </div>
            <div class="habit-count" id="habitCount">20 habits (16 shown on bingo card)</div>
            <div class="habits-list" id="habitsList"></div>
            <div class="add-habit-row">
                <input type="text" id="newHabitInput" placeholder="Add new habit..." onkeypress="if(event.key==='Enter') addNewHabit()">
                <button class="add-habit-btn" onclick="addNewHabit()">+</button>
            </div>
            <div class="habits-modal-actions">
                <button class="habits-cancel-btn" onclick="closeHabitsEditor()">Cancel</button>
                <button class="habits-save-btn" onclick="saveHabitsChanges()">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        const defaultCharlieHabits = [
            "Exercise 30+ Minutes",
            "Eat a Healthy Meal",
            "Read 10+ Pages",
            "Meditate",
            "Sleep 7+ Hours",
            "Journal",
            "Walk 10k Steps",
            "Vibration Plate",
            "Learn Something New",
            "Practice Gratitude",
            "Acupuncture Mat",
            "Tidy Living Space",
            "30 Mins of Guitar",
            "EFT Tapping",
            "Time in Nature",
            "Acts of Kindness"
        ];

        let charlieHabits = [...defaultCharlieHabits];
        let editingHabits = [];

        // Firebase sync functions
        async function syncToFirebase(collectionName, data) {
            if (!window.db) return;
            try {
                const { setDoc, doc } = window.firestoreImports;
                await setDoc(doc(window.db, collectionName, 'data'), { items: data });
            } catch (error) {
                console.error(`Error syncing ${collectionName}:`, error);
            }
        }

        async function loadFromFirebase(collectionName) {
            if (!window.db) return null;
            try {
                const { getDoc, doc } = window.firestoreImports;
                const docRef = doc(window.db, collectionName, 'data');
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    return docSnap.data().items;
                }
                return null;
            } catch (error) {
                console.error(`Error loading ${collectionName}:`, error);
                return null;
            }
        }

        function setupFirebaseListener(collectionName, callback) {
            if (!window.db) return;
            try {
                const { onSnapshot, doc } = window.firestoreImports;
                const docRef = doc(window.db, collectionName, 'data');
                
                onSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        callback(doc.data().items);
                    }
                });
            } catch (error) {
                console.error(`Error setting up listener for ${collectionName}:`, error);
            }
        }

        // Load custom habits from localStorage
        function loadCustomHabits() {
            const saved = localStorage.getItem('charlieCustomHabits');
            if (saved) {
                const parsed = JSON.parse(saved);
                if (parsed && parsed.length >= 16) {
                    charlieHabits = parsed;
                }
            }
        }

        // Habits Editor Functions
        function openHabitsEditor() {
            editingHabits = [...charlieHabits];
            renderHabitsList();
            document.getElementById('habitsModalOverlay').classList.add('visible');
        }

        function closeHabitsEditor(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('habitsModalOverlay').classList.remove('visible');
        }

        function renderHabitsList() {
            const list = document.getElementById('habitsList');
            document.getElementById('habitCount').textContent = `${editingHabits.length} habits (16 shown on bingo card)`;
            
            list.innerHTML = editingHabits.map((habit, index) => `
                <div class="habit-item">
                    <input type="text" value="${habit}" onchange="updateHabit(${index}, this.value)">
                    <button class="habit-delete" onclick="deleteHabit(${index})">Ã—</button>
                </div>
            `).join('');
        }

        function updateHabit(index, value) {
            editingHabits[index] = value.trim();
        }

        function deleteHabit(index) {
            if (editingHabits.length <= 16) {
                alert('You need at least 16 habits for the bingo card!');
                return;
            }
            editingHabits.splice(index, 1);
            renderHabitsList();
        }

        function addNewHabit() {
            const input = document.getElementById('newHabitInput');
            const value = input.value.trim();
            if (!value) return;
            
            editingHabits.push(value);
            input.value = '';
            renderHabitsList();
        }

        function saveHabitsChanges() {
            editingHabits = editingHabits.filter(h => h.trim() !== '');
            
            if (editingHabits.length < 16) {
                alert('You need at least 16 habits for the bingo card!');
                return;
            }
            
            charlieHabits = [...editingHabits];
            localStorage.setItem('charlieCustomHabits', JSON.stringify(charlieHabits));
            shuffleBoard();
            closeHabitsEditor();
        }

        const dailyPrompts = [
            "What's one thing I did today that made you smile?",
            "What's your favorite memory of us from this past month?",
            "What's one way I can support you better this week?",
            "What's something you're grateful for about our relationship?",
            "What's a goal you have for us as a couple?",
            "What's one thing you admire about me?",
            "What's your favorite thing we do together?",
            "What's something new you'd like to try together?",
            "What's a challenge we've overcome together that you're proud of?",
            "What makes you feel most loved by me?",
            "What's something you've learned about yourself through our relationship?",
            "What's a small gesture I do that means a lot to you?",
            "What's your favorite quality about our relationship?",
            "What's something you're excited about for our future?",
            "What's one way we've grown together recently?",
            "What's a tradition you'd like to start with us?",
            "What's something I do that makes you laugh?",
            "What's your favorite way to spend quality time together?",
            "What's something you want to accomplish together this year?",
            "What's one thing about our relationship that makes you feel secure?",
            "What's a moment when you felt really connected to me?",
            "What's something you appreciate about how we handle disagreements?",
            "What's your favorite inside joke or moment between us?",
            "What's one way our relationship has changed you for the better?",
            "What's something you'd like more of in our relationship?",
            "What's a compliment you wish you heard more often?",
            "What's your favorite physical gesture of affection from me?",
            "What's something I do that helps you feel understood?",
            "What's a dream you have for us that we haven't talked about yet?",
            "What's one thing that always brightens your day when I do it?"
        ];

        const defaultResources = {
            meditate: [
                { title: 'Insight Timer', link: 'https://insighttimer.com', note: 'Free guided meditations. Huge library.' },
                { title: 'Headspace', link: 'https://www.headspace.com', note: '10-min daily meditations. Great for beginners.' }
            ],
            exercise: [
                { title: 'Yoga with Adriene', link: 'https://www.youtube.com/@yogawithadriene', note: '30-day programs, all levels.' },
                { title: 'Rebounder Workouts', link: 'https://www.youtube.com/results?search_query=rebounder+workout', note: 'Low impact cardio, fun!' }
            ],
            meals: [
                { title: 'Budget Bytes', link: 'https://www.budgetbytes.com', note: 'Easy, affordable, healthy recipes.' }
            ],
            journal: [
                { title: 'Morning brain dump', link: null, note: 'Write 3 pages of whatever comes to mind. No filtering.' },
                { title: 'What I\'m proud of', link: null, note: 'List 3 things from today you handled well.' }
            ],
            read: [
                { title: 'Atomic Habits by James Clear', link: null, note: 'THE book for building habits.' },
                { title: 'The Mountain Is You by Brianna Wiest', link: null, note: 'About self-sabotage and growth.' }
            ],
            walk: [
                { title: 'Unlocking Us - Bren&eacute; Brown', link: null, note: 'Podcast about vulnerability and courage.' }
            ],
            guitar: [
                { title: 'JustinGuitar', link: 'https://www.justinguitar.com', note: 'Free structured course. Start here.' },
                { title: 'Marty Music', link: 'https://www.youtube.com/@MartyMusic', note: 'Learn popular songs easily.' }
            ],
            learn: [
                { title: 'Coursera', link: 'https://www.coursera.org', note: 'Free university courses. Audit for free.' },
                { title: 'YouTube - Crash Course', link: 'https://www.youtube.com/@crashcourse', note: 'Fun 10-15 min lessons on everything.' }
            ]
        };

        let boardState = [];
        let currentHabits = [];
        let videos = [];
        let resources = {};
        let todos = [];
        let pendingResourceFile = null;
        let pendingVideoFile = null;

        // Storage functions (localStorage only)
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function loadData(key) {
            const saved = localStorage.getItem(key);
            return saved ? JSON.parse(saved) : null;
        }

        function switchTabFromDropdown() {
            const dropdown = document.getElementById('sectionDropdown');
            const tab = dropdown.value;
            
            document.querySelectorAll('.hub-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');

            if (tab === 'prompt') loadHubPrompt();
            else if (tab === 'resources') renderAllResources();
            else if (tab === 'todos') renderTodos();
        }

        async function initBoard() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('bingoDate_charlie');
            const boardVersion = localStorage.getItem('bingoVersion_charlie');
            
            // Force reset if switching from 5x5 to 4x4 OR if we detect wrong number of habits
            if (boardVersion !== '4x4') {
                localStorage.removeItem('bingoState_charlie');
                localStorage.setItem('bingoVersion_charlie', '4x4');
                localStorage.setItem('bingoDate_charlie', today);
                shuffleBoard();
            } else if (savedDate !== today) {
                localStorage.removeItem('bingoState_charlie');
                localStorage.setItem('bingoDate_charlie', today);
                shuffleBoard();
            } else {
                const saved = localStorage.getItem('bingoState_charlie');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.habits && data.habits.length === 16) {
                        currentHabits = data.habits;
                        boardState = data.state;
                    } else {
                        shuffleBoard();
                    }
                } else {
                    shuffleBoard();
                }
            }
            
            // Final safety check - if we somehow still don't have 16 habits, shuffle
            if (!currentHabits || currentHabits.length !== 16) {
                shuffleBoard();
            }
            
            updateDateDisplay();
            renderBoard();
            updateStats();
        }

        function updateDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('en-US', options);
        }

        async function shuffleBoard() {
            // Save which habits are currently completed
            const completedHabits = new Set();
            currentHabits.forEach((habit, index) => {
                if (boardState[index]) {
                    completedHabits.add(habit);
                }
            });

            // Shuffle and get new habits
            const shuffled = [...charlieHabits].sort(() => Math.random() - 0.5).slice(0, 16);
            currentHabits = shuffled;
            
            // Restore completed state for habits that are still on the board
            boardState = new Array(16).fill(false);
            currentHabits.forEach((habit, index) => {
                if (completedHabits.has(habit)) {
                    boardState[index] = true;
                }
            });

            await saveState();
            renderBoard();
            updateStats();
        }

        function renderBoard() {
            const grid = document.getElementById('bingoGrid');
            grid.innerHTML = '';
            
            currentHabits.forEach((habit, index) => {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                cell.textContent = habit;
                
                if (boardState[index]) cell.classList.add('completed');
                cell.onclick = () => toggleCell(index);
                
                grid.appendChild(cell);
            });
        }

        async function toggleCell(index) {
            boardState[index] = !boardState[index];
            await saveState();
            renderBoard();
            updateStats();
            checkBingo();
        }

        async function resetBoard() {
            boardState = new Array(16).fill(false);
            await saveState();
            renderBoard();
            updateStats();
        }

        async function saveState() {
            const data = {
                habits: currentHabits,
                state: boardState
            };
            localStorage.setItem('bingoState_charlie', JSON.stringify(data));
            saveData(data);
        }

        function updateStats() {
            const completed = boardState.filter(Boolean).length;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('bingoCount').textContent = countBingos();
        }

        function countBingos() {
            let count = 0;
            // Check rows (4 rows)
            for (let i = 0; i < 4; i++) {
                if (boardState.slice(i * 4, i * 4 + 4).every(Boolean)) count++;
            }
            // Check columns (4 columns)
            for (let i = 0; i < 4; i++) {
                if ([0, 1, 2, 3].every(j => boardState[i + j * 4])) count++;
            }
            // Check diagonals
            if ([0, 5, 10, 15].every(i => boardState[i])) count++; // Top-left to bottom-right
            if ([3, 6, 9, 12].every(i => boardState[i])) count++; // Top-right to bottom-left
            return count;
        }

        function checkBingo() {
            const prevCount = parseInt(localStorage.getItem('prevBingoCount_charlie') || '0');
            const currentCount = countBingos();
            if (currentCount > prevCount) showCelebration();
            localStorage.setItem('prevBingoCount_charlie', currentCount);
        }

        function showCelebration() {
            document.getElementById('celebration').classList.add('show');
            createConfetti();
        }

        function closeCelebration() {
            document.getElementById('celebration').classList.remove('show');
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffd93d', '#a8e6cf', '#ff8b94', '#c7ceea', '#b4f8c8', '#ffa07a', '#98d8c8'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    const size = Math.random() * 8 + 6;
                    confetti.style.width = size + 'px';
                    confetti.style.height = size + 'px';
                    const duration = Math.random() * 2 + 2;
                    confetti.style.animationDuration = duration + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), duration * 1000);
                }, i * 30);
            }
        }

        function loadResources() {
            const saved = localStorage.getItem('resources_charlie');
            if (saved) {
                resources = JSON.parse(saved);
            } else {
                resources = JSON.parse(JSON.stringify(defaultResources));
            }
            renderAllResources();
        }

        function saveResources() {
            localStorage.setItem('resources_charlie', JSON.stringify(resources));
        }

        function handleResourceUpload() {
            const fileInput = document.getElementById('resourceFile');
            const file = fileInput.files[0];
            if (file) {
                // File size validation
                const sizeMB = (file.size / 1024 / 1024).toFixed(1);
                if (file.size > 2 * 1024 * 1024) {
                    if (!confirm('File is ' + sizeMB + 'MB. This may cause issues. Continue?')) {
                        fileInput.value = '';
                        return;
                    }
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    pendingResourceFile = {
                        data: e.target.result,
                        type: file.type,
                        name: file.name
                    };
                    document.getElementById('resourceLink').value = '';
                };
                reader.readAsDataURL(file);
            }
        }

        function toggleResource(e, category) {
            e.target.closest('.resource-category').classList.toggle('active');
        }

        function renderAllResources() {
            Object.keys(resources).forEach(category => renderResourceCategory(category));
        }

        function renderResourceCategory(category) {
            const container = document.getElementById(`${category}-items`);
            if (!container) return;

            if (!resources[category] || resources[category].length === 0) {
                container.innerHTML = '<div class="empty-state">No resources yet. Add your first one!</div>';
                return;
            }

            container.innerHTML = '';
            resources[category].forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'resource-item';
                
                let mediaContent = '';
                if (item.file) {
                    if (item.file.type.startsWith('image')) {
                        mediaContent = `<img src="${item.file.data}" style="max-width: 200px; margin-bottom: 8px; border-radius: 4px;">`;
                    } else if (item.file.type.startsWith('video')) {
                        mediaContent = `<video controls style="max-width: 200px; margin-bottom: 8px;"><source src="${item.file.data}" type="${item.file.type}"></video>`;
                    }
                }
                
                itemDiv.innerHTML = `
                    <div class="resource-item-content">
                        <div class="resource-item-title">${item.title}</div>
                        ${mediaContent}
                        ${item.link ? `<a href="${item.link}" target="_blank" class="resource-item-link">${item.link}</a>` : ''}
                        ${item.note ? `<div class="resource-item-note">${item.note}</div>` : ''}
                    </div>
                    <button class="btn" onclick="deleteResource('${category}', ${index})" style="padding: 4px 8px; min-width: auto;">&times;</button>
                `;
                container.appendChild(itemDiv);
            });
        }

        function showAddResourceForm(category) {
            document.getElementById('resourceCategory').value = category;
            document.getElementById('resourceForm').classList.add('active');
        }

        function hideAddResourceForm() {
            document.getElementById('resourceForm').classList.remove('active');
            document.getElementById('resourceForm').querySelector('form').reset();
            pendingResourceFile = null;
        }

        async function addResource(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const category = formData.get('category');

            const resource = {
                title: formData.get('title'),
                link: formData.get('link') || null,
                note: formData.get('note') || null,
                file: pendingResourceFile
            };

            if (!resources[category]) resources[category] = [];
            resources[category].push(resource);
            await saveResources();
            renderResourceCategory(category);
            hideAddResourceForm();
        }

        async function deleteResource(category, index) {
            if (confirm('Delete this resource?')) {
                resources[category].splice(index, 1);
                await saveResources();
                renderResourceCategory(category);
            }
        }

        function handleVideoUpload() {
            const fileInput = document.getElementById('videoFile');
            const file = fileInput.files[0];
            if (file) {
                const sizeMB = (file.size / 1024 / 1024).toFixed(1);
                if (file.size > 10 * 1024 * 1024) {
                    alert('Video too large (' + sizeMB + 'MB).\n\nVideos over 10MB cannot save properly. Please:\n1. Upload to YouTube and use the link, OR\n2. Compress video to under 10MB');
                    fileInput.value = '';
                    return;
                }
                if (file.size > 2 * 1024 * 1024) {
                    alert('Warning: Video is ' + sizeMB + 'MB. May load slowly.');
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    pendingVideoFile = {
                        data: e.target.result,
                        type: file.type,
                        name: file.name
                    };
                    document.getElementById('videoLink').value = '';
                };
                reader.readAsDataURL(file);
            }
        }

        function loadVideos() {
            const saved = localStorage.getItem('videos_charlie');
            if (saved) {
                videos = JSON.parse(saved);
            } else {
                videos = [];
            }
            renderVideos();
        }

        function saveVideos() {
            localStorage.setItem('videos_charlie', JSON.stringify(videos));
        }

        function toggleVideoForm() {
            const form = document.getElementById('videoForm');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                form.querySelector('form').reset();
                pendingVideoFile = null;
            }
        }

        async function addVideo(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const video = {
                title: formData.get('title'),
                link: formData.get('link') || null,
                file: pendingVideoFile,
                tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
                dateAdded: new Date().toISOString()
            };

            videos.push(video);
            await saveVideos();
            renderVideos();
            e.target.reset();
            pendingVideoFile = null;
            toggleVideoForm();
        }

        function renderVideos() {
            const list = document.getElementById('videosList');
            if (videos.length === 0) {
                list.innerHTML = '<div class="empty-state">No videos yet. Add your first motivational video!</div>';
                return;
            }

            list.innerHTML = '';
            videos.forEach((video, index) => {
                const videoDiv = document.createElement('div');
                videoDiv.className = 'video-item';
                
                let videoContent = '';
                if (video.file) {
                    videoContent = `
                        <video controls style="width: 100%; max-width: 300px; margin-bottom: 8px; background: #000;">
                            <source src="${video.file.data}" type="${video.file.type}">
                        </video>
                        <div class="video-title">${video.title}</div>
                    `;
                } else if (video.link) {
                    videoContent = `
                        <div class="video-title">${video.title}</div>
                        <a href="${video.link}" target="_blank" class="video-link">${video.link}</a>
                    `;
                }

                videoDiv.innerHTML = `
                    <div class="video-content">
                        ${videoContent}
                        ${video.tags.length > 0 ? `
                            <div class="video-tags">
                                ${video.tags.map(tag => `<span class="video-tag">${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                    <button class="btn" onclick="deleteVideo(${index})" style="padding: 4px 8px; min-width: auto;">Delete</button>
                `;
                list.appendChild(videoDiv);
            });
        }

        async function deleteVideo(index) {
            if (confirm('Delete this video?')) {
                videos.splice(index, 1);
                await saveVideos();
                renderVideos();
            }
        }

        // TO-DO LIST FUNCTIONS
        function loadTodos() {
            const saved = localStorage.getItem('todos_charlie');
            if (saved) {
                todos = JSON.parse(saved);
            } else {
                todos = [];
            }
            renderTodos();
        }

        function saveTodos() {
            localStorage.setItem('todos_charlie', JSON.stringify(todos));
        }

        function toggleTodoForm() {
            const form = document.getElementById('todoForm');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                form.querySelector('form').reset();
            }
        }

        function addTodo(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const todo = {
                text: formData.get('todo'),
                completed: false,
                dateAdded: new Date().toISOString()
            };

            todos.push(todo);
            saveTodos();
            renderTodos();
            e.target.reset();
            toggleTodoForm();
        }

        async function toggleTodoComplete(index) {
            todos[index].completed = !todos[index].completed;
            await saveTodos();
            renderTodos();
        }

        async function deleteTodo(index) {
            if (confirm('Delete this to-do?')) {
                todos.splice(index, 1);
                await saveTodos();
                renderTodos();
            }
        }

        function renderTodos() {
            const list = document.getElementById('todosList');
            if (todos.length === 0) {
                list.innerHTML = '<div class="empty-state">No to-dos yet. Add your first task!</div>';
                return;
            }

            list.innerHTML = '';
            todos.forEach((todo, index) => {
                const todoDiv = document.createElement('div');
                todoDiv.className = 'todo-item';
                if (todo.completed) todoDiv.classList.add('completed');
                
                todoDiv.innerHTML = `
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodoComplete(${index})">
                    <div class="todo-content">
                        <div class="todo-text">${todo.text}</div>
                    </div>
                    <div class="todo-actions">
                        <button class="btn" onclick="deleteTodo(${index})" style="padding: 4px 8px; min-width: auto;">Delete</button>
                    </div>
                `;
                list.appendChild(todoDiv);
            });
        }

        async function loadHubPrompt() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            const promptIndex = dayOfYear % dailyPrompts.length;
            document.getElementById('promptQuestionHub').textContent = dailyPrompts[promptIndex];

            const saved = localStorage.getItem('dailyPromptAnswers');
            const savedAnswers = saved ? JSON.parse(saved) : {};
            
            // If there's a saved answer for today, populate the textarea
            if (savedAnswers.date === today.toDateString() && savedAnswers.charlie) {
                document.getElementById('answerInput').value = savedAnswers.charlie;
            } else {
                document.getElementById('answerInput').value = '';
            }
        }

        function saveAnswer(e) {
            e.preventDefault();
            const answer = new FormData(e.target).get('answer');
            const today = new Date().toDateString();

            const saved = localStorage.getItem('dailyPromptAnswers');
            let savedAnswers = saved ? JSON.parse(saved) : {};
            savedAnswers.date = today;
            savedAnswers.charlie = answer;
            localStorage.setItem('dailyPromptAnswers', JSON.stringify(savedAnswers));
            
            loadHubPrompt();
            alert('Your answer has been saved! It will appear on the homepage.');
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadCustomHabits();
            initBoard();
            loadVideos();
            loadResources();
            loadTodos();
        });
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCDda9sPwSY-RQ5rrM5THOvcLtHvcPRYd4",
            authDomain: "our-habit-hub.firebaseapp.com",
            projectId: "our-habit-hub",
            storageBucket: "our-habit-hub.firebasestorage.app",
            messagingSenderId: "78555830496",
            appId: "1:78555830496:web:3e457e54729cc11b825885"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.firestoreImports = { collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot };

        console.log('Firebase initialized successfully!');
    </script>

</body>
</html>
