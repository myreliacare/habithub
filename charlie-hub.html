<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Charlie's Habit Hub</title>
    <script>
    /* Life Hub Settings Engine v2 - Complete Color Rewriting */
    (function(){
        if(window._lhEngineLoaded) return; window._lhEngineLoaded=true;

        // ── Color manipulation helpers ──
        function h2r(h){h=h.replace('#','');return[parseInt(h.substring(0,2),16),parseInt(h.substring(2,4),16),parseInt(h.substring(4,6),16)];}
        function r2h(r,g,b){return'#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);}
        function clamp(v){return Math.max(0,Math.min(255,Math.round(v)));}
        function lighten(hex,pct){var c=h2r(hex);return r2h(clamp(c[0]+(255-c[0])*pct),clamp(c[1]+(255-c[1])*pct),clamp(c[2]+(255-c[2])*pct));}
        function darken(hex,pct){var c=h2r(hex);return r2h(clamp(c[0]*(1-pct)),clamp(c[1]*(1-pct)),clamp(c[2]*(1-pct)));}
        function rgbStr(hex){var c=h2r(hex);return c[0]+','+c[1]+','+c[2];}

        // ── Palette definitions (v3 — matches settings page) ──
        var accentHexMap={sage:'#a3b899',blush:'#d4919e',cream:'#e8ddd0',periwinkle:'#8e9cc7',dustylilac:'#c3a6c9',powderblue:'#a4c2d8',softmint:'#a8d8c4',moss:'#8a9c6b',burntsienna:'#c97856',rosegold:'#d4a4a4',dustyteal:'#6d9e9e',petalpink:'#e8b4b8',apricot:'#e8b088',palejade:'#8ec4a8',raspberry:'#b0607a',denim:'#6888a8',nude:'#d4b8a8',obsidian:'#181818',darkplum:'#3d2f31',storm:'#252830'};
        var defaultSecMap={sage:'rosegold',blush:'sage',cream:'rosegold',periwinkle:'rosegold',dustylilac:'rosegold',powderblue:'rosegold',softmint:'rosegold',moss:'rosegold',burntsienna:'sage',rosegold:'sage',dustyteal:'rosegold',petalpink:'sage',apricot:'sage',palejade:'rosegold',raspberry:'sage',denim:'rosegold',nude:'sage',obsidian:'rosegold',darkplum:'sage',storm:'rosegold'};
        var bgMap={dark:'#3d2f31',forest:'#1f2e2a',espresso:'#2b2220',storm:'#252830',midnight:'#141420',warmcocoa:'#362a28',deepteal:'#1a2e2e',warmlinen:'#f0e8dc',dustymauve:'#332830',obsidian:'#181818',softblush:'#f2e2e4',bordeaux:'#301820'};
        var bgDkMap={dark:'#2a1f21',forest:'#15231f',espresso:'#1e1816',storm:'#1b1d24',midnight:'#0d0d16',warmcocoa:'#281e1c',deepteal:'#122020',warmlinen:'#e4dace',dustymauve:'#261c24',obsidian:'#101010',softblush:'#e8d6d9',bordeaux:'#221018'};
        var tcMap={dark:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},forest:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},espresso:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},storm:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},midnight:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},warmcocoa:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},deepteal:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},warmlinen:{t:'#3d2f31',m:'rgba(61,47,49,0.65)',f:'rgba(61,47,49,0.4)'},dustymauve:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},obsidian:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},softblush:{t:'#3d2f31',m:'rgba(61,47,49,0.65)',f:'rgba(61,47,49,0.4)'},bordeaux:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'}};
        var fontMap={philosopher:"'Philosopher',Georgia,serif",cormorant:"'Cormorant Garamond',Georgia,serif",worksans:"'Work Sans',sans-serif",baloo:"'Baloo 2',cursive",lora:"'Lora',Georgia,serif",cardo:"'Cardo',Georgia,serif",playfair:"'Playfair Display',Georgia,serif",kalam:"'Kalam',cursive",lobster:"'Lobster',cursive",indieflower:"'Indie Flower',cursive",gilda:"'Gilda Display',Georgia,serif",cormorantinfant:"'Cormorant Infant',Georgia,serif",dmserif:"'DM Serif Display',Georgia,serif",tenor:"'Tenor Sans',sans-serif",dancing:"'Dancing Script',cursive",satisfy:"'Satisfy',cursive",greatvibes:"'Great Vibes',cursive",abril:"'Abril Fatface',Georgia,serif"};

        // ── Read settings ──
        var ac=localStorage.getItem('accentColor')||'sage';
        var sc=localStorage.getItem('secondaryColor')||defaultSecMap[ac]||'rosegold';
        var bc=localStorage.getItem('bgColor')||'dark';
        var ff=localStorage.getItem('fontFamily')||'philosopher';
        var hf=localStorage.getItem('headingFont')||'philosopher';
        var fs=parseInt(localStorage.getItem('fontSize')||'100',10);
        var appName=localStorage.getItem('appName')||'Our Life Hub';
        var names;try{names=JSON.parse(localStorage.getItem('userNames')||'{}');}catch(e){names={};}
        names.name1=names.name1||'Kasey'; names.name2=names.name2||'Charlie';
        var archivedPages;try{archivedPages=JSON.parse(localStorage.getItem('archivedPages')||'[]');}catch(e){archivedPages=[];}

        // Person 2 hub theme overrides
        var p2o;try{p2o=JSON.parse(localStorage.getItem('person2Appearance')||'{}');}catch(e){p2o={};}
        if(p2o.accentColor)ac=p2o.accentColor;
        if(p2o.secondaryColor)sc=p2o.secondaryColor;
        if(p2o.bgColor)bc=p2o.bgColor;
        if(p2o.fontFamily)ff=p2o.fontFamily;
        if(p2o.headingFont)hf=p2o.headingFont;

        var pa=accentHexMap[ac]||accentHexMap.sage;
        var sec=accentHexMap[sc]||accentHexMap.rosegold;
        var bg=bgMap[bc]||bgMap.dark;
        var bgDk=bgDkMap[bc]||bgDkMap.dark;
        var tc=tcMap[bc]||tcMap.dark;
        var font=fontMap[ff]||fontMap.philosopher;
        var hFont=fontMap[hf]||fontMap.philosopher;
        var basePx=Math.round(16*fs/100);

        // ── Generate accent color variants ──
        var A = {
            vdark:  darken(pa, 0.45),   // #4a5c3f, #4a6a3e
            dark:   darken(pa, 0.30),    // #6d8a5e, #7d8f76
            mdark:  darken(pa, 0.15),    // #8fa87a, #8fa882
            base:   pa,                  // #a3b899
            light:  lighten(pa, 0.15),   // #b4c9aa, #b5c9a8
            vlight: lighten(pa, 0.30),   // #b5d4a4, #c4d9b5
            xlight: lighten(pa, 0.50),   // very light washes
            hover:  lighten(pa, 0.12)
        };

        // ── Generate secondary color variants ──
        var S = {
            vdark:  darken(sec, 0.45),   // #5a4345, #5a4a4c
            dark:   darken(sec, 0.30),    // #6b5a5e, #7a6668
            mdark:  darken(sec, 0.15),    // #9a7a80, #a57f85
            base:   sec,                  // #b59197
            light:  lighten(sec, 0.10),   // #c5a1a7, #c9a9a6
            vlight: lighten(sec, 0.25),   // #d4b5b8, #d4b5ba
            xlight: lighten(sec, 0.40),   // #e8d5d8
            redish: darken(sec, 0.10),    // #c97a7a, #d67373 (more saturated)
        };

        // ── Generate background mid-tones ──
        var bgMid = lighten(bg, 0.15);   // #4a3a3c, #4a3b3e

        // ── Apply CSS custom properties ──
        var r=document.documentElement;
        r.style.setProperty('--lh-accent',A.base);
        r.style.setProperty('--lh-accent-hover',A.hover);
        r.style.setProperty('--lh-accent-muted','rgba('+rgbStr(A.base)+',0.2)');
        r.style.setProperty('--lh-accent-border','rgba('+rgbStr(A.base)+',0.3)');
        r.style.setProperty('--lh-accent-text','rgba('+rgbStr(A.base)+',0.6)');
        r.style.setProperty('--lh-bg',bg);
        r.style.setProperty('--lh-bg-darker',bgDk);
        r.style.setProperty('--lh-secondary',S.base);
        var sR=parseInt(sec.slice(1,3),16),sG=parseInt(sec.slice(3,5),16),sB=parseInt(sec.slice(5,7),16);
        r.style.setProperty('--lh-secondary-muted','rgba('+sR+','+sG+','+sB+',0.15)');
        r.style.setProperty('--lh-secondary-border','rgba('+sR+','+sG+','+sB+',0.3)');
        r.style.setProperty('--lh-text',tc.t);
        r.style.setProperty('--lh-text-muted',tc.m);
        r.style.setProperty('--lh-text-faint',tc.f);
        r.style.setProperty('--lh-font',font);
        r.style.setProperty('--lh-heading-font',hFont);
        r.style.setProperty('--lh-font-size',basePx+'px');
        r.style.background=bg; r.style.fontSize=basePx+'px';

        // Load fonts if not already present
        var neededFonts=[];
        var fontUrls={philosopher:'Philosopher:ital,wght@0,400;0,700;1,400',cormorant:'Cormorant+Garamond:wght@300;400;500;600;700',worksans:'Work+Sans:wght@400;500;600;700;800',baloo:'Baloo+2:wght@400;500;600;700;800',lora:'Lora:ital,wght@0,400;0,500;0,600;0,700;1,400',cardo:'Cardo:ital,wght@0,400;0,700;1,400',playfair:'Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400',kalam:'Kalam:wght@300;400;700',lobster:'Lobster',indieflower:'Indie+Flower',gilda:'Gilda+Display',cormorantinfant:'Cormorant+Infant:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400',dmserif:'DM+Serif+Display:ital@0;1',tenor:'Tenor+Sans',dancing:'Dancing+Script:wght@400;500;600;700',satisfy:'Satisfy',greatvibes:'Great+Vibes',abril:'Abril+Fatface'};
        [ff,hf].forEach(function(f){if(fontUrls[f]&&neededFonts.indexOf(fontUrls[f])===-1)neededFonts.push(fontUrls[f]);});
        if(neededFonts.length){var link=document.createElement('link');link.rel='stylesheet';link.href='https://fonts.googleapis.com/css2?'+neededFonts.map(function(f){return'family='+f;}).join('&')+'&display=swap';document.head.appendChild(link);}

        // Heading font override
        var hfSt=document.createElement('style');hfSt.textContent='.nav-logo,.page-title,.home-title,.main-title,.journal-title,.spellbook-title,.calendar-title,.schedule-title{font-family:var(--lh-heading-font)!important}';(document.head||r).appendChild(hfSt);

        // Archive nav links
        var pageHrefs={home:'index.html',person1:'kasey-hub.html',person2:'charlie-hub.html',dreams:'our-dreams.html',meals:'meal-plan.html',settings:'settings.html'};
        var archCSS='';archivedPages.forEach(function(k){var h=pageHrefs[k];if(h)archCSS+='a.nav-link[href="'+h+'"],a.nav-link-mobile[href="'+h+'"]{display:none!important}\n';});
        if(archCSS){var st=document.createElement('style');st.textContent=archCSS;(document.head||r).appendChild(st);}

        // Expose for settings page
        window.LifeHubSettings={current:{appName:appName,names:names,accentColor:ac,secondaryColor:sc,bgColor:bc,fontFamily:ff,headingFont:hf,fontSize:fs,archivedPages:archivedPages,archivedSections:JSON.parse(localStorage.getItem('archivedSections')||'{}'),features:JSON.parse(localStorage.getItem('features')||'{}'),pageLabels:JSON.parse(localStorage.getItem('pageLabels')||'{}')},getName:function(p){return p===1||p==='person1'?names.name1:names.name2;},accentHexMap:accentHexMap,defaultSecMap:defaultSecMap};

        function onReady(fn){if(document.readyState!=='loading')fn();else document.addEventListener('DOMContentLoaded',fn);}
        onReady(function(){
            // ── Apply names ──
            document.querySelectorAll('.nav-logo').forEach(function(el){el.textContent=appName;});
            document.querySelectorAll('.nav-link,.nav-link-mobile').forEach(function(lnk){
                var href=lnk.getAttribute('href')||'';
                if(href==='kasey-hub.html')lnk.textContent=names.name1;
                if(href==='charlie-hub.html')lnk.textContent=names.name2;
            });
            document.querySelectorAll('[data-lh-name="app"]').forEach(function(el){el.textContent=appName;});
            document.querySelectorAll('[data-lh-name="person1"]').forEach(function(el){el.textContent=names.name1;});
            document.querySelectorAll('[data-lh-name="person2"]').forEach(function(el){el.textContent=names.name2;});
            var title=document.title;
            if(title.indexOf('Our Life Hub')!==-1)document.title=title.replace('Our Life Hub',appName);
            if(title.indexOf("Kasey's")!==-1)document.title=title.replace("Kasey's",names.name1+"'s");
            else if(title.indexOf('Kasey')!==-1)document.title=title.replace('Kasey',names.name1);
            if(title.indexOf("Charlie's")!==-1)document.title=title.replace("Charlie's",names.name2+"'s");
            else if(title.indexOf('Charlie')!==-1)document.title=title.replace('Charlie',names.name2);

            // ── Skip rewriting if all defaults ──
            if(ac==='sage'&&bc==='dark')return;

            // ── Build replacement map ──
            var reps=[];

            if(ac!=='sage'){
                var aRgb=rgbStr(A.base), sRgb=rgbStr(S.base);

                // PRIMARY ACCENT — hex values (green family)
                // Very dark greens
                reps.push(['#4a5c3f',A.vdark],['#4a6a3e',A.vdark],['#4A5C3F',A.vdark],['#4A6A3E',A.vdark]);
                // Dark greens
                reps.push(['#6d8a5e',A.dark],['#5a7a4a',A.dark],['#6D8A5E',A.dark],['#5A7A4A',A.dark]);
                // Medium-dark greens
                reps.push(['#7d8f76',A.mdark],['#8fa87a',A.mdark],['#8fa882',A.mdark],['#7a9b6a',A.mdark]);
                reps.push(['#7D8F76',A.mdark],['#8FA87A',A.mdark],['#8FA882',A.mdark],['#7A9B6A',A.mdark]);
                // Base greens
                reps.push(['#a3b899',A.base],['#A3B899',A.base],['#7ba886',A.base],['#7BA886',A.base]);
                // Light greens
                reps.push(['#b4c9aa',A.light],['#B4C9AA',A.light],['#b5c9a8',A.light],['#B5C9A8',A.light]);
                reps.push(['#a8c99b',A.light],['#A8C99B',A.light],['#b8c9ad',A.light],['#B8C9AD',A.light]);
                // Very light greens
                reps.push(['#b5d4a4',A.vlight],['#B5D4A4',A.vlight],['#c4d9b5',A.vlight],['#C4D9B5',A.vlight]);

                // SECONDARY ACCENT — hex values (rose family)
                // Very dark roses
                reps.push(['#5a4345',S.vdark],['#5a4a4c',S.vdark],['#5A4345',S.vdark],['#5A4A4C',S.vdark]);
                // Dark roses
                reps.push(['#6b5a5e',S.dark],['#7a6668',S.dark],['#6B5A5E',S.dark],['#7A6668',S.dark]);
                // Medium-dark roses
                reps.push(['#9a7a80',S.mdark],['#a57f85',S.mdark],['#9A7A80',S.mdark],['#A57F85',S.mdark]);
                reps.push(['#b4828c',S.mdark],['#B4828C',S.mdark]);
                // Base roses
                reps.push(['#b59197',S.base],['#B59197',S.base]);
                // Light roses
                reps.push(['#c5a1a7',S.light],['#c9a9a6',S.light],['#c8b8bb',S.light]);
                reps.push(['#C5A1A7',S.light],['#C9A9A6',S.light],['#C8B8BB',S.light]);
                // Very light roses
                reps.push(['#d4b5b8',S.vlight],['#d4b5ba',S.vlight],['#d4a5a5',S.vlight],['#d4a5ae',S.vlight]);
                reps.push(['#D4B5B8',S.vlight],['#D4B5BA',S.vlight],['#D4A5A5',S.vlight],['#D4A5AE',S.vlight]);
                // Extra light roses
                reps.push(['#e8d5d8',S.xlight],['#E8D5D8',S.xlight]);
                // Red-ish accent variants
                reps.push(['#c97a7a',S.redish],['#C97A7A',S.redish],['#d67373',S.redish],['#D67373',S.redish]);

                // TEAL (index calendar) — map to accent dark
                reps.push(['#3d6b6b',A.dark],['#3D6B6B',A.dark]);
                reps.push(['#4a7a7a',A.mdark],['#4A7A7A',A.mdark]);
                reps.push(['#5a9a9a',A.base],['#5A9A9A',A.base]);

                // GOLD/BROWN accents — map to accent or secondary variants
                reps.push(['#c4a882',A.light],['#C4A882',A.light],['#d4a882',A.light],['#D4A882',A.light]);
                reps.push(['#8a7a2e',A.dark],['#8A7A2E',A.dark],['#b5a33d',A.mdark],['#B5A33D',A.mdark]);
                reps.push(['#c9b84a',A.base],['#C9B84A',A.base]);
                reps.push(['#8a7a6d',S.dark],['#8A7A6D',S.dark]);
                reps.push(['#edecd5',A.xlight],['#EDECD5',A.xlight]);

                // PURPLE accents — map to secondary
                reps.push(['#a08cb4',S.light],['#A08CB4',S.light]);
                reps.push(['#c7ceea',S.xlight],['#C7CEEA',S.xlight]);

                // PASTEL PALETTE (wellness moods etc) — shift toward accent/secondary
                reps.push(['#a8e6cf',lighten(A.base,0.40)],['#98d8c8',lighten(A.base,0.35)]);
                reps.push(['#b4f8c8',lighten(A.base,0.50)]);
                reps.push(['#4ecdc4',A.base],['#45b7d1',A.mdark]);
                reps.push(['#95c9b4',A.light]);

                // rgba — PRIMARY ACCENT (sage green rgb: 163,184,153)
                reps.push([/rgba\(\s*163,\s*184,\s*153,\s*([0-9.]+)\s*\)/g,'rgba('+aRgb+',$1)']);
                // Other green rgbas
                reps.push([/rgba\(\s*122,\s*138,\s*110,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);
                reps.push([/rgba\(\s*168,\s*201,\s*155,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.light)+',$1)']);
                reps.push([/rgba\(\s*123,\s*168,\s*134,\s*([0-9.]+)\s*\)/g,'rgba('+aRgb+',$1)']);
                reps.push([/rgba\(\s*109,\s*138,\s*94,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);
                reps.push([/rgba\(\s*125,\s*143,\s*118,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.mdark)+',$1)']);
                // Teal rgba
                reps.push([/rgba\(\s*61,\s*107,\s*107,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);

                // rgba — SECONDARY (rose rgb: 181,145,151)
                reps.push([/rgba\(\s*181,\s*145,\s*151,\s*([0-9.]+)\s*\)/g,'rgba('+sRgb+',$1)']);
                reps.push([/rgba\(\s*201,\s*169,\s*166,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.light)+',$1)']);
                reps.push([/rgba\(\s*180,\s*130,\s*140,\s*([0-9.]+)\s*\)/g,'rgba('+sRgb+',$1)']);
                reps.push([/rgba\(\s*201,\s*122,\s*122,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.redish)+',$1)']);
                reps.push([/rgba\(\s*160,\s*140,\s*180,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.light)+',$1)']);
                reps.push([/rgba\(\s*196,\s*168,\s*130,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.light)+',$1)']);
                reps.push([/rgba\(\s*201,\s*184,\s*74,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.mdark)+',$1)']);
            }

            if(bc!=='dark'){
                // BACKGROUND
                reps.push(['#3d2f31',bg],['#3D2F31',bg],['#3c2f31',bg],['#3C2F31',bg]);
                reps.push(['#2a1f21',bgDk],['#2A1F21',bgDk]);
                reps.push(['#4a3a3c',bgMid],['#4A3A3C',bgMid],['#4a3b3e',bgMid],['#4A3B3E',bgMid]);

                // Background rgbas
                reps.push([/rgba\(\s*61,\s*47,\s*49,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bg)+',$1)']);
                reps.push([/rgba\(\s*60,\s*47,\s*49,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bg)+',$1)']);
                reps.push([/rgba\(\s*42,\s*31,\s*33,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bgDk)+',$1)']);
            }

            if(bc==='cream'){
                // TEXT — flip to dark for light background
                reps.push(['#f2ebe0',tc.t],['#F2EBE0',tc.t],['#e0d2d0',tc.t],['#E0D2D0',tc.t]);
                reps.push(['#EBE0D6',tc.t],['#ebe0d6',tc.t],['#f5ede6',tc.t],['#F5EDE6',tc.t]);
                reps.push(['#f5f0ed',tc.t],['#F5F0ED',tc.t],['#f0ebe6',tc.t],['#F0EBE6',tc.t]);
                reps.push(['#f0efe8',tc.t],['#F0EFE8',tc.t],['#faf8f6',tc.t],['#FAF8F6',tc.t]);
                reps.push(['#f7ebf0',tc.t],['#F7EBEF',tc.t]);
                reps.push(['#e3d6cc',tc.m],['#E3D6CC',tc.m],['#e0d5cb',tc.m],['#E0D5CB',tc.m]);
                reps.push([/rgba\(\s*242,\s*235,\s*224,\s*([0-9.]+)\s*\)/g,tc.m]);
                reps.push([/rgba\(\s*224,\s*210,\s*208,\s*([0-9.]+)\s*\)/g,tc.m]);
                // White text used in some buttons → dark
                reps.push(['#fff',tc.t],['#FFF',tc.t]);
            }

            // ── Apply replacements ──
            function applyReps(text){
                reps.forEach(function(pair){
                    if(pair[0] instanceof RegExp)text=text.replace(pair[0],pair[1]);
                    else text=text.split(pair[0]).join(pair[1]);
                });
                return text;
            }

            // Rewrite <style> tags
            document.querySelectorAll('style').forEach(function(s){
                var css=s.textContent,orig=css;
                css=applyReps(css);
                if(css!==orig)s.textContent=css;
            });

            // Rewrite inline styles
            document.querySelectorAll('[style]').forEach(function(el){
                var st=el.getAttribute('style'),orig=st;
                st=applyReps(st);
                if(st!==orig)el.setAttribute('style',st);
            });

            // Override CSS custom properties (meal-plan uses :root vars)
            var ov=document.createElement('style');
            ov.textContent=':root{--dark-bg:'+bg+'!important;--card-bg:'+bgDk+'!important;--sage-green:'+A.base+'!important;--muted-sage:'+A.mdark+'!important;--light-text:'+tc.t+'!important;--cream:'+tc.t+'!important;--border-color:rgba('+rgbStr(A.base)+',0.2)!important}';
            document.head.appendChild(ov);
        });
    })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            background: #3d2f31;
        }

        body {
            font-family: 'Work Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-weight: 700;
            background: #3d2f31 !important;
            min-height: 100vh;
            padding: 72px 16px 16px 16px;
            color: #4a3a3c;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .section-nav {
            margin-bottom: 24px;
        }

        .section-dropdown {
            width: 100%;
            background: #EBE0D6;
            border: 1px solid #7ba886;
            color: #4a3a3c;
            padding: 12px 16px;
            font-size: 1rem;
            font-family: inherit;
            font-weight: 700;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L6 6L11 1' stroke='%237ba886' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
            text-align: left;
        }

        .section-dropdown:focus {
            outline: none;
            border-color: #7ba886;
            box-shadow: 0 0 0 2px rgba(123, 168, 134, 0.2);
        }

        .section-dropdown option {
            background: #EBE0D6;
            color: #4a3a3c;
            padding: 12px;
            text-align: left;
        }

        .hub-tab {
            display: none;
        }

        .hub-tab.active {
            display: block;
        }

        .section {
            background: #EBE0D6;
            border: 1px solid #7ba886;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #7ba886;
            margin-bottom: 20px;
        }

        .bingo-section {
            background: #EBE0D6;
            border: 1px solid #7ba886;
            padding: 16px 12px;
            margin-bottom: 24px;
        }

        h1 {
            text-align: center;
            color: #4a3a3c;
            margin-bottom: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .main-title {
            text-align: center;
            color: #7ba886;
            margin-bottom: 16px;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.05em;
            line-height: 1.2;
        }

        .subtitle {
            text-align: center;
            color: #7a6668;
            margin-bottom: 16px;
            font-size: 0.8rem;
        }

        .date-display {
            text-align: center;
            color: #7a6668;
            margin-bottom: 20px;
            font-size: 0.8rem;
        }

        .bingo-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 2px;
            margin-bottom: 20px;
            background: #EBE0D6;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .bingo-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 8px 4px;
            background: #E0D5CB;
            color: #4a3a3c;
            position: relative;
            line-height: 1.2;
            font-weight: 600;
        }

        .bingo-cell.completed {
            background: #7ba886;
            color: #4a3a3c;
        }


        .controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .controls .btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 20px;
            font-size: 0.85rem;
        }

        .stats {
            text-align: center;
            padding: 16px;
            background: #EBE0D6;
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }

        .stats-item {
            color: #7a6668;
            font-size: 0.85rem;
        }

        .stats-item span {
            color: #7ba886;
            font-size: 1.5rem;
            display: block;
            margin-bottom: 4px;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #EBE0D6;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            text-align: center;
            display: none;
            z-index: 1000;
            border: 1px solid #4a4a4a;
        }

        .celebration.show {
            display: block;
        }

        .celebration h2 {
            color: #7ba886;
            margin-bottom: 12px;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .celebration p {
            color: #7a6668;
            margin-bottom: 24px;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #7ba886;
            position: fixed;
            left: 50%;
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .resource-category {
            margin-bottom: 1px;
        }

        .resource-header {
            background: #EBE0D6;
            padding: 16px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
            border: 1px solid #e8d5d8;
        }

        .resource-header:hover {
            background: #333;
        }

        .resource-name {
            color: #4a3a3c;
            font-size: 1rem;
            font-weight: 700;
        }

        .resource-arrow {
            color: #7a6668;
            transition: transform 0.2s;
        }

        .resource-category.active .resource-arrow {
            transform: rotate(180deg);
            color: #7ba886;
        }

        .resource-content {
            display: none;
            background: #EBE0D6;
            padding: 16px 20px;
            border: 1px solid #e8d5d8;
            border-top: none;
        }

        .resource-category.active .resource-content {
            display: block;
        }

        .resource-item {
            background: #EBE0D6;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .resource-item-content {
            flex: 1;
        }

        .resource-item-title {
            color: #4a3a3c;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .resource-item-link {
            color: #7ba886;
            font-size: 0.85rem;
            word-break: break-all;
            text-decoration: none;
            display: block;
            margin-bottom: 6px;
        }

        .resource-item-link:hover {
            text-decoration: underline;
        }

        .resource-item-note {
            color: #7a6668;
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .add-resource-btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            margin-top: 12px;
            font-family: inherit;
        }

        .add-resource-btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .empty-state {
            text-align: center;
            color: #7a6668;
            padding: 20px;
        }

        .add-event-btn {
            width: 100%;
            margin-top: 12px;
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .add-event-btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .event-form {
            display: none;
            background: #EBE0D6;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid #e8d5d8;
        }

        .event-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #7a6668;
            font-size: 0.85rem;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            background: #EBE0D6;
            border: 1px solid #d4b5b8;
            color: #4a3a3c;
            padding: 10px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-actions button[type="submit"] {
            border-color: #7ba886;
            color: #7ba886;
            background: transparent;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-actions button[type="submit"]:hover {
            background: #7ba886;
            color: #4a3a3c;
        }

        .video-item {
            background: #EBE0D6;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .video-content {
            flex: 1;
        }

        .video-title {
            color: #4a3a3c;
            font-size: 0.95rem;
            margin-bottom: 6px;
        }

        .video-link {
            color: #7ba886;
            font-size: 0.85rem;
            word-break: break-all;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }

        .video-link:hover {
            text-decoration: underline;
        }

        .video-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .video-tag {
            background: #EBE0D6;
            color: #7a6668;
            padding: 4px 10px;
            font-size: 0.75rem;
            border: 1px solid #d4b5b8;
        }

        .todo-item {
            background: #EBE0D6;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 3px solid #7ba886;
        }

        .todo-item.completed {
            opacity: 0.6;
            border-left-color: #444;
        }

        .todo-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            cursor: pointer;
            accent-color: #7ba886;
        }

        .todo-content {
            flex: 1;
        }

        .todo-text {
            color: #4a3a3c;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #7a6668;
        }

        .todo-actions {
            display: flex;
            gap: 8px;
        }

        .prompt-question {
            background: #EBE0D6;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 3px solid #7ba886;
        }

        .prompt-label {
            font-size: 0.75rem;
            color: #7a6668;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .prompt-text {
            color: #4a3a3c;
            font-size: 1.125rem;
            line-height: 1.5;
            font-style: italic;
            font-weight: 600;
        }

        .answer-box {
            background: #EBE0D6;
            padding: 20px;
            margin-bottom: 20px;
        }

        .answer-person {
            font-size: 0.75rem;
            color: #7ba886;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .answer-text {
            color: #4a3a3c;
            line-height: 1.6;
            font-size: 0.95rem;
            white-space: pre-wrap;
        }

        @media (max-width: 768px) {
            .bingo-grid {
                max-width: 100%;
                gap: 2px;
            }

            .bingo-cell {
                aspect-ratio: auto;
                min-height: 80px;
                font-size: 0.7rem;
                padding: 6px 3px;
                line-height: 1.2;
            }

            .controls {
                flex-direction: column;
            }

            .controls .btn {
                width: 100%;
                min-width: unset;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 72px 12px 12px 12px;
            }

            .bingo-section {
                padding: 12px;
            }

            .main-title {
                font-size: 1.5rem;
            }

            .bingo-grid {
                gap: 2px;
                margin-bottom: 12px;
            }

            .bingo-cell {
                aspect-ratio: auto;
                min-height: 70px;
                font-size: 0.68rem;
                padding: 5px 2px;
                line-height: 1.2;
            }

            .controls {
                gap: 8px;
            }

            .controls .btn {
                padding: 8px 12px;
                font-size: 0.75rem;
            }

            .stats {
                padding: 12px;
                gap: 12px;
            }

            .stats-item {
                font-size: 0.75rem;
            }

            .stats-item span {
                font-size: 1.2rem;
            }
        }

        /* Habits Editor Modal */
        .habits-modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.8); z-index: 2000;
            display: none; align-items: center; justify-content: center;
            padding: 20px;
        }
        .habits-modal-overlay.visible { display: flex; }
        .habits-modal {
            background: #EBE0D6; border: 1px solid rgba(123, 168, 134, 0.4);
            width: 100%; max-width: 500px; max-height: 85vh;
            overflow-y: auto; padding: 24px;
        }
        .habits-modal-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 12px;
            border-bottom: 1px solid rgba(123, 168, 134, 0.2);
        }
        .habits-modal-title { font-size: 1.1rem; color: #f2ebe0; }
        .habits-modal-close {
            background: transparent; border: none; color: #a3b899;
            font-size: 1.5rem; cursor: pointer; padding: 0; line-height: 1;
        }
        .habits-modal-close:hover { color: #f2ebe0; }
        .habits-list { margin-bottom: 20px; max-height: 400px; overflow-y: auto; }
        .habit-item {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 12px; margin-bottom: 6px;
            background: rgba(20, 20, 20, 0.4);
            border-left: 2px solid #7ba886;
        }
        .habit-item input {
            flex: 1; background: transparent; border: none;
            color: #f2ebe0; font-size: 0.9rem; font-family: inherit;
            padding: 4px 0;
        }
        .habit-item input:focus { outline: none; }
        .habit-delete {
            background: transparent; border: none;
            color: rgba(163, 184, 153, 0.5); cursor: pointer;
            font-size: 1rem; padding: 4px 8px;
        }
        .habit-delete:hover { color: #a3b899; }
        .add-habit-row {
            display: flex; gap: 8px; margin-bottom: 16px;
        }
        .add-habit-row input {
            flex: 1; background: rgba(20, 20, 20, 0.5);
            border: 1px solid rgba(123, 168, 134, 0.3); color: #f2ebe0;
            padding: 10px 12px; font-size: 0.9rem; font-family: inherit;
        }
        .add-habit-row input:focus { outline: none; border-color: rgba(123, 168, 134, 0.5); }
        .add-habit-row input::placeholder { color: rgba(242, 235, 224, 0.4); }
        .add-habit-btn {
            background: #7ba886; border: none; color: #1c1c1c;
            padding: 10px 16px; cursor: pointer; font-size: 0.9rem; font-family: inherit;
        }
        .add-habit-btn:hover { background: #a3b899; }
        .habits-modal-actions {
            display: flex; gap: 10px; justify-content: flex-end;
            padding-top: 16px; border-top: 1px solid rgba(123, 168, 134, 0.2);
        }
        .habits-save-btn {
            background: #7ba886; border: none; color: #1c1c1c;
            padding: 10px 20px; cursor: pointer; font-size: 0.85rem; font-family: inherit;
        }
        .habits-save-btn:hover { background: #a3b899; }
        .habits-cancel-btn {
            background: transparent; border: 1px solid rgba(123, 168, 134, 0.4);
            color: #a3b899; padding: 10px 20px; cursor: pointer;
            font-size: 0.85rem; font-family: inherit;
        }
        .habits-cancel-btn:hover { border-color: rgba(123, 168, 134, 0.6); }
        .habit-count { font-size: 0.75rem; color: rgba(242, 235, 224, 0.5); margin-bottom: 12px; }

        /* ===== NAV BAR ===== */
        .top-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: #2a1f21;
            border-bottom: 1px solid rgba(163, 184, 153, 0.2);
            z-index: 9999;
            padding: 0 24px;
            font-family: 'Philosopher', Georgia, serif;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
        }
        .nav-logo {
            font-size: 1.1rem;
            font-weight: 700;
            color: #a3b899;
            text-decoration: none;
            white-space: nowrap;
        }
        .nav-links {
            display: flex;
            gap: 28px;
            align-items: center;
        }
        .nav-link {
            color: rgba(242, 235, 224, 0.6);
            text-decoration: none;
            font-size: 0.88rem;
            font-weight: 500;
            white-space: nowrap;
            transition: color 0.2s;
        }
        .nav-link:hover { color: #f2ebe0; }
        .nav-link.active { color: #a3b899; }

        /* ===== HAMBURGER ===== */
        .nav-refresh {
        display: block;
        background: none;
        border: none;
        color: #b59197;
        font-size: 1.4rem;
        cursor: pointer;
        padding: 2px 0;
        z-index: 10001;
        line-height: 1;
    }
    .nav-refresh:active {
        transform: rotate(180deg);
        transition: transform 0.3s;
    }
    .nav-hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            z-index: 10001;
        }
        .nav-hamburger span {
            display: block;
            width: 24px;
            height: 2px;
            background: #a3b899;
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        .nav-hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .nav-hamburger.open span:nth-child(2) { opacity: 0; }
        .nav-hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

        .nav-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #2a1f21;
            z-index: 10000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .nav-overlay.open { display: flex; }
        .nav-link-mobile {
            color: rgba(242, 235, 224, 0.7);
            text-decoration: none;
            font-size: 1.3rem;
            font-family: 'Philosopher', Georgia, serif;
            font-weight: 500;
            padding: 18px 40px;
            transition: color 0.2s;
            display: block;
            width: 100%;
            text-align: center;
        }
        .nav-link-mobile:hover { color: #f2ebe0; }
        .nav-link-mobile.active { color: #a3b899; }

        @media (max-width: 768px) {
            .nav-hamburger { display: block; }
            .nav-links { display: none; }
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ===== NAV OVERRIDE - GOLD STANDARD ===== */
        .top-nav {
            position: fixed !important;
            top: 0 !important; left: 0 !important; right: 0 !important;
            background: #2a1f21 !important;
            border-bottom: 1px solid rgba(163, 184, 153, 0.2) !important;
            z-index: 9999 !important;
            padding: 0 24px !important;
            font-family: 'Philosopher', Georgia, serif !important;
        }
        .nav-container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            height: 56px !important;
        }
        .nav-logo {
            font-size: 1.1rem !important;
            font-weight: 700 !important;
            color: #a3b899 !important;
            text-decoration: none !important;
            white-space: nowrap !important;
        }
        .nav-links { display: flex !important; gap: 28px !important; align-items: center !important; }
        .nav-link {
            color: rgba(242, 235, 224, 0.6) !important;
            text-decoration: none !important;
            font-size: 0.88rem !important;
            font-weight: 500 !important;
            white-space: nowrap !important;
            transition: color 0.2s !important;
            letter-spacing: normal !important;
            display: inline !important;
            min-height: auto !important;
            min-width: auto !important;
        }
        .nav-link:hover { color: #f2ebe0 !important; }
        .nav-link.active { color: #a3b899 !important; }
        .nav-hamburger {
            display: none !important;
            background: none !important;
            border: none !important;
            cursor: pointer !important;
            padding: 10px !important;
            z-index: 10001 !important;
        }
        .nav-hamburger span {
            display: block !important; width: 24px !important; height: 2px !important;
            background: #a3b899 !important; margin: 5px 0 !important;
            transition: all 0.3s ease !important;
            border-radius: 0 !important;
        }
        .nav-hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px) !important; }
        .nav-hamburger.open span:nth-child(2) { opacity: 0 !important; }
        .nav-hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px) !important; }
        .nav-overlay {
            display: none !important;
            position: fixed !important;
            top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important;
            background: #2a1f21 !important;
            z-index: 10000 !important;
            flex-direction: column !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 0 !important;
            opacity: 1 !important;
        }
        .nav-overlay.open { display: flex !important; }
        .nav-link-mobile {
            color: rgba(242, 235, 224, 0.7) !important;
            text-decoration: none !important;
            font-size: 1.05rem !important;
            font-family: 'Philosopher', Georgia, serif !important;
            font-weight: 500 !important;
            padding: 12px 40px !important;
            transition: color 0.2s !important;
            display: block !important;
            width: 100% !important;
            text-align: center !important;
            letter-spacing: normal !important;
        }
        .nav-link-mobile:hover { color: #f2ebe0 !important; }
        .nav-link-mobile.active { color: #a3b899 !important; }
        @media (max-width: 768px) {
            .nav-hamburger { display: block !important; }
            .nav-links { display: none !important; }
            .nav-container { height: 56px !important; }
            .nav-logo { font-size: 1.1rem !important; }
            .top-nav { padding: 0 24px !important; }
        }
        @media (max-width: 480px) {
            .nav-container { height: 56px !important; }
            .nav-logo { font-size: 1.1rem !important; }
            .top-nav { padding: 0 24px !important; }
        }
        /* ===== END NAV OVERRIDE ===== */
        /* ===== MOBILE OPTIMIZATION ===== */
        html, body {
            overflow-x: hidden !important;
            max-width: 100vw !important;
        }
        /* Prevent iOS auto-zoom on input focus */
        @media screen and (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
        /* ===== END MOBILE OPTIMIZATION ===== */
    /* ===== WELLNESS SCHEDULE CSS ===== */
    .schedule-section { padding: 0 4px; }
    .schedule-item {
        display: flex;
        gap: 12px;
        padding: 10px 0;
        border-bottom: 1px solid rgba(181, 145, 151, 0.15);
    }
    .schedule-time {
        min-width: 75px;
        font-size: 0.78rem;
        color: #b59197;
        font-weight: 600;
        padding-top: 2px;
    }
    .schedule-content { flex: 1; }
    .schedule-title {
        font-weight: 600;
        font-size: 0.9rem;
        color: #4a3b3e;
        margin-bottom: 4px;
    }
    .schedule-details {
        font-size: 0.82rem;
        color: #6b5a5e;
        line-height: 1.55;
    }
    .schedule-details strong { color: #4a3b3e; }
    .schedule-details em { color: #9a7a80; }

    .day-card {
        background: #f5ede6;
        border: 1px solid rgba(181,145,151,0.2);
        margin-bottom: 8px;
        overflow: hidden;
        width: 100%;
    }
    .day-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 14px 16px;
        cursor: pointer;
        user-select: none;
    }
    .day-header:hover { background: rgba(181,145,151,0.05); }
    .day-name { font-weight: 700; font-size: 0.92rem; color: #4a3b3e; }
    .day-preview { font-size: 0.78rem; color: #9a7a80; margin-top: 2px; }
    .arrow { font-size: 0.7rem; color: #b59197; transition: transform 0.2s; }
    .day-card.expanded .arrow { transform: rotate(180deg); }
    .day-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        padding: 0 16px;
    }
    .day-card.expanded .day-details {
        max-height: 3000px;
        padding: 0 16px 16px;
    }

    .day-nav-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin: 12px 0;
    }
    .day-nav-btn {
        background: none;
        border: 1px solid rgba(181,145,151,0.3);
        color: #b59197;
        font-size: 1.1rem;
        cursor: pointer;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    #currentDayDisplay {
        font-size: 0.95rem;
        font-weight: 600;
        color: #4a3b3e;
        min-width: 200px;
        text-align: center;
    }

    /* ===== ROUTINE EDITOR ===== */
    .routine-editor-overlay { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:10001; overflow-y:auto; }
    .routine-editor-overlay.active { display:block; }
    .routine-editor { background:#f5ede6; max-width:600px; margin:20px auto; border:2px solid #b59197; }
    .routine-editor-header { display:flex; justify-content:space-between; align-items:center; padding:14px 18px; border-bottom:1px solid rgba(181,145,151,0.3); }
    .routine-editor-header h2 { margin:0; font-size:1.1rem; color:#4a3b3e; }
    .routine-editor-close { background:none; border:none; font-size:1.6rem; color:#b59197; cursor:pointer; line-height:1; }
    .routine-editor-body { padding:14px 18px; max-height:65vh; overflow-y:auto; }
    .routine-block-label { font-weight:700; color:#b59197; font-size:0.85rem; text-transform:uppercase; letter-spacing:0.05em; margin:14px 0 8px; border-bottom:1px solid rgba(181,145,151,0.2); padding-bottom:4px; }
    .routine-block-label:first-child { margin-top:0; }
    .routine-item-edit { background:#fff; padding:10px 12px; margin-bottom:6px; border:1px solid rgba(181,145,151,0.15); }
    .routine-edit-row { display:flex; gap:6px; margin-bottom:4px; }
    .routine-edit-row input { padding:5px 8px; border:1px solid #ddd; font-family:inherit; font-size:0.82rem; background:#fff; color:#4a3b3e; }
    .routine-edit-row .re-time { width:90px; flex:none; }
    .routine-edit-row .re-title { flex:1; min-width:0; }
    .routine-edit-details { width:100%; padding:5px 8px; border:1px solid #ddd; font-family:inherit; font-size:0.8rem; min-height:32px; resize:vertical; color:#6b5a5e; background:#fff; box-sizing:border-box; }
    .routine-edit-details:disabled { background:#f0ebe6; color:#aaa; font-style:italic; }
    .routine-edit-actions { display:flex; gap:4px; margin-top:4px; }
    .routine-edit-actions button { background:none; border:1px solid #ddd; padding:2px 8px; font-size:0.72rem; cursor:pointer; font-family:inherit; color:#888; }
    .routine-edit-actions button:hover { border-color:#b59197; color:#b59197; }
    .routine-edit-actions .re-del:hover { border-color:#c97a7a; color:#c97a7a; }
    .routine-add-item { background:none; border:1px dashed rgba(181,145,151,0.4); color:#b59197; padding:6px; width:100%; cursor:pointer; font-family:inherit; font-size:0.82rem; margin-bottom:10px; }
    .routine-add-item:hover { border-color:#b59197; background:rgba(181,145,151,0.05); }
    .routine-editor-footer { display:flex; justify-content:flex-end; gap:8px; padding:12px 18px; border-top:1px solid rgba(181,145,151,0.2); }
    .routine-editor-footer button { padding:8px 20px; font-family:inherit; font-size:0.85rem; cursor:pointer; border:none; }
    .routine-editor-footer .re-cancel { background:#ddd; color:#666; }
    .routine-editor-footer .re-save { background:#a3b899; color:#1c1c1c; font-weight:600; }

    /* ===== VIDEO GRID CSS ===== */
    .video-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 3px;
    }
    .video-thumb {
        aspect-ratio: 1;
        background: #3d2f31;
        position: relative;
        cursor: pointer;
        overflow: hidden;
    }
    .video-thumb video,
    .video-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
    .video-thumb-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 20px 6px 6px;
        background: linear-gradient(transparent, rgba(0,0,0,0.6));
        color: #f5ede6;
        font-size: 0.7rem;
        font-weight: 500;
    }
    .video-thumb-play {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 36px;
        height: 36px;
        background: rgba(0,0,0,0.4);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .video-thumb-play::after {
        content: '';
        display: block;
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 7px 0 7px 12px;
        border-color: transparent transparent transparent rgba(255,255,255,0.85);
        margin-left: 2px;
    }
    .video-link-thumb {
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #3d2f31;
    }
    .video-link-icon {
        font-size: 1.8rem;
        color: rgba(181,145,151,0.6);
        margin-bottom: 4px;
    }
    .video-link-label {
        color: rgba(181,145,151,0.8);
        font-size: 0.65rem;
    }
    .video-detail-modal {
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.95);
        z-index: 10000;
        flex-direction: column;
    }
    .video-detail-modal.active { display: flex; }
    .video-detail-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 16px;
        background: rgba(60,47,49,0.9);
    }
    .video-detail-title {
        color: #f5ede6;
        font-size: 0.95rem;
        font-weight: 600;
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .video-detail-close {
        color: #b59197;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 4px 8px;
        background: none;
        border: none;
    }
    .video-detail-body {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 8px;
        overflow: hidden;
    }
    .video-detail-body video {
        max-width: 100%;
        max-height: 100%;
    }
    .video-detail-footer {
        padding: 12px 16px;
        background: rgba(60,47,49,0.9);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .video-detail-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    .video-detail-tags .video-tag {
        background: rgba(181,145,151,0.2);
        color: #d4a5a5;
        padding: 3px 10px;
        font-size: 0.75rem;
    }
    .video-detail-delete {
        background: none;
        border: 1px solid rgba(201,122,122,0.4);
        color: #c97a7a;
        padding: 6px 14px;
        font-size: 0.8rem;
        cursor: pointer;
    }

    /* ===== JOURNAL CSS ===== */
    .journal-locked {
        background: #3c2f31;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        margin: -20px -20px 0;
        padding: 40px 20px;
    }
    .journal-password-box {
        background: #f5ede6;
        padding: 40px 30px;
        max-width: 320px;
        width: 90%;
        text-align: center;
    }
    .journal-password-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: #4a3b3e;
        margin-bottom: 6px;
    }
    .journal-password-subtitle {
        font-size: 0.85rem;
        color: #a3b899;
        margin-bottom: 20px;
    }
    .journal-password-input {
        width: 100%;
        padding: 12px;
        border: 1px solid rgba(163,184,153,0.3);
        background: #fff;
        font-size: 1rem;
        text-align: center;
        margin-bottom: 12px;
        box-sizing: border-box;
    }
    .journal-password-input:focus {
        outline: none;
        border-color: #a3b899;
    }
    .journal-unlock-btn {
        width: 100%;
        padding: 12px;
        background: #a3b899;
        color: #fff;
        border: none;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        font-family: inherit;
    }
    .journal-unlock-btn:hover { background: #8fa882; }
    .journal-error { color: #c97a7a; font-size: 0.85rem; margin-top: 8px; display: none; }
    .journal-error.show { display: block; }

    .journal-content { padding: 4px 0; }
    .journal-empty { color: #a3b899; text-align: center; font-size: 0.9rem; padding: 20px; }
    .journal-entry {
        background: #f5ede6;
        border: 1px solid rgba(163,184,153,0.15);
        padding: 16px;
        margin-bottom: 8px;
    }
    .journal-entry-date {
        font-size: 0.78rem;
        color: #a3b899;
        font-weight: 600;
        margin-bottom: 6px;
    }
    .journal-entry-text {
        font-size: 0.88rem;
        color: #4a3b3e;
        line-height: 1.6;
        white-space: pre-wrap;
    }
    .journal-entry-actions {
        display: flex;
        justify-content: flex-end;
        margin-top: 8px;
    }

    /* ===== FUTURE TODOS ===== */
    .future-todos-section {
        margin-top: 20px;
        border-top: 2px solid rgba(123,168,134,0.2);
        padding-top: 16px;
    }
    .future-todos-header {
        font-size: 1rem;
        font-weight: 700;
        color: #7ba886;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 4px;
    }
    .future-todos-subtitle {
        font-size: 0.78rem;
        color: #9a7a80;
        font-style: italic;
        margin-bottom: 12px;
    }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Philosopher:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
</head>

<script>
 window.firebaseReady = false;
 window.firebaseError = null;
</script>

<script type="module">
 import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
 import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
 import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

 try {
 const firebaseConfig = {
 apiKey: "AIzaSyCDda9sPwSY-RQ5rrM5THOvcLtHvcPRYd4",
 authDomain: "our-habit-hub.firebaseapp.com",
 projectId: "our-habit-hub",
 storageBucket: "our-habit-hub.firebasestorage.app",
 messagingSenderId: "78555830496",
 appId: "1:78555830496:web:3e457e54729cc11b825885"
 };

 const app = initializeApp(firebaseConfig);
 const db = getFirestore(app);
 const storage = getStorage(app);

 window.db = db;
 window.firebaseStorage = storage;
 window.firebaseStorageImports = { ref, uploadBytes, getDownloadURL, deleteObject };
 window.firestoreImports = { collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot };
 window.firebaseReady = true;
 window.dispatchEvent(new Event('firebaseReady'));
 } catch (error) {
 window.firebaseReady = false;
 window.firebaseError = error.message;
 }
</script>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">Our Life Hub</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="kasey-hub.html" class="nav-link">Kasey</a>
                <a href="charlie-hub.html" class="nav-link active">Charlie</a>
                <a href="our-dreams.html" class="nav-link">Us ♡</a>
                <a href="meal-plan.html" class="nav-link">Meals</a>
                <a href="settings.html" class="nav-link">Settings</a>
            </div>
            <div style="display:flex;align-items:center;gap:2px;"><button class="nav-refresh" onclick="location.reload(true)" aria-label="Refresh" title="Refresh page">↻</button>
            <button class="nav-hamburger" id="navHamburger" onclick="toggleNav()" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button></div>
        </div>
    </nav>
    <div class="nav-overlay" id="navOverlay" onclick="toggleNav()">
        <a href="index.html" class="nav-link-mobile">Home</a>
        <a href="kasey-hub.html" class="nav-link-mobile">Kasey</a>
        <a href="charlie-hub.html" class="nav-link-mobile active">Charlie</a>
        <a href="our-dreams.html" class="nav-link-mobile">Us ♡</a>
        <a href="meal-plan.html" class="nav-link-mobile">Meals</a>
        <a href="settings.html" class="nav-link-mobile">Settings</a>
    </div>
    <div class="container">
        
        <div class="section-nav">
            <select id="sectionDropdown" onchange="switchTabFromDropdown()" class="section-dropdown">
                <option value="bingo">Habits & Wellness</option>
                <option value="resources">Resources</option>
                <option value="videos">Video Hub</option>
                <option value="todos">To-Do List</option>
                <option value="journal">Journal</option>
                <option value="prompt">Daily Prompt</option>
            </select>
        </div>

        <!-- BINGO & WELLNESS TAB -->
        <div id="bingo-tab" class="hub-tab active">
            <!-- Wellness Schedule -->
            <div class="bingo-section">
                <div class="main-title" style="font-size:1.4rem;">CHARLIE'S WELLNESS ROUTINE</div>
                <div class="day-nav-row">
                    <button class="day-nav-btn" onclick="changeDay(-1)">&#9664;</button>
                    <div id="currentDayDisplay"></div>
                    <button class="day-nav-btn" onclick="changeDay(1)">&#9654;</button>
                </div>
                <div id="dailyScheduleContainer"></div>
                <div style="text-align:center;"><button class="btn" onclick="openRoutineEditor()" style="margin-top:16px;padding:8px 20px;">Edit Routine</button></div>
            </div>

            <!-- Bingo Card -->
            <div class="bingo-section" style="margin-top: 24px;">
                <div class="main-title">DAILY HABITS BINGO</div>
                <p class="subtitle">Click squares to mark complete &bull; Get 4 in a row to win</p>
                <div class="date-display" id="dateDisplay"></div>
                
                <div class="bingo-grid" id="bingoGrid"></div>
                
                <div class="controls">
                    <button class="btn" onclick="resetBoard()">Reset Today</button>
                    <button class="btn" onclick="shuffleBoard()">Shuffle Habits</button>
                    <button class="btn" onclick="openHabitsEditor()">Edit Habits</button>
                </div>

                <div class="stats">
                    <div class="stats-item">
                        <span id="completedCount">0</span>
                        Complete
                    </div>
                    <div class="stats-item">
                        <span id="bingoCount">0</span>
                        Bingos
                    </div>
                </div>
            </div>
        </div>

        <!-- RESOURCES TAB -->
        <div id="resources-tab" class="hub-tab">
            <div class="section">
                <h2 class="section-title">Habit Resources</h2>
                
                <div class="event-form" id="resourceForm">
                    <form onsubmit="addResource(event)">
                        <input type="hidden" id="resourceCategory" name="category">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Upload Image/Video (optional)</label>
                            <input type="file" name="file" accept="image/*,video/*" id="resourceFile" onchange="handleResourceUpload()">
                            <div style="text-align: center; color: #7a6668; margin: 8px 0; font-size: 0.85rem;">&mdash; OR &mdash;</div>
                        </div>
                        <div class="form-group">
                            <label>Link (optional)</label>
                            <input type="url" name="link" id="resourceLink">
                        </div>
                        <div class="form-group">
                            <label>Notes (optional)</label>
                            <textarea name="note" rows="3"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideAddResourceForm()">Cancel</button>
                            <button type="submit" class="btn">Save Resource</button>
                        </div>
                    </form>
                </div>
                
                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'meditate')">
                        <span class="resource-name">Meditate</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="meditate-content">
                        <div id="meditate-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('meditate')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'exercise')">
                        <span class="resource-name">Exercise</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="exercise-content">
                        <div id="exercise-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('exercise')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'meals')">
                        <span class="resource-name">Healthy Meals</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="meals-content">
                        <div id="meals-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('meals')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'journal')">
                        <span class="resource-name">Journal</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="journal-content">
                        <div id="journal-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('journal')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'read')">
                        <span class="resource-name">Read</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="read-content">
                        <div id="read-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('read')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'walk')">
                        <span class="resource-name">Walk / Podcasts</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="walk-content">
                        <div id="walk-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('walk')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'guitar')">
                        <span class="resource-name">Guitar</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="guitar-content">
                        <div id="guitar-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('guitar')">+ Add Resource</button>
                    </div>
                </div>

                <div class="resource-category">
                    <div class="resource-header" onclick="toggleResource(event, 'learn')">
                        <span class="resource-name">Learn Something New</span>
                        <span class="resource-arrow">&#9660;</span>
                    </div>
                    <div class="resource-content" id="learn-content">
                        <div id="learn-items"></div>
                        <button class="add-resource-btn" onclick="showAddResourceForm('learn')">+ Add Resource</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIDEOS TAB -->
        <div id="videos-tab" class="hub-tab">
            <div class="section">
                <div style="display:flex;align-items:baseline;gap:12px;margin-bottom:8px;">
                    <h2 class="section-title" style="margin:0;">VIDEO HUB</h2>
                    <span id="videoCount" style="font-size:0.8rem;color:#9a7a80;"></span>
                </div>
                <button class="add-event-btn" onclick="toggleVideoForm()" style="margin-bottom:12px;">+ Add</button>
                
                <div class="event-form" id="videoForm">
                    <form onsubmit="addVideo(event); return false;">
                        <div class="form-group">
                            <label>Video Title</label>
                            <input type="text" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Upload Video from Phone</label>
                            <input type="file" name="video" accept="video/*" id="videoFile" onchange="handleVideoUpload()">
                            <div id="videoUploadStatus" style="margin-top: 6px; font-size: 0.82rem; color: #7ba886; display: none;"></div>
                            <div style="text-align: center; color: #7a6668; margin: 8px 0; font-size: 0.85rem;">&mdash; OR &mdash;</div>
                        </div>
                        <div class="form-group">
                            <label>Video Link (TikTok, YouTube, etc)</label>
                            <input type="url" name="link" id="videoLink">
                        </div>
                        <div class="form-group">
                            <label>Tags (comma separated)</label>
                            <input type="text" name="tags" placeholder="motivation, exercise, meditation">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="toggleVideoForm()">Cancel</button>
                            <button type="submit" class="btn" id="videoSaveBtn">Save Video</button>
                        </div>
                    </form>
                </div>

                <div id="videosList" class="video-grid">
                    <div class="empty-state" style="grid-column:1/-1;">No videos yet. Add your first motivational video!</div>
                </div>
            </div>
        </div>

        <!-- TO-DO LIST TAB -->
        <div id="todos-tab" class="hub-tab">
            <div class="section">
                <h2 class="section-title">To-Do List</h2>
                <button class="add-event-btn" onclick="toggleTodoForm()">Add To-Do</button>
                
                <div class="event-form" id="todoForm">
                    <form onsubmit="addTodo(event)">
                        <div class="form-group">
                            <label>To-Do Item</label>
                            <input type="text" name="todo" required placeholder="What needs to be done?">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="toggleTodoForm()">Cancel</button>
                            <button type="submit" class="btn">Add To-Do</button>
                        </div>
                    </form>
                </div>

                <div id="todosList" style="margin-top: 20px;">
                    <div class="empty-state">No to-dos yet. Add your first task!</div>
                </div>

                <!-- Future To-Dos -->
                <div class="future-todos-section">
                    <div class="future-todos-header">Future To-Dos</div>
                    <div class="future-todos-subtitle">Things to get to when the time is right</div>
                    <div style="display:flex;gap:8px;margin-bottom:12px;">
                        <input type="text" id="futureTodoInput" placeholder="Add a future to-do..." style="flex:1;padding:8px 12px;border:1px solid rgba(123,168,134,0.3);background:#fff;font-family:inherit;" onkeydown="if(event.key==='Enter')addFutureTodo()">
                        <button class="btn" onclick="addFutureTodo()" style="border-color:#7ba886;color:#7ba886;">Add</button>
                    </div>
                    <div id="futureTodosList"></div>
                </div>
            </div>
        </div>

        <!-- PROMPT TAB -->
        <!-- JOURNAL TAB -->
        <div id="journal-tab" class="hub-tab">
            <div id="journalLocked" class="journal-locked" style="display:none;">
                <div class="journal-password-box">
                    <div class="journal-password-title">Charlie's Journal</div>
                    <div class="journal-password-subtitle">Enter your password to unlock</div>
                    <input type="password" id="journalPasswordInput" class="journal-password-input" placeholder="Password" onkeydown="if(event.key==='Enter') unlockJournal()">
                    <button class="journal-unlock-btn" onclick="unlockJournal()">Unlock</button>
                    <div id="journalError" class="journal-error">Incorrect password</div>
                </div>
            </div>
            <div id="journalContent" class="journal-content" style="display:none;">
                <div id="journalDate" style="font-family:'Dancing Script',cursive;font-size:1.2rem;color:#a3b899;margin-bottom:12px;text-align:center;"></div>
                <div id="journalPrompt" style="background:#f5ede6;border-left:3px solid #a3b899;padding:12px 16px;margin-bottom:16px;font-size:0.9rem;color:#4a3b3e;line-height:1.5;font-style:italic;"></div>
                <div style="margin-bottom: 12px;">
                    <textarea id="journalTextarea" placeholder="Write what's on your mind..." style="width:100%;min-height:100px;padding:12px;border:1px solid rgba(163,184,153,0.3);background:#fff;font-family:inherit;font-size:0.9rem;box-sizing:border-box;resize:vertical;"></textarea>
                    <button class="btn" onclick="saveJournalEntry()" style="margin-top:6px;padding:8px 20px;">Save Entry</button>
                </div>
                <div id="journalEntries"></div>
            </div>
        </div>

        <div id="prompt-tab" class="hub-tab">
            <div class="section">
                <h2 class="section-title">Today's Prompt</h2>
                
                <div class="prompt-question">
                    <div class="prompt-label">Question of the Day</div>
                    <div class="prompt-text" id="promptQuestionHub"></div>
                </div>

                <div class="event-form active">
                    <form onsubmit="saveAnswer(event)">
                        <div class="form-group">
                            <label id="answerLabel">Your Answer</label>
                            <textarea name="answer" rows="6" required id="answerInput"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn">Save Answer</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Routine Editor Modal -->
    <div class="routine-editor-overlay" id="routineEditorOverlay" onclick="if(event.target===this)closeRoutineEditor()">
        <div class="routine-editor">
            <div class="routine-editor-header">
                <h2>Edit Routine</h2>
                <button class="routine-editor-close" onclick="closeRoutineEditor()">&times;</button>
            </div>
            <div class="routine-editor-body" id="routineEditorBody"></div>
            <div class="routine-editor-footer">
                <button class="re-cancel" onclick="resetRoutineToDefaults()" style="margin-right:auto;font-size:0.78rem;padding:6px 12px;">Reset Defaults</button>
                <button class="re-cancel" onclick="closeRoutineEditor()">Cancel</button>
                <button class="re-save" onclick="saveRoutineEdits()">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <h2>BINGO!</h2>
        <p>Amazing work! You got 4 in a row!</p>
        <button class="btn" onclick="closeCelebration()">Continue</button>
    </div>

    <!-- Habits Editor Modal -->
    <div class="habits-modal-overlay" id="habitsModalOverlay" onclick="closeHabitsEditor(event)">
        <div class="habits-modal" onclick="event.stopPropagation()">
            <div class="habits-modal-header">
                <div class="habits-modal-title">Edit My Habits</div>
                <button class="habits-modal-close" onclick="closeHabitsEditor()">&times;</button>
            </div>
            <div class="habit-count" id="habitCount">20 habits (16 shown on bingo card)</div>
            <div class="habits-list" id="habitsList"></div>
            <div class="add-habit-row">
                <input type="text" id="newHabitInput" placeholder="Add new habit..." onkeypress="if(event.key==='Enter') addNewHabit()">
                <button class="add-habit-btn" onclick="addNewHabit()">+</button>
            </div>
            <div class="habits-modal-actions">
                <button class="habits-cancel-btn" onclick="closeHabitsEditor()">Cancel</button>
                <button class="habits-save-btn" onclick="saveHabitsChanges()">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        const defaultCharlieHabits = [
            "Exercise 30+ Minutes",
            "Eat a Healthy Meal",
            "Read 10+ Pages",
            "Meditate",
            "Sleep 7+ Hours",
            "Journal",
            "Walk 10k Steps",
            "Vibration Plate",
            "Learn Something New",
            "Practice Gratitude",
            "Acupuncture Mat",
            "Tidy Living Space",
            "30 Mins of Guitar",
            "EFT Tapping",
            "Time in Nature",
            "Acts of Kindness"
        ];

        let charlieHabits = [...defaultCharlieHabits];
        let editingHabits = [];

        // Load custom habits from localStorage
        function loadCustomHabits() {
            const saved = localStorage.getItem('charlieCustomHabits');
            if (saved) {
                const parsed = JSON.parse(saved);
                if (parsed && parsed.length >= 16) {
                    charlieHabits = parsed;
                }
            }
            loadFromFirebase('charlieCustomHabits').then(firebaseData => {
                if (firebaseData && firebaseData.length >= 16) {
                    charlieHabits = firebaseData;
                    localStorage.setItem('charlieCustomHabits', JSON.stringify(charlieHabits));
                } else if (saved) {
                    syncToFirebase('charlieCustomHabits', charlieHabits);
                }
            });
        }

        // Habits Editor Functions
        function openHabitsEditor() {
            editingHabits = [...charlieHabits];
            renderHabitsList();
            document.getElementById('habitsModalOverlay').classList.add('visible');
        }

        function closeHabitsEditor(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('habitsModalOverlay').classList.remove('visible');
        }

        function renderHabitsList() {
            const list = document.getElementById('habitsList');
            document.getElementById('habitCount').textContent = `${editingHabits.length} habits (16 shown on bingo card)`;
            
            list.innerHTML = editingHabits.map((habit, index) => `
                <div class="habit-item">
                    <input type="text" value="${habit}" onchange="updateHabit(${index}, this.value)">
                    <button class="habit-delete" onclick="deleteHabit(${index})">×</button>
                </div>
            `).join('');
        }

        function updateHabit(index, value) {
            editingHabits[index] = value.trim();
        }

        function deleteHabit(index) {
            if (editingHabits.length <= 16) {
                alert('You need at least 16 habits for the bingo card!');
                return;
            }
            editingHabits.splice(index, 1);
            renderHabitsList();
        }

        function addNewHabit() {
            const input = document.getElementById('newHabitInput');
            const value = input.value.trim();
            if (!value) return;
            
            editingHabits.push(value);
            input.value = '';
            renderHabitsList();
        }

        function saveHabitsChanges() {
            editingHabits = editingHabits.filter(h => h.trim() !== '');
            
            if (editingHabits.length < 16) {
                alert('You need at least 16 habits for the bingo card!');
                return;
            }
            
            charlieHabits = [...editingHabits];
            localStorage.setItem('charlieCustomHabits', JSON.stringify(charlieHabits));
            syncToFirebase('charlieCustomHabits', charlieHabits);
            shuffleBoard();
            closeHabitsEditor();
        }

        const dailyPrompts = [
            "What's one thing I did today that made you smile?",
            "What's your favorite memory of us from this past month?",
            "What's one way I can support you better this week?",
            "What's something you're grateful for about our relationship?",
            "What's a goal you have for us as a couple?",
            "What's one thing you admire about me?",
            "What's your favorite thing we do together?",
            "What's something new you'd like to try together?",
            "What's a challenge we've overcome together that you're proud of?",
            "What makes you feel most loved by me?",
            "What's something you've learned about yourself through our relationship?",
            "What's a small gesture I do that means a lot to you?",
            "What's your favorite quality about our relationship?",
            "What's something you're excited about for our future?",
            "What's one way we've grown together recently?",
            "What's a tradition you'd like to start with us?",
            "What's something I do that makes you laugh?",
            "What's your favorite way to spend quality time together?",
            "What's something you want to accomplish together this year?",
            "What's one thing about our relationship that makes you feel secure?",
            "What's a moment when you felt really connected to me?",
            "What's something you appreciate about how we handle disagreements?",
            "What's your favorite inside joke or moment between us?",
            "What's one way our relationship has changed you for the better?",
            "What's something you'd like more of in our relationship?",
            "What's a compliment you wish you heard more often?",
            "What's your favorite physical gesture of affection from me?",
            "What's something I do that helps you feel understood?",
            "What's a dream you have for us that we haven't talked about yet?",
            "What's one thing that always brightens your day when I do it?"
        ];

        const defaultResources = {
            meditate: [
                { title: 'Insight Timer', link: 'https://insighttimer.com', note: 'Free guided meditations. Huge library.' },
                { title: 'Headspace', link: 'https://www.headspace.com', note: '10-min daily meditations. Great for beginners.' }
            ],
            exercise: [
                { title: 'Yoga with Adriene', link: 'https://www.youtube.com/@yogawithadriene', note: '30-day programs, all levels.' },
                { title: 'Rebounder Workouts', link: 'https://www.youtube.com/results?search_query=rebounder+workout', note: 'Low impact cardio, fun!' }
            ],
            meals: [
                { title: 'Budget Bytes', link: 'https://www.budgetbytes.com', note: 'Easy, affordable, healthy recipes.' }
            ],
            journal: [
                { title: 'Morning brain dump', link: null, note: 'Write 3 pages of whatever comes to mind. No filtering.' },
                { title: 'What I\'m proud of', link: null, note: 'List 3 things from today you handled well.' }
            ],
            read: [
                { title: 'Atomic Habits by James Clear', link: null, note: 'THE book for building habits.' },
                { title: 'The Mountain Is You by Brianna Wiest', link: null, note: 'About self-sabotage and growth.' }
            ],
            walk: [
                { title: 'Unlocking Us - Bren&eacute; Brown', link: null, note: 'Podcast about vulnerability and courage.' }
            ],
            guitar: [
                { title: 'JustinGuitar', link: 'https://www.justinguitar.com', note: 'Free structured course. Start here.' },
                { title: 'Marty Music', link: 'https://www.youtube.com/@MartyMusic', note: 'Learn popular songs easily.' }
            ],
            learn: [
                { title: 'Coursera', link: 'https://www.coursera.org', note: 'Free university courses. Audit for free.' },
                { title: 'YouTube - Crash Course', link: 'https://www.youtube.com/@crashcourse', note: 'Fun 10-15 min lessons on everything.' }
            ]
        };

        let boardState = [];
        let currentHabits = [];
        let videos = [];
        let resources = {};
        let todos = [];
        let pendingResourceFile = null;
        let pendingVideoFile = null;

        // Storage functions (localStorage + Firebase sync)
        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
            syncToFirebase(key, data);
        }

        function loadData(key) {
            const saved = localStorage.getItem(key);
            return saved ? JSON.parse(saved) : null;
        }

        async function syncToFirebase(collectionName, data) {
            if (!window.firebaseReady) {
                await Promise.race([
                    new Promise(resolve => {
                        if (window.firebaseReady) resolve();
                        else window.addEventListener('firebaseReady', resolve, { once: true });
                    }),
                    new Promise(resolve => setTimeout(resolve, 5000))
                ]);
            }
            if (!window.firebaseReady || !window.db) return;
            try {
                const { setDoc, doc } = window.firestoreImports;
                await setDoc(doc(window.db, collectionName, 'data'), { items: data });
            } catch (error) {}
        }

        async function loadFromFirebase(collectionName) {
            if (!window.firebaseReady) {
                await Promise.race([
                    new Promise(resolve => {
                        if (window.firebaseReady) resolve();
                        else window.addEventListener('firebaseReady', resolve, { once: true });
                    }),
                    new Promise(resolve => setTimeout(resolve, 5000))
                ]);
            }
            if (!window.firebaseReady || !window.db) return null;
            try {
                const { getDoc, doc } = window.firestoreImports;
                const docSnap = await getDoc(doc(window.db, collectionName, 'data'));
                if (docSnap.exists()) return docSnap.data().items;
                return null;
            } catch (error) { return null; }
        }

        async function setupFirebaseListener(collectionName, callback) {
            if (!window.firebaseReady) {
                await Promise.race([
                    new Promise(resolve => {
                        if (window.firebaseReady) resolve();
                        else window.addEventListener('firebaseReady', resolve, { once: true });
                    }),
                    new Promise(resolve => setTimeout(resolve, 5000))
                ]);
            }
            if (!window.firebaseReady || !window.db) return;
            try {
                const { onSnapshot, doc } = window.firestoreImports;
                onSnapshot(doc(window.db, collectionName, 'data'), (d) => {
                    if (d.exists()) callback(d.data().items);
                });
            } catch (error) {}
        }

        // Firebase Storage (Cloud file uploads)
        async function uploadToFirebaseStorage(blob, path) {
            if (!window.firebaseReady || !window.firebaseStorage) return null;
            try {
                const { ref, uploadBytes, getDownloadURL } = window.firebaseStorageImports;
                const storageRef = ref(window.firebaseStorage, path);
                await uploadBytes(storageRef, blob);
                return await getDownloadURL(storageRef);
            } catch (error) { return null; }
        }

        async function deleteFromFirebaseStorage(path) {
            if (!window.firebaseReady || !window.firebaseStorage) return;
            try {
                const { ref, deleteObject } = window.firebaseStorageImports;
                await deleteObject(ref(window.firebaseStorage, path));
            } catch (error) {}
        }

        function switchTabFromDropdown() {
            const dropdown = document.getElementById('sectionDropdown');
            const tab = dropdown.value;
            
            document.querySelectorAll('.hub-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');
            localStorage.setItem('charlieHub_activeTab', tab);

            // Hide journal lock screen when not on journal tab
            if (tab !== 'journal') {
                document.getElementById('journalLocked').style.display = 'none';
                document.getElementById('journalContent').style.display = 'none';
            }

            if (tab === 'prompt') loadHubPrompt();
            else if (tab === 'resources') renderAllResources();
            else if (tab === 'todos') { renderTodos(); renderFutureTodos(); }
            else if (tab === 'bingo') renderDailySchedule();
            else if (tab === 'journal') {
                document.getElementById('journalLocked').style.display = 'flex';
                document.getElementById('journalContent').style.display = 'none';
            }
            else if (tab === 'videos') renderVideos();
        }

        async function initBoard() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('bingoDate_charlie');
            const boardVersion = localStorage.getItem('bingoVersion_charlie');
            
            // Force reset if switching from 5x5 to 4x4 OR if we detect wrong number of habits
            if (boardVersion !== '4x4') {
                localStorage.removeItem('bingoState_charlie');
                localStorage.setItem('bingoVersion_charlie', '4x4');
                localStorage.setItem('bingoDate_charlie', today);
                shuffleBoard();
            } else if (savedDate !== today) {
                localStorage.removeItem('bingoState_charlie');
                localStorage.setItem('bingoDate_charlie', today);
                shuffleBoard();
            } else {
                const saved = localStorage.getItem('bingoState_charlie');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.habits && data.habits.length === 16) {
                        currentHabits = data.habits;
                        boardState = data.state;
                    } else {
                        shuffleBoard();
                    }
                } else {
                    shuffleBoard();
                }
            }
            
            // Final safety check - if we somehow still don't have 16 habits, shuffle
            if (!currentHabits || currentHabits.length !== 16) {
                shuffleBoard();
            }
            
            updateDateDisplay();
            renderBoard();
            updateStats();
        }

        function updateDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('dateDisplay').textContent = new Date().toLocaleDateString('en-US', options);
        }

        async function shuffleBoard() {
            // Save which habits are currently completed
            const completedHabits = new Set();
            currentHabits.forEach((habit, index) => {
                if (boardState[index]) {
                    completedHabits.add(habit);
                }
            });

            // Shuffle and get new habits
            const shuffled = [...charlieHabits].sort(() => Math.random() - 0.5).slice(0, 16);
            currentHabits = shuffled;
            
            // Restore completed state for habits that are still on the board
            boardState = new Array(16).fill(false);
            currentHabits.forEach((habit, index) => {
                if (completedHabits.has(habit)) {
                    boardState[index] = true;
                }
            });

            await saveState();
            renderBoard();
            updateStats();
        }

        function renderBoard() {
            const grid = document.getElementById('bingoGrid');
            grid.innerHTML = '';
            
            currentHabits.forEach((habit, index) => {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                cell.textContent = habit;
                
                if (boardState[index]) cell.classList.add('completed');
                cell.onclick = () => toggleCell(index);
                
                grid.appendChild(cell);
            });
        }

        async function toggleCell(index) {
            boardState[index] = !boardState[index];
            await saveState();
            renderBoard();
            updateStats();
            checkBingo();
        }

        async function resetBoard() {
            boardState = new Array(16).fill(false);
            await saveState();
            renderBoard();
            updateStats();
        }

        async function saveState() {
            const data = {
                habits: currentHabits,
                state: boardState
            };
            localStorage.setItem('bingoState_charlie', JSON.stringify(data));
            syncToFirebase('bingoState_charlie', data);
        }

        function updateStats() {
            const completed = boardState.filter(Boolean).length;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('bingoCount').textContent = countBingos();
        }

        function countBingos() {
            let count = 0;
            // Check rows (4 rows)
            for (let i = 0; i < 4; i++) {
                if (boardState.slice(i * 4, i * 4 + 4).every(Boolean)) count++;
            }
            // Check columns (4 columns)
            for (let i = 0; i < 4; i++) {
                if ([0, 1, 2, 3].every(j => boardState[i + j * 4])) count++;
            }
            // Check diagonals
            if ([0, 5, 10, 15].every(i => boardState[i])) count++; // Top-left to bottom-right
            if ([3, 6, 9, 12].every(i => boardState[i])) count++; // Top-right to bottom-left
            return count;
        }

        function checkBingo() {
            const prevCount = parseInt(localStorage.getItem('prevBingoCount_charlie') || '0');
            const currentCount = countBingos();
            if (currentCount > prevCount) showCelebration();
            localStorage.setItem('prevBingoCount_charlie', currentCount);
        }

        function showCelebration() {
            document.getElementById('celebration').classList.add('show');
            createConfetti();
        }

        function closeCelebration() {
            document.getElementById('celebration').classList.remove('show');
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffd93d', '#a8e6cf', '#ff8b94', '#c7ceea', '#b4f8c8', '#ffa07a', '#98d8c8'];
            for (let i = 0; i < 100; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    const size = Math.random() * 8 + 6;
                    confetti.style.width = size + 'px';
                    confetti.style.height = size + 'px';
                    const duration = Math.random() * 2 + 2;
                    confetti.style.animationDuration = duration + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), duration * 1000);
                }, i * 30);
            }
        }

        function loadResources() {
            const saved = localStorage.getItem('resources_charlie');
            if (saved) {
                resources = JSON.parse(saved);
            } else {
                resources = JSON.parse(JSON.stringify(defaultResources));
            }
            renderAllResources();
            loadFromFirebase('resources_charlie').then(firebaseData => {
                if (firebaseData) {
                    resources = firebaseData;
                    localStorage.setItem('resources_charlie', JSON.stringify(resources));
                    renderAllResources();
                } else if (saved) {
                    syncToFirebase('resources_charlie', resources);
                }
            });
            setupFirebaseListener('resources_charlie', (data) => {
                resources = data;
                renderAllResources();
            });
        }

        function saveResources() {
            // Strip base64 data before saving
            const metadataOnly = {};
            for (const [cat, items] of Object.entries(resources)) {
                metadataOnly[cat] = items.map(item => {
                    if (item.file && item.file.data) {
                        const { data, ...rest } = item.file;
                        return { ...item, file: rest };
                    }
                    return item;
                });
            }
            try { localStorage.setItem('resources_charlie', JSON.stringify(metadataOnly)); } catch(e) {}
            syncToFirebase('resources_charlie', metadataOnly);
        }

        let pendingResourceBlob = null;

        function handleResourceUpload() {
            const fileInput = document.getElementById('resourceFile');
            const file = fileInput.files[0];
            if (file) {
                const sizeMB = (file.size / 1024 / 1024).toFixed(1);
                if (file.size > 200 * 1024 * 1024) {
                    alert('File too large (' + sizeMB + 'MB). Max is 200MB.');
                    fileInput.value = '';
                    return;
                }
                pendingResourceFile = { type: file.type, name: file.name, size: file.size };
                pendingResourceBlob = file;
                document.getElementById('resourceLink').value = '';
            }
        }

        function toggleResource(e, category) {
            e.target.closest('.resource-category').classList.toggle('active');
        }

        function renderAllResources() {
            Object.keys(resources).forEach(category => renderResourceCategory(category));
        }

        function renderResourceCategory(category) {
            const container = document.getElementById(`${category}-items`);
            if (!container) return;

            if (!resources[category] || resources[category].length === 0) {
                container.innerHTML = '<div class="empty-state">No resources yet. Add your first one!</div>';
                return;
            }

            container.innerHTML = '';
            resources[category].forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'resource-item';
                
                let mediaContent = '';
                if (item.file) {
                    const fileUrl = item.file.cloudUrl || item.file.data || null;
                    if (fileUrl) {
                        if (item.file.type.startsWith('image')) {
                            mediaContent = `<img src="${fileUrl}" style="max-width: 200px; margin-bottom: 8px; border-radius: 4px;">`;
                        } else if (item.file.type.startsWith('video')) {
                            mediaContent = `<video controls style="max-width: 200px; margin-bottom: 8px;"><source src="${fileUrl}" type="${item.file.type}"></video>`;
                        }
                    } else {
                        mediaContent = '<div style="color:#b59197;font-size:0.85rem;">📱 File only available on upload device</div>';
                    }
                }
                
                itemDiv.innerHTML = `
                    <div class="resource-item-content">
                        <div class="resource-item-title">${item.title}</div>
                        ${mediaContent}
                        ${item.link ? `<a href="${item.link}" target="_blank" class="resource-item-link">${item.link}</a>` : ''}
                        ${item.note ? `<div class="resource-item-note">${item.note}</div>` : ''}
                    </div>
                    <button class="btn" onclick="deleteResource('${category}', ${index})" style="padding: 4px 8px; min-width: auto;">&times;</button>
                `;
                container.appendChild(itemDiv);
            });
        }

        function showAddResourceForm(category) {
            document.getElementById('resourceCategory').value = category;
            document.getElementById('resourceForm').classList.add('active');
        }

        function hideAddResourceForm() {
            document.getElementById('resourceForm').classList.remove('active');
            document.getElementById('resourceForm').querySelector('form').reset();
            pendingResourceFile = null;
            pendingResourceBlob = null;
        }

        async function addResource(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const category = formData.get('category');
            const fileId = 'res_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);

            const resource = {
                title: formData.get('title'),
                link: formData.get('link') || null,
                note: formData.get('note') || null,
                file: pendingResourceFile ? { type: pendingResourceFile.type, name: pendingResourceFile.name, size: pendingResourceFile.size, id: fileId } : null
            };

            try {
                if (pendingResourceBlob && resource.file) {
                    const storagePath = 'resources/charlie/' + fileId + '_' + pendingResourceFile.name;
                    const downloadUrl = await uploadToFirebaseStorage(pendingResourceBlob, storagePath);
                    if (downloadUrl) {
                        resource.file.cloudUrl = downloadUrl;
                        resource.file.storagePath = storagePath;
                    }
                }
                if (!resources[category]) resources[category] = [];
                resources[category].push(resource);
                await saveResources();
                renderResourceCategory(category);
                hideAddResourceForm();
                pendingResourceFile = null;
                pendingResourceBlob = null;
            } catch(err) {
                alert('Could not save file: ' + (err.message || 'Unknown error'));
            }
        }

        async function deleteResource(category, index) {
            const item = resources[category][index];
            if (item.file && item.file.storagePath) {
                try { await deleteFromFirebaseStorage(item.file.storagePath); } catch(e) {}
            }
            resources[category].splice(index, 1);
            await saveResources();
            renderResourceCategory(category);
        }

        let pendingVideoBlob = null;

        function handleVideoUpload() {
            const fileInput = document.getElementById('videoFile');
            const status = document.getElementById('videoUploadStatus');
            const saveBtn = document.getElementById('videoSaveBtn');
            const file = fileInput.files[0];
            if (file) {
                const sizeMB = (file.size / 1024 / 1024).toFixed(1);
                if (file.size > 200 * 1024 * 1024) {
                    alert('Video too large (' + sizeMB + 'MB). Max is 200MB.');
                    fileInput.value = '';
                    return;
                }
                status.style.display = 'block';
                status.innerHTML = '<span style="display:inline-block;width:12px;height:12px;border:2px solid rgba(123,168,134,0.3);border-top-color:#7ba886;border-radius:50%;animation:spin 0.6s linear infinite;vertical-align:middle;margin-right:6px;"></span> Processing video (' + sizeMB + 'MB)...';
                saveBtn.disabled = true;
                saveBtn.style.opacity = '0.5';

                pendingVideoFile = { type: file.type, name: file.name, size: file.size };
                pendingVideoBlob = file;
                document.getElementById('videoLink').value = '';
                status.innerHTML = '&#10004; Video ready (' + sizeMB + 'MB)';
                status.style.color = '#7ba886';
                saveBtn.disabled = false;
                saveBtn.style.opacity = '1';
            }
        }

        function loadVideos() {
            const saved = localStorage.getItem('videos_charlie');
            if (saved) {
                videos = JSON.parse(saved);
            } else {
                videos = [];
            }
            renderVideos();
            loadFromFirebase('videos_charlie').then(firebaseData => {
                if (firebaseData) {
                    videos = firebaseData;
                    localStorage.setItem('videos_charlie', JSON.stringify(videos));
                    renderVideos();
                } else if (saved) {
                    syncToFirebase('videos_charlie', videos);
                }
            });
            setupFirebaseListener('videos_charlie', (data) => {
                videos = data;
                renderVideos();
            });
        }

        function saveVideos() {
            // Strip base64 data before saving - only keep metadata + cloudUrl
            const metadataOnly = videos.map(v => {
                if (v.file && v.file.data) {
                    const { data, ...rest } = v.file;
                    return { ...v, file: rest };
                }
                return v;
            });
            try { localStorage.setItem('videos_charlie', JSON.stringify(metadataOnly)); } catch(e) {}
            syncToFirebase('videos_charlie', metadataOnly);
        }

        function toggleVideoForm() {
            const form = document.getElementById('videoForm');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                form.querySelector('form').reset();
                pendingVideoFile = null;
                const status = document.getElementById('videoUploadStatus');
                if (status) { status.style.display = 'none'; status.innerHTML = ''; }
                const saveBtn = document.getElementById('videoSaveBtn');
                if (saveBtn) { saveBtn.disabled = false; saveBtn.style.opacity = '1'; saveBtn.style.cssText = ''; saveBtn.textContent = 'Save Video'; }
            }
        }

        async function addVideo(e) {
            e.preventDefault();
            const saveBtn = document.getElementById('videoSaveBtn');
            const status = document.getElementById('videoUploadStatus');
            const origText = saveBtn.textContent;

            saveBtn.textContent = '';
            saveBtn.style.cssText = 'position:relative;pointer-events:none;min-width:90px;color:transparent;border-color:#7ba886;background:rgba(123,168,134,0.1);';
            const spinner = document.createElement('span');
            spinner.style.cssText = 'position:absolute;top:50%;left:50%;width:14px;height:14px;margin:-7px 0 0 -7px;border:2px solid rgba(123,168,134,0.3);border-top-color:#7ba886;border-radius:50%;animation:spin 0.6s linear infinite;';
            saveBtn.appendChild(spinner);

            if (status) { status.style.display = 'block'; status.innerHTML = 'Uploading...'; }

            const formData = new FormData(e.target);
            const videoId = 'vid_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);

            const video = {
                id: videoId,
                title: formData.get('title'),
                link: formData.get('link') || null,
                file: pendingVideoFile ? { type: pendingVideoFile.type, name: pendingVideoFile.name, size: pendingVideoFile.size, id: videoId } : null,
                tags: formData.get('tags') ? formData.get('tags').split(',').map(t => t.trim()) : [],
                dateAdded: new Date().toISOString()
            };

            try {
                if (pendingVideoBlob && video.file) {
                    const storagePath = 'videos/charlie/' + videoId + '_' + pendingVideoFile.name;
                    if (status) status.innerHTML = 'Uploading to cloud...';
                    const downloadUrl = await uploadToFirebaseStorage(pendingVideoBlob, storagePath);
                    if (downloadUrl) {
                        video.file.cloudUrl = downloadUrl;
                        video.file.storagePath = storagePath;
                    }
                }
                videos.push(video);
                saveVideos();
            } catch(err) {
                saveBtn.textContent = origText;
                saveBtn.style.cssText = '';
                alert('Could not save video: ' + (err.message || 'Unknown error') + '\nTry using a link instead.');
                return;
            }

            renderVideos();
            pendingVideoFile = null;
            pendingVideoBlob = null;

            saveBtn.textContent = 'Saved!';
            saveBtn.style.cssText = 'border-color:#7ba886;color:#7ba886;pointer-events:none;min-width:90px;';

            setTimeout(function() {
                saveBtn.textContent = origText;
                saveBtn.style.cssText = '';
                e.target.reset();
                if (status) { status.style.display = 'none'; status.innerHTML = ''; }
                toggleVideoForm();
            }, 800);
        }

        function renderVideos() {
            const list = document.getElementById('videosList');
            const countEl = document.getElementById('videoCount');
            if (countEl) countEl.textContent = videos.length > 0 ? videos.length + ' video' + (videos.length !== 1 ? 's' : '') : '';
            if (videos.length === 0) {
                list.innerHTML = '<div class="empty-state" style="grid-column:1/-1;">No videos yet. Add your first motivational video!</div>';
                return;
            }
            list.innerHTML = '';
            videos.forEach((video, index) => {
                const thumb = document.createElement('div');
                thumb.className = 'video-thumb';
                if (video.file) {
                    const videoUrl = video.file.cloudUrl || video.file.data || null;
                    if (videoUrl) {
                        const thumbId = 'vthumb_' + index;
                        thumb.innerHTML = '<canvas id="' + thumbId + '" style="width:100%;height:100%;object-fit:cover;display:block;"></canvas><div class="video-thumb-play"></div><div class="video-thumb-overlay">' + (video.title || '') + '</div>';
                        thumb.onclick = () => openVideoDetail(index, videoUrl);
                        list.appendChild(thumb);
                        (function(url, canvasId) {
                            const tempVid = document.createElement('video');
                            tempVid.muted = true; tempVid.preload = 'auto';
                            if (url.startsWith('http')) tempVid.crossOrigin = 'anonymous';
                            tempVid.addEventListener('loadeddata', function() { tempVid.currentTime = 0.5; });
                            tempVid.addEventListener('seeked', function() {
                                try {
                                    const canvas = document.getElementById(canvasId);
                                    if (canvas) {
                                        const size = Math.min(tempVid.videoWidth, tempVid.videoHeight) || 200;
                                        canvas.width = size; canvas.height = size;
                                        const ctx = canvas.getContext('2d');
                                        ctx.drawImage(tempVid, (tempVid.videoWidth-size)/2, (tempVid.videoHeight-size)/2, size, size, 0, 0, size, size);
                                    }
                                } catch(e) {}
                            });
                            tempVid.src = url;
                        })(videoUrl, thumbId);
                        return;
                    } else {
                        thumb.innerHTML = '<div class="video-link-thumb"><div class="video-link-icon">📱</div><div style="color:#b59197;font-size:0.7rem;font-weight:600;">' + (video.title || 'Video') + '</div><div class="video-link-label" style="font-size:0.6rem;">Only plays on upload device</div></div>';
                    }
                } else if (video.link) {
                    thumb.innerHTML = '<div class="video-link-thumb"><div class="video-link-icon">▶</div><div style="color:#b59197;font-size:0.75rem;font-weight:600;margin-bottom:4px;">' + (video.title || 'Video') + '</div><div class="video-link-label">' + video.link.replace(/https?:\/\/(www\.)?/, '').split('/')[0] + '</div></div>';
                    thumb.onclick = () => openVideoDetail(index, null);
                }
                list.appendChild(thumb);
            });
        }

        async function deleteVideo(index) {
            const video = videos[index];
            if (video.file && video.file.storagePath) {
                try { await deleteFromFirebaseStorage(video.file.storagePath); } catch(e) {}
            }
            videos.splice(index, 1);
            await saveVideos();
            renderVideos();
        }

        // TO-DO LIST FUNCTIONS
        function loadTodos() {
            const saved = localStorage.getItem('todos_charlie');
            if (saved) {
                todos = JSON.parse(saved);
            } else {
                todos = [];
            }
            renderTodos();
            loadFromFirebase('todos_charlie').then(firebaseData => {
                if (firebaseData) {
                    todos = firebaseData;
                    localStorage.setItem('todos_charlie', JSON.stringify(todos));
                    renderTodos();
                } else if (saved) {
                    syncToFirebase('todos_charlie', todos);
                }
            });
            setupFirebaseListener('todos_charlie', (data) => {
                todos = data;
                renderTodos();
            });
        }

        function saveTodos() {
            localStorage.setItem('todos_charlie', JSON.stringify(todos));
            syncToFirebase('todos_charlie', todos);
        }

        function toggleTodoForm() {
            const form = document.getElementById('todoForm');
            form.classList.toggle('active');
            if (!form.classList.contains('active')) {
                form.querySelector('form').reset();
            }
        }

        function addTodo(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            const todo = {
                text: formData.get('todo'),
                completed: false,
                dateAdded: new Date().toISOString()
            };

            todos.push(todo);
            saveTodos();
            renderTodos();
            e.target.reset();
            toggleTodoForm();
        }

        async function toggleTodoComplete(index) {
            todos[index].completed = !todos[index].completed;
            await saveTodos();
            renderTodos();
        }

        async function deleteTodo(index) {
            todos.splice(index, 1);
            await saveTodos();
            renderTodos();
        }

        function renderTodos() {
            const list = document.getElementById('todosList');
            if (todos.length === 0) {
                list.innerHTML = '<div class="empty-state">No to-dos yet. Add your first task!</div>';
                return;
            }

            list.innerHTML = '';
            todos.forEach((todo, index) => {
                const todoDiv = document.createElement('div');
                todoDiv.className = 'todo-item';
                if (todo.completed) todoDiv.classList.add('completed');
                
                todoDiv.innerHTML = `
                    <input type="checkbox" class="todo-checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodoComplete(${index})">
                    <div class="todo-content">
                        <div class="todo-text">${todo.text}</div>
                    </div>
                    <div class="todo-actions">
                        <button class="btn" onclick="deleteTodo(${index})" style="padding: 4px 8px; min-width: auto;">Delete</button>
                    </div>
                `;
                list.appendChild(todoDiv);
            });
        }

        async function loadHubPrompt() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            const promptIndex = dayOfYear % dailyPrompts.length;
            document.getElementById('promptQuestionHub').textContent = dailyPrompts[promptIndex];

            const firebaseData = await loadFromFirebase('dailyPromptAnswers');
            const savedAnswers = firebaseData || (function() {
                const s = localStorage.getItem('dailyPromptAnswers');
                return s ? JSON.parse(s) : {};
            })();
            
            if (savedAnswers.date === today.toDateString() && savedAnswers.charlie) {
                document.getElementById('answerInput').value = savedAnswers.charlie;
            } else {
                document.getElementById('answerInput').value = '';
            }
        }

        function saveAnswer(e) {
            e.preventDefault();
            const answer = new FormData(e.target).get('answer');
            const today = new Date().toDateString();

            const saved = localStorage.getItem('dailyPromptAnswers');
            let savedAnswers = saved ? JSON.parse(saved) : {};
            savedAnswers.date = today;
            savedAnswers.charlie = answer;
            localStorage.setItem('dailyPromptAnswers', JSON.stringify(savedAnswers));
            syncToFirebase('dailyPromptAnswers', savedAnswers);
            
            loadHubPrompt();
        }

        // ===== WELLNESS SCHEDULE =====
        let currentViewingDay = new Date().getDay();
        const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        const defaultScheduleItems = {
            morning: [
                { id:'cm1', time:'8:00 AM', title:'Morning Supplements', details:'• Life Extension Neuro-Mag (3 caps = 144mg Mg L-threonate)\n• Allergy pill (1 tab)\n• Lexapro\n⚡ Take with full glass of water on empty stomach' },
                { id:'cm2', time:'8:05 AM', title:'Morning Skin Care', details:'1. Wash face\n2. Moisturize\n3. Sunscreen' },
                { id:'cm3', time:'8:15 AM', title:'Feed Wizzy & Moo, refresh water', details:'' },
                { id:'cm4', time:'8:45 AM', title:'WORKOUT (30-45 min)', details:'Workout details coming soon' },
                { id:'cm5', time:'~9:30 AM', title:'Smoothie + Morning Supplements', details:'Smoothie Recipe (~322 cal, ~43g protein):\n• 1 cup unsweetened almond milk\n• 1.5 tbsp cacao powder (NOT Dutch-processed)\n• 1 scoop ON Gold Standard Banana Cream whey\n• ~1/2 scoop Vital Proteins chocolate collagen (~12g)\n• 5g L-glutamine\n• 1 tsp Nature\'s Way MCT oil\n• Optional: 1 cup frozen spinach, 1/2 cup frozen blueberries\n\nTake WITH smoothie:\n• Daily multivitamin\n• Big dark pill (name TBD)' },
                { id:'cm6', time:'10:00 AM', title:'Creatine + Prep to Leave', details:'Mix creatine (5g minimum) in water. Head out 10–10:30 AM' }
            ],
            daytime: [
                { id:'cd1', time:'10:30-1:30', title:'Pet Care Visits', details:'Client visits\nWalking between homes counts as steps' },
                { id:'cd2', time:'2:00-3:00 PM', title:'Lunch', details:'Target: ~400-500 cal, protein-focused' },
                { id:'cd5', time:'~3:00 PM', title:'Journal (5-10 min)', details:'Check today\'s prompt and write what comes up' },
                { id:'cd3', time:'3:00-7:00 PM', title:'Work Block', details:'Admin, client management, business tasks' },
                { id:'cd4', time:'~5:00 PM', title:'Fiber', details:'Fiber drink (midday, before dinner)' }
            ],
            evening: [
                { id:'ce1', time:'7:15 PM', title:'Start Dinner Prep', details:'Wrap up work' },
                { id:'ce2', time:'7:30 PM', title:'Dinner + Evening Supplements', details:'Take WITH dinner:\n• Mag Glycinate\n• Probiotic' },
                { id:'ce3', time:'9:25 PM', title:'Evening Skin Care', details:'1. Wash face\n2. Moisturize\n3. Pink stuff\n\n🗓 Sundays: Deep pore cleansing mask first (with Kasey)' },
                { id:'ce4', time:'9:30 PM', title:'Dim Lights', details:'Lamps only. Night mode on screens. Wind down begins' },
                { id:'ce5', time:'10:30 PM', title:'Nighttime Meds + Bedtime', details:'• Muscle relaxer\n• Amitriptyline\nTeeth, wind down' },
                { id:'ce6', time:'11:00 PM', title:'Lights Out', details:'Phone face down or in another room\n⚡ Target: 9 hours sleep (11 PM - 8 AM)' }
            ]
        };

        let scheduleData = JSON.parse(JSON.stringify(defaultScheduleItems));

        function loadScheduleData() {
            const saved = localStorage.getItem('scheduleData_charlie');
            if (saved) {
                try { scheduleData = JSON.parse(saved); } catch(e) {}
            }
            loadFromFirebase('scheduleData_charlie').then(data => {
                if (data && data.morning) {
                    scheduleData = data;
                    localStorage.setItem('scheduleData_charlie', JSON.stringify(scheduleData));
                    renderDailySchedule();
                } else if (saved) {
                    syncToFirebase('scheduleData_charlie', scheduleData);
                }
            });
            setupFirebaseListener('scheduleData_charlie', (data) => {
                if (data && data.morning) {
                    scheduleData = data;
                    localStorage.setItem('scheduleData_charlie', JSON.stringify(scheduleData));
                    renderDailySchedule();
                }
            });
        }

        function saveScheduleData() {
            localStorage.setItem('scheduleData_charlie', JSON.stringify(scheduleData));
            syncToFirebase('scheduleData_charlie', scheduleData);
        }

        function changeDay(direction) {
            currentViewingDay += direction;
            if (currentViewingDay > 6) currentViewingDay = 0;
            if (currentViewingDay < 0) currentViewingDay = 6;
            renderDailySchedule();
        }

        function renderDailySchedule() {
            const dayName = dayNames[currentViewingDay];
            const today = new Date();
            const dayOffset = currentViewingDay - today.getDay();
            const viewingDate = new Date(today);
            viewingDate.setDate(today.getDate() + dayOffset);
            const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            document.getElementById('currentDayDisplay').textContent = dayName + ', ' + monthNames[viewingDate.getMonth()] + ' ' + viewingDate.getDate();

            const container = document.getElementById('dailyScheduleContainer');

            function renderBlock(label, timeRange, items) {
                let h = '<div class="day-card"><div class="day-header" onclick="this.parentElement.classList.toggle(\'expanded\')"><div><div class="day-name">' + label + ' (' + timeRange + ')</div></div><span class="arrow">&#9660;</span></div><div class="day-details">';
                items.forEach(function(item) {
                    var details = (item.details || '').replace(/\n/g, '<br>');
                    if (item.title.toLowerCase().indexOf('dinner prep') !== -1) {
                        details = '<a href="meal-plan.html" style="display:inline-block;background:#a3b899;color:#1c1c1c;padding:8px 18px;text-decoration:none;font-weight:600;font-size:0.85rem;margin-bottom:6px;">View Tonight\'s Meal Plan</a>' + (details ? '<br>' + details : '');
                    }
                    if (item.title.toLowerCase().indexOf('journal') !== -1) {
                        details = '<a onclick="document.getElementById(\'sectionDropdown\').value=\'journal\';switchTabFromDropdown();" style="display:inline-block;background:#a3b899;color:#1c1c1c;padding:8px 18px;text-decoration:none;font-weight:600;font-size:0.85rem;margin-bottom:6px;cursor:pointer;">Open Journal</a>' + (details ? '<br>' + details : '');
                    }
                    h += '<div class="schedule-item"><span class="schedule-time">' + item.time + '</span><div class="schedule-content"><div class="schedule-title">' + item.title + '</div>';
                    if (details) h += '<div class="schedule-details">' + details + '</div>';
                    h += '</div></div>';
                });
                h += '</div></div>';
                return h;
            }

            container.innerHTML =
                renderBlock('Morning Routine', '8:00 AM - 10:30 AM', scheduleData.morning) +
                renderBlock('Daytime Routine', '10:30 AM - 7 PM', scheduleData.daytime) +
                renderBlock('Evening Routine', '7 PM - 11 PM', scheduleData.evening);
        }

        // ===== ROUTINE EDITOR =====
        function openRoutineEditor() {
            const body = document.getElementById('routineEditorBody');
            body.innerHTML =
                renderEditorBlock('Morning', 'morning', scheduleData.morning) +
                renderEditorBlock('Daytime', 'daytime', scheduleData.daytime) +
                renderEditorBlock('Evening', 'evening', scheduleData.evening);
            document.getElementById('routineEditorOverlay').classList.add('active');
        }

        function renderEditorBlock(label, key, items) {
            var h = '<div class="routine-block-label">' + label + '</div>';
            items.forEach(function(item, i) {
                h += '<div class="routine-item-edit" data-block="' + key + '" data-idx="' + i + '">'
                    + '<div class="routine-edit-row">'
                    + '<input class="re-time" value="' + (item.time||'').replace(/"/g,'&quot;') + '" placeholder="Time">'
                    + '<input class="re-title" value="' + (item.title||'').replace(/"/g,'&quot;') + '" placeholder="Title">'
                    + '</div>'
                    + '<textarea class="routine-edit-details" placeholder="Details (optional)">' + (item.details||'').replace(/</g,'&lt;') + '</textarea>'
                    + '<div class="routine-edit-actions">'
                    + '<button onclick="moveRoutineItem(\''+key+'\','+i+',-1)">↑</button>'
                    + '<button onclick="moveRoutineItem(\''+key+'\','+i+',1)">↓</button>'
                    + '<button class="re-del" onclick="removeRoutineItem(\''+key+'\','+i+')">✕ Delete</button>'
                    + '</div></div>';
            });
            h += '<button class="routine-add-item" onclick="addRoutineItem(\''+key+'\')">+ Add Item</button>';
            return h;
        }

        function closeRoutineEditor() {
            document.getElementById('routineEditorOverlay').classList.remove('active');
        }

        function readEditorState() {
            ['morning','daytime','evening'].forEach(function(block) {
                var els = document.querySelectorAll('.routine-item-edit[data-block="'+block+'"]');
                scheduleData[block] = Array.from(els).map(function(el, i) {
                    return {
                        id: (scheduleData[block][i] && scheduleData[block][i].id) || (block[0] + '_' + Date.now() + '_' + i),
                        time: el.querySelector('.re-time').value,
                        title: el.querySelector('.re-title').value,
                        details: el.querySelector('.routine-edit-details').value
                    };
                });
            });
        }

        function saveRoutineEdits() {
            readEditorState();
            saveScheduleData();
            renderDailySchedule();
            closeRoutineEditor();
        }

        function addRoutineItem(block) {
            readEditorState();
            scheduleData[block].push({ id: block[0]+'_'+Date.now(), time:'', title:'New Item', details:'' });
            openRoutineEditor();
            // Scroll to bottom of editor body
            var body = document.getElementById('routineEditorBody');
            setTimeout(function(){ body.scrollTop = body.scrollHeight; }, 50);
        }

        function removeRoutineItem(block, index) {
            if (!confirm('Delete this item?')) return;
            readEditorState();
            scheduleData[block].splice(index, 1);
            openRoutineEditor();
        }

        function moveRoutineItem(block, index, direction) {
            readEditorState();
            var newIdx = index + direction;
            if (newIdx < 0 || newIdx >= scheduleData[block].length) return;
            var items = scheduleData[block];
            var temp = items[index];
            items[index] = items[newIdx];
            items[newIdx] = temp;
            openRoutineEditor();
        }

        function resetRoutineToDefaults() {
            if (!confirm('Reset entire routine to defaults? This will overwrite your edits.')) return;
            scheduleData = JSON.parse(JSON.stringify(defaultScheduleItems));
            saveScheduleData();
            renderDailySchedule();
            openRoutineEditor();
        }

        // ===== JOURNAL =====
        let journalEntries = [];
        const JOURNAL_PASSWORD_CHARLIE = 'charlie2025';

        const journalPrompts = [
            'Sunday: What are you grateful for this week? Name three things, big or small.',
            'Monday: What\'s one thing you want to focus on this week? Why does it matter to you?',
            'Tuesday: How are you feeling right now — physically and mentally? No filtering, just honest.',
            'Wednesday: What\'s something you\'ve been avoiding? What would it feel like to just start?',
            'Thursday: What\'s something you\'re learning about yourself lately?',
            'Friday: What\'s one win from this week, even if it felt small?',
            'Saturday: What does rest look like for you today? What do you actually need right now?'
        ];

        function updateJournalDate() {
            const el = document.getElementById('journalDate');
            if (!el) return;
            const d = new Date();
            const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
            el.textContent = days[d.getDay()] + ', ' + months[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
            const promptEl = document.getElementById('journalPrompt');
            if (promptEl) promptEl.textContent = journalPrompts[d.getDay()];
        }

        function unlockJournal() {
            const input = document.getElementById('journalPasswordInput');
            const errorEl = document.getElementById('journalError');
            if (input.value === JOURNAL_PASSWORD_CHARLIE) {
                document.getElementById('journalLocked').style.display = 'none';
                document.getElementById('journalContent').style.display = 'block';
                updateJournalDate();
                loadJournalEntries();
            } else {
                errorEl.classList.add('show');
                setTimeout(() => errorEl.classList.remove('show'), 2000);
            }
        }

        function saveJournalEntry() {
            const textarea = document.getElementById('journalTextarea');
            const text = textarea.value.trim();
            if (!text) return;
            const now = new Date();
            journalEntries.unshift({
                text: text,
                date: now.toISOString(),
                id: 'j_' + Date.now()
            });
            textarea.value = '';
            localStorage.setItem('journalEntries_charlie', JSON.stringify(journalEntries));
            syncToFirebase('journalEntries_charlie', journalEntries);
            renderJournalEntries();
        }

        function deleteJournalEntry(id) {
            journalEntries = journalEntries.filter(e => e.id !== id);
            localStorage.setItem('journalEntries_charlie', JSON.stringify(journalEntries));
            syncToFirebase('journalEntries_charlie', journalEntries);
            renderJournalEntries();
        }

        function loadJournalEntries() {
            const saved = localStorage.getItem('journalEntries_charlie');
            if (saved) journalEntries = JSON.parse(saved);
            renderJournalEntries();
            loadFromFirebase('journalEntries_charlie').then(data => {
                if (data) {
                    journalEntries = data;
                    localStorage.setItem('journalEntries_charlie', JSON.stringify(journalEntries));
                    renderJournalEntries();
                } else if (saved) {
                    syncToFirebase('journalEntries_charlie', journalEntries);
                }
            });
            setupFirebaseListener('journalEntries_charlie', (data) => {
                journalEntries = data;
                renderJournalEntries();
            });
        }

        function renderJournalEntries() {
            const container = document.getElementById('journalEntries');
            if (!container) return;
            if (journalEntries.length === 0) {
                container.innerHTML = '<div class="journal-empty">No entries yet. Start writing!</div>';
                return;
            }
            container.innerHTML = '';
            journalEntries.forEach(entry => {
                const d = new Date(entry.date);
                const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
                const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
                const dateStr = days[d.getDay()] + ', ' + months[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
                const h = d.getHours(); const m = d.getMinutes();
                const timeStr = (h > 12 ? h - 12 : h || 12) + ':' + (m < 10 ? '0' : '') + m + ' ' + (h >= 12 ? 'PM' : 'AM');
                const div = document.createElement('div');
                div.className = 'journal-entry';
                div.innerHTML = `
                    <div class="journal-entry-date">${dateStr} <span class="journal-entry-time">${timeStr}</span></div>
                    <div class="journal-entry-text">${entry.text}</div>
                    <button class="journal-entry-delete" onclick="deleteJournalEntry('${entry.id}')">Delete</button>
                `;
                container.appendChild(div);
            });
        }

        // ===== VIDEO DETAIL MODAL =====
        function openVideoDetail(index, videoUrl) {
            const video = videos[index];
            if (!video) return;
            const modal = document.getElementById('videoDetailModal');
            document.getElementById('videoDetailTitle').textContent = video.title || 'Untitled';
            const body = document.getElementById('videoDetailBody');
            if (videoUrl && video.file) {
                body.innerHTML = '<video controls autoplay style="max-width:100%;max-height:100%;"><source src="' + videoUrl + '" type="' + (video.file.type || 'video/mp4') + '"></video>';
            } else if (video.link) {
                body.innerHTML = '<div style="text-align:center;padding:40px;"><a href="' + video.link + '" target="_blank" style="color:#b59197;font-size:1.1rem;">Open: ' + video.link + '</a></div>';
            }
            const tagsEl = document.getElementById('videoDetailTags');
            tagsEl.innerHTML = (video.tags || []).map(t => '<span class="video-tag">' + t + '</span>').join('');
            document.getElementById('videoDetailDelete').onclick = function() {
                deleteVideo(index);
                closeVideoDetail();
            };
            modal.classList.add('active');
        }

        function closeVideoDetail() {
            const modal = document.getElementById('videoDetailModal');
            modal.classList.remove('active');
            document.getElementById('videoDetailBody').innerHTML = '';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadCustomHabits();
            initBoard();
            loadScheduleData();
            renderDailySchedule();
            loadVideos();
            loadResources();
            loadTodos();

            // Always start on Habits & Wellness tab
        });
    </script>
<script>
function toggleNav() {
    var h = document.getElementById('navHamburger');
    var o = document.getElementById('navOverlay');
    if (!h || !o) return;
    var isOpen = o.classList.contains('open');
    if (isOpen) {
        h.classList.remove('open');
        o.classList.remove('open');
        document.body.style.overflow = '';
    } else {
        h.classList.add('open');
        o.classList.add('open');
        document.body.style.overflow = 'hidden';
    }
}
</script>
</body>
</html>
