<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Our Daily Habits Hub - Home</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant:wght@300;400;500;600;700&family=Work+Sans:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            width: 100%;
            height: 100%;
        }

        body {
            font-family: 'Cormorant', Georgia, 'Times New Roman', serif;
            background: #1a1a1a;
            min-height: 100vh;
            padding: 16px;
            color: #e0e0e0;
            position: relative;
            width: 100%;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .sync-status {
            position: absolute;
            top: 16px;
            right: 16px;
            background: #2a2a2a;
            border: 1px solid #444;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.75rem;
            color: #999;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sync-status.synced {
            border-color: #7ba886;
            color: #7ba886;
        }

        .sync-status.error {
            border-color: #d67373;
            color: #d67373;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #999;
        }

        .sync-status.synced .sync-dot {
            background: #7ba886;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .home-header {
            text-align: center;
            margin-bottom: 32px;
            margin-top: 48px;
        }

        .home-title {
            background: linear-gradient(135deg, #b59197 0%, #7ba886 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5rem;
            font-weight: 400;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .home-subtitle {
            color: #999;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
        }

        .nav-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 32px;
        }

        .hub-nav-btn {
            background: #2a2a2a;
            border: 1px solid #b59197;
            color: #b59197;
            padding: 24px;
            font-size: 1.25rem;
            font-weight: 400;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Cormorant', Georgia, 'Times New Roman', serif;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .hub-nav-btn:hover {
            background: #b59197;
            color: #2a2a2a;
        }

        .hub-nav-btn.charlie {
            border-color: #7ba886;
            color: #7ba886;
            font-family: 'Work Sans', sans-serif;
            font-weight: 700;
            font-size: 1.15rem;
        }

        .hub-nav-btn.charlie:hover {
            background: #7ba886;
            color: #ffffff;
        }

        .hub-nav-btn.dreams {
            border: 2px solid transparent;
            background-image: 
                linear-gradient(#2a2a2a, #2a2a2a),
                linear-gradient(135deg, #b59197 0%, #7ba886 100%);
            background-origin: border-box;
            background-clip: padding-box, border-box;
            color: #b59197;
            font-family: 'Cormorant', Georgia, 'Times New Roman', serif;
            font-weight: 500;
        }

        .hub-nav-btn.dreams:hover {
            background: linear-gradient(135deg, #b59197 0%, #7ba886 100%);
            color: #ffffff;
        }

        .section {
            background: #2a2a2a;
            border: 1px solid #b59197;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 400;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #b59197;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .calendar-nav {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .calendar-nav button,
        .view-toggle,
        .add-event-btn,
        .btn {
            background: transparent;
            border: 1px solid #444;
            color: #999;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .calendar-nav button:hover,
        .view-toggle:hover,
        .add-event-btn:hover,
        .btn:hover {
            background: #b59197;
            color: #2a2a2a;
            border-color: #b59197;
        }

        .calendar-title {
            color: #fff;
            font-size: 1.125rem;
            font-weight: 400;
        }

        #calendarContainer {
            margin-bottom: 20px;
        }

        .week-day {
            background: #3a3a3a;
            padding: 16px;
            margin-bottom: 8px;
            border-left: 3px solid transparent;
        }

        .week-day.today {
            border-left-color: #b59197;
            background: rgba(181, 145, 151, 0.1);
        }

        .week-day-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .week-day-name {
            font-size: 1rem;
            color: #fff;
        }

        .week-day-date {
            color: #999;
        }

        .event-item {
            background: #2a2a2a;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .event-title {
            color: #fff;
            font-size: 0.9rem;
        }

        .event-note {
            color: #999;
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .add-event-btn {
            width: 100%;
            margin-top: 12px;
        }

        .event-form {
            display: none;
            background: #1a1a1a;
            padding: 20px;
            margin-top: 15px;
            border: 1px solid #333;
        }

        .event-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #999;
            font-size: 0.85rem;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
            padding: 10px;
            font-size: 0.9rem;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #b59197;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-actions button[type="submit"] {
            border-color: #b59197;
            color: #b59197;
        }

        .form-actions button[type="submit"]:hover {
            background: #b59197;
            color: #2a2a2a;
        }

        .sticky-note {
            background: #2a2a2a;
            padding: 16px;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            border-radius: 2px;
            position: relative;
            border: 1px solid #3a3a3a;
        }

        .sticky-note::before {
            content: '';
            position: absolute;
            top: 0;
            right: 20px;
            width: 40px;
            height: 20px;
            background: rgba(123, 168, 134, 0.1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .sticky-note-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #7ba886;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sticky-note-input {
            display: flex;
            gap: 6px;
            margin-top: 12px;
        }

        .sticky-note-input input {
            flex: 1;
            background: #1a1a1a;
            border: 1px solid #444;
            padding: 8px;
            font-size: 0.85rem;
            font-family: inherit;
            border-radius: 2px;
            color: #e0e0e0;
        }

        .sticky-note-input input::placeholder {
            color: #666;
        }

        .sticky-note-input button {
            background: #7ba886;
            color: #ffffff;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 2px;
            transition: all 0.2s;
            font-weight: 600;
        }

        .sticky-note-input button:hover {
            background: #8fb99a;
        }

        .sticky-item {
            background: #1a1a1a;
            padding: 8px 10px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 2px;
            border: 1px solid #333;
        }

        .sticky-item-text {
            flex: 1;
            color: #e0e0e0;
            font-size: 0.85rem;
            word-wrap: break-word;
            cursor: pointer;
        }

        .sticky-item-text.completed {
            text-decoration: line-through;
            opacity: 0.5;
            color: #999;
        }

        .sticky-item button {
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .sticky-item button:hover {
            color: #7ba886;
        }

        .prompt-question {
            background: #1a1a1a;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 3px solid #b59197;
            border-right: 3px solid #7ba886;
            cursor: pointer;
            transition: background 0.2s;
        }

        .prompt-question:hover {
            background: #222;
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .expand-icon {
            color: #b59197;
            font-size: 1.25rem;
            transition: transform 0.3s;
            user-select: none;
        }

        .expand-icon.expanded {
            transform: rotate(180deg);
        }

        .prompt-label {
            font-size: 0.75rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 8px;
        }

        .prompt-text {
            color: #fff;
            font-size: 1.125rem;
            line-height: 1.5;
            font-style: italic;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .answers-grid.expanded {
            max-height: 1000px;
            margin-top: 20px;
        }

        .answer-box {
            background: #1a1a1a;
            padding: 20px;
        }

        .answer-person {
            font-size: 0.75rem;
            color: #b59197;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 12px;
        }

        .answer-input {
            width: 100%;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
            padding: 12px;
            font-size: 0.9rem;
            font-family: inherit;
            min-height: 80px;
            resize: vertical;
        }

        .answer-display {
            color: #e0e0e0;
            line-height: 1.6;
            font-size: 0.95rem;
            white-space: pre-wrap;
        }

        .save-answer-btn {
            margin-top: 8px;
            background: transparent;
            border: 1px solid #7ba886;
            color: #7ba886;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            width: 100%;
        }

        .save-answer-btn:hover {
            background: #7ba886;
            color: #ffffff;
        }

        .challenge-box {
            background: #1a1a1a;
            padding: 24px;
            border-left: 3px solid #7ba886;
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .challenge-month {
            color: #7ba886;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 500;
        }

        .challenge-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }

        .challenge-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #7ba886;
        }

        .challenge-status {
            color: #999;
            font-size: 0.85rem;
        }

        .challenge-checkbox input[type="checkbox"]:checked ~ .challenge-status {
            color: #7ba886;
            font-weight: 500;
        }

        .challenge-text {
            color: #fff;
            font-size: 1.125rem;
            line-height: 1.6;
            font-style: italic;
        }

        .challenge-notes {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #3a3a3a;
        }

        .challenge-notes-toggle {
            background: transparent;
            border: 1px solid #7ba886;
            color: #7ba886;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .challenge-notes-toggle:hover {
            background: rgba(123, 168, 134, 0.1);
        }

        .challenge-notes-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .challenge-notes-content.expanded {
            max-height: 300px;
            margin-top: 12px;
        }

        .challenge-notes-textarea {
            width: 100%;
            background: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
            padding: 12px;
            font-size: 0.9rem;
            font-family: inherit;
            min-height: 100px;
            resize: vertical;
        }

        .challenge-notes-textarea:focus {
            outline: none;
            border-color: #7ba886;
        }

        .challenge-notes-save {
            margin-top: 8px;
            background: transparent;
            border: 1px solid #7ba886;
            color: #7ba886;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .challenge-notes-save:hover {
            background: #7ba886;
            color: #ffffff;
        }

        .challenge-notes-display {
            color: #e0e0e0;
            line-height: 1.6;
            font-size: 0.95rem;
            white-space: pre-wrap;
            padding: 12px;
            background: #2a2a2a;
            position: relative;
        }

        .challenge-notes-edit-btn {
            margin-top: 8px;
            background: transparent;
            border: 1px solid #7ba886;
            color: #7ba886;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .challenge-notes-edit-btn:hover {
            background: rgba(123, 168, 134, 0.1);
        }

        .no-answer {
            color: #666;
            font-style: italic;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #1a1a1a;
            margin-bottom: 16px;
        }

        .calendar-day-header {
            background: #1a1a1a;
            padding: 12px;
            text-align: center;
            font-size: 0.75rem;
            color: #999;
            text-transform: uppercase;
        }

        .calendar-day {
            background: #3a3a3a;
            padding: 12px;
            min-height: 80px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .calendar-day:hover {
            background: #4a4a4a;
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            background: rgba(181, 145, 151, 0.2);
            border: 1px solid #b59197;
        }

        .day-number {
            font-size: 0.875rem;
            color: #e0e0e0;
            margin-bottom: 4px;
        }

        .day-events {
            font-size: 0.7rem;
            color: #b59197;
        }

        @media (max-width: 768px) {
            .answers-grid {
                grid-template-columns: 1fr;
            }

            .nav-buttons {
                grid-template-columns: 1fr;
            }

            .calendar-header {
                flex-direction: column;
                align-items: stretch;
            }

            body > .container > div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }

            .sticky-notes-grid {
                grid-template-columns: 1fr !important;
            }

            .sync-status {
                top: 8px;
                right: 8px;
                font-size: 0.7rem;
                padding: 6px 10px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }

            .home-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="sync-status" id="syncStatus">
        <span class="sync-dot"></span>
        <span id="syncText">Connecting...</span>
    </div>

    <div class="container">
        <div class="home-header">
            <h1 class="home-title">Our Habit Hub</h1>
        </div>

        <div class="nav-buttons">
            <a href="kasey-hub.html" class="hub-nav-btn">Kasey's Habit Hub</a>
            <a href="charlie-hub.html" class="hub-nav-btn charlie">Charlie's Habit Hub</a>
        </div>

        <!-- Shared Calendar -->
        <div class="section">
            <h2 class="section-title">Our Shared Calendar</h2>
            
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button onclick="calendarPrevious()">←</button>
                    <span class="calendar-title" id="calendarTitle"></span>
                    <button onclick="calendarNext()">→</button>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="view-toggle" onclick="calendarToggleView()">Full Week</button>
                    <button class="view-toggle" onclick="calendarToggleMonthView()">Month View</button>
                </div>
            </div>

            <div id="calendarContainer"></div>

            <button class="add-event-btn" onclick="calendarShowAddForm()">Add Event</button>

            <div class="event-form" id="calendarEventForm">
                <form onsubmit="calendarAddEvent(event)">
                    <div class="form-group">
                        <label>Event Title</label>
                        <input type="text" id="calendarEventTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="calendarEventDate" required>
                    </div>
                    <div class="form-group">
                        <label>Time (optional)</label>
                        <input type="time" id="calendarEventTime">
                    </div>
                    <div class="form-group">
                        <label>Notes (optional)</label>
                        <textarea id="calendarEventNote" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn" onclick="calendarHideAddForm()">Cancel</button>
                        <button type="submit" class="btn">Save Event</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Reminders & Grocery List -->
        <div class="sticky-notes-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 24px; margin-bottom: 24px;">
            <div class="sticky-note">
                <h3 class="sticky-note-title">Reminders</h3>
                <div id="remindersList"></div>
                <div class="sticky-note-input">
                    <input type="text" id="reminderInput" placeholder="Add reminder..." onkeypress="if(event.key==='Enter') addReminder()">
                    <button onclick="addReminder()">+</button>
                </div>
            </div>

            <div class="sticky-note">
                <h3 class="sticky-note-title">Grocery List</h3>
                <div id="groceryList"></div>
                <div class="sticky-note-input">
                    <input type="text" id="groceryInput" placeholder="Add item..." onkeypress="if(event.key==='Enter') addGrocery()">
                    <button onclick="addGrocery()">+</button>
                </div>
            </div>
        </div>

        <!-- Dreams & Goals Link -->
        <a href="our-dreams.html" class="hub-nav-btn dreams" style="margin-bottom: 24px;">Our Life Together</a>

        <!-- Daily Prompt Section -->
        <div class="section">
            <h2 class="section-title">Today's Prompt</h2>
            
            <div class="prompt-question" onclick="togglePromptAnswers()">
                <div class="prompt-header">
                    <div style="flex: 1;">
                        <div class="prompt-label">Question of the Day</div>
                        <div class="prompt-text" id="promptQuestion"></div>
                    </div>
                    <span class="expand-icon" id="expandIcon">▼</span>
                </div>
            </div>

            <div class="answers-grid" id="answersGrid">
                <div class="answer-box">
                    <div class="answer-person">Kasey's Answer</div>
                    <div id="kaseyAnswerContainer">
                        <textarea class="answer-input" id="kaseyAnswerInput" placeholder="Share your thoughts..."></textarea>
                        <button class="save-answer-btn" onclick="saveAnswer('kasey')">Save Answer</button>
                    </div>
                    <div id="kaseyAnswerDisplay" class="answer-display" style="display: none;"></div>
                </div>
                <div class="answer-box">
                    <div class="answer-person">Charlie's Answer</div>
                    <div id="charlieAnswerContainer">
                        <textarea class="answer-input" id="charlieAnswerInput" placeholder="Share your thoughts..."></textarea>
                        <button class="save-answer-btn" onclick="saveAnswer('charlie')">Save Answer</button>
                    </div>
                    <div id="charlieAnswerDisplay" class="answer-display" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Monthly Challenge Section -->
        <div class="section">
            <h2 class="section-title">This Month's Challenge</h2>
            
            <div class="challenge-box">
                <div class="challenge-header">
                    <div class="challenge-month" id="challengeMonth"></div>
                    <label class="challenge-checkbox">
                        <input type="checkbox" id="challengeComplete" onchange="toggleChallenge()">
                        <span class="checkmark"></span>
                        <span class="challenge-status" id="challengeStatus">Not completed</span>
                    </label>
                </div>
                <div class="challenge-text" id="challengeText"></div>
                
                <div class="challenge-notes">
                    <button class="challenge-notes-toggle" onclick="toggleChallengeNotes()">
                        <span>Notes & Ideas</span>
                        <span class="expand-icon" id="challengeNotesIcon">▼</span>
                    </button>
                    <div class="challenge-notes-content" id="challengeNotesContent">
                        <div id="challengeNotesEdit">
                            <textarea class="challenge-notes-textarea" id="challengeNotesInput" placeholder="Add notes, ideas, or plans for this challenge..."></textarea>
                            <button class="challenge-notes-save" onclick="saveChallengeNotes()">Save Notes</button>
                        </div>
                        <div id="challengeNotesDisplayContainer" style="display: none;">
                            <div id="challengeNotesDisplay" class="challenge-notes-display"></div>
                            <button class="challenge-notes-edit-btn" onclick="editChallengeNotes()">Edit Notes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCDda9sPwSY-RQ5rrM5THOvcLtHvcPRYd4",
            authDomain: "our-habit-hub.firebaseapp.com",
            projectId: "our-habit-hub",
            storageBucket: "our-habit-hub.firebasestorage.app",
            messagingSenderId: "78555830496",
            appId: "1:78555830496:web:3e457e54729cc11b825885"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make Firebase available globally
        window.db = db;
        window.firestoreImports = { collection, doc, setDoc, getDoc, getDocs, deleteDoc, onSnapshot };

        // Update sync status
        function updateSyncStatus(status, message) {
            const statusEl = document.getElementById('syncStatus');
            const textEl = document.getElementById('syncText');
            
            statusEl.className = 'sync-status';
            if (status === 'synced') {
                statusEl.classList.add('synced');
            } else if (status === 'error') {
                statusEl.classList.add('error');
            }
            
            textEl.textContent = message;
        }

        // Initialize sync status
        updateSyncStatus('synced', 'Synced');

        console.log('Firebase initialized successfully!');
    </script>

    <script>
        const dailyPrompts = [
            "What's one thing I did today that made you smile?",
            "What's your favorite memory of us from this past month?",
            "What's one way I can support you better this week?",
            "What's something you're grateful for about our relationship?",
            "What's a goal you have for us as a couple?",
            "What's one thing you admire about me?",
            "What's your favorite thing we do together?",
            "What's something new you'd like to try together?",
            "What's a challenge we've overcome together that you're proud of?",
            "What makes you feel most loved by me?",
            "What's something you've learned about yourself through our relationship?",
            "What's a small gesture I do that means a lot to you?",
            "What's your favorite quality about our relationship?",
            "What's something you're excited about for our future?",
            "What's one way we've grown together recently?",
            "What's a tradition you'd like to start with us?",
            "What's something I do that makes you laugh?",
            "What's your favorite way to spend quality time together?",
            "What's something you want to accomplish together this year?",
            "What's one thing about our relationship that makes you feel secure?",
            "What's a moment when you felt really connected to me?",
            "What's something you appreciate about how we handle disagreements?",
            "What's your favorite inside joke or moment between us?",
            "What's one way our relationship has changed you for the better?",
            "What's something you'd like more of in our relationship?",
            "What's a compliment you wish you heard more often?",
            "What's your favorite physical gesture of affection from me?",
            "What's something I do that helps you feel understood?",
            "What's a dream you have for us that we haven't talked about yet?",
            "What's one thing that always brightens your day when I do it?"
        ];

        const monthlyChallenges = [
            "Write each other a love letter and read them aloud together",
            "Go on a walk together at least 3 times per week",
            "Try a new restaurant or cafe you've never been to",
            "Have a technology-free evening once a week",
            "Learn something new together (a skill, hobby, or topic)",
            "Do a random act of kindness for each other every week",
            "Plan and execute a surprise date for each other",
            "Start a new tradition together",
            "Declutter and organize one space in your home together",
            "Take photos together once a week to capture memories",
            "Cook a new recipe together that neither of you has tried before",
            "Create something together (art, craft, garden, etc.)"
        ];

        let calendarView = 'twoday';
        let calendarDate = new Date();
        let calendarEvents = [];
        let reminders = [];
        let groceries = [];

        // FIREBASE FUNCTIONS
        async function syncToFirebase(collectionName, data) {
            if (!window.db) return;
            try {
                const { setDoc, doc } = window.firestoreImports;
                await setDoc(doc(window.db, collectionName, 'data'), { items: data });
                console.log(`${collectionName} synced to Firebase`);
            } catch (error) {
                console.error(`Error syncing ${collectionName}:`, error);
            }
        }

        async function loadFromFirebase(collectionName) {
            if (!window.db) return null;
            try {
                const { getDoc, doc } = window.firestoreImports;
                const docRef = doc(window.db, collectionName, 'data');
                const docSnap = await getDoc(docRef);
                
                if (docSnap.exists()) {
                    return docSnap.data().items;
                }
                return null;
            } catch (error) {
                console.error(`Error loading ${collectionName}:`, error);
                return null;
            }
        }

        function setupFirebaseListener(collectionName, callback) {
            if (!window.db) return;
            try {
                const { onSnapshot, doc } = window.firestoreImports;
                const docRef = doc(window.db, collectionName, 'data');
                
                onSnapshot(docRef, (doc) => {
                    if (doc.exists()) {
                        callback(doc.data().items);
                    }
                });
            } catch (error) {
                console.error(`Error setting up listener for ${collectionName}:`, error);
            }
        }

        // CALENDAR FUNCTIONS
        async function calendarLoadEvents() {
            const firebaseData = await loadFromFirebase('calendarEvents');
            if (firebaseData) {
                calendarEvents = firebaseData;
            } else {
                const saved = localStorage.getItem('calendarEvents');
                if (saved) {
                    calendarEvents = JSON.parse(saved);
                    await syncToFirebase('calendarEvents', calendarEvents);
                }
            }
        }

        async function calendarSaveEvents() {
            localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents));
            await syncToFirebase('calendarEvents', calendarEvents);
        }

        function calendarGetEventsForDate(date) {
            const dateStr = date.toDateString();
            return calendarEvents.filter(event => {
                try {
                    const [year, month, day] = event.date.split('-').map(Number);
                    const eventDate = new Date(year, month - 1, day);
                    return eventDate.toDateString() === dateStr;
                } catch (e) {
                    return false;
                }
            });
        }

        function calendarToggleView() {
            const buttons = document.querySelectorAll('.view-toggle');
            if (calendarView === 'twoday') {
                calendarView = 'week';
                buttons[0].textContent = 'Today & Tomorrow';
            } else {
                calendarView = 'twoday';
                buttons[0].textContent = 'Full Week';
            }
            calendarRender();
        }

        function calendarToggleMonthView() {
            const buttons = document.querySelectorAll('.view-toggle');
            if (calendarView === 'month') {
                calendarView = 'twoday';
                buttons[0].textContent = 'Full Week';
                buttons[1].textContent = 'Month View';
            } else {
                calendarView = 'month';
                buttons[0].textContent = 'Full Week';
                buttons[1].textContent = 'Day View';
            }
            calendarRender();
        }

        function calendarPrevious() {
            if (calendarView === 'twoday') {
                calendarDate.setDate(calendarDate.getDate() - 2);
            } else if (calendarView === 'week') {
                calendarDate.setDate(calendarDate.getDate() - 7);
            } else {
                calendarDate.setMonth(calendarDate.getMonth() - 1);
            }
            calendarRender();
        }

        function calendarNext() {
            if (calendarView === 'twoday') {
                calendarDate.setDate(calendarDate.getDate() + 2);
            } else if (calendarView === 'week') {
                calendarDate.setDate(calendarDate.getDate() + 7);
            } else {
                calendarDate.setMonth(calendarDate.getMonth() + 1);
            }
            calendarRender();
        }

        function calendarRenderTwoDay() {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '';
            
            const firstDay = new Date(calendarDate);
            const secondDay = new Date(calendarDate);
            secondDay.setDate(firstDay.getDate() + 1);
            
            document.getElementById('calendarTitle').textContent = 
                `${firstDay.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${secondDay.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
            
            const today = new Date();
            const todayStr = today.toDateString();
            
            for (let i = 0; i < 2; i++) {
                const date = i === 0 ? new Date(firstDay) : new Date(secondDay);
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'week-day';
                
                if (date.toDateString() === todayStr) {
                    dayDiv.classList.add('today');
                }
                
                const dayEvents = calendarGetEventsForDate(date);
                
                let eventsHTML = '';
                if (dayEvents.length > 0) {
                    dayEvents.forEach((event) => {
                        const eventIndex = calendarEvents.indexOf(event);
                        eventsHTML += `
                            <div class="event-item">
                                <div>
                                    <div class="event-title">${event.time ? event.time + ' - ' : ''}${event.title}</div>
                                    ${event.note ? `<div class="event-note">${event.note}</div>` : ''}
                                </div>
                                <button class="btn" onclick="calendarDeleteEvent(${eventIndex})" style="padding: 6px 12px; font-size: 0.75rem;">Delete</button>
                            </div>
                        `;
                    });
                } else {
                    eventsHTML = '<div class="empty-state">No events</div>';
                }
                
                dayDiv.innerHTML = `
                    <div class="week-day-header">
                        <span class="week-day-name">${date.toLocaleDateString('en-US', { weekday: 'long' })}</span>
                        <span class="week-day-date">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                    </div>
                    <div>${eventsHTML}</div>
                `;
                
                container.appendChild(dayDiv);
            }
        }

        function calendarRenderWeek() {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '';
            
            const startOfWeek = new Date(calendarDate);
            startOfWeek.setDate(calendarDate.getDate() - calendarDate.getDay());
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            document.getElementById('calendarTitle').textContent = 
                `${startOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${endOfWeek.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                
                const dayDiv = document.createElement('div');
                dayDiv.className = 'week-day';
                
                const today = new Date();
                if (date.toDateString() === today.toDateString()) {
                    dayDiv.classList.add('today');
                }
                
                const dayEvents = calendarGetEventsForDate(date);
                
                let eventsHTML = '';
                if (dayEvents.length > 0) {
                    dayEvents.forEach((event) => {
                        const eventIndex = calendarEvents.indexOf(event);
                        eventsHTML += `
                            <div class="event-item">
                                <div>
                                    <div class="event-title">${event.time ? event.time + ' - ' : ''}${event.title}</div>
                                    ${event.note ? `<div class="event-note">${event.note}</div>` : ''}
                                </div>
                                <button class="btn" onclick="calendarDeleteEvent(${eventIndex})" style="padding: 6px 12px; font-size: 0.75rem;">Delete</button>
                            </div>
                        `;
                    });
                } else {
                    eventsHTML = '<div class="empty-state">No events</div>';
                }
                
                dayDiv.innerHTML = `
                    <div class="week-day-header">
                        <span class="week-day-name">${date.toLocaleDateString('en-US', { weekday: 'long' })}</span>
                        <span class="week-day-date">${date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                    </div>
                    <div>${eventsHTML}</div>
                `;
                
                container.appendChild(dayDiv);
            }
        }

        function calendarRenderMonth() {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '';
            
            const year = calendarDate.getFullYear();
            const month = calendarDate.getMonth();
            
            document.getElementById('calendarTitle').textContent = 
                calendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            const grid = document.createElement('div');
            grid.className = 'calendar-grid';
            
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = startingDayOfWeek - 1; i >= 0; i--) {
                const day = prevMonthLastDay - i;
                const date = new Date(year, month - 1, day);
                grid.appendChild(calendarCreateMonthDay(date, true));
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                grid.appendChild(calendarCreateMonthDay(date, false));
            }
            
            const totalCells = startingDayOfWeek + daysInMonth;
            const remainingCells = totalCells % 7 === 0 ? 0 : 7 - (totalCells % 7);
            for (let day = 1; day <= remainingCells; day++) {
                const date = new Date(year, month + 1, day);
                grid.appendChild(calendarCreateMonthDay(date, true));
            }
            
            container.appendChild(grid);
        }

        function calendarCreateMonthDay(date, otherMonth) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            
            if (otherMonth) {
                dayDiv.classList.add('other-month');
            }
            
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayDiv.classList.add('today');
            }
            
            const dayEvents = calendarGetEventsForDate(date);
            
            dayDiv.innerHTML = `
                <div class="day-number">${date.getDate()}</div>
                ${dayEvents.length > 0 ? `<div class="day-events">${dayEvents.length} event${dayEvents.length > 1 ? 's' : ''}</div>` : ''}
            `;
            
            dayDiv.onclick = () => {
                calendarDate = new Date(date);
                calendarView = 'twoday';
                const buttons = document.querySelectorAll('.view-toggle');
                buttons[0].textContent = 'Full Week';
                buttons[1].textContent = 'Month View';
                calendarRender();
            };
            
            return dayDiv;
        }

        function calendarRender() {
            if (calendarView === 'twoday') {
                calendarRenderTwoDay();
            } else if (calendarView === 'week') {
                calendarRenderWeek();
            } else {
                calendarRenderMonth();
            }
        }

        function calendarShowAddForm() {
            const form = document.getElementById('calendarEventForm');
            form.classList.add('active');
            const today = new Date();
            document.getElementById('calendarEventDate').value = today.toISOString().split('T')[0];
        }

        function calendarHideAddForm() {
            const form = document.getElementById('calendarEventForm');
            form.classList.remove('active');
            document.getElementById('calendarEventTitle').value = '';
            document.getElementById('calendarEventDate').value = '';
            document.getElementById('calendarEventTime').value = '';
            document.getElementById('calendarEventNote').value = '';
        }

        async function calendarAddEvent(e) {
            e.preventDefault();
            
            const title = document.getElementById('calendarEventTitle').value;
            const date = document.getElementById('calendarEventDate').value;
            const time = document.getElementById('calendarEventTime').value;
            const note = document.getElementById('calendarEventNote').value;
            
            if (!title || !date) {
                alert('Please fill in the event title and date.');
                return;
            }
            
            const event = {
                title: title,
                date: date,
                time: time || null,
                note: note || null
            };
            
            calendarEvents.push(event);
            await calendarSaveEvents();
            calendarHideAddForm();
            calendarRender();
        }

        async function calendarDeleteEvent(index) {
            if (index < 0 || index >= calendarEvents.length) return;
            
            const event = calendarEvents[index];
            const eventTitle = event.title;
            if (confirm(`Are you sure you want to delete "${eventTitle}"?\n\nThis cannot be undone.`)) {
                calendarEvents.splice(index, 1);
                await calendarSaveEvents();
                calendarRender();
            }
        }

        async function calendarInit() {
            await calendarLoadEvents();
            calendarDate = new Date();
            calendarView = 'twoday';
            calendarRender();
            
            // Setup real-time listener
            setupFirebaseListener('calendarEvents', (data) => {
                calendarEvents = data;
                calendarRender();
            });
        }

        // DAILY PROMPT FUNCTIONS
        function setDailyPrompt() {
            const today = new Date();
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 86400000);
            const promptIndex = dayOfYear % dailyPrompts.length;
            document.getElementById('promptQuestion').textContent = dailyPrompts[promptIndex];
        }

        function togglePromptAnswers() {
            const answersGrid = document.getElementById('answersGrid');
            const expandIcon = document.getElementById('expandIcon');
            
            if (answersGrid.classList.contains('expanded')) {
                answersGrid.classList.remove('expanded');
                expandIcon.classList.remove('expanded');
            } else {
                answersGrid.classList.add('expanded');
                expandIcon.classList.add('expanded');
            }
        }

        async function saveAnswer(person) {
            const today = new Date().toDateString();
            const inputId = person === 'kasey' ? 'kaseyAnswerInput' : 'charlieAnswerInput';
            const answer = document.getElementById(inputId).value.trim();
            
            if (!answer) {
                alert('Please write an answer before saving.');
                return;
            }
            
            const savedAnswers = await loadFromFirebase('dailyPromptAnswers') || { date: today, kasey: '', charlie: '' };
            
            if (savedAnswers.date !== today) {
                savedAnswers.date = today;
                savedAnswers.kasey = '';
                savedAnswers.charlie = '';
            }
            
            savedAnswers[person] = answer;
            localStorage.setItem('dailyPromptAnswers', JSON.stringify(savedAnswers));
            await syncToFirebase('dailyPromptAnswers', savedAnswers);
            
            loadPromptAnswers();
        }

        async function loadPromptAnswers() {
            const today = new Date().toDateString();
            const savedAnswers = await loadFromFirebase('dailyPromptAnswers') || { date: today, kasey: '', charlie: '' };
            
            if (savedAnswers.date !== today) {
                const newAnswers = { date: today, kasey: '', charlie: '' };
                localStorage.setItem('dailyPromptAnswers', JSON.stringify(newAnswers));
                await syncToFirebase('dailyPromptAnswers', newAnswers);
                
                document.getElementById('kaseyAnswerContainer').style.display = 'block';
                document.getElementById('kaseyAnswerDisplay').style.display = 'none';
                document.getElementById('charlieAnswerContainer').style.display = 'block';
                document.getElementById('charlieAnswerDisplay').style.display = 'none';
                document.getElementById('kaseyAnswerInput').value = '';
                document.getElementById('charlieAnswerInput').value = '';
            } else {
                if (savedAnswers.kasey) {
                    document.getElementById('kaseyAnswerDisplay').textContent = savedAnswers.kasey;
                    document.getElementById('kaseyAnswerContainer').style.display = 'none';
                    document.getElementById('kaseyAnswerDisplay').style.display = 'block';
                } else {
                    document.getElementById('kaseyAnswerContainer').style.display = 'block';
                    document.getElementById('kaseyAnswerDisplay').style.display = 'none';
                }
                
                if (savedAnswers.charlie) {
                    document.getElementById('charlieAnswerDisplay').textContent = savedAnswers.charlie;
                    document.getElementById('charlieAnswerContainer').style.display = 'none';
                    document.getElementById('charlieAnswerDisplay').style.display = 'block';
                } else {
                    document.getElementById('charlieAnswerContainer').style.display = 'block';
                    document.getElementById('charlieAnswerDisplay').style.display = 'none';
                }
            }
        }

        // STICKY NOTES
        async function loadReminders() {
            const firebaseData = await loadFromFirebase('reminders');
            if (firebaseData) {
                reminders = firebaseData;
            } else {
                const saved = localStorage.getItem('reminders');
                if (saved) {
                    reminders = JSON.parse(saved);
                    await syncToFirebase('reminders', reminders);
                }
            }
            renderReminders();
        }

        async function saveReminders() {
            localStorage.setItem('reminders', JSON.stringify(reminders));
            await syncToFirebase('reminders', reminders);
        }

        async function addReminder() {
            const input = document.getElementById('reminderInput');
            const text = input.value.trim();
            if (text) {
                reminders.push({ text, completed: false });
                await saveReminders();
                renderReminders();
                input.value = '';
            }
        }

        async function toggleReminder(index) {
            if (index >= 0 && index < reminders.length) {
                reminders[index].completed = !reminders[index].completed;
                await saveReminders();
                renderReminders();
            }
        }

        async function deleteReminder(index) {
            if (index >= 0 && index < reminders.length) {
                reminders.splice(index, 1);
                await saveReminders();
                renderReminders();
            }
        }

        function renderReminders() {
            const list = document.getElementById('remindersList');
            if (!list) return;
            
            if (reminders.length === 0) {
                list.innerHTML = '<div class="empty-state" style="color: #666; font-size: 0.85rem; padding: 12px;">No reminders yet</div>';
                return;
            }

            list.innerHTML = '';
            reminders.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sticky-item';
                itemDiv.innerHTML = `
                    <div class="sticky-item-text ${item.completed ? 'completed' : ''}" onclick="toggleReminder(${index})">${item.text}</div>
                    <button onclick="deleteReminder(${index})">×</button>
                `;
                list.appendChild(itemDiv);
            });
        }

        async function loadGroceries() {
            const firebaseData = await loadFromFirebase('groceries');
            if (firebaseData) {
                groceries = firebaseData;
            } else {
                const saved = localStorage.getItem('groceries');
                if (saved) {
                    groceries = JSON.parse(saved);
                    await syncToFirebase('groceries', groceries);
                }
            }
            renderGroceries();
        }

        async function saveGroceries() {
            localStorage.setItem('groceries', JSON.stringify(groceries));
            await syncToFirebase('groceries', groceries);
        }

        async function addGrocery() {
            const input = document.getElementById('groceryInput');
            const text = input.value.trim();
            if (text) {
                groceries.push({ text, completed: false });
                await saveGroceries();
                renderGroceries();
                input.value = '';
            }
        }

        async function toggleGrocery(index) {
            if (index >= 0 && index < groceries.length) {
                groceries[index].completed = !groceries[index].completed;
                await saveGroceries();
                renderGroceries();
            }
        }

        async function deleteGrocery(index) {
            if (index >= 0 && index < groceries.length) {
                groceries.splice(index, 1);
                await saveGroceries();
                renderGroceries();
            }
        }

        function renderGroceries() {
            const list = document.getElementById('groceryList');
            if (!list) return;
            
            if (groceries.length === 0) {
                list.innerHTML = '<div class="empty-state" style="color: #666; font-size: 0.85rem; padding: 12px;">No items yet</div>';
                return;
            }

            list.innerHTML = '';
            groceries.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sticky-item';
                itemDiv.innerHTML = `
                    <div class="sticky-item-text ${item.completed ? 'completed' : ''}" onclick="toggleGrocery(${index})">${item.text}</div>
                    <button onclick="deleteGrocery(${index})">×</button>
                `;
                list.appendChild(itemDiv);
            });
        }

        // MONTHLY CHALLENGE FUNCTIONS
        async function setMonthlyChallenge() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('challengeMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            const challengeIndex = currentMonth;
            document.getElementById('challengeText').textContent = monthlyChallenges[challengeIndex];
            
            await loadChallengeStatus();
        }

        async function loadChallengeStatus() {
            const today = new Date();
            const currentMonth = `${today.getFullYear()}-${today.getMonth()}`;
            const savedChallenge = await loadFromFirebase('monthlyChallenge') || { month: currentMonth, completed: false };
            
            if (savedChallenge.month === currentMonth && savedChallenge.completed) {
                document.getElementById('challengeComplete').checked = true;
                document.getElementById('challengeStatus').textContent = 'Completed';
            } else {
                document.getElementById('challengeComplete').checked = false;
                document.getElementById('challengeStatus').textContent = 'Not completed';
                if (savedChallenge.month !== currentMonth) {
                    const newChallenge = { month: currentMonth, completed: false };
                    localStorage.setItem('monthlyChallenge', JSON.stringify(newChallenge));
                    await syncToFirebase('monthlyChallenge', newChallenge);
                }
            }
        }

        async function toggleChallenge() {
            const isCompleted = document.getElementById('challengeComplete').checked;
            const today = new Date();
            const currentMonth = `${today.getFullYear()}-${today.getMonth()}`;
            
            const challengeData = {
                month: currentMonth,
                completed: isCompleted
            };
            
            localStorage.setItem('monthlyChallenge', JSON.stringify(challengeData));
            await syncToFirebase('monthlyChallenge', challengeData);
            
            if (isCompleted) {
                document.getElementById('challengeStatus').textContent = 'Completed';
            } else {
                document.getElementById('challengeStatus').textContent = 'Not completed';
            }
        }

        function toggleChallengeNotes() {
            const content = document.getElementById('challengeNotesContent');
            const icon = document.getElementById('challengeNotesIcon');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                icon.classList.add('expanded');
            }
        }

        async function saveChallengeNotes() {
            const today = new Date();
            const currentMonth = `${today.getFullYear()}-${today.getMonth()}`;
            const notes = document.getElementById('challengeNotesInput').value.trim();
            
            const notesData = {
                month: currentMonth,
                notes: notes
            };
            
            localStorage.setItem('challengeNotes', JSON.stringify(notesData));
            await syncToFirebase('challengeNotes', notesData);
            
            loadChallengeNotes();
        }

        function editChallengeNotes() {
            const displayText = document.getElementById('challengeNotesDisplay').textContent;
            document.getElementById('challengeNotesInput').value = displayText;
            document.getElementById('challengeNotesEdit').style.display = 'block';
            document.getElementById('challengeNotesDisplayContainer').style.display = 'none';
        }

        async function loadChallengeNotes() {
            const today = new Date();
            const currentMonth = `${today.getFullYear()}-${today.getMonth()}`;
            const savedNotes = await loadFromFirebase('challengeNotes') || { month: currentMonth, notes: '' };
            
            if (savedNotes.month !== currentMonth) {
                const newNotes = { month: currentMonth, notes: '' };
                localStorage.setItem('challengeNotes', JSON.stringify(newNotes));
                await syncToFirebase('challengeNotes', newNotes);
                document.getElementById('challengeNotesInput').value = '';
                document.getElementById('challengeNotesEdit').style.display = 'block';
                document.getElementById('challengeNotesDisplayContainer').style.display = 'none';
            } else if (savedNotes.notes) {
                document.getElementById('challengeNotesDisplay').textContent = savedNotes.notes;
                document.getElementById('challengeNotesEdit').style.display = 'none';
                document.getElementById('challengeNotesDisplayContainer').style.display = 'block';
            } else {
                document.getElementById('challengeNotesInput').value = '';
                document.getElementById('challengeNotesEdit').style.display = 'block';
                document.getElementById('challengeNotesDisplayContainer').style.display = 'none';
            }
        }

        // Setup real-time listeners for all collections
        function setupAllListeners() {
            setupFirebaseListener('reminders', (data) => {
                reminders = data;
                renderReminders();
            });
            
            setupFirebaseListener('groceries', (data) => {
                groceries = data;
                renderGroceries();
            });
            
            setupFirebaseListener('dailyPromptAnswers', (data) => {
                loadPromptAnswers();
            });
            
            setupFirebaseListener('monthlyChallenge', (data) => {
                loadChallengeStatus();
            });

            setupFirebaseListener('challengeNotes', (data) => {
                loadChallengeNotes();
            });
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', async function() {
            await calendarInit();
            await loadReminders();
            await loadGroceries();
            setDailyPrompt();
            await loadPromptAnswers();
            await setMonthlyChallenge();
            await loadChallengeNotes();
            
            // Setup real-time listeners
            setTimeout(setupAllListeners, 1000);
        });
    </script>
</body>
</html>
