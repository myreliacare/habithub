<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Plan | Our Life Hub</title>
    <script>
    /* Life Hub Settings Engine v2 - Complete Color Rewriting */
    (function(){
        if(window._lhEngineLoaded) return; window._lhEngineLoaded=true;

        // ── Color manipulation helpers ──
        function h2r(h){h=h.replace('#','');return[parseInt(h.substring(0,2),16),parseInt(h.substring(2,4),16),parseInt(h.substring(4,6),16)];}
        function r2h(r,g,b){return'#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);}
        function clamp(v){return Math.max(0,Math.min(255,Math.round(v)));}
        function lighten(hex,pct){var c=h2r(hex);return r2h(clamp(c[0]+(255-c[0])*pct),clamp(c[1]+(255-c[1])*pct),clamp(c[2]+(255-c[2])*pct));}
        function darken(hex,pct){var c=h2r(hex);return r2h(clamp(c[0]*(1-pct)),clamp(c[1]*(1-pct)),clamp(c[2]*(1-pct)));}
        function rgbStr(hex){var c=h2r(hex);return c[0]+','+c[1]+','+c[2];}

        // ── Palette definitions ──
        var palettes={sage:{accent:'#a3b899'},rose:{accent:'#c9a9a6'},lavender:{accent:'#b4a7d6'},teal:{accent:'#7ba8a1'},peach:{accent:'#d4a59a'},gold:{accent:'#c9b77c'},cream:{accent:'#e8ddd0'},blush:{accent:'#d4919e'},coral:{accent:'#d98a7e'},mauve:{accent:'#b8879e'},berry:{accent:'#9c6b82'},periwinkle:{accent:'#8e9cc7'},seafoam:{accent:'#7bbfb0'},terracotta:{accent:'#c4836a'},honey:{accent:'#d4b870'}};
        var secMap={sage:'#b59197',rose:'#a3b899',lavender:'#c9a9a6',teal:'#b59197',peach:'#a3b899',gold:'#b59197',cream:'#b59197',blush:'#a3b899',coral:'#b4a7d6',mauve:'#a3b899',berry:'#c9b77c',periwinkle:'#c9a9a6',seafoam:'#d4a59a',terracotta:'#a3b899',honey:'#b59197'};
        var bgMap={dark:'#3d2f31',charcoal:'#1a1a1a',navy:'#1e2638',forest:'#1f2e2a',cream:'#f5f0e8',wine:'#2d1f2b',slate:'#2a2d35',espresso:'#2b2220',storm:'#252830'};
        var bgDkMap={dark:'#2a1f21',charcoal:'#111111',navy:'#141c2a',forest:'#15231f',cream:'#ebe4d9',wine:'#211520',slate:'#1f2229',espresso:'#1e1816',storm:'#1b1d24'};
        var tcMap={dark:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},charcoal:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},navy:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},forest:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},cream:{t:'#3d2f31',m:'rgba(61,47,49,0.65)',f:'rgba(61,47,49,0.4)'},wine:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},slate:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},espresso:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},storm:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'}};
        var fontMap={philosopher:"'Philosopher',Georgia,serif",cormorant:"'Cormorant',Georgia,'Times New Roman',serif",worksans:"'Work Sans',sans-serif",georgia:"Georgia,serif",arial:"Arial,sans-serif"};

        // ── Read settings ──
        var ac=localStorage.getItem('accentColor')||'sage';
        var bc=localStorage.getItem('bgColor')||'dark';
        var ff=localStorage.getItem('fontFamily')||'philosopher';
        var fs=parseInt(localStorage.getItem('fontSize')||'100',10);
        var appName=localStorage.getItem('appName')||'Our Life Hub';
        var names;try{names=JSON.parse(localStorage.getItem('userNames')||'{}');}catch(e){names={};}
        names.name1=names.name1||'Kasey'; names.name2=names.name2||'Charlie';
        var archivedPages;try{archivedPages=JSON.parse(localStorage.getItem('archivedPages')||'[]');}catch(e){archivedPages=[];}

        var pa=(palettes[ac]||palettes.sage).accent;
        var sec=secMap[ac]||'#b59197';
        var bg=bgMap[bc]||bgMap.dark;
        var bgDk=bgDkMap[bc]||bgDkMap.dark;
        var tc=tcMap[bc]||tcMap.dark;
        var font=fontMap[ff]||fontMap.philosopher;
        var basePx=Math.round(16*fs/100);

        // ── Generate accent color variants ──
        var A = {
            vdark:  darken(pa, 0.45),   // #4a5c3f, #4a6a3e
            dark:   darken(pa, 0.30),    // #6d8a5e, #7d8f76
            mdark:  darken(pa, 0.15),    // #8fa87a, #8fa882
            base:   pa,                  // #a3b899
            light:  lighten(pa, 0.15),   // #b4c9aa, #b5c9a8
            vlight: lighten(pa, 0.30),   // #b5d4a4, #c4d9b5
            xlight: lighten(pa, 0.50),   // very light washes
            hover:  lighten(pa, 0.12)
        };

        // ── Generate secondary color variants ──
        var S = {
            vdark:  darken(sec, 0.45),   // #5a4345, #5a4a4c
            dark:   darken(sec, 0.30),    // #6b5a5e, #7a6668
            mdark:  darken(sec, 0.15),    // #9a7a80, #a57f85
            base:   sec,                  // #b59197
            light:  lighten(sec, 0.10),   // #c5a1a7, #c9a9a6
            vlight: lighten(sec, 0.25),   // #d4b5b8, #d4b5ba
            xlight: lighten(sec, 0.40),   // #e8d5d8
            redish: darken(sec, 0.10),    // #c97a7a, #d67373 (more saturated)
        };

        // ── Generate background mid-tones ──
        var bgMid = lighten(bg, 0.15);   // #4a3a3c, #4a3b3e

        // ── Apply CSS custom properties ──
        var r=document.documentElement;
        r.style.setProperty('--lh-accent',A.base);
        r.style.setProperty('--lh-accent-hover',A.hover);
        r.style.setProperty('--lh-accent-muted','rgba('+rgbStr(A.base)+',0.2)');
        r.style.setProperty('--lh-accent-border','rgba('+rgbStr(A.base)+',0.3)');
        r.style.setProperty('--lh-accent-text','rgba('+rgbStr(A.base)+',0.6)');
        r.style.setProperty('--lh-bg',bg);
        r.style.setProperty('--lh-bg-darker',bgDk);
        r.style.setProperty('--lh-secondary',S.base);
        r.style.setProperty('--lh-text',tc.t);
        r.style.setProperty('--lh-text-muted',tc.m);
        r.style.setProperty('--lh-text-faint',tc.f);
        r.style.setProperty('--lh-font',font);
        r.style.setProperty('--lh-font-size',basePx+'px');
        r.style.background=bg; r.style.fontSize=basePx+'px';

        // Archive nav links
        var pageHrefs={home:'index.html',person1:'kasey-hub.html',person2:'charlie-hub.html',dreams:'our-dreams.html',meals:'meal-plan.html',settings:'settings.html'};
        var archCSS='';archivedPages.forEach(function(k){var h=pageHrefs[k];if(h)archCSS+='a.nav-link[href="'+h+'"],a.nav-link-mobile[href="'+h+'"]{display:none!important}\n';});
        if(archCSS){var st=document.createElement('style');st.textContent=archCSS;(document.head||r).appendChild(st);}

        // Expose for settings page
        window.LifeHubSettings={current:{appName:appName,names:names,accentColor:ac,bgColor:bc,fontFamily:ff,fontSize:fs,archivedPages:archivedPages,archivedSections:JSON.parse(localStorage.getItem('archivedSections')||'{}'),features:JSON.parse(localStorage.getItem('features')||'{}'),pageLabels:JSON.parse(localStorage.getItem('pageLabels')||'{}')},getName:function(p){return p===1||p==='person1'?names.name1:names.name2;}};

        function onReady(fn){if(document.readyState!=='loading')fn();else document.addEventListener('DOMContentLoaded',fn);}
        onReady(function(){
            // ── Apply names ──
            document.querySelectorAll('.nav-logo').forEach(function(el){el.textContent=appName;});
            document.querySelectorAll('.nav-link,.nav-link-mobile').forEach(function(lnk){
                var href=lnk.getAttribute('href')||'';
                if(href==='kasey-hub.html')lnk.textContent=names.name1;
                if(href==='charlie-hub.html')lnk.textContent=names.name2;
            });
            document.querySelectorAll('[data-lh-name="app"]').forEach(function(el){el.textContent=appName;});
            document.querySelectorAll('[data-lh-name="person1"]').forEach(function(el){el.textContent=names.name1;});
            document.querySelectorAll('[data-lh-name="person2"]').forEach(function(el){el.textContent=names.name2;});
            var title=document.title;
            if(title.indexOf('Our Life Hub')!==-1)document.title=title.replace('Our Life Hub',appName);
            if(title.indexOf("Kasey's")!==-1)document.title=title.replace("Kasey's",names.name1+"'s");
            else if(title.indexOf('Kasey')!==-1)document.title=title.replace('Kasey',names.name1);
            if(title.indexOf("Charlie's")!==-1)document.title=title.replace("Charlie's",names.name2+"'s");
            else if(title.indexOf('Charlie')!==-1)document.title=title.replace('Charlie',names.name2);

            // ── Skip rewriting if all defaults ──
            if(ac==='sage'&&bc==='dark')return;

            // ── Build replacement map ──
            var reps=[];

            if(ac!=='sage'){
                var aRgb=rgbStr(A.base), sRgb=rgbStr(S.base);

                // PRIMARY ACCENT — hex values (green family)
                // Very dark greens
                reps.push(['#4a5c3f',A.vdark],['#4a6a3e',A.vdark],['#4A5C3F',A.vdark],['#4A6A3E',A.vdark]);
                // Dark greens
                reps.push(['#6d8a5e',A.dark],['#5a7a4a',A.dark],['#6D8A5E',A.dark],['#5A7A4A',A.dark]);
                // Medium-dark greens
                reps.push(['#7d8f76',A.mdark],['#8fa87a',A.mdark],['#8fa882',A.mdark],['#7a9b6a',A.mdark]);
                reps.push(['#7D8F76',A.mdark],['#8FA87A',A.mdark],['#8FA882',A.mdark],['#7A9B6A',A.mdark]);
                // Base greens
                reps.push(['#a3b899',A.base],['#A3B899',A.base],['#7ba886',A.base],['#7BA886',A.base]);
                // Light greens
                reps.push(['#b4c9aa',A.light],['#B4C9AA',A.light],['#b5c9a8',A.light],['#B5C9A8',A.light]);
                reps.push(['#a8c99b',A.light],['#A8C99B',A.light],['#b8c9ad',A.light],['#B8C9AD',A.light]);
                // Very light greens
                reps.push(['#b5d4a4',A.vlight],['#B5D4A4',A.vlight],['#c4d9b5',A.vlight],['#C4D9B5',A.vlight]);

                // SECONDARY ACCENT — hex values (rose family)
                // Very dark roses
                reps.push(['#5a4345',S.vdark],['#5a4a4c',S.vdark],['#5A4345',S.vdark],['#5A4A4C',S.vdark]);
                // Dark roses
                reps.push(['#6b5a5e',S.dark],['#7a6668',S.dark],['#6B5A5E',S.dark],['#7A6668',S.dark]);
                // Medium-dark roses
                reps.push(['#9a7a80',S.mdark],['#a57f85',S.mdark],['#9A7A80',S.mdark],['#A57F85',S.mdark]);
                reps.push(['#b4828c',S.mdark],['#B4828C',S.mdark]);
                // Base roses
                reps.push(['#b59197',S.base],['#B59197',S.base]);
                // Light roses
                reps.push(['#c5a1a7',S.light],['#c9a9a6',S.light],['#c8b8bb',S.light]);
                reps.push(['#C5A1A7',S.light],['#C9A9A6',S.light],['#C8B8BB',S.light]);
                // Very light roses
                reps.push(['#d4b5b8',S.vlight],['#d4b5ba',S.vlight],['#d4a5a5',S.vlight],['#d4a5ae',S.vlight]);
                reps.push(['#D4B5B8',S.vlight],['#D4B5BA',S.vlight],['#D4A5A5',S.vlight],['#D4A5AE',S.vlight]);
                // Extra light roses
                reps.push(['#e8d5d8',S.xlight],['#E8D5D8',S.xlight]);
                // Red-ish accent variants
                reps.push(['#c97a7a',S.redish],['#C97A7A',S.redish],['#d67373',S.redish],['#D67373',S.redish]);

                // TEAL (index calendar) — map to accent dark
                reps.push(['#3d6b6b',A.dark],['#3D6B6B',A.dark]);
                reps.push(['#4a7a7a',A.mdark],['#4A7A7A',A.mdark]);
                reps.push(['#5a9a9a',A.base],['#5A9A9A',A.base]);

                // GOLD/BROWN accents — map to accent or secondary variants
                reps.push(['#c4a882',A.light],['#C4A882',A.light],['#d4a882',A.light],['#D4A882',A.light]);
                reps.push(['#8a7a2e',A.dark],['#8A7A2E',A.dark],['#b5a33d',A.mdark],['#B5A33D',A.mdark]);
                reps.push(['#c9b84a',A.base],['#C9B84A',A.base]);
                reps.push(['#8a7a6d',S.dark],['#8A7A6D',S.dark]);
                reps.push(['#edecd5',A.xlight],['#EDECD5',A.xlight]);

                // PURPLE accents — map to secondary
                reps.push(['#a08cb4',S.light],['#A08CB4',S.light]);
                reps.push(['#c7ceea',S.xlight],['#C7CEEA',S.xlight]);

                // PASTEL PALETTE (wellness moods etc) — shift toward accent/secondary
                reps.push(['#a8e6cf',lighten(A.base,0.40)],['#98d8c8',lighten(A.base,0.35)]);
                reps.push(['#b4f8c8',lighten(A.base,0.50)]);
                reps.push(['#4ecdc4',A.base],['#45b7d1',A.mdark]);
                reps.push(['#95c9b4',A.light]);

                // rgba — PRIMARY ACCENT (sage green rgb: 163,184,153)
                reps.push([/rgba\(\s*163,\s*184,\s*153,\s*([0-9.]+)\s*\)/g,'rgba('+aRgb+',$1)']);
                // Other green rgbas
                reps.push([/rgba\(\s*122,\s*138,\s*110,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);
                reps.push([/rgba\(\s*168,\s*201,\s*155,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.light)+',$1)']);
                reps.push([/rgba\(\s*123,\s*168,\s*134,\s*([0-9.]+)\s*\)/g,'rgba('+aRgb+',$1)']);
                reps.push([/rgba\(\s*109,\s*138,\s*94,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);
                reps.push([/rgba\(\s*125,\s*143,\s*118,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.mdark)+',$1)']);
                // Teal rgba
                reps.push([/rgba\(\s*61,\s*107,\s*107,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);

                // rgba — SECONDARY (rose rgb: 181,145,151)
                reps.push([/rgba\(\s*181,\s*145,\s*151,\s*([0-9.]+)\s*\)/g,'rgba('+sRgb+',$1)']);
                reps.push([/rgba\(\s*201,\s*169,\s*166,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.light)+',$1)']);
                reps.push([/rgba\(\s*180,\s*130,\s*140,\s*([0-9.]+)\s*\)/g,'rgba('+sRgb+',$1)']);
                reps.push([/rgba\(\s*201,\s*122,\s*122,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.redish)+',$1)']);
                reps.push([/rgba\(\s*160,\s*140,\s*180,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.light)+',$1)']);
                reps.push([/rgba\(\s*196,\s*168,\s*130,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.light)+',$1)']);
                reps.push([/rgba\(\s*201,\s*184,\s*74,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.mdark)+',$1)']);
            }

            if(bc!=='dark'){
                // BACKGROUND
                reps.push(['#3d2f31',bg],['#3D2F31',bg],['#3c2f31',bg],['#3C2F31',bg]);
                reps.push(['#2a1f21',bgDk],['#2A1F21',bgDk]);
                reps.push(['#4a3a3c',bgMid],['#4A3A3C',bgMid],['#4a3b3e',bgMid],['#4A3B3E',bgMid]);

                // Background rgbas
                reps.push([/rgba\(\s*61,\s*47,\s*49,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bg)+',$1)']);
                reps.push([/rgba\(\s*60,\s*47,\s*49,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bg)+',$1)']);
                reps.push([/rgba\(\s*42,\s*31,\s*33,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bgDk)+',$1)']);
            }

            if(bc==='cream'){
                // TEXT — flip to dark for light background
                reps.push(['#f2ebe0',tc.t],['#F2EBE0',tc.t],['#e0d2d0',tc.t],['#E0D2D0',tc.t]);
                reps.push(['#EBE0D6',tc.t],['#ebe0d6',tc.t],['#f5ede6',tc.t],['#F5EDE6',tc.t]);
                reps.push(['#f5f0ed',tc.t],['#F5F0ED',tc.t],['#f0ebe6',tc.t],['#F0EBE6',tc.t]);
                reps.push(['#f0efe8',tc.t],['#F0EFE8',tc.t],['#faf8f6',tc.t],['#FAF8F6',tc.t]);
                reps.push(['#f7ebf0',tc.t],['#F7EBEF',tc.t]);
                reps.push(['#e3d6cc',tc.m],['#E3D6CC',tc.m],['#e0d5cb',tc.m],['#E0D5CB',tc.m]);
                reps.push([/rgba\(\s*242,\s*235,\s*224,\s*([0-9.]+)\s*\)/g,tc.m]);
                reps.push([/rgba\(\s*224,\s*210,\s*208,\s*([0-9.]+)\s*\)/g,tc.m]);
                // White text used in some buttons → dark
                reps.push(['#fff',tc.t],['#FFF',tc.t]);
            }

            // ── Apply replacements ──
            function applyReps(text){
                reps.forEach(function(pair){
                    if(pair[0] instanceof RegExp)text=text.replace(pair[0],pair[1]);
                    else text=text.split(pair[0]).join(pair[1]);
                });
                return text;
            }

            // Rewrite <style> tags
            document.querySelectorAll('style').forEach(function(s){
                var css=s.textContent,orig=css;
                css=applyReps(css);
                if(css!==orig)s.textContent=css;
            });

            // Rewrite inline styles
            document.querySelectorAll('[style]').forEach(function(el){
                var st=el.getAttribute('style'),orig=st;
                st=applyReps(st);
                if(st!==orig)el.setAttribute('style',st);
            });

            // Override CSS custom properties (meal-plan uses :root vars)
            var ov=document.createElement('style');
            ov.textContent=':root{--dark-bg:'+bg+'!important;--card-bg:'+bgDk+'!important;--sage-green:'+A.base+'!important;--muted-sage:'+A.mdark+'!important;--light-text:'+tc.t+'!important;--cream:'+tc.t+'!important;--border-color:rgba('+rgbStr(A.base)+',0.2)!important}';
            document.head.appendChild(ov);
        });
    })();
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Philosopher:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #3d2f31;
            --card-bg: #2a1f21;
            --sage-green: #a3b899;
            --muted-sage: #7d8f76;
            --light-text: #e0d2d0;
            --cream: #f2ebe0;
            --border-color: rgba(163, 184, 153, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Philosopher', serif;
            background: var(--dark-bg);
            min-height: 100vh;
            padding: 90px 16px 16px;
            color: var(--light-text);
        }
        
        /* Navigation Bar */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
            z-index: 9999;
            padding: 0 24px;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }
        
        .nav-logo {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--sage-green);
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }
        
        .nav-link {
            color: rgba(242, 235, 224, 0.7);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
            font-weight: 500;
        }
        
        .nav-link:hover {
            color: var(--sage-green);
        }
        
        .nav-link.active {
            color: var(--sage-green);
        }
        
        @media (max-width: 768px) {
            .nav-links {
                gap: 16px;
            }
            .nav-link {
                font-size: 0.85rem;
            }
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .header h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 2.5rem;
            color: var(--sage-green);
            font-weight: 400;
        }
        
        .header p {
            color: var(--light-text);
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            margin-top: 4px;
            opacity: 0.7;
        }
        
        .toggle-container {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .toggle-btn {
            padding: 10px 20px;
            border-radius: 4px;
            font-size: 0.875rem;
            font-family: 'Philosopher', serif;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            color: var(--light-text);
            letter-spacing: 0.05em;
        }
        
        .toggle-btn.active {
            background: var(--sage-green);
            color: var(--dark-bg);
            border: 1px solid var(--sage-green);
        }
        
        .goals {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            justify-content: center;
            gap: 32px;
            font-size: 0.875rem;
            border: 1px solid var(--border-color);
        }
        
        .goals span {
            color: var(--light-text);
            opacity: 0.7;
        }
        
        .goals strong {
            color: var(--sage-green);
        }
        
        .plan-progress {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 14px 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-color);
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }
        
        .progress-text span:first-child {
            color: var(--sage-green);
            font-weight: 600;
            letter-spacing: 0.03em;
        }
        
        .progress-text span:last-child {
            color: var(--light-text);
            opacity: 0.5;
            font-size: 0.75rem;
        }
        
        .progress-bar {
            height: 6px;
            background: rgba(163, 184, 153, 0.15);
            border-radius: 99px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--sage-green);
            border-radius: 99px;
            transition: width 0.4s ease;
        }
        
        .calendar-header-row {
            text-align: center;
            margin-bottom: 12px;
        }
        
        .calendar-header-row span {
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            color: var(--sage-green);
            font-weight: 600;
        }
        
        .calendar {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }
        
        .week-label {
            font-size: 0.7rem;
            color: var(--muted-sage);
            letter-spacing: 0.15em;
            margin-bottom: 10px;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }
        
        .week-label span {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--light-text);
            opacity: 0.6;
            letter-spacing: 0.05em;
        }
        
        .day-btn.is-today {
            box-shadow: 0 0 0 2px var(--sage-green), inset 0 0 0 1px rgba(163,184,153,0.3);
        }
        
        .day-btn.is-past .day-check {
            font-size: 0.55rem;
            opacity: 0.7;
        }
        
        .day-check {
            font-size: 0.55rem;
            line-height: 1;
        }
        
        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin-bottom: 16px;
        }
        
        .week-grid:last-child {
            margin-bottom: 0;
        }
        
        .day-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Philosopher', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
            font-weight: 500;
        }
        
        .day-letter {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.8;
        }
        
        .day-number {
            font-size: 1rem;
            font-weight: 700;
        }
        
        .day-detail {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            color: var(--dark-bg);
            flex-wrap: wrap;
            gap: 4px;
        }
        
        .day-header-left {
            display: flex;
            align-items: baseline;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .day-num {
            font-size: 1.1rem;
            font-weight: 700;
            white-space: nowrap;
        }
        
        .day-theme {
            font-size: 0.875rem;
            opacity: 0.9;
        }
        
        .day-header-right {
            display: flex;
            gap: 16px;
            font-size: 0.75rem;
        }
        
        .meals-container {
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .meal-btn {
            width: 100%;
            background: rgba(61, 47, 49, 0.3);
            border: none;
            border-bottom: 1px solid var(--border-color);
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-family: 'Philosopher', serif;
        }
        
        .meal-btn:hover {
            background: rgba(163, 184, 153, 0.1);
        }
        
        .meal-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .meal-info {
            flex: 1;
        }
        
        .meal-type {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--sage-green);
            margin-bottom: 2px;
        }
        
        .meal-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 2px;
        }
        
        .meal-portion {
            font-size: 0.75rem;
            color: var(--light-text);
            opacity: 0.6;
        }
        
        .meal-arrow {
            color: var(--sage-green);
            font-size: 1.2rem;
            opacity: 0.5;
        }
        
        /* Modal */
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10002;
            padding: 20px;
        }
        
        .modal-container.active {
            display: flex;
        }
        
        .modal {
            background: var(--card-bg);
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
        }
        
        .modal-header {
            padding: 24px 20px 20px;
            color: var(--dark-bg);
            border-radius: 12px 12px 0 0;
            position: relative;
            overflow: visible;
        }
        
        .modal-header h3 {
            font-size: 1.25rem;
            line-height: 1.3;
            margin-bottom: 8px;
            font-weight: 400;
            padding-right: 44px;
            word-wrap: break-word;
        }
        
        .modal-header .meta {
            font-size: 0.875rem;
            opacity: 0.9;
            padding-right: 44px;
        }
        
        .modal-close {
            position: absolute;
            top: 20px;
            right: 12px;
            background: none;
            border: none;
            color: var(--dark-bg);
            opacity: 0.8;
            font-size: 1.5rem;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            opacity: 1;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-section {
            margin-bottom: 20px;
        }
        
        .modal-section h4 {
            color: var(--sage-green);
            margin-bottom: 12px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        .modal-section ul {
            list-style: none;
        }
        
        .modal-section li {
            color: var(--light-text);
            font-size: 0.875rem;
            margin-bottom: 6px;
            display: flex;
            gap: 8px;
        }
        
        .modal-section li span {
            color: var(--sage-green);
            min-width: 15px;
        }
        
        .step-number {
            background: var(--sage-green);
            color: var(--dark-bg);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            flex-shrink: 0;
        }
        
        .tip-box {
            background: rgba(163, 184, 153, 0.1);
            border-radius: 8px;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
        }
        
        .tip-box p {
            font-size: 0.875rem;
            color: var(--light-text);
            margin: 0;
        }
        
        .portions-row {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .portion-tag {
            background: rgba(163, 184, 153, 0.2);
            border-radius: 9999px;
            padding: 6px 12px;
            color: var(--light-text);
            font-size: 0.75rem;
            border: 1px solid var(--border-color);
        }
        
        /* ===== RESPONSIVE: DESKTOP ===== */
        @media (min-width: 769px) {
            .container {
                max-width: 700px;
            }
            .rb-grid {
                grid-template-columns: 1fr 1fr;
            }
            .modal {
                max-width: 560px;
            }
            .grocery-category {
                margin-bottom: 10px;
            }
            .gen-section {
                padding: 24px;
            }
        }

        /* ===== RESPONSIVE: SMALL MOBILE ===== */
        @media (max-width: 480px) {
            body {
                padding: 76px 8px 8px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .container {
                max-width: 100%;
            }
            
            .calendar {
                padding: 12px 8px;
            }
            
            .plan-progress {
                padding: 10px 12px;
            }

            .week-grid {
                gap: 4px;
            }

            .day-btn {
                aspect-ratio: auto;
                padding: 6px 2px;
                border-radius: 4px;
            }

            .day-letter {
                font-size: 0.55rem;
            }

            .day-number {
                font-size: 0.8rem;
            }
            
            .modal {
                max-height: 85vh;
            }
            .modal-container {
                padding: 10px;
            }

            .page-tab {
                padding: 9px 4px;
                font-size: 0.7rem;
            }

            .toggle-btn {
                padding: 8px 14px;
                font-size: 0.8rem;
            }

            .goals {
                gap: 16px;
                padding: 12px;
                font-size: 0.8rem;
            }

            .day-detail {
                padding: 14px;
            }
            .day-header {
                padding: 10px 12px;
            }
            .day-num {
                font-size: 0.95rem;
            }
            .day-theme {
                font-size: 0.78rem;
            }
            .day-header-right {
                gap: 10px;
                font-size: 0.7rem;
            }

            .meal-btn {
                padding: 12px;
                gap: 10px;
            }
            .meal-icon {
                width: 34px;
                height: 34px;
                font-size: 1rem;
            }
            .meal-name {
                font-size: 0.8rem;
            }
            .meal-portion {
                font-size: 0.7rem;
            }

            .modal-header {
                padding: 18px 16px 14px;
            }
            .modal-header h3 {
                font-size: 1.1rem;
            }
            .modal-body {
                padding: 16px;
            }
            .modal-section li {
                font-size: 0.8rem;
            }
            .tip-box p {
                font-size: 0.8rem;
            }

            .rb-card {
                padding: 12px;
            }
            .rb-card-name {
                font-size: 0.82rem;
            }
            .rb-filter {
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            .gen-section {
                padding: 14px;
            }
            .gen-section h3 {
                font-size: 0.82rem;
            }
            .gen-row {
                flex-direction: column;
                gap: 6px;
            }
            .gen-label {
                min-width: auto;
            }
            .gen-btn {
                font-size: 0.9rem;
                padding: 12px;
            }

            .diet-tag {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            .grocery-cat-header {
                padding: 8px 12px;
            }
            .grocery-cat-header h4 {
                font-size: 0.75rem;
            }
            .grocery-item {
                font-size: 0.72rem;
                padding: 5px 0;
            }

            .plan-selector select {
                font-size: 0.75rem !important;
            }
        }

        /* ===== RESPONSIVE: TINY MOBILE ===== */
        @media (max-width: 360px) {
            body {
                padding: 70px 6px 6px;
            }
            .header h1 {
                font-size: 1.5rem;
            }
            .page-tab {
                padding: 8px 2px;
                font-size: 0.62rem;
            }
            .toggle-btn {
                padding: 7px 10px;
                font-size: 0.75rem;
            }
            .goals {
                flex-direction: column;
                gap: 4px;
                text-align: center;
            }
            .day-header {
                flex-direction: column;
                text-align: center;
            }
            .day-header-left {
                justify-content: center;
            }
        }

        /* ===== HAMBURGER MENU ===== */
        .nav-hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            z-index: 10001;
        }
        .nav-hamburger span {
            display: block; width: 24px; height: 2px;
            background: #a3b899; margin: 5px 0;
            transition: all 0.3s ease;
        }
        .nav-hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .nav-hamburger.open span:nth-child(2) { opacity: 0; }
        .nav-hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }
        .nav-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #2a1f21;
            z-index: 10000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .nav-overlay.open { display: flex; }
        .nav-link-mobile {
            color: rgba(242, 235, 224, 0.7);
            text-decoration: none;
            font-size: 1.3rem;
            font-family: 'Philosopher', Georgia, serif;
            font-weight: 500;
            padding: 18px 40px;
            transition: color 0.2s;
            display: block;
            width: 100%;
            text-align: center;
        }
        .nav-link-mobile:hover { color: #f2ebe0; }
        .nav-link-mobile.active { color: #a3b899; }
        @media (max-width: 768px) {
            .nav-hamburger { display: block; }
            .nav-links { display: none; }
        }

        /* ===== PAGE TABS ===== */
        .page-tabs {
            display: flex;
            gap: 4px;
            background: rgba(42, 31, 33, 0.6);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 16px;
            border: 1px solid var(--border-color);
        }
        .page-tab {
            flex: 1;
            padding: 10px 8px;
            background: none;
            border: none;
            color: rgba(224, 210, 208, 0.5);
            font-family: 'Philosopher', serif;
            font-size: 0.8rem;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            letter-spacing: 0.03em;
        }
        .page-tab:hover { color: var(--light-text); }
        .page-tab.active {
            background: rgba(163, 184, 153, 0.15);
            color: var(--sage-green);
        }
        .tab-view { display: none; }
        .tab-view.active { display: block; }

        /* ===== RECIPE BANK ===== */
        .rb-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .rb-search {
            flex: 1;
            min-width: 140px;
            padding: 10px 14px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--light-text);
            font-family: 'Philosopher', serif;
            font-size: 0.85rem;
        }
        .rb-search::placeholder { color: rgba(224, 210, 208, 0.3); }
        .rb-search:focus { outline: none; border-color: var(--sage-green); }
        .rb-filters {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        .rb-filter {
            padding: 8px 12px;
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: rgba(224, 210, 208, 0.5);
            font-family: 'Philosopher', serif;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .rb-filter:hover { color: var(--light-text); }
        .rb-filter.active {
            background: rgba(163, 184, 153, 0.15);
            color: var(--sage-green);
            border-color: rgba(163, 184, 153, 0.3);
        }
        .rb-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        .rb-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .rb-card:hover { border-color: rgba(163, 184, 153, 0.4); }
        .rb-card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }
        .rb-card-name {
            font-size: 0.9rem;
            color: var(--cream);
            font-weight: 400;
            flex: 1;
            padding-right: 8px;
        }
        .rb-card-fav {
            background: none;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            padding: 2px;
            opacity: 0.3;
            transition: all 0.2s;
        }
        .rb-card-fav.favorited { opacity: 1; }
        .rb-card-meta {
            font-size: 0.7rem;
            color: rgba(224, 210, 208, 0.4);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 6px;
        }
        .rb-card-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        .rb-tag {
            padding: 2px 8px;
            border-radius: 99px;
            font-size: 0.65rem;
            letter-spacing: 0.04em;
        }
        .rb-tag-breakfast { background: rgba(163, 184, 153, 0.15); color: var(--sage-green); }
        .rb-tag-lunch { background: rgba(196, 168, 130, 0.15); color: #c4a882; }
        .rb-tag-dinner { background: rgba(180, 130, 140, 0.15); color: #b4828c; }
        .rb-tag-dessert { background: rgba(160, 140, 180, 0.15); color: #a08cb4; }
        .rb-tag-snack { background: rgba(125, 143, 118, 0.15); color: var(--muted-sage); }
        .rb-tag-cuisine { background: rgba(224, 210, 208, 0.08); color: rgba(224, 210, 208, 0.5); }
        .rb-count {
            font-size: 0.75rem;
            color: rgba(224, 210, 208, 0.3);
            text-align: center;
            padding: 12px 0;
        }
        .rb-empty {
            text-align: center;
            padding: 40px 20px;
            color: rgba(224, 210, 208, 0.3);
            font-size: 0.85rem;
        }

        /* ===== GENERATE VIEW ===== */
        .gen-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 12px;
        }
        .gen-section h3 {
            font-size: 0.9rem;
            color: var(--sage-green);
            margin-bottom: 12px;
            font-weight: 400;
            letter-spacing: 0.03em;
        }
        .gen-row {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
            align-items: center;
        }
        .gen-label {
            font-size: 0.8rem;
            color: rgba(224, 210, 208, 0.6);
            min-width: 90px;
        }
        .gen-input {
            flex: 1;
            padding: 8px 12px;
            background: rgba(61, 47, 49, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--light-text);
            font-family: 'Philosopher', serif;
            font-size: 0.85rem;
        }
        .gen-input:focus { outline: none; border-color: var(--sage-green); }
        .gen-btn {
            width: auto;
            display: inline-block;
            padding: 10px 22px;
            background: var(--sage-green);
            color: var(--dark-bg);
            border: none;
            border-radius: 8px;
            font-family: 'Philosopher', serif;
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            letter-spacing: 0.03em;
        }
        .gen-btn:hover { opacity: 0.9; }
        .gen-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .gen-btn-secondary {
            background: none;
            border: 1px solid var(--sage-green);
            color: var(--sage-green);
        }
        .gen-status {
            text-align: center;
            padding: 20px;
            font-size: 0.85rem;
            color: rgba(224, 210, 208, 0.5);
        }
        .gen-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(163, 184, 153, 0.2);
            border-top-color: var(--sage-green);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .gen-preview-day {
            background: rgba(61, 47, 49, 0.4);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
        }
        .gen-preview-day h4 {
            font-size: 0.8rem;
            color: var(--sage-green);
            margin-bottom: 8px;
            font-weight: 400;
        }
        .gen-preview-meal {
            font-size: 0.75rem;
            color: rgba(224, 210, 208, 0.6);
            padding: 4px 0;
        }
        .gen-preview-meal strong {
            color: var(--light-text);
            font-weight: 400;
        }
        .gen-checkbox-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: rgba(224, 210, 208, 0.6);
        }
        .gen-checkbox-row input[type="checkbox"] {
            accent-color: var(--sage-green);
        }

        .gen-chip {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: rgba(163, 184, 153, 0.08);
            border: 1px solid rgba(163, 184, 153, 0.2);
            border-radius: 20px;
            font-size: 0.75rem;
            color: rgba(224, 210, 208, 0.6);
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        .gen-chip:has(input:checked) {
            background: rgba(163, 184, 153, 0.2);
            border-color: rgba(163, 184, 153, 0.5);
            color: var(--light-text);
        }
        .gen-chip:hover {
            border-color: rgba(163, 184, 153, 0.4);
        }
        .gen-chip input[type="checkbox"] {
            accent-color: var(--sage-green);
            width: 13px;
            height: 13px;
            margin: 0;
        }

        .diet-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: rgba(163, 184, 153, 0.15);
            border: 1px solid rgba(163, 184, 153, 0.3);
            border-radius: 20px;
            font-size: 0.7rem;
            color: rgba(224, 210, 208, 0.7);
        }
        .diet-tag button {
            background: none;
            border: none;
            color: rgba(180, 130, 140, 0.6);
            font-size: 0.85rem;
            cursor: pointer;
            padding: 0 2px;
            line-height: 1;
        }
        .diet-tag button:hover {
            color: #b4828c;
        }

        .grocery-category {
            margin-bottom: 14px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }
        .grocery-cat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: rgba(163,184,153,0.1);
            cursor: pointer;
        }
        .grocery-cat-header h4 {
            margin: 0;
            font-size: 0.8rem;
            color: var(--sage-green);
            letter-spacing: 0.05em;
        }
        .grocery-cat-header span {
            font-size: 0.65rem;
            color: rgba(224,210,208,0.4);
        }
        .grocery-cat-items {
            padding: 6px 14px 10px;
        }
        .grocery-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 0;
            border-bottom: 1px solid rgba(224,210,208,0.06);
            font-size: 0.78rem;
            color: var(--light-text);
        }
        .grocery-item:last-child { border-bottom: none; }
        .grocery-item input[type="checkbox"] {
            accent-color: var(--sage-green);
            flex-shrink: 0;
        }
        .grocery-item.checked span {
            text-decoration: line-through;
            opacity: 0.4;
        }
        .grocery-item .grocery-remove {
            margin-left: auto;
            background: none;
            border: none;
            color: rgba(180,130,140,0.4);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 0 4px;
        }
        .grocery-item .grocery-remove:hover { color: #b4828c; }

        /* Add recipe form */
        #add-recipe-form input,
        #add-recipe-form select,
        #add-recipe-form textarea {
            font-size: 0.8rem;
        }
        @media (max-width: 480px) {
            #add-recipe-form input,
            #add-recipe-form select,
            #add-recipe-form textarea {
                font-size: 0.75rem;
                padding: 7px 10px;
            }
            #grocery-view h3 {
                font-size: 0.9rem !important;
            }
            #modal-swap-list button {
                font-size: 0.72rem !important;
                padding: 8px 10px !important;
            }
        }

        /* ===== PLAN SELECTOR ===== */
        .plan-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding: 10px 14px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        .plan-selector label {
            font-size: 0.75rem;
            color: rgba(224, 210, 208, 0.5);
            white-space: nowrap;
        }
        .plan-selector select {
            flex: 1;
            padding: 6px 10px;
            background: rgba(61, 47, 49, 0.6);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--light-text);
            font-family: 'Philosopher', serif;
            font-size: 0.85rem;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M6 8L1 3h10z' fill='%23a3b899'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 28px;
        }
        .plan-selector select:focus {
            outline: none;
            border-color: var(--sage-green);
        }
        .plan-delete-btn {
            background: none;
            border: 1px solid rgba(180, 130, 140, 0.3);
            color: rgba(180, 130, 140, 0.6);
            font-size: 0.7rem;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Philosopher', serif;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .plan-delete-btn:hover {
            border-color: rgba(180, 130, 140, 0.6);
            color: #b4828c;
        }
    </style>
</head>
<body>
<nav class="top-nav">
<div class="nav-container">
<a href="index.html" class="nav-logo">Our Life Hub</a>
<div class="nav-links">
<a href="index.html" class="nav-link">Home</a>
<a href="kasey-hub.html" class="nav-link">Kasey</a>
<a href="charlie-hub.html" class="nav-link">Charlie</a>
<a href="our-dreams.html" class="nav-link">Us ♡</a>
<a href="meal-plan.html" class="nav-link active">Meals</a>
<a href="settings.html" class="nav-link">Settings</a>
</div>
<div style="display:flex;align-items:center;gap:2px;">
<button onclick="location.reload()" aria-label="Refresh" style="background:none;border:none;color:rgba(224,210,208,0.6);font-size:1.2rem;cursor:pointer;padding:6px;">&#x21bb;</button>
<button class="nav-hamburger" id="navHamburger" onclick="toggleNav()" aria-label="Menu">
    <span></span>
    <span></span>
    <span></span>
</button>
</div>
</div>
</nav>
<div class="nav-overlay" id="navOverlay" onclick="toggleNav()">
    <a href="index.html" class="nav-link-mobile">Home</a>
    <a href="kasey-hub.html" class="nav-link-mobile">Kasey</a>
    <a href="charlie-hub.html" class="nav-link-mobile">Charlie</a>
    <a href="our-dreams.html" class="nav-link-mobile">Us ♡</a>
    <a href="meal-plan.html" class="nav-link-mobile active">Meals</a>
    <a href="settings.html" class="nav-link-mobile">Settings</a>
</div>

<div class="container">
    <div class="header">
        <h1>Meal Plan</h1>
        <p id="header-subtitle" style="display:none;"></p>
    </div>
    
    <div class="page-tabs">
        <button class="page-tab active" onclick="switchTab('plan')">Plan</button>
        <button class="page-tab" onclick="switchTab('recipes')">Recipes</button>
        <button class="page-tab" onclick="switchTab('grocery')">Grocery</button>
        <button class="page-tab" onclick="switchTab('generate')">Generate</button>
    </div>

    <div id="plan-view" class="tab-view active">
    
    <div class="plan-selector" id="plan-selector" style="display:none;">
        <label>Plan:</label>
        <select id="plan-dropdown" onchange="switchPlan(this.value)"></select>
        <button class="plan-delete-btn" id="plan-delete-btn" onclick="deleteCurrentPlan()">Delete</button>
    </div>

    <div class="toggle-container">
        <button class="toggle-btn active" data-person="kasey">Kasey</button>
        <button class="toggle-btn" data-person="charlie">Charlie</button>
    </div>
    
    <div class="goals">
        <div><span>Protein:</span> <strong id="goal-protein">140-165g</strong></div>
        <div><span>Calories:</span> <strong id="goal-calories">1,500-1,700</strong></div>
    </div>
    
    <div class="plan-progress" id="plan-progress">
        <div class="progress-text"><span id="progress-label">Day 1 of 14</span><span id="progress-dates"></span></div>
        <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
    </div>

    <div class="calendar">
        <div class="calendar-header-row" style="display:none;">
            <span id="cal-month-label">FEBRUARY 2026</span>
        </div>
        <div class="week-label">WEEK 1 <span id="week1-range"></span></div>
        <div class="week-grid" id="week1"></div>
        <div class="week-label">WEEK 2 <span id="week2-range"></span></div>
        <div class="week-grid" id="week2"></div>
    </div>
    
    <div class="day-detail">
        <div class="day-header" id="day-header">
            <div class="day-header-left">
                <div class="day-num" id="day-num">1</div>
                <div class="day-theme" id="day-theme">Italian</div>
            </div>
            <div class="day-header-right">
                <div id="day-protein">145g</div>
                <div id="day-calories">1,600 cal</div>
            </div>
        </div>
        <div class="meals-container" id="meals-container"></div>
    </div>
    </div><!-- end plan-view -->

    <!-- RECIPE BANK VIEW -->
    <div id="recipes-view" class="tab-view">
        <div class="rb-toolbar">
            <input type="text" class="rb-search" id="rb-search" placeholder="Search recipes..." oninput="filterRecipes()">
        </div>
        <div class="rb-filters" id="rb-filters">
            <button class="rb-filter active" data-filter="all" onclick="setRecipeFilter('all', this)">All</button>
            <button class="rb-filter" data-filter="Breakfast" onclick="setRecipeFilter('Breakfast', this)">Breakfast</button>
            <button class="rb-filter" data-filter="Lunch" onclick="setRecipeFilter('Lunch', this)">Lunch</button>
            <button class="rb-filter" data-filter="Dinner" onclick="setRecipeFilter('Dinner', this)">Dinner</button>
            <button class="rb-filter" data-filter="Dessert" onclick="setRecipeFilter('Dessert', this)">Dessert</button>
            <button class="rb-filter" data-filter="favorites" onclick="setRecipeFilter('favorites', this)">♥ Favs</button>
        </div>
        <div class="rb-count" id="rb-count"></div>
        <div id="add-recipe-form" style="display:none;margin-bottom:16px;background:var(--card-bg);border-radius:8px;border:1px solid var(--border-color);padding:14px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                <h4 style="margin:0;color:var(--sage-green);font-size:0.85rem;">Add Custom Recipe</h4>
                <button onclick="document.getElementById('add-recipe-form').style.display='none'" style="background:none;border:none;color:rgba(224,210,208,0.4);font-size:1.1rem;cursor:pointer;">×</button>
            </div>
            <input id="ar-name" placeholder="Recipe name" style="width:100%;padding:8px 10px;margin-bottom:8px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.8rem;box-sizing:border-box;">
            <div style="display:flex;gap:6px;margin-bottom:8px;">
                <select id="ar-type" style="flex:1;padding:8px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.8rem;">
                    <option value="Breakfast">Breakfast</option>
                    <option value="Lunch">Lunch</option>
                    <option value="Dinner" selected>Dinner</option>
                    <option value="Dessert">Dessert</option>
                </select>
                <input id="ar-protein" placeholder="Protein (g)" style="width:70px;padding:8px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.8rem;">
                <input id="ar-cal" placeholder="Calories" style="width:70px;padding:8px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.8rem;">
            </div>
            <textarea id="ar-ingredients" placeholder="Ingredients (one per line)" style="width:100%;min-height:70px;padding:8px 10px;margin-bottom:8px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.78rem;resize:vertical;box-sizing:border-box;"></textarea>
            <textarea id="ar-steps" placeholder="Steps (one per line)" style="width:100%;min-height:70px;padding:8px 10px;margin-bottom:8px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.78rem;resize:vertical;box-sizing:border-box;"></textarea>
            <input id="ar-tip" placeholder="Tip or note (optional)" style="width:100%;padding:8px 10px;margin-bottom:10px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.8rem;box-sizing:border-box;">
            <button onclick="saveCustomRecipe()" style="width:100%;padding:10px;background:var(--sage-green);color:#1a1a1a;border:none;border-radius:6px;font-family:'Philosopher',serif;font-size:0.8rem;cursor:pointer;font-weight:700;">Save Recipe</button>
        </div>
        <button onclick="document.getElementById('add-recipe-form').style.display='block'" id="add-recipe-btn" style="width:100%;padding:10px;margin-bottom:16px;background:rgba(163,184,153,0.1);border:1px dashed rgba(163,184,153,0.3);border-radius:6px;color:#a3b899;font-family:'Philosopher',serif;font-size:0.78rem;cursor:pointer;letter-spacing:0.03em;">+ Add Custom Recipe</button>
        <div class="rb-grid" id="rb-grid"></div>
    </div>

    <!-- GROCERY LIST VIEW -->
    <div id="grocery-view" class="tab-view">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <h3 style="margin:0;color:var(--light-text);font-size:1rem;">Grocery List</h3>
            <div style="display:flex;gap:8px;">
                <button onclick="generateGroceryList()" class="gen-btn" style="font-size:0.75rem;padding:8px 14px;margin:0;">Generate from Plan</button>
            </div>
        </div>
        <div id="grocery-list-content">
            <div style="color:rgba(224,210,208,0.4);font-size:0.8rem;text-align:center;padding:40px 20px;">
                Tap "Generate from Plan" to build your grocery list from the current meal plan.
            </div>
        </div>
        <div id="grocery-send-bar" style="display:none;position:sticky;bottom:0;padding:12px 0;background:var(--bg-color);">
            <button onclick="sendGroceryToHomeHub()" class="gen-btn" style="width:100%;margin:0;background:#a3b899;">Send to Home Hub Grocery List</button>
        </div>
    </div>

    <!-- GENERATE PLAN VIEW -->
    <div id="generate-view" class="tab-view">
        <div class="gen-section">
            <h3>Generate New 2-Week Plan</h3>
            <div class="gen-row">
                <span class="gen-label">Start Date</span>
                <input type="date" class="gen-input" id="gen-start-date">
            </div>
            <div class="gen-row">
                <span class="gen-label">Duration</span>
                <select class="gen-input" id="gen-duration">
                    <option value="7">1 Week (7 days)</option>
                    <option value="14" selected>2 Weeks (14 days)</option>
                </select>
            </div>
        </div>

        <div class="gen-section">
            <h3>Preferences</h3>
            <div class="gen-checkbox-row">
                <input type="checkbox" id="gen-favor-favs" checked>
                <label for="gen-favor-favs">Prioritize favorite recipes</label>
            </div>
            <div class="gen-checkbox-row">
                <input type="checkbox" id="gen-new-recipes" checked>
                <label for="gen-new-recipes">Include ~30% new recipe ideas</label>
            </div>
            <div class="gen-checkbox-row">
                <input type="checkbox" id="gen-no-repeat" checked>
                <label for="gen-no-repeat">No same meal two days in a row</label>
            </div>
            <div class="gen-checkbox-row">
                <input type="checkbox" id="gen-prep-days" checked>
                <label for="gen-prep-days">Include prep day schedules</label>
            </div>
        </div>

        <div class="gen-section">
            <h3>Vibe</h3>
            <div class="gen-row">
                <span class="gen-label">Spice Level</span>
                <select class="gen-input" id="gen-spice">
                    <option value="mild">Mild — keep it chill</option>
                    <option value="medium">Medium — some kick</option>
                    <option value="hot" selected>Hot — we love spice 🌶️</option>
                    <option value="extra">Extra — bring the heat 🔥</option>
                </select>
            </div>
            <div class="gen-row" style="flex-direction:column;align-items:flex-start;gap:6px;">
                <span class="gen-label">Cuisine Focus <span style="opacity:0.4;font-weight:400;font-size:0.7rem;">(pick any)</span></span>
                <div style="display:flex;flex-wrap:wrap;gap:6px;width:100%;">
                    <label class="gen-chip"><input type="checkbox" value="mediterranean" id="gen-c-med" checked> Mediterranean</label>
                    <label class="gen-chip"><input type="checkbox" value="mexican" id="gen-c-mex" checked> Mexican / Tex-Mex</label>
                    <label class="gen-chip"><input type="checkbox" value="asian" id="gen-c-asian"> Asian-inspired</label>
                    <label class="gen-chip"><input type="checkbox" value="italian" id="gen-c-ital" checked> Italian</label>
                    <label class="gen-chip"><input type="checkbox" value="comfort" id="gen-c-comfort"> Comfort food</label>
                    <label class="gen-chip"><input type="checkbox" value="indian" id="gen-c-indian"> Indian</label>
                    <label class="gen-chip"><input type="checkbox" value="korean" id="gen-c-korean"> Korean</label>
                    <label class="gen-chip"><input type="checkbox" value="middleeastern" id="gen-c-me"> Middle Eastern</label>
                </div>
            </div>
            <div class="gen-row">
                <span class="gen-label">Dinner Effort</span>
                <select class="gen-input" id="gen-effort">
                    <option value="quick">Quick — 20 min or less</option>
                    <option value="normal" selected>Normal — 20-35 min</option>
                    <option value="involved">Worth it — up to 45 min</option>
                </select>
            </div>
            <div class="gen-row">
                <span class="gen-label">Grocery Runs</span>
                <select class="gen-input" id="gen-grocery-runs">
                    <option value="minimal" selected>Minimal — reuse ingredients across days</option>
                    <option value="moderate">Moderate — some variety is fine</option>
                    <option value="variety">Max variety — don't care about overlap</option>
                </select>
            </div>
            <div class="gen-row" style="flex-direction:column;align-items:flex-start;gap:6px;">
                <span class="gen-label">Dessert Style <span style="opacity:0.4;font-weight:400;font-size:0.7rem;">(pick any)</span></span>
                <div style="display:flex;flex-wrap:wrap;gap:6px;width:100%;">
                    <label class="gen-chip"><input type="checkbox" value="light" id="gen-d-light" checked> Light & healthy</label>
                    <label class="gen-chip"><input type="checkbox" value="protein" id="gen-d-protein" checked> Protein-packed</label>
                    <label class="gen-chip"><input type="checkbox" value="treat" id="gen-d-treat"> Real treats</label>
                    <label class="gen-chip"><input type="checkbox" value="skip" id="gen-d-skip"> Skip desserts</label>
                </div>
            </div>
            <div class="gen-row" style="flex-direction:column;align-items:flex-start;gap:6px;">
                <span class="gen-label">Special Requests</span>
                <input type="text" id="gen-special" class="gen-input" style="width:100%;box-sizing:border-box;" placeholder="e.g. &quot;more one-pot meals&quot;, &quot;use up the ricotta&quot;, &quot;lighter lunches&quot;">
            </div>
        </div>

        <div class="gen-section">
            <h3>Dietary Reminders</h3>
            <div id="diet-tags" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px;"></div>
            <div style="display:flex;gap:6px;">
                <input type="text" id="diet-tag-input" placeholder="Add a reminder..." style="flex:1;padding:8px 12px;background:rgba(61,47,49,0.6);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:'Philosopher',serif;font-size:0.8rem;">
                <button onclick="addDietTag()" style="padding:8px 14px;background:var(--sage-green);color:#1a1a1a;border:none;border-radius:6px;font-family:'Philosopher',serif;font-size:0.8rem;cursor:pointer;font-weight:700;">Add</button>
            </div>
        </div>

        <div style="text-align:center;">
        <button class="gen-btn" id="gen-btn" onclick="generatePlan()">Generate Meal Plan</button>
        </div>
        
        <div id="gen-status" class="gen-status" style="display:none;"></div>
        <div id="gen-preview" style="display:none; margin-top: 16px;"></div>
    </div>
</div><!-- end container -->

<div class="modal-container" id="modal">
    <div class="modal">
        <div class="modal-header" id="modal-header">
            <button class="modal-close" onclick="closeModal()">×</button>
            <h3 id="modal-title">Recipe Name</h3>
            <div class="meta" id="modal-meta">25g protein • 350 cal • 25 min</div>
        </div>
        <div class="modal-body">
            <div class="modal-section">
                <h4>Ingredients</h4>
                <ul id="modal-ingredients"></ul>
            </div>
            <div class="modal-section">
                <h4>Instructions</h4>
                <ul id="modal-steps"></ul>
            </div>
            <div class="tip-box" id="modal-tip" style="display: none;">
                <p></p>
            </div>
            <div class="portions-row" id="modal-portions"></div>
            <div id="modal-swap-section" style="display:none;margin-top:12px;">
                <button id="modal-swap-btn" onclick="showSwapOptions()" style="width:100%;padding:10px;background:rgba(163,184,153,0.15);border:1px solid rgba(163,184,153,0.3);border-radius:6px;color:#a3b899;font-family:'Philosopher',serif;font-size:0.78rem;cursor:pointer;letter-spacing:0.03em;">Swap this meal</button>
                <div id="modal-swap-list" style="display:none;margin-top:10px;max-height:250px;overflow-y:auto;"></div>
            </div>
        </div>
    </div>
</div>

<script>
// SNACK MENU - pick whatever sounds good each day (~150-200 cal)
const snackMenu = [
    { name: "Barebell Protein Bar", portion: "20g protein - 200 cal", color: "#7d8f76",
        ingredients: ["1 Barebell protein bar (any flavor)"],
        steps: ["Unwrap. Eat."],
        tip: "High protein, low sugar, zero effort. Keep a box at home and one in your bag.",
        portions: ["20g protein", "200 cal", "0 min"]
    },
    { name: "1 Hard-Boiled Egg", portion: "6g protein - 70 cal", color: "#7d8f76",
        ingredients: ["1 egg"],
        steps: ["Boil a batch on Sunday — they keep 7 days in the fridge."],
        tip: "Complete protein plus choline for DNA repair. Batch-prep a dozen at the start of each week.",
        portions: ["6g protein", "70 cal", "0g fiber"]
    },
    { name: "1/2 Cup Cottage Cheese", portion: "14g protein - 90 cal", color: "#7d8f76",
        ingredients: ["1/2 cup low-fat cottage cheese"],
        steps: ["Scoop and eat. Top with anything from this list."],
        tip: "Casein protein for slow, sustained release. Great base for mixing with any fruit on this list.",
        portions: ["14g protein", "90 cal", "0g fiber"]
    },
    { name: "3/4 Cup Greek Yogurt", portion: "18g protein - 100 cal", color: "#7d8f76",
        ingredients: ["3/4 cup nonfat Greek yogurt"],
        steps: ["Scoop into bowl. Add whatever sounds good."],
        tip: "Probiotics for gut health, which is increasingly linked to cancer prevention. Great with berries, honey, or nuts.",
        portions: ["18g protein", "100 cal", "0g fiber"]
    },
    { name: "3/4 Cup Edamame", portion: "18g protein - 190 cal", color: "#7d8f76",
        ingredients: ["3/4 cup shelled edamame", "Flaky sea salt"],
        steps: ["Steam or microwave. Salt. Done."],
        tip: "Soy isoflavones have documented anti-cancer effects. One of the highest-protein plant snacks you can grab.",
        portions: ["18g protein", "190 cal", "4g fiber"]
    },
    { name: "Chocolate Covered Almonds (10)", portion: "4g protein - 150 cal", color: "#7d8f76",
        ingredients: ["10 chocolate covered almonds"],
        steps: ["Eat 10. Try not to eat 30."],
        tip: "Dark chocolate flavanols plus vitamin E from almonds. Portion into small bags for the week.",
        portions: ["4g protein", "150 cal", "2g fiber"]
    },
    { name: "1/4 Cup Hummus", portion: "5g protein - 100 cal", color: "#7d8f76",
        ingredients: ["1/4 cup hummus"],
        steps: ["Scoop with carrots, bell pepper, or a spoon. No judgment."],
        tip: "Chickpea fiber plus tahini healthy fats. Pairs with any raw veggie on this list.",
        portions: ["5g protein", "100 cal", "3g fiber"]
    },
    { name: "1.5 Tbsp Walnut Butter", portion: "3g protein - 140 cal", color: "#7d8f76",
        ingredients: ["1.5 tbsp walnut butter"],
        steps: ["Spread on fruit or eat straight."],
        tip: "Walnuts are the only nut with significant omega-3 ALA. Anti-inflammatory powerhouse.",
        portions: ["3g protein", "140 cal", "1g fiber"]
    },
    { name: "1 Medium Apple", portion: "0g protein - 95 cal", color: "#7d8f76",
        ingredients: ["1 medium apple"],
        steps: ["Slice or just bite into it."],
        tip: "Pectin fiber feeds beneficial gut bacteria. Great with walnut butter from this list.",
        portions: ["0g protein", "95 cal", "4g fiber"]
    },
    { name: "1/2 Banana", portion: "1g protein - 50 cal", color: "#7d8f76",
        ingredients: ["1/2 banana"],
        steps: ["Peel. Eat. Or slice and dip."],
        tip: "Prebiotic fiber for gut health. Potassium for blood pressure.",
        portions: ["1g protein", "50 cal", "1g fiber"]
    },
    { name: "1/2 Cup Mango", portion: "1g protein - 50 cal", color: "#7d8f76",
        ingredients: ["1/2 cup diced mango (fresh or frozen, thawed)"],
        steps: ["Dice fresh or thaw frozen."],
        tip: "Beta-carotene and vitamin C from whole food. Great with cottage cheese or yogurt.",
        portions: ["1g protein", "50 cal", "1g fiber"]
    },
    { name: "1/2 Cup Mixed Berries", portion: "0g protein - 40 cal", color: "#7d8f76",
        ingredients: ["1/2 cup mixed berries (fresh or frozen, thawed)"],
        steps: ["Rinse fresh or thaw frozen."],
        tip: "Anthocyanins and ellagic acid — two of the most studied anti-cancer compounds in fruit.",
        portions: ["0g protein", "40 cal", "2g fiber"]
    },
    { name: "1/2 Cup Strawberries", portion: "0g protein - 25 cal", color: "#7d8f76",
        ingredients: ["1/2 cup sliced strawberries"],
        steps: ["Slice and enjoy."],
        tip: "Ellagic acid has been shown to suppress cancer cell growth in lab studies. Also just delicious.",
        portions: ["0g protein", "25 cal", "2g fiber"]
    },
    { name: "1/2 Cup Pineapple", portion: "0g protein - 40 cal", color: "#7d8f76",
        ingredients: ["1/2 cup diced pineapple"],
        steps: ["Dice fresh or use pre-cut."],
        tip: "Bromelain enzyme has anti-inflammatory and potential anti-cancer properties.",
        portions: ["0g protein", "40 cal", "1g fiber"]
    },
    { name: "1/4 Cup Pomegranate Seeds", portion: "1g protein - 35 cal", color: "#7d8f76",
        ingredients: ["1/4 cup pomegranate seeds"],
        steps: ["Pop the seeds out or buy pre-seeded."],
        tip: "Punicalagins and ellagic acid — heavily studied for prostate cancer prevention especially.",
        portions: ["1g protein", "35 cal", "2g fiber"]
    },
    { name: "1 Cup Carrot Sticks", portion: "1g protein - 50 cal", color: "#7d8f76",
        ingredients: ["1 cup carrot sticks (or baby carrots)"],
        steps: ["Dip in hummus or eat plain."],
        tip: "Beta-carotene from food is safely protective (unlike supplements). Great dipper.",
        portions: ["1g protein", "50 cal", "4g fiber"]
    },
    { name: "1 Cup Green Tea", portion: "0g protein - 0 cal", color: "#7d8f76",
        ingredients: ["1 cup brewed green tea"],
        steps: ["Steep 3 min in hot (not boiling) water."],
        tip: "EGCG is one of the most studied anti-cancer compounds. Free calories, real protection.",
        portions: ["0g protein", "0 cal", "0g fiber"]
    },
    { name: "1 Tbsp Pumpkin Seeds", portion: "3g protein - 45 cal", color: "#7d8f76",
        ingredients: ["1 tbsp pumpkin seeds (pepitas)"],
        steps: ["Sprinkle on yogurt, cottage cheese, or eat by the handful."],
        tip: "Rich in zinc for immune function. Crunchy topper for anything.",
        portions: ["3g protein", "45 cal", "1g fiber"]
    },
    { name: "1 Tbsp Pistachios", portion: "2g protein - 45 cal", color: "#7d8f76",
        ingredients: ["1 tbsp shelled pistachios"],
        steps: ["Eat as-is or crush over yogurt."],
        tip: "Gamma-tocopherol (vitamin E form) and lutein. Great crunch.",
        portions: ["2g protein", "45 cal", "1g fiber"]
    },
    { name: "1 Tbsp Walnuts", portion: "2g protein - 50 cal", color: "#7d8f76",
        ingredients: ["1 tbsp walnuts, chopped"],
        steps: ["Eat plain, add to yogurt, or top cottage cheese."],
        tip: "The most anti-inflammatory nut. Only nut with significant omega-3 ALA.",
        portions: ["2g protein", "50 cal", "1g fiber"]
    },
    { name: "1 Tbsp Dark Chocolate Chips", portion: "1g protein - 70 cal", color: "#7d8f76",
        ingredients: ["1 tbsp dark chocolate chips"],
        steps: ["Sprinkle on anything. Or just eat them."],
        tip: "Flavanols from dark chocolate. A little goes a long way as a topper.",
        portions: ["1g protein", "70 cal", "1g fiber"]
    },
    { name: "String Cheese", portion: "7g protein - 80 cal", color: "#7d8f76",
        ingredients: ["1 Galbani reduced fat mozzarella string cheese"],
        steps: ["Peel and eat."],
        tip: "Calcium plus protein in a grab-and-go package. Keep these stocked.",
        portions: ["7g protein", "80 cal", "0g fiber"]
    },
    { name: "Trail Mix (pre-made batch)", portion: "10g protein - 200 cal", color: "#7d8f76",
        ingredients: ["2 tbsp walnuts", "2 tbsp dried tart cherries", "1 tbsp cacao nibs", "1 tbsp pumpkin seeds"],
        steps: ["Mix a big batch. Portion into baggies for the week."],
        tip: "Tart cherries have among the highest anti-inflammatory scores. Cacao nibs add flavanols. Concentrated antioxidant snack.",
        portions: ["10g protein", "200 cal", "3g fiber"]
    },
    { name: "Protein Chia Pudding", portion: "23g protein - 190 cal", color: "#7d8f76",
        ingredients: ["2 tbsp chia seeds", "1/2 cup unsweetened almond milk", "1/2 scoop protein powder", "1/2 tsp vanilla"],
        steps: ["Mix all ingredients. Refrigerate 2+ hours or overnight.", "Top with anything from this list."],
        tip: "Omega-3 ALA from chia plus protein powder. Prep several at once for the week.",
        portions: ["23g protein", "190 cal", "8g fiber"]
    }
];

const mealData = {
    kasey: {
        goals: { protein: "140-165g", calories: "1,500-1,700" },
        days: [
            {
                day: 1, theme: "Lemon Garlic", protein: "148g", calories: "1,590",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Cacao Berry Smoothie Bowl", portion: "42g protein - 420 cal", color: "#a3b899",
                        ingredients: ["1 cup unsweetened almond milk", "1.5 tbsp cacao powder (NOT Dutch-processed)", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "1 scoop ON Gold Standard Banana Cream whey", "1/2 cup frozen blueberries", "1/2 cup nonfat Greek yogurt", "--- TOPPINGS ---", "2 tbsp walnuts, chopped", "1 tbsp ground flaxseed", "1 tsp honey"],
                        steps: ["Blend almond milk, cacao, collagen, L-glutamine, MCT oil, whey, blueberries, and yogurt until thick.", "Pour into bowl.", "Top with walnuts, flaxseed, honey drizzle."],
                        tip: "Your full supplement stack blended right in. Blueberries are rich in anthocyanins linked to reduced cancer risk. Cacao (non-Dutch) retains maximum flavanols.",
                        portions: ["42g protein", "420 cal", "8g fiber", "5 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Spicy Black Bean Quesadilla", portion: "32g protein - 420 cal", color: "#a3b899",
                        ingredients: ["2 Mission Carb Balance tortillas", "1/2 cup black beans, drained", "1/3 cup Mexican blend shredded cheese", "2 tbsp salsa", "Hot sauce", "1 tbsp sour cream", "1 Galbani string cheese on the side"],
                        steps: ["Warm a tortilla in a dry pan over medium heat.", "Spread black beans on half, top with cheese.", "Fold and cook 2-3 min per side until golden and melty.", "Repeat with second tortilla if hungry.", "Dip in salsa and sour cream. Hit with hot sauce."],
                        tip: "Day 1 — no prep done yet, so this is a quick pantry lunch. Black beans are loaded with antioxidants and fiber. String cheese on the side bumps the protein.",
                        portions: ["32g protein", "420 cal", "12g fiber", "5 min"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Lemon Garlic Chicken over Farro", portion: "48g protein - 530 cal", color: "#a3b899",
                        ingredients: ["6 oz chicken breast cutlet", "1/2 cup cooked farro", "1 tbsp olive oil", "3 cloves garlic, minced", "Juice of 1 lemon", "1/2 tsp oregano", "Red pepper flakes", "1 cup roasted carrots", "2 tbsp shredded Parmesan", "Salt & pepper"],
                        steps: ["Cook farro according to package directions.", "Season chicken with salt, pepper, oregano, red pepper flakes.", "Heat olive oil in a pan over medium-high. Sear chicken 5-6 min per side until golden.", "In the last minute, add garlic to the pan. Squeeze lemon over everything.", "Toss carrots with olive oil, salt, roast at 400°F for 20 min.", "Plate farro, top with chicken, carrots, pan juices, and Parmesan."],
                        tip: "Use the fresh chicken cutlets tonight — they need to be cooked first. Garlic contains allicin with potent anti-cancer properties. Lemon boosts iron absorption. Cook extra chicken and farro for lunch prep!",
                        portions: ["48g protein", "530 cal", "6g fiber", "30 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Frozen Berry Yogurt Bark", portion: "14g protein - 160 cal", color: "#c4a882",
                        ingredients: ["3/4 cup nonfat Greek yogurt", "1/2 cup mixed berries", "1 tsp honey", "1 tbsp mini dark chocolate chips"],
                        steps: ["Mix yogurt with honey.", "Spread thin on parchment-lined sheet pan.", "Press berries and chocolate chips into yogurt.", "Freeze 2+ hours. Break into pieces."],
                        tip: "Make a batch tonight during prep — it freezes perfectly for the whole week. Yogurt probiotics, berry anthocyanins, and chocolate flavanols.",
                        portions: ["14g protein", "160 cal", "2g fiber", "5 min + freeze"]
                    }
                ]
            },
            {
                day: 2, theme: "Date Night", protein: "116g", calories: "1,270",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Protein Yogurt Parfait + Morning Shake", portion: "38g protein - 400 cal", color: "#a3b899",
                        ingredients: ["--- MORNING BOOST SHAKE ---", "1 cup unsweetened almond milk", "1.5 tbsp cacao powder (NOT Dutch-processed)", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "--- PARFAIT ---", "1 cup Oikos Triple Zero vanilla Greek yogurt", "1/2 cup fresh strawberries, sliced", "2 tbsp walnuts, chopped", "1 tsp honey drizzle"],
                        steps: ["Blend shake ingredients and sip alongside breakfast.", "Scoop yogurt into a bowl. Top with strawberries, walnuts, and honey."],
                        tip: "No prep done yet so keep it simple — shake gets your supplements in, parfait is high-protein and zero effort. Use up those fresh strawberries!",
                        portions: ["38g protein", "400 cal", "3g fiber", "5 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Spicy Chicken & Black Bean Bowl", portion: "44g protein - 490 cal", color: "#a3b899",
                        ingredients: ["5 oz chicken breast (leftover from last night's dinner)", "1/2 cup black beans", "1/2 cup cooked brown rice or farro (leftover from last night)", "1/4 cup corn", "2 tbsp Mexican blend shredded cheese", "2 tbsp salsa", "1 tbsp sour cream or Greek yogurt", "Hot sauce, garlic powder"],
                        steps: ["Reheat leftover chicken and grains from last night, plus beans and corn.", "Top with cheese, salsa, sour cream.", "Hit it with hot sauce."],
                        tip: "Using the extra chicken and farro you cooked last night. Black beans are among the highest-antioxidant foods by ORAC score. Light lunch before date night!",
                        portions: ["44g protein", "490 cal", "10g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🍷", name: "The Melting Pot — Date Night!", portion: "~30g protein - ~varies", color: "#d4a882",
                        ingredients: ["Reservations", "Good vibes"],
                        steps: ["Get dressed.", "Go to The Melting Pot.", "Enjoy fondue.", "Don't think about macros tonight."],
                        tip: "Happy Friday the 13th! Every good meal plan has room for living your life. Enjoy the night out — you've earned it.",
                        portions: ["date night", "enjoy!", "no dishes"]
                    }
                ]
            },
            {
                day: 3, theme: "Chipotle + Bolognese", protein: "148g", calories: "1,550", prep: "PREP DAY — Prep Session 1 today (Sat)",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Strawberry-Honey Overnight Oats", portion: "35g protein - 400 cal", color: "#a3b899",
                        ingredients: ["1/2 cup rolled oats", "1 cup unsweetened almond milk", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "3 tbsp hemp hearts", "1 tsp chia seeds", "--- MORNING TOPPINGS ---", "1/2 cup fresh strawberries, sliced", "1 tsp honey", "1 tbsp walnuts, chopped"],
                        steps: ["Combine oats, almond milk, collagen, L-glutamine, MCT oil, hemp hearts, and chia seeds in a jar.", "Stir well. Refrigerate overnight.", "Top with sliced strawberries, honey, and walnuts before eating."],
                        tip: "Prep these Friday night before bed — just grab from the fridge Saturday morning. All your supplements folded in. Fresh strawberries on top before they go bad.",
                        portions: ["35g protein", "400 cal", "8g fiber", "0 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Chipotle Chicken Wrap", portion: "42g protein - 460 cal", color: "#a3b899",
                        ingredients: ["4 oz shredded chicken (leftover from Day 1, or cook some fresh this morning during prep)", "1 Mission Carb Balance tortilla", "1 tbsp chipotle in adobo, minced", "1/4 cup cooked brown rice", "2 tbsp Mexican blend shredded cheese", "2 tbsp salsa", "Squeeze of lime"],
                        steps: ["Warm tortilla in a dry pan or microwave 15 sec.", "Layer rice, chicken, chipotle, cheese, salsa.", "Squeeze lime over. Wrap and eat."],
                        tip: "It's prep day! Get your chicken cooking early and shred some for this wrap. Chipotle peppers are smoked jalapeños — capsaicin has documented anti-inflammatory and anti-cancer properties.",
                        portions: ["42g protein", "460 cal", "9g fiber", "5 min"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Cauliflower Bolognese over Protein Spaghetti", portion: "45g protein - 530 cal", color: "#a3b899",
                        ingredients: ["4 oz ground turkey (93% lean)", "1 cup frozen riced cauliflower", "1 cup marinara sauce", "2 oz Kroger Protein Grain & Legume Spaghetti", "1/4 cup diced onion", "2 cloves garlic, minced", "1 tbsp olive oil", "2 tbsp shredded Parmesan", "Red pepper flakes", "Italian seasoning"],
                        steps: ["Cook protein spaghetti al dente. Drain and set aside.", "Heat olive oil. Sauté onion and garlic 3 min.", "Add ground turkey, break up and brown.", "Stir in riced cauliflower, cook 3 min.", "Pour in marinara. Add Italian seasoning and red pepper flakes. Simmer 10 min.", "Toss with spaghetti. Top with Parmesan."],
                        tip: "Cauliflower is cruciferous — ricing it into the sauce sneaks in cancer-fighting sulforaphane. The protein spaghetti adds extra fiber and protein vs regular pasta. Cooked tomato sauce = maximum lycopene.",
                        portions: ["45g protein", "530 cal", "10g fiber", "25 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Warm Mixed Berry Crumble", portion: "8g protein - 160 cal", color: "#c4a882",
                        ingredients: ["1/2 cup frozen mixed berries", "1 tbsp rolled oats", "1 tsp honey", "1/2 tsp cinnamon", "1 tsp butter", "1 tbsp chopped walnuts", "2 tbsp Greek yogurt for topping"],
                        steps: ["Put frozen berries in a small oven-safe dish or mug.", "Mix oats, honey, cinnamon, butter, and walnuts. Crumble on top.", "Microwave 2-3 min until berries are bubbling.", "Top with a dollop of Greek yogurt."],
                        tip: "Berries are among the highest-antioxidant foods. Heating them actually increases some bioavailable compounds. Quick comfort dessert with zero prep needed.",
                        portions: ["8g protein", "160 cal", "3g fiber", "5 min"]
                    }
                ]
            },
            {
                day: 4, theme: "Enchilada Sunday", protein: "149g", calories: "1,530",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Protein Yogurt Parfait", portion: "30g protein - 350 cal", color: "#a3b899",
                        ingredients: ["1 cup Oikos Triple Zero vanilla Greek yogurt", "1/2 cup fresh strawberries, sliced", "2 tbsp walnuts, chopped", "1 tsp honey drizzle"],
                        steps: ["Scoop yogurt into a bowl.", "Top with fresh strawberries, walnuts, and honey."],
                        tip: "Use up those fresh strawberries! Ellagic acid in strawberries has been shown to suppress cancer cell growth. Yogurt probiotics support gut health.",
                        portions: ["30g protein", "350 cal", "3g fiber", "3 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Chipotle Chicken Wrap", portion: "42g protein - 460 cal", color: "#a3b899",
                        ingredients: ["4 oz shredded chicken (from prep)", "1 Mission Carb Balance tortilla", "1 tbsp chipotle in adobo, minced", "1/4 cup cooked brown rice", "2 tbsp Mexican blend shredded cheese", "2 tbsp salsa", "Squeeze of lime"],
                        steps: ["Warm tortilla in a dry pan or microwave 15 sec.", "Layer rice, chicken, chipotle, cheese, salsa.", "Squeeze lime over. Wrap and eat."],
                        tip: "Same great wrap from Day 2 — still delicious, still easy. The carb balance tortilla keeps this high-fiber and high-protein.",
                        portions: ["42g protein", "460 cal", "9g fiber", "5 min"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Spicy Turkey Enchiladas", portion: "46g protein - 540 cal", color: "#a3b899",
                        ingredients: ["5 oz ground turkey (93% lean)", "1/4 cup diced onion", "2 cloves garlic, minced", "1 tsp cumin", "1 tsp chili powder", "Red pepper flakes", "3 Mission Carb Balance tortillas", "1 cup enchilada sauce", "1/2 cup Mexican blend shredded cheese", "2 tbsp sour cream", "Hot sauce"],
                        steps: ["Preheat oven to 375°F.", "Brown ground turkey with onion, garlic, cumin, chili powder, and red pepper flakes.", "Divide turkey mix between tortillas. Roll up and place seam-down in a baking dish.", "Pour enchilada sauce over. Top with cheese.", "Bake 20 min until bubbly and golden.", "Top with sour cream and hot sauce."],
                        tip: "First day eating prepped food! Cumin and chili powder both have anti-inflammatory properties. The carb balance tortillas keep the fiber high. Make a couple extra for Charlie's portions.",
                        portions: ["46g protein", "540 cal", "8g fiber", "35 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Chocolate Avocado Mousse", portion: "3g protein - 170 cal", color: "#c4a882",
                        ingredients: ["1/2 ripe avocado", "2 tbsp cocoa powder", "1 tbsp honey", "1 tbsp almond milk", "Pinch of sea salt"],
                        steps: ["Blend all ingredients until silky smooth.", "Chill 15 min for best texture.", "Top with a few berries if desired."],
                        tip: "You literally cannot taste the avocado — it just makes it impossibly creamy. Cocoa is one of the highest-antioxidant foods on earth. Use that avocado before it goes bad!",
                        portions: ["3g protein", "170 cal", "5g fiber", "5 min"]
                    }
                ]
            },
            {
                day: 5, theme: "Italian Comfort", protein: "150g", calories: "1,560",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Kefir Berry Smoothie", portion: "35g protein - 380 cal", color: "#a3b899",
                        ingredients: ["1 cup Lifeway strawberry kefir", "1/2 cup frozen mixed berries", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "1/2 banana"],
                        steps: ["Add all ingredients to a blender.", "Blend until smooth, about 30 seconds.", "Pour and drink."],
                        tip: "Kefir has 12+ strains of probiotics vs yogurt's 2-3. This is a gut health powerhouse. The frozen berries make it thick like a milkshake.",
                        portions: ["35g protein", "380 cal", "4g fiber", "3 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Lemony Chicken & Grain Bowl", portion: "42g protein - 480 cal", color: "#a3b899",
                        ingredients: ["5 oz grilled chicken (from prep)", "1/2 cup cooked farro or quinoa (from prep)", "1/4 cup chickpeas", "1/4 cup roasted red peppers (jarred)", "1 cup spinach", "1 tbsp olive oil", "Juice of 1/2 lemon", "Garlic powder, red pepper flakes"],
                        steps: ["Reheat chicken and grains.", "Toss spinach with olive oil and lemon juice to slightly wilt.", "Assemble bowl: grains, chicken, chickpeas, roasted red peppers, spinach.", "Sprinkle with garlic powder and red pepper flakes."],
                        tip: "Chickpeas provide folate for DNA repair. Roasted red peppers are loaded with vitamin C. The lemon-olive oil dressing is classic Mediterranean.",
                        portions: ["42g protein", "480 cal", "8g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Ricotta & Spinach Stuffed Zucchini Boats", portion: "42g protein - 480 cal", color: "#a3b899",
                        ingredients: ["2 medium zucchini, halved lengthwise", "1/2 cup ricotta cheese", "1 cup baby spinach, chopped", "2 cloves garlic, minced", "1/4 cup shredded Parmesan", "1 egg", "1/2 cup marinara sauce", "1/2 cup shredded mozzarella", "Italian seasoning, red pepper flakes", "1 tbsp olive oil"],
                        steps: ["Preheat oven to 375°F. Halve zucchini and scoop out centers.", "Mix ricotta, chopped spinach, garlic, Parmesan, egg, Italian seasoning, and red pepper flakes.", "Fill zucchini halves with the ricotta mixture.", "Spoon marinara over the top. Sprinkle with mozzarella.", "Bake 25-30 min until zucchini is tender and cheese is bubbly."],
                        tip: "Use the fresh zucchini and ricotta before they go! Zucchini is rich in vitamin C and potassium. Ricotta adds calcium. The marinara provides lycopene. This is Mediterranean comfort food.",
                        portions: ["42g protein", "480 cal", "5g fiber", "35 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Frozen Berry Yogurt Bark", portion: "14g protein - 160 cal", color: "#c4a882",
                        ingredients: ["3/4 cup nonfat Greek yogurt", "1/2 cup mixed berries", "1 tsp honey", "1 tbsp mini dark chocolate chips"],
                        steps: ["Grab from the freezer — you made this on Day 1!"],
                        tip: "Already prepped. Just break off a piece. Berry anthocyanins, yogurt probiotics, chocolate flavanols.",
                        portions: ["14g protein", "160 cal", "2g fiber", "0 min"]
                    }
                ]
            },
            {
                day: 6, theme: "Spicy Stew Night", protein: "152g", calories: "1,540",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Cacao Berry Smoothie Bowl", portion: "42g protein - 420 cal", color: "#a3b899",
                        ingredients: ["1 cup unsweetened almond milk", "1.5 tbsp cacao powder (NOT Dutch-processed)", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "1 scoop ON Gold Standard Banana Cream whey", "1/2 cup frozen blueberries", "1/2 cup nonfat Greek yogurt", "--- TOPPINGS ---", "2 tbsp walnuts, chopped", "1 tbsp ground flaxseed", "1 tsp honey"],
                        steps: ["Blend almond milk, cacao, collagen, L-glutamine, MCT oil, whey, blueberries, and yogurt until thick.", "Pour into bowl.", "Top with walnuts, flaxseed, honey drizzle."],
                        tip: "Your full supplement stack blended right in. Blueberries + cacao = massive antioxidant hit to start the day.",
                        portions: ["42g protein", "420 cal", "8g fiber", "5 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Chicken Burrito Bowl", portion: "43g protein - 480 cal", color: "#a3b899",
                        ingredients: ["5 oz grilled chicken (from prep)", "1/2 cup cooked brown rice", "1/2 cup black beans", "1/4 cup corn", "2 tbsp crumbled feta", "Squeeze of lime", "Hot sauce", "1 tbsp olive oil"],
                        steps: ["Reheat chicken, rice, beans, and corn.", "Assemble bowl. Top with feta and a big squeeze of lime.", "Hot sauce to taste."],
                        tip: "Feta + lime gives this a totally different vibe than the salsa-cheese version. Black beans and whole grain rice provide resistant starch that feeds anti-cancer gut bacteria.",
                        portions: ["43g protein", "480 cal", "9g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Spicy Red Lentil & Cauliflower Stew + Chicken", portion: "48g protein - 510 cal", color: "#a3b899",
                        ingredients: ["4 oz grilled chicken breast", "1/2 cup red lentils", "1 cup cauliflower florets", "1/2 cup diced carrots", "1 cup marinara sauce", "1/2 cup diced onion", "2 cloves garlic, minced", "Red pepper flakes, garlic powder, cumin", "1 tbsp olive oil", "Fresh parsley or cilantro", "Squeeze of lemon"],
                        steps: ["Heat olive oil. Sauté onion and garlic 3 min.", "Add garlic powder, cumin, red pepper flakes. Cook 30 seconds.", "Add lentils, marinara, cauliflower, carrots, and 1.5 cups water.", "Simmer 20 min until lentils are soft and stew is thick.", "Serve topped with sliced chicken, parsley, and a squeeze of lemon."],
                        tip: "Red lentils provide incredible fiber plus folate for DNA repair. Cauliflower is cruciferous (sulforaphane). Cooked tomato sauce maximizes lycopene. This is one of the most cancer-protective meals in the plan.",
                        portions: ["48g protein", "510 cal", "14g fiber", "30 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Dark Chocolate Strawberry Bites", portion: "3g protein - 150 cal", color: "#c4a882",
                        ingredients: ["4-5 fresh strawberries", "1 oz dark chocolate (70%+)", "Flaky sea salt"],
                        steps: ["Melt dark chocolate in a small bowl (microwave 30 sec, stir, repeat).", "Dip each strawberry halfway into chocolate.", "Place on parchment paper, sprinkle with flaky sea salt.", "Let set 10-15 min in fridge (or eat warm — no judgment)."],
                        tip: "Dark chocolate (70%+) is rich in flavanols with documented anti-cancer properties. Strawberries add vitamin C and ellagic acid. Sea salt makes the chocolate pop.",
                        portions: ["3g protein", "150 cal", "3g fiber", "10 min"]
                    }
                ]
            },
            {
                day: 7, theme: "Comfort Alfredo", protein: "151g", calories: "1,570",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Cacao-Berry Overnight Oats", portion: "44g protein - 430 cal", color: "#a3b899",
                        ingredients: ["1/2 cup rolled oats", "1 cup unsweetened almond milk", "1.5 tbsp cacao powder (NOT Dutch-processed)", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "1 scoop ON Gold Standard Banana Cream whey", "1 tsp chia seeds", "--- MORNING TOPPINGS ---", "1/2 cup frozen mixed berries (thawed)", "1 tbsp walnuts", "1 tsp honey"],
                        steps: ["Combine oats, almond milk, cacao, collagen, L-glutamine, MCT oil, whey, and chia seeds in a jar.", "Stir well. Refrigerate overnight.", "Top with thawed berries, walnuts, and honey before eating."],
                        tip: "Prepped — grab from fridge. Cacao oats are basically dessert for breakfast but with your full supplement stack built in.",
                        portions: ["44g protein", "430 cal", "10g fiber", "0 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Lemony Chicken & Grain Bowl", portion: "42g protein - 480 cal", color: "#a3b899",
                        ingredients: ["5 oz grilled chicken (from prep)", "1/2 cup cooked farro or quinoa (from prep)", "1/4 cup chickpeas", "1/4 cup roasted red peppers (jarred)", "1 cup spinach", "1 tbsp olive oil", "Juice of 1/2 lemon", "Garlic powder, red pepper flakes"],
                        steps: ["Reheat chicken and grains.", "Toss spinach with olive oil and lemon juice.", "Assemble bowl: grains, chicken, chickpeas, roasted red peppers, spinach.", "Sprinkle with garlic powder and red pepper flakes."],
                        tip: "Classic Mediterranean grain bowl. Olive oil + lemon is the foundation of the diet. Chickpeas add plant protein and fiber.",
                        portions: ["42g protein", "480 cal", "8g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Chicken Alfredo with Protein Pasta", portion: "46g protein - 520 cal", color: "#a3b899",
                        ingredients: ["5 oz chicken breast, sliced", "2 oz Kroger Protein Grain & Legume Spaghetti", "1/2 cup alfredo sauce", "1 cup baby spinach", "2 cloves garlic, minced", "1 tbsp olive oil", "2 tbsp shredded Parmesan", "Red pepper flakes", "Salt & pepper"],
                        steps: ["Cook protein spaghetti al dente.", "Season chicken with salt, pepper, garlic powder. Sear in olive oil 5-6 min per side. Slice.", "In the same pan, add garlic, cook 30 seconds. Add alfredo sauce and warm through.", "Toss in spinach until wilted. Add pasta and toss to coat.", "Plate and top with sliced chicken, Parmesan, and red pepper flakes."],
                        tip: "Comfort food night. The protein pasta bumps this way above regular alfredo nutritionally. Adding spinach sneaks in folate and iron. Garlic adds allicin.",
                        portions: ["46g protein", "520 cal", "6g fiber", "20 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Berry Crumble", portion: "5g protein - 180 cal", color: "#c4a882",
                        ingredients: ["1.5 cups mixed berries (fresh or frozen)", "2 tbsp rolled oats", "1 tbsp chopped walnuts", "1 tsp coconut oil", "1 tsp honey", "Pinch cinnamon", "Dollop Greek yogurt for topping"],
                        steps: ["Place berries in a small oven-safe dish.", "Mix oats, walnuts, coconut oil, honey, cinnamon. Crumble over berries.", "Bake at 375°F for 20-25 min until bubbly and golden.", "Top with a spoonful of Greek yogurt."],
                        tip: "Berries, oats, walnuts, and yogurt — every bite is anti-cancer. The warm crumble with cold yogurt is ridiculously good.",
                        portions: ["5g protein", "180 cal", "5g fiber", "25 min"]
                    }
                ]
            },
            {
                day: 8, theme: "Sweet Potato Spice", protein: "147g", calories: "1,510", prep: "PREP DAY — Prep Session 2 tonight after dinner",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Egg Muffin Cups + Morning Shake", portion: "38g protein - 380 cal", color: "#a3b899",
                        ingredients: ["--- MORNING BOOST SHAKE ---", "1 cup unsweetened almond milk", "1.5 tbsp cacao powder (NOT Dutch-processed)", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "--- EGG MUFFIN CUPS (x2) ---", "2 eggs (from batch)", "Spinach, onion, cheese (baked in)"],
                        steps: ["Blend shake ingredients and sip alongside breakfast.", "Reheat 2 egg muffin cups in microwave ~45 sec."],
                        tip: "Grab from freezer if you're into the second batch, or fridge if they're fresh from last prep. The shake gets your supplements in.",
                        portions: ["38g protein", "380 cal", "2g fiber", "2 min reheat"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Chicken Burrito Bowl", portion: "43g protein - 480 cal", color: "#a3b899",
                        ingredients: ["5 oz grilled chicken (from prep)", "1/2 cup cooked brown rice", "1/2 cup black beans", "1/4 cup corn", "2 tbsp crumbled feta", "Squeeze of lime", "Hot sauce", "1 tbsp olive oil"],
                        steps: ["Reheat chicken, rice, beans, and corn.", "Assemble bowl. Top with feta and lime.", "Hot sauce to taste."],
                        tip: "Feta is a Mediterranean staple — lower sodium than most cheeses and pairs beautifully with lime and black beans.",
                        portions: ["43g protein", "480 cal", "9g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Spicy Black Bean & Sweet Potato Bowl", portion: "38g protein - 490 cal", color: "#a3b899",
                        ingredients: ["1 medium sweet potato, cubed", "1/2 cup black beans", "1/4 cup corn", "2 tbsp crumbled feta", "1/4 cup cooked brown rice or quinoa", "1 tbsp olive oil", "1 tsp cumin", "1/2 tsp chili powder", "Garlic powder, red pepper flakes", "Squeeze of lime", "Hot sauce"],
                        steps: ["Preheat oven to 400°F. Toss cubed sweet potato with olive oil, cumin, chili powder, garlic powder.", "Roast 25 min until tender and caramelized.", "Warm black beans and corn with a pinch of cumin.", "Bowl: rice, sweet potato, beans, corn.", "Top with feta, lime squeeze, hot sauce."],
                        tip: "Sweet potato provides beta-carotene safely from food. Black beans are antioxidant powerhouses. Cumin has anti-cancer properties. This bowl is a flavor and nutrition bomb.",
                        portions: ["38g protein", "490 cal", "12g fiber", "35 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Protein Chia Pudding", portion: "23g protein - 190 cal", color: "#c4a882",
                        ingredients: ["2 tbsp chia seeds", "1/2 cup unsweetened almond milk", "1/2 scoop protein powder", "1/2 tsp vanilla", "1 tsp honey", "Berries for topping"],
                        steps: ["Mix chia seeds, almond milk, protein powder, vanilla, and honey.", "Refrigerate 2+ hours or overnight.", "Top with berries before eating."],
                        tip: "Chia seeds are loaded with omega-3 ALA and fiber. Make a couple of these during tonight's prep session for easy desserts later this week.",
                        portions: ["23g protein", "190 cal", "8g fiber", "5 min + chill"]
                    }
                ]
            },
            {
                day: 9, theme: "Asian Night", protein: "148g", calories: "1,530",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Kefir Berry Smoothie", portion: "35g protein - 380 cal", color: "#a3b899",
                        ingredients: ["1 cup Lifeway strawberry kefir", "1/2 cup frozen mixed berries", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "1/2 banana"],
                        steps: ["Add all ingredients to a blender.", "Blend until smooth.", "Pour and drink."],
                        tip: "Kefir's 12+ probiotic strains are linked to reduced inflammation and better immune function. The frozen berries make it thick and creamy.",
                        portions: ["35g protein", "380 cal", "4g fiber", "3 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Turkey Taco Wrap", portion: "40g protein - 450 cal", color: "#a3b899",
                        ingredients: ["4 oz seasoned ground turkey (from prep)", "1 Mission Carb Balance tortilla", "1/4 cup cooked brown rice", "2 tbsp Mexican blend shredded cheese", "2 tbsp salsa", "Hot sauce", "1 tbsp sour cream"],
                        steps: ["Warm tortilla. Reheat turkey and rice.", "Layer turkey, rice, cheese, salsa, sour cream.", "Wrap and eat. Add hot sauce."],
                        tip: "Prepped turkey makes this a 3-minute assembly. The carb balance tortillas have more fiber than most whole wheat breads.",
                        portions: ["40g protein", "450 cal", "8g fiber", "3 min"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Asian Garlic-Honey Chicken & Rice", portion: "46g protein - 520 cal", color: "#a3b899",
                        ingredients: ["6 oz chicken breast", "1/2 cup cooked white rice", "1 cup roasted carrots and green beans", "--- GLAZE ---", "2 tbsp soy sauce (or coconut aminos)", "1 tbsp honey", "3 cloves garlic, minced", "1 tsp fresh ginger or 1/2 tsp ground", "Red pepper flakes", "1 tsp sesame oil"],
                        steps: ["Mix soy sauce, honey, garlic, ginger, red pepper flakes, and sesame oil.", "Season chicken with salt & pepper. Sear in a hot pan 5-6 min per side.", "In the last 2 minutes, pour glaze over chicken. Let it caramelize and get sticky.", "Roast carrots and green beans at 400°F with olive oil, salt, 20 min.", "Serve chicken over rice with roasted veggies. Spoon extra glaze from the pan over everything."],
                        tip: "Ginger has documented anti-inflammatory and anti-nausea properties. Garlic's allicin is anti-cancer. The honey glaze caramelizes beautifully — you won't miss takeout.\n\n🐟 OPTIONAL SWAP: Replace chicken with a 6 oz salmon fillet. Same glaze, same method — sear skin-side down first. The strong garlic-honey glaze completely masks any fishiness.",
                        portions: ["46g protein", "520 cal", "4g fiber", "25 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Chocolate Covered Almonds + Green Tea", portion: "4g protein - 150 cal", color: "#c4a882",
                        ingredients: ["10 chocolate covered almonds", "1 cup brewed green tea"],
                        steps: ["Steep green tea 3 min in hot (not boiling) water.", "Eat almonds. Sip tea."],
                        tip: "Dark chocolate flavanols + vitamin E from almonds + EGCG from green tea. Three anti-cancer compounds in one low-effort dessert.",
                        portions: ["4g protein", "150 cal", "2g fiber", "5 min"]
                    }
                ]
            },
            {
                day: 10, theme: "Chipotle Orzo", protein: "150g", calories: "1,540",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Protein Yogurt Parfait", portion: "30g protein - 350 cal", color: "#a3b899",
                        ingredients: ["1 cup Oikos Triple Zero vanilla Greek yogurt", "1/2 cup frozen mixed berries (thawed)", "2 tbsp walnuts, chopped", "1 tsp honey drizzle"],
                        steps: ["Scoop yogurt into a bowl.", "Top with thawed berries, walnuts, and honey."],
                        tip: "Simple, satisfying, probiotic-rich. The berries thaw overnight in the fridge — zero effort in the morning.",
                        portions: ["30g protein", "350 cal", "3g fiber", "3 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Spicy Chicken & Black Bean Bowl", portion: "44g protein - 490 cal", color: "#a3b899",
                        ingredients: ["5 oz chicken breast, seasoned (from prep)", "1/2 cup black beans", "1/2 cup cooked brown rice", "1/4 cup corn", "2 tbsp Mexican blend shredded cheese", "2 tbsp salsa", "Hot sauce, garlic powder"],
                        steps: ["Reheat prepped chicken, rice, beans, and corn.", "Top with cheese, salsa, hot sauce."],
                        tip: "This bowl is a repeat for a reason — high-fiber, high-protein, and you never get tired of it with enough hot sauce.",
                        portions: ["44g protein", "490 cal", "10g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "One-Pot Chipotle Chicken & Orzo", portion: "48g protein - 520 cal", color: "#a3b899",
                        ingredients: ["5 oz chicken breast", "1/2 cup orzo (or use protein spaghetti broken into pieces)", "1 cup marinara sauce", "1 cup baby spinach", "1-2 chipotle peppers in adobo, minced", "3 cloves garlic, minced", "1 tbsp olive oil", "2 tbsp shredded Parmesan", "1 cup chicken broth", "Red pepper flakes"],
                        steps: ["Season chicken. Sear in olive oil 5-6 min per side. Remove and set aside.", "Sauté garlic and minced chipotles 30 seconds.", "Add marinara, broth, and orzo. Stir. Simmer 10 min until orzo is tender.", "Nestle chicken back in. Cook 5 more min.", "Stir in spinach until wilted. Top with Parmesan and red pepper flakes."],
                        tip: "Smoky chipotle + marinara is an incredible combo. The one-pot method means the orzo soaks up all that smoky tomato flavor. Lycopene from the marinara, allicin from garlic, capsaicin from chipotle.",
                        portions: ["48g protein", "520 cal", "6g fiber", "25 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Frozen Berry Yogurt Bark", portion: "14g protein - 160 cal", color: "#c4a882",
                        ingredients: ["3/4 cup nonfat Greek yogurt", "1/2 cup mixed berries", "1 tsp honey", "1 tbsp mini dark chocolate chips"],
                        steps: ["Make a fresh batch if you're out — same method as Day 1.", "Or grab from freezer if you still have some."],
                        tip: "Keep this in rotation. It's basically frozen candy that's actually good for you.",
                        portions: ["14g protein", "160 cal", "2g fiber", "0 min"]
                    }
                ]
            },
            {
                day: 11, theme: "Enchilada Night (Round 2)", protein: "149g", calories: "1,530", prep: "PREP DAY — Prep Session 3 tonight after dinner",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Cacao Berry Smoothie Bowl", portion: "42g protein - 420 cal", color: "#a3b899",
                        ingredients: ["1 cup unsweetened almond milk", "1.5 tbsp cacao powder (NOT Dutch-processed)", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "1 scoop ON Gold Standard Banana Cream whey", "1/2 cup frozen blueberries", "1/2 cup nonfat Greek yogurt", "--- TOPPINGS ---", "2 tbsp walnuts, chopped", "1 tbsp ground flaxseed", "1 tsp honey"],
                        steps: ["Blend almond milk, cacao, collagen, L-glutamine, MCT oil, whey, blueberries, and yogurt until thick.", "Pour into bowl. Top with walnuts, flaxseed, honey."],
                        tip: "The OG breakfast. Full supplement stack. Anthocyanins from blueberries, flavanols from cacao, omega-3s from walnuts and flax.",
                        portions: ["42g protein", "420 cal", "8g fiber", "5 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Turkey Taco Wrap", portion: "40g protein - 450 cal", color: "#a3b899",
                        ingredients: ["4 oz seasoned ground turkey (from prep)", "1 Mission Carb Balance tortilla", "1/4 cup cooked brown rice", "2 tbsp Mexican blend shredded cheese", "2 tbsp salsa", "Hot sauce", "1 tbsp sour cream"],
                        steps: ["Warm tortilla. Reheat turkey and rice.", "Layer, wrap, eat."],
                        tip: "Quick assembly from prepped ingredients. The carb balance tortillas are doing a lot of heavy lifting on fiber here.",
                        portions: ["40g protein", "450 cal", "8g fiber", "3 min"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Spicy Turkey Enchiladas (Round 2)", portion: "46g protein - 540 cal", color: "#a3b899",
                        ingredients: ["5 oz ground turkey (93% lean)", "1/4 cup diced onion", "2 cloves garlic, minced", "1 tsp cumin", "1 tsp chili powder", "Red pepper flakes", "3 Mission Carb Balance tortillas", "1 cup enchilada sauce", "1/2 cup Mexican blend shredded cheese", "2 tbsp sour cream", "Hot sauce"],
                        steps: ["Preheat oven to 375°F.", "Brown turkey with onion, garlic, cumin, chili powder, red pepper flakes.", "Roll in tortillas, place in baking dish. Cover with enchilada sauce and cheese.", "Bake 20 min. Top with sour cream and hot sauce."],
                        tip: "Round 2! These were good enough the first time to earn a repeat. You know the drill by now. Cumin and chili powder both have anti-inflammatory properties.",
                        portions: ["46g protein", "540 cal", "8g fiber", "35 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Warm Cinnamon Baked Apple", portion: "1g protein - 150 cal", color: "#c4a882",
                        ingredients: ["1 medium apple, cored", "1 tsp butter", "1/2 tsp cinnamon", "1 tsp honey", "1 tbsp chopped walnuts"],
                        steps: ["Core apple. Fill with butter, cinnamon, honey, walnuts.", "Bake 375°F for 25 min or microwave 3-4 min."],
                        tip: "Quick, warm, comforting. Pectin feeds gut bacteria. Pop it in the oven while the enchiladas bake — same temp.",
                        portions: ["1g protein", "150 cal", "4g fiber", "25 min"]
                    }
                ]
            },
            {
                day: 12, theme: "Creamy Lemon", protein: "147g", calories: "1,540",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Mango-Coconut Overnight Oats", portion: "35g protein - 410 cal", color: "#a3b899",
                        ingredients: ["1/2 cup rolled oats", "1/2 cup unsweetened almond milk", "1/4 cup Simple Truth light coconut milk", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "3 tbsp hemp hearts", "1 tsp chia seeds", "--- MORNING TOPPINGS ---", "1/2 cup frozen mango (thawed)", "1 tbsp walnuts", "1 tsp honey"],
                        steps: ["Combine oats, almond milk, coconut milk, collagen, L-glutamine, MCT oil, hemp hearts, and chia seeds in a jar.", "Stir well. Refrigerate overnight.", "Top with thawed mango, walnuts, and honey."],
                        tip: "Coconut milk adds medium-chain fatty acids and a tropical vibe. Mango provides beta-carotene and vitamin C. Uses up that coconut milk.",
                        portions: ["35g protein", "410 cal", "8g fiber", "0 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "White Bean & Spinach Soup", portion: "38g protein - 420 cal", color: "#a3b899",
                        ingredients: ["5 oz shredded chicken (from prep)", "1 cup cannellini beans", "2 cups baby spinach", "1 cup marinara sauce", "2 cloves garlic", "1/2 cup diced carrots", "1 tbsp olive oil", "4 cups low-sodium chicken broth", "Italian seasoning, garlic powder, red pepper flakes"],
                        steps: ["Reheat a portion of the prepped soup.", "Top with a drizzle of olive oil and Parmesan if you want."],
                        tip: "White beans are loaded with resistant starch that feeds anti-cancer gut bacteria. Combined with spinach and tomato sauce, this is a Mediterranean powerhouse.",
                        portions: ["38g protein", "420 cal", "12g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Creamy Lemon Chicken & Farro", portion: "48g protein - 530 cal", color: "#a3b899",
                        ingredients: ["6 oz chicken breast", "1/2 cup cooked farro", "1 cup baby spinach", "3 cloves garlic, minced", "Juice of 1 lemon", "1/4 cup chicken broth", "2 tbsp coconut milk (or splash of cream)", "1 tbsp olive oil", "2 tbsp shredded Parmesan", "Red pepper flakes", "Salt & pepper"],
                        steps: ["Cook farro if not prepped already.", "Season chicken. Sear in olive oil 5-6 min per side. Remove and let rest.", "In the same pan, sauté garlic 30 seconds.", "Add broth and lemon juice. Let it reduce by half (~2 min).", "Stir in coconut milk. Add spinach, wilt down.", "Slice chicken. Serve over farro with the creamy lemon sauce spooned over. Top with Parmesan and red pepper flakes."],
                        tip: "This is the Mediterranean diet at its best — olive oil, lemon, garlic, whole grains, greens. The pan sauce comes together in 3 minutes and tastes restaurant-quality.",
                        portions: ["48g protein", "530 cal", "6g fiber", "25 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Berry Crumble", portion: "5g protein - 180 cal", color: "#c4a882",
                        ingredients: ["1.5 cups mixed berries (frozen)", "2 tbsp rolled oats", "1 tbsp chopped walnuts", "1 tsp coconut oil", "1 tsp honey", "Pinch cinnamon", "Dollop Greek yogurt for topping"],
                        steps: ["Place berries in a small oven-safe dish.", "Mix oats, walnuts, coconut oil, honey, cinnamon. Crumble over berries.", "Bake at 375°F for 20-25 min until bubbly.", "Top with yogurt."],
                        tip: "Frozen berries work just as well as fresh here. Pop it in the oven while dinner cooks.",
                        portions: ["5g protein", "180 cal", "5g fiber", "25 min"]
                    }
                ]
            },
            {
                day: 13, theme: "One-Pot Basil", protein: "153g", calories: "1,550",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Egg Muffin Cups + Morning Shake", portion: "38g protein - 380 cal", color: "#a3b899",
                        ingredients: ["--- MORNING BOOST SHAKE ---", "1 cup unsweetened almond milk", "1.5 tbsp cacao powder (NOT Dutch-processed)", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "--- EGG MUFFIN CUPS (x2) ---", "2 eggs (from batch)", "Spinach, onion, cheese (baked in)"],
                        steps: ["Blend shake ingredients and sip alongside breakfast.", "Reheat 2 egg muffin cups in microwave ~45 sec."],
                        tip: "Last round of egg cups! If you've been freezing them, they reheat perfectly. Shake gets the supplements in.",
                        portions: ["38g protein", "380 cal", "2g fiber", "2 min reheat"]
                    },
                    { type: "Lunch", icon: "☀️", name: "Chicken Burrito Bowl", portion: "43g protein - 480 cal", color: "#a3b899",
                        ingredients: ["5 oz grilled chicken (from prep)", "1/2 cup cooked brown rice", "1/2 cup black beans", "1/4 cup corn", "2 tbsp crumbled feta", "Squeeze of lime", "Hot sauce"],
                        steps: ["Reheat chicken, rice, beans, corn.", "Top with feta, lime, hot sauce."],
                        tip: "You know the drill. Feta + lime + hot sauce. Black beans and brown rice provide resistant starch for gut health.",
                        portions: ["43g protein", "480 cal", "9g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "One-Pot Basil Chicken & Orzo in Marinara", portion: "48g protein - 520 cal", color: "#a3b899",
                        ingredients: ["5 oz chicken breast", "1/2 cup orzo (or broken protein spaghetti)", "1 cup marinara sauce", "1 cup baby spinach", "1/2 cup diced carrots", "3 cloves garlic, minced", "1 tbsp olive oil", "Fresh basil (or dried)", "2 tbsp shredded Parmesan", "1 cup chicken broth", "Red pepper flakes"],
                        steps: ["Sear seasoned chicken in olive oil. Remove and set aside.", "Sauté garlic and carrots 2 min.", "Add marinara, broth, and orzo. Stir and simmer 10 min.", "Nestle chicken back in. Cook 5 more min until chicken is done.", "Stir in spinach until wilted. Top with basil, Parmesan, red pepper flakes."],
                        tip: "One-pot wonder. The orzo absorbs all the marinara flavor. Cooked tomato sauce = max lycopene. Garlic, spinach, olive oil — this is textbook Mediterranean.",
                        portions: ["48g protein", "520 cal", "7g fiber", "25 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Protein Chia Pudding", portion: "23g protein - 190 cal", color: "#c4a882",
                        ingredients: ["2 tbsp chia seeds", "1/2 cup unsweetened almond milk", "1/2 scoop protein powder", "1/2 tsp vanilla", "1 tsp honey", "Berries for topping"],
                        steps: ["Should already be prepped — grab from fridge.", "Top with berries."],
                        tip: "Omega-3 ALA from chia, protein from powder, antioxidants from berries. Tastes like pudding, performs like a supplement.",
                        portions: ["23g protein", "190 cal", "8g fiber", "0 min"]
                    }
                ]
            },
            {
                day: 14, theme: "Celebration!", protein: "152g", calories: "1,560",
                meals: [
                    { type: "Breakfast", icon: "🌅", name: "Kefir Berry Smoothie", portion: "35g protein - 380 cal", color: "#a3b899",
                        ingredients: ["1 cup Lifeway strawberry kefir", "1/2 cup frozen mixed berries", "~1/2 scoop Vital Proteins chocolate collagen (~12g)", "5g L-glutamine", "1 tsp Nature's Way MCT oil", "1/2 banana"],
                        steps: ["Blend everything. Drink."],
                        tip: "Last day! Kefir probiotics + berry antioxidants + your supplement stack. You did 14 days of this.",
                        portions: ["35g protein", "380 cal", "4g fiber", "3 min"]
                    },
                    { type: "Lunch", icon: "☀️", name: "White Bean & Spinach Soup", portion: "38g protein - 420 cal", color: "#a3b899",
                        ingredients: ["5 oz shredded chicken (from prep)", "1 cup cannellini beans", "2 cups baby spinach", "1 cup marinara sauce", "2 cloves garlic", "1/2 cup diced carrots", "1 tbsp olive oil", "4 cups low-sodium chicken broth", "Italian seasoning, garlic powder, red pepper flakes"],
                        steps: ["Reheat prepped soup. Drizzle with olive oil."],
                        tip: "Last bowl. White beans + spinach + tomato sauce = the Mediterranean trifecta for gut health and cancer prevention.",
                        portions: ["38g protein", "420 cal", "12g fiber", "3 min reheat"]
                    },
                    { type: "Dinner", icon: "🌙", name: "Chicken & Spinach Baked Pasta", portion: "48g protein - 540 cal", color: "#a3b899",
                        ingredients: ["5 oz chicken breast, diced", "2 oz Kroger Protein Grain & Legume Spaghetti", "1 cup marinara sauce", "1/4 cup ricotta cheese", "1 cup baby spinach", "2 cloves garlic, minced", "1/2 cup shredded mozzarella", "2 tbsp shredded Parmesan", "1 tbsp olive oil", "Italian seasoning, red pepper flakes"],
                        steps: ["Preheat oven to 375°F. Cook protein pasta al dente.", "Sear diced chicken in olive oil with garlic. Season with Italian seasoning and red pepper flakes.", "Toss pasta with marinara, chicken, spinach, and ricotta.", "Pour into a small baking dish. Top with mozzarella and Parmesan.", "Bake 15-20 min until cheese is bubbly and golden."],
                        tip: "Celebration dinner! 🎉 Marinara lycopene, garlic allicin, spinach folate, olive oil polyphenols, whole grain protein pasta. Every element is evidence-based Mediterranean. You just crushed 14 days. Start the cycle again or build from the recipe bank!",
                        portions: ["48g protein", "540 cal", "7g fiber", "30 min"]
                    },
                    { type: "Dessert", icon: "🍨", name: "Berry Crumble for Two", portion: "5g protein - 180 cal", color: "#c4a882",
                        ingredients: ["1.5 cups mixed berries (frozen)", "2 tbsp rolled oats", "1 tbsp chopped walnuts", "1 tsp coconut oil", "1 tsp honey", "Pinch cinnamon", "Dollop Greek yogurt for topping"],
                        steps: ["Place berries in a small oven-safe dish.", "Mix oats, walnuts, coconut oil, honey, cinnamon. Crumble over berries.", "Bake at 375°F for 20-25 min until bubbly and golden.", "Top with Greek yogurt. Celebrate!"],
                        tip: "You did it! 14 days of eating well. Berries, oats, walnuts, yogurt — every bite is anti-cancer. Now do it again.",
                        portions: ["5g protein", "180 cal", "5g fiber", "25 min"]
                    }
                ]
            }
        ]
    },
    charlie: {
        goals: { protein: "180-210g", calories: "2,200-2,500" },
        days: []
    }
};

// Generate Charlie's meals (scaled up: +30% protein, +40% calories)
mealData.charlie.days = mealData.kasey.days.map(function(day) {
    var cDay = JSON.parse(JSON.stringify(day));
    var kProtein = parseInt(day.protein);
    var kCal = parseInt(day.calories.replace(",", ""));
    cDay.protein = Math.round(kProtein * 1.3) + "g";
    cDay.calories = (Math.round(kCal * 1.4 / 100) * 100).toLocaleString();
    
    cDay.meals = cDay.meals.map(function(meal) {
        var m = JSON.parse(JSON.stringify(meal));
        // Skip scaling for the Melting Pot date night
        if (m.name.indexOf("Melting Pot") !== -1) return m;
        var origProtein = parseInt(m.portion);
        var calMatch = m.portion.match(/(\d+) cal/);
        var origCal = calMatch ? parseInt(calMatch[1]) : 0;
        if (isNaN(origProtein) || origCal === 0) return m;
        var newProtein = Math.round(origProtein * 1.3);
        var newCal = Math.round(origCal * 1.4);
        m.portion = newProtein + "g protein - " + newCal + " cal";
        
        m.portions = m.portions.map(function(p) {
            if (p.indexOf("protein") !== -1) return newProtein + "g protein";
            if (p.indexOf("cal") !== -1) return newCal + " cal";
            if (p.indexOf("fiber") !== -1) {
                var f = parseInt(p);
                return Math.round(f * 1.2) + "g fiber";
            }
            return p;
        });
        
        if (m.type === "Dinner" && m.tip) {
            m.tip += "\n\nCHARLIE: Extra cooked tomato sauce with olive oil boosts lycopene absorption, especially important for prostate cancer prevention given your family history.";
        }
        
        return m;
    });
    return cDay;
});

// ===== PREP SESSION DETAILS =====
var prepSessions = {
    3: {
        name: "Prep Session 1",
        color: "#a3b899",
        portions: ["Covers Days 4–7 (Sun–Wed)", "Portions for BOTH of you", "~90-120 min total"],
        ingredients: [
            "--- EGG MUFFIN CUPS (batch of 24 — two muffin tins) ---",
            "24 eggs", "Splash of milk",
            "4 cups baby spinach, chopped",
            "1 cup diced onion",
            "2 cups shredded cheese (Mexican blend or mozzarella)",
            "Cooking spray or olive oil for muffin tins",
            "--- OVERNIGHT OATS (4 jars — 2 per person) ---",
            "2 cups rolled oats (1/2 cup per jar)",
            "4 cups almond milk (1 cup per jar)",
            "Collagen (your usual doses × 4 jars)",
            "L-glutamine (your usual doses × 4 jars)",
            "MCT oil (your usual doses × 4 jars)",
            "12 tbsp hemp hearts",
            "4 tsp chia seeds",
            "Strawberries (jar toppings)",
            "Frozen berries (jar toppings)",
            "Honey (jar toppings)",
            "Walnuts (jar toppings)",
            "--- CHICKEN (for lunches Days 4–7, both of you) ---",
            "~4 lbs chicken breast",
            "Olive oil",
            "Garlic powder",
            "Cumin",
            "Chili powder",
            "Oregano",
            "Salt & pepper",
            "--- CHIPOTLE CHICKEN (portion from the cooked chicken above) ---",
            "Set aside ~12 oz of the cooked chicken for chipotle wraps",
            "3-4 chipotle peppers in adobo, minced",
            "--- LUNCH BASES ---",
            "3 cups brown rice, dry (makes ~6 cups cooked)",
            "2 cans black beans, drained",
            "1.5 cups corn",
            "--- FROZEN BERRY YOGURT BARK ---",
            "3 cups Greek yogurt",
            "1.5 cups mixed berries",
            "Honey",
            "Dark chocolate chips",
            "--- ALSO PREP FOR DAYS 5–7 (was Session 2) ---",
            "2 cups farro or quinoa, dry (cook it — for lemony grain bowls)",
            "1 can chickpeas, drained",
            "1 jar roasted red peppers",
            "Extra spinach (for grain bowls day-of)",
            "Olive oil (for grain bowls day-of)",
            "2 lemons (for grain bowls day-of)",
            "Feta (for burrito bowls)",
            "Lime (for burrito bowls)"
        ],
        steps: [
            "START THE RICE — Put 3 cups dry brown rice on to cook. This takes the longest so get it going first.",
            "EGG MUFFIN CUPS — Preheat oven to 375°F. Whisk 24 eggs with a splash of milk, salt & pepper. Grease two muffin tins. Divide spinach, onion, and cheese into cups. Pour egg mixture over. Bake 20 min until set. Cool and store — fridge for 3-4 days, freeze the rest.",
            "SEASON & COOK CHICKEN — While muffins bake, season ~4 lbs chicken with olive oil, garlic powder, cumin, chili powder, salt, pepper. Grill, bake at 400°F for 22-25 min, or pan-sear. Let rest, then slice/shred. Season about 1.5 lbs separately with oregano + lemon for grain bowls.",
            "MAKE CHIPOTLE CHICKEN — Take ~12 oz of the cooked chicken, shred it, and toss with 3-4 minced chipotle peppers in adobo. Store separately for wraps.",
            "PORTION LUNCH BASES — Divide rice, black beans, and corn into containers. Make 6 containers: Kasey gets ~5 oz chicken + 1/2 cup rice per box, Charlie gets ~6.5 oz chicken + 2/3 cup rice per box.",
            "OVERNIGHT OATS — Make 4 jars: oats, almond milk, collagen, L-glutamine, MCT oil, hemp hearts, chia seeds. Stir well, refrigerate. Add toppings in the morning.",
            "YOGURT BARK — Spread yogurt on a parchment-lined sheet pan, press in berries and chocolate chips, freeze.",
            "COOK FARRO/QUINOA — Start 2 cups dry farro or quinoa for the grain bowls later in the week. Let it cook while you do everything else.",
            "PORTION GRAIN BOWL BASES — 4 containers with grains + chickpeas + roasted red peppers. Keep spinach and lemon separate (add day-of).",
            "LABEL & STORE — Label containers K or C so you grab the right one. You're set through Wednesday!"
        ],
        tip: "Big Saturday prep day! This is your first and biggest session — you're covering 4 days. Future sessions will be faster because you'll know the rhythm. Put on a podcast or some music — this goes quick once you're rolling."
    },
    8: {
        name: "Prep Session 2",
        color: "#a3b899",
        portions: ["Covers Days 9–11 (Fri–Sun)", "Portions for BOTH of you", "~60 min total"],
        ingredients: [
            "--- EGG MUFFIN CUPS (batch of 24 — two muffin tins) ---",
            "24 eggs", "Splash of milk",
            "4 cups baby spinach, chopped",
            "1 cup diced onion",
            "2 cups shredded cheese",
            "--- TURKEY TACO MEAT (for wraps Days 9 & 11, both of you) ---",
            "1.5 lbs ground turkey (93% lean)",
            "1 cup diced onion",
            "4 cloves garlic, minced",
            "1 tbsp cumin",
            "2 tsp chili powder",
            "1 tsp garlic powder",
            "Red pepper flakes",
            "Salt",
            "--- CHICKEN (for black bean bowl Day 10, both of you) ---",
            "~1.5 lbs chicken breast",
            "Olive oil",
            "Garlic powder",
            "Cumin",
            "Chili powder",
            "Salt",
            "--- LUNCH BASES ---",
            "3 cups brown rice, dry",
            "2 cans black beans",
            "1 cup corn",
            "--- OVERNIGHT OATS (4 jars — 2 per person) ---",
            "2 cups rolled oats",
            "4 cups almond milk",
            "Collagen (your usual doses × 4 jars)",
            "L-glutamine (your usual doses × 4 jars)",
            "MCT oil (your usual doses × 4 jars)"
        ],
        steps: [
            "START RICE — Get 3 cups dry brown rice cooking.",
            "EGG MUFFIN CUPS — Same method: whisk 24 eggs, grease two tins, divide spinach/onion/cheese, pour egg, bake 375°F for 20 min. Freeze extras.",
            "COOK TURKEY TACO MEAT — Brown 1.5 lbs ground turkey with onion, garlic, cumin, chili powder, garlic powder, red pepper flakes. Let cool and portion: Kasey containers get ~5 oz meat, Charlie containers get ~6.5 oz.",
            "COOK CHICKEN — Season and cook ~1.5 lbs chicken breast. Slice for black bean bowls. Portion: Kasey ~5 oz, Charlie ~6.5 oz.",
            "PORTION LUNCH BASES — Divide rice, beans, corn, and chicken/turkey into labeled containers.",
            "OVERNIGHT OATS — Make 4 jars with supplement base.",
            "Covered through Sunday!"
        ],
        tip: "You're a pro at this by now. Same pattern — grains and protein cook while you assemble everything else. The turkey taco meat is new but it's dead simple."
    },
    11: {
        name: "Prep Session 3",
        color: "#a3b899",
        portions: ["Covers Days 12–14 (Mon–Wed)", "Portions for BOTH of you", "~60 min total"],
        ingredients: [
            "--- WHITE BEAN & SPINACH SOUP (big pot — 4 servings) ---",
            "~1.5 lbs chicken breast (for soup + burrito bowls — cook all together)",
            "3 cans cannellini beans",
            "6 cups baby spinach",
            "3 cups marinara sauce",
            "6 cloves garlic",
            "1.5 cups diced carrots",
            "3 tbsp olive oil",
            "12 cups low-sodium chicken broth",
            "Italian seasoning",
            "Garlic powder",
            "Red pepper flakes",
            "--- CHICKEN (extra for burrito bowls Day 13) ---",
            "Already included above — set aside ~12 oz before adding to soup",
            "Cumin",
            "Garlic powder",
            "Chili powder",
            "--- LUNCH BASES (for burrito bowls Day 13) ---",
            "2 cups brown rice, dry",
            "1 can black beans",
            "Corn",
            "Feta",
            "Lime",
            "--- OVERNIGHT OATS (4 jars — 2 per person) ---",
            "Coconut milk (for Day 12 oat jars)",
            "Frozen mango (for Day 12 oat jars)",
            "2 cups rolled oats",
            "4 cups almond milk",
            "Collagen (your usual doses × 4 jars)",
            "L-glutamine (your usual doses × 4 jars)",
            "MCT oil (your usual doses × 4 jars)",
            "--- CHIA PUDDING (4 servings — 2 each) ---",
            "8 tbsp chia seeds",
            "3 cups almond milk",
            "4 scoops protein powder",
            "Vanilla extract",
            "Honey"
        ],
        steps: [
            "START RICE — Get 2 cups dry brown rice cooking.",
            "COOK ALL CHICKEN — Season ~1.5 lbs total chicken. Cook it all at once. Set aside ~12 oz for burrito bowls (dice and season with cumin/chili). Shred the rest for soup.",
            "MAKE THE SOUP — Sauté garlic and carrots in olive oil. Add broth, marinara, cannellini beans. Simmer 10 min. Add spinach until wilted. Stir in shredded chicken. Season with Italian seasoning, garlic powder, red pepper flakes. Portion into 4 containers — Kasey's portions slightly smaller than Charlie's.",
            "PORTION BURRITO BOWLS — 2 containers for Day 13: Kasey gets ~5 oz chicken + 1/2 cup rice + beans + corn. Charlie gets ~6.5 oz chicken + 2/3 cup rice + beans + corn.",
            "OVERNIGHT OATS — Make 4 jars. Use coconut milk + mango for the Day 12 jars.",
            "CHIA PUDDING — Mix 4 servings: chia seeds, almond milk, protein powder, vanilla, honey. Divide into 4 jars, refrigerate.",
            "Last prep! You're almost at the finish line!"
        ],
        tip: "Last prep session! The soup is the star here — it makes a big pot that covers 4 lunches between you. After this you just have 3 dinners to cook fresh and you're done with the whole plan."
    }
};

// State
var currentPerson = "kasey";
var showingSnacks = false;

// ===== DATE SYSTEM =====
// Plan starts Feb 12, 2026 — 14 days through Feb 25
var PLAN_START = new Date(2026, 1, 12); // Thu Feb 12
var PLAN_DAYS = 14;
var SHORT_DAYS = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
var SHORT_MONTHS = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

function getPlanDayFromDate(date) {
    var start = new Date(PLAN_START);
    start.setHours(0,0,0,0);
    var check = new Date(date);
    check.setHours(0,0,0,0);
    var diff = Math.floor((check - start) / (1000 * 60 * 60 * 24));
    return diff + 1; // 1-indexed
}

function getDateForPlanDay(dayNum) {
    var d = new Date(PLAN_START);
    d.setDate(d.getDate() + dayNum - 1);
    return d;
}

// Figure out today's plan day, clamp to 1-14
var todayPlanDay = getPlanDayFromDate(new Date());
if (todayPlanDay < 1) todayPlanDay = 1;
if (todayPlanDay > PLAN_DAYS) todayPlanDay = PLAN_DAYS;
var currentDay = todayPlanDay;

// ===== MULTI-PLAN SYSTEM =====
var savedPlans = [{
    id: 'plan_original',
    label: 'Feb 12–25',
    startDate: '2026-02-12',
    days: 14,
    kaseyDays: mealData.kasey.days,
    charlieDays: mealData.charlie.days
}];
var currentPlanIndex = 0;

function renderPlanSelector() {
    var sel = document.getElementById('plan-selector');
    var dd = document.getElementById('plan-dropdown');
    var delBtn = document.getElementById('plan-delete-btn');
    
    if (savedPlans.length <= 1) {
        sel.style.display = 'none';
        return;
    }
    
    sel.style.display = 'flex';
    dd.innerHTML = '';
    savedPlans.forEach(function(p, i) {
        var opt = document.createElement('option');
        opt.value = i;
        opt.textContent = p.label;
        opt.selected = i === currentPlanIndex;
        dd.appendChild(opt);
    });
    
    // Don't allow deleting the original plan
    delBtn.style.display = currentPlanIndex === 0 ? 'none' : 'inline-block';
}

function switchPlan(index) {
    index = parseInt(index);
    if (index < 0 || index >= savedPlans.length) return;
    currentPlanIndex = index;
    
    var plan = savedPlans[index];
    PLAN_START = new Date(plan.startDate + 'T00:00:00');
    PLAN_DAYS = plan.days;
    mealData.kasey.days = plan.kaseyDays;
    mealData.charlie.days = plan.charlieDays;
    
    // Update subtitle
    var sd = new Date(plan.startDate + 'T00:00:00');
    var ed = new Date(sd); ed.setDate(ed.getDate() + plan.days - 1);
    document.getElementById('header-subtitle').textContent = 'Kasey & Charlie \u2022 ' + SHORT_MONTHS[sd.getMonth()] + ' ' + sd.getDate() + '\u2013' + ed.getDate();
    
    // Reset to appropriate day
    var todayD = getPlanDayFromDate(new Date());
    if (todayD < 1) todayD = 1;
    if (todayD > PLAN_DAYS) todayD = 1;
    currentDay = todayD;
    
    renderPlanSelector();
    renderCalendar();
    selectDay(currentDay);
}

function deleteCurrentPlan() {
    if (currentPlanIndex === 0) return;
    if (!confirm('Delete this plan? This cannot be undone.')) return;
    savedPlans.splice(currentPlanIndex, 1);
    currentPlanIndex = 0;
    switchPlan(0);
    saveAllPlansToFirebase();
}

function saveAllPlansToFirebase() {
    // Update current plan's data before saving
    savedPlans[currentPlanIndex].kaseyDays = mealData.kasey.days;
    savedPlans[currentPlanIndex].charlieDays = mealData.charlie.days;
    
    if (!window.fbReady) {
        localStorage.setItem('mealplan_allplans', JSON.stringify(savedPlans));
        return;
    }
    try {
        var imports = window.firestoreImports;
        imports.setDoc(imports.doc(window.db, 'mealPlanData', 'allPlans'), {
            plans: JSON.stringify(savedPlans),
            updatedAt: new Date().toISOString()
        });
    } catch(e) {
        localStorage.setItem('mealplan_allplans', JSON.stringify(savedPlans));
    }
}

function loadAllPlansFromFirebase(callback) {
    if (!window.fbReady) {
        var saved = localStorage.getItem('mealplan_allplans');
        if (saved) {
            try {
                var loaded = JSON.parse(saved);
                if (loaded.length > 0) savedPlans = loaded;
            } catch(e) {}
        }
        callback();
        return;
    }
    try {
        var imports = window.firestoreImports;
        imports.getDoc(imports.doc(window.db, 'mealPlanData', 'allPlans')).then(function(snap) {
            if (snap.exists() && snap.data().plans) {
                try {
                    var loaded = JSON.parse(snap.data().plans);
                    if (loaded.length > 0) savedPlans = loaded;
                } catch(e) {}
            }
            callback();
        }).catch(function() { callback(); });
    } catch(e) { callback(); }
}

var dayColors = [
    "#a3b899", "#8fa882", "#7d8f76", "#a3b899", "#8fa882", "#b8c9ad", "#7d8f76",
    "#a3b899", "#8fa882", "#7d8f76", "#a3b899", "#8fa882", "#b8c9ad", "#7d8f76"
];

function getData() {
    return mealData[currentPerson];
}

function renderProgress() {
    var pct = Math.round((currentDay / PLAN_DAYS) * 100);
    document.getElementById("progress-fill").style.width = pct + "%";
    
    var startStr = SHORT_MONTHS[PLAN_START.getMonth()] + " " + PLAN_START.getDate();
    var endDate = getDateForPlanDay(PLAN_DAYS);
    var endStr = SHORT_MONTHS[endDate.getMonth()] + " " + endDate.getDate();
    
    document.getElementById("progress-label").textContent = "Day " + currentDay + " of " + PLAN_DAYS;
    document.getElementById("progress-dates").textContent = startStr + " – " + endStr;
}

function renderCalendar() {
    var data = getData();
    
    // Week ranges
    var w1Start = getDateForPlanDay(1);
    var w1End = getDateForPlanDay(7);
    var w2Start = getDateForPlanDay(8);
    var w2End = getDateForPlanDay(14);
    document.getElementById("week1-range").textContent = SHORT_MONTHS[w1Start.getMonth()] + " " + w1Start.getDate() + "–" + w1End.getDate();
    document.getElementById("week2-range").textContent = SHORT_MONTHS[w2Start.getMonth()] + " " + w2Start.getDate() + "–" + w2End.getDate();
    
    // Month label
    document.getElementById("cal-month-label").textContent = SHORT_MONTHS[PLAN_START.getMonth()].toUpperCase() + " " + PLAN_START.getFullYear();
    
    var todayDayNum = getPlanDayFromDate(new Date());
    
    ["week1", "week2"].forEach(function(id, weekIdx) {
        var grid = document.getElementById(id);
        grid.innerHTML = "";
        for (var i = 0; i < 7; i++) {
            var dayNum = weekIdx * 7 + i + 1;
            var dayDate = getDateForPlanDay(dayNum);
            var dateNum = dayDate.getDate();
            
            var btn = document.createElement("button");
            btn.className = "day-btn";
            
            var isActive = dayNum === currentDay;
            var isToday = dayNum === todayDayNum;
            var isPast = dayNum < todayDayNum;
            var isFuture = dayNum > todayDayNum;
            
            if (isToday) btn.classList.add("is-today");
            if (isPast) btn.classList.add("is-past");
            
            var baseColor = dayColors[dayNum - 1];
            
            if (isActive) {
                btn.style.background = baseColor;
                btn.style.color = "#2a1f21";
            } else if (isPast) {
                btn.style.background = "rgba(163,184,153,0.08)";
                btn.style.color = "rgba(224,210,208,0.4)";
            } else {
                btn.style.background = "rgba(163,184,153,0.1)";
                btn.style.color = "var(--light-text)";
            }
            
            var checkMark = isPast && !isActive ? '<span class="day-check">✓</span>' : '';
            var todayDot = isToday && !isActive ? '<span style="width:4px;height:4px;border-radius:50%;background:var(--sage-green);display:inline-block;"></span>' : '';
            
            btn.innerHTML = '<span class="day-letter">' + SHORT_DAYS[dayDate.getDay()] + '</span><span class="day-number">' + dateNum + '</span>' + checkMark + todayDot;
            btn.onclick = (function(d) { return function() { currentDay = d; showingSnacks = false; render(); }; })(dayNum);
            grid.appendChild(btn);
        }
    });
}

function renderDayDetail() {
    var data = getData();
    var day = data.days[currentDay - 1];
    var dayDate = getDateForPlanDay(currentDay);
    var dateStr = SHORT_DAYS[dayDate.getDay()] + ", " + SHORT_MONTHS[dayDate.getMonth()] + " " + dayDate.getDate();
    
    var header = document.getElementById("day-header");
    header.style.background = dayColors[currentDay - 1];
    document.getElementById("day-num").textContent = dateStr;
    document.getElementById("day-theme").textContent = day.theme;
    document.getElementById("day-protein").textContent = day.protein + " protein";
    document.getElementById("day-calories").textContent = day.calories + " cal";
    
    // Prep day banner
    var existingPrep = document.getElementById("prep-banner");
    if (existingPrep) existingPrep.remove();
    if (day.prep) {
        var prepBanner = document.createElement("div");
        prepBanner.id = "prep-banner";
        prepBanner.style.cssText = "background: rgba(163,184,153,0.15); border: 1px solid rgba(163,184,153,0.3); border-radius: 6px; padding: 10px 14px; margin-bottom: 12px; font-size: 0.8rem; color: #a3b899; text-align: center; letter-spacing: 0.03em; cursor: pointer; transition: background 0.2s;";
        prepBanner.innerHTML = "" + day.prep + ' <span style="opacity:0.6; margin-left:6px;">tap for details ›</span>';
        prepBanner.onmouseenter = function() { this.style.background = "rgba(163,184,153,0.25)"; };
        prepBanner.onmouseleave = function() { this.style.background = "rgba(163,184,153,0.15)"; };
        prepBanner.onclick = function() {
            var ps = prepSessions[currentDay];
            if (ps) openModal(ps);
        };
        document.querySelector(".day-detail").insertBefore(prepBanner, document.getElementById("meals-container"));
    }
    
    var container = document.getElementById("meals-container");
    container.innerHTML = "";
    
    if (showingSnacks) {
        // Render snack menu
        var backBtn = document.createElement("button");
        backBtn.className = "meal-btn";
        backBtn.style.background = "rgba(163,184,153,0.15)";
        backBtn.style.borderColor = "#a3b899";
        backBtn.innerHTML = '<div class="meal-icon" style="background:rgba(163,184,153,0.2)">←</div><div class="meal-info"><div class="meal-type" style="color:#a3b899">Back to ' + dateStr + '</div><div class="meal-name">Return to meals</div></div>';
        backBtn.onclick = function() { showingSnacks = false; render(); };
        container.appendChild(backBtn);
        
        var snackHeader = document.createElement("div");
        snackHeader.style.cssText = "text-align:center; padding: 16px 0 8px; color: rgba(242,235,224,0.5); font-size: 0.8rem; letter-spacing: 0.1em; text-transform: uppercase;";
        snackHeader.textContent = "Mix & match \u2022 build your own snacks";
        container.appendChild(snackHeader);
        
        snackMenu.forEach(function(snack) {
            var btn = document.createElement("button");
            btn.className = "meal-btn";
            btn.innerHTML = '<div class="meal-icon" style="background: rgba(163,184,153,0.15)">\u2728</div>' +
                '<div class="meal-info">' +
                    '<div class="meal-type">Snack</div>' +
                    '<div class="meal-name">' + snack.name + '</div>' +
                    '<div class="meal-portion">' + snack.portion + '</div>' +
                '</div>' +
                '<div class="meal-arrow">\u203A</div>';
            btn.onclick = (function(s) { return function() { openModal(s); }; })(snack);
            container.appendChild(btn);
        });
    } else {
        // Render day meals
        day.meals.forEach(function(meal, mi) {
            var btn = document.createElement("button");
            btn.className = "meal-btn";
            var iconMap = { "sun": "\u2600\uFE0F", "moon": "\uD83C\uDF19", "star": "\u2728", "dessert": "\uD83C\uDF68" };
            var displayIcon = iconMap[meal.icon] || meal.icon;
            btn.innerHTML = '<div class="meal-icon" style="background: rgba(163,184,153,0.15)">' + displayIcon + '</div>' +
                '<div class="meal-info">' +
                    '<div class="meal-type">' + meal.type + '</div>' +
                    '<div class="meal-name">' + meal.name + '</div>' +
                    '<div class="meal-portion">' + meal.portion + '</div>' +
                '</div>' +
                '<div class="meal-arrow">\u203A</div>';
            btn.onclick = (function(m, idx) { return function() { openModal(m, idx); }; })(meal, mi);
            container.appendChild(btn);
        });
        
        // Add snack menu button
        var snackBtn = document.createElement("button");
        snackBtn.className = "meal-btn";
        snackBtn.style.borderColor = "rgba(163,184,153,0.4)";
        snackBtn.style.background = "rgba(163,184,153,0.05)";
        snackBtn.innerHTML = '<div class="meal-icon" style="background: rgba(163,184,153,0.2)">\u2728</div>' +
            '<div class="meal-info">' +
                '<div class="meal-type" style="color:#a3b899">Snack Menu</div>' +
                '<div class="meal-name" style="color:#a3b899">' + snackMenu.length + ' items \u2022 mix & match however you want</div>' +
                '<div class="meal-portion">proteins, fruits, dips, nuts & more</div>' +
            '</div>' +
            '<div class="meal-arrow" style="color:#a3b899">\u203A</div>';
        snackBtn.onclick = function() { showingSnacks = true; render(); };
        container.appendChild(snackBtn);
        
        // Day notes
        var notesDiv = document.createElement("div");
        notesDiv.style.cssText = "margin-top: 16px; padding-top: 12px; border-top: 1px solid rgba(224,210,208,0.08);";
        var noteKey = 'dayNote_' + currentPlanIndex + '_' + currentDay + '_' + currentPerson;
        var savedNote = localStorage.getItem(noteKey) || '';
        notesDiv.innerHTML = '<div style="font-size:0.65rem;color:rgba(224,210,208,0.35);letter-spacing:0.1em;margin-bottom:6px;text-transform:uppercase;">Day Notes</div>' +
            '<textarea id="day-note-input" placeholder="How did today go? Any swaps, skips, or wins..." style="width:100%;min-height:60px;padding:10px;background:rgba(61,47,49,0.4);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:\'Philosopher\',serif;font-size:0.78rem;resize:vertical;box-sizing:border-box;">' + savedNote + '</textarea>';
        container.appendChild(notesDiv);
        
        // Auto-save on input
        setTimeout(function() {
            var ta = document.getElementById('day-note-input');
            if (ta) {
                ta.addEventListener('input', function() {
                    localStorage.setItem(noteKey, this.value);
                    saveDayNotesToFirebase();
                });
            }
        }, 50);
    }
}

var currentModalMeal = null;
var currentModalMealIndex = -1;

function openModal(meal, mealIndex) {
    currentModalMeal = meal;
    currentModalMealIndex = (typeof mealIndex === 'number') ? mealIndex : -1;
    
    var modal = document.getElementById("modal");
    var header = document.getElementById("modal-header");
    header.style.background = meal.color || "#a3b899";
    document.getElementById("modal-title").textContent = meal.name;
    document.getElementById("modal-meta").textContent = meal.portions.join(" \u2022 ");
    
    var ingList = document.getElementById("modal-ingredients");
    ingList.innerHTML = "";
    meal.ingredients.forEach(function(ing) {
        var li = document.createElement("li");
        if (ing.indexOf("---") === 0) {
            li.innerHTML = '<span></span><strong style="color: var(--sage-green); font-size: 0.75rem; letter-spacing: 0.05em;">' + ing.replace(/---/g, "").trim() + '</strong>';
        } else {
            li.innerHTML = '<span>\u2022</span>' + ing;
        }
        ingList.appendChild(li);
    });
    
    var stepList = document.getElementById("modal-steps");
    stepList.innerHTML = "";
    meal.steps.forEach(function(step, i) {
        var li = document.createElement("li");
        li.innerHTML = '<span class="step-number">' + (i + 1) + '</span>' + step;
        stepList.appendChild(li);
    });
    
    var tipBox = document.getElementById("modal-tip");
    if (meal.tip) {
        tipBox.style.display = "block";
        tipBox.querySelector("p").innerHTML = meal.tip.replace(/\n\n/g, "<br><br>");
    } else {
        tipBox.style.display = "none";
    }
    
    var portions = document.getElementById("modal-portions");
    portions.innerHTML = "";
    meal.portions.forEach(function(p) {
        portions.innerHTML += '<span class="portion-tag">' + p + '</span>';
    });
    
    // Show swap button only for plan meals (not snacks or prep sessions)
    var swapSection = document.getElementById('modal-swap-section');
    var swapList = document.getElementById('modal-swap-list');
    if (swapSection) {
        swapSection.style.display = (currentModalMealIndex >= 0 && meal.type) ? 'block' : 'none';
        swapList.style.display = 'none';
    }
    
    modal.classList.add("active");
}

function closeModal() {
    document.getElementById("modal").classList.remove("active");
}

function showSwapOptions() {
    if (!currentModalMeal || currentModalMealIndex < 0) return;
    var swapList = document.getElementById('modal-swap-list');
    var mealType = currentModalMeal.type; // Breakfast, Lunch, Dinner, Dessert
    
    // Find alternatives from recipe bank
    var alternatives = [];
    var currentName = currentModalMeal.name;
    
    // First check recipe bank
    recipeBank.forEach(function(recipe) {
        if (recipe.name === currentName) return;
        if (recipe.type === mealType) {
            alternatives.push(recipe);
        }
    });
    
    // Also check all meals in the current plan for same type
    var data = getData();
    var seen = {};
    seen[currentName] = true;
    data.days.forEach(function(day) {
        day.meals.forEach(function(m) {
            if (m.type === mealType && !seen[m.name] && m.ingredients) {
                seen[m.name] = true;
                alternatives.push(m);
            }
        });
    });
    
    if (alternatives.length === 0) {
        swapList.innerHTML = '<div style="padding:12px;text-align:center;color:rgba(224,210,208,0.4);font-size:0.75rem;">No alternatives found. Add more recipes to your bank!</div>';
        swapList.style.display = 'block';
        return;
    }
    
    var html = '<div style="font-size:0.65rem;color:rgba(224,210,208,0.35);letter-spacing:0.08em;text-transform:uppercase;margin-bottom:8px;">Pick a replacement:</div>';
    alternatives.forEach(function(alt, i) {
        html += '<button onclick="swapMeal(' + i + ')" style="width:100%;display:flex;justify-content:space-between;align-items:center;padding:10px 12px;margin-bottom:4px;background:rgba(61,47,49,0.5);border:1px solid var(--border-color);border-radius:6px;color:var(--light-text);font-family:\'Philosopher\',serif;font-size:0.78rem;cursor:pointer;text-align:left;">' +
            '<span>' + alt.name + '</span>' +
            '<span style="opacity:0.5;font-size:0.7rem;">' + (alt.portion || '') + '</span>' +
            '</button>';
    });
    
    swapList.innerHTML = html;
    swapList.style.display = 'block';
    
    // Store alternatives for selection
    window._swapAlternatives = alternatives;
}

function swapMeal(altIndex) {
    var alt = window._swapAlternatives[altIndex];
    if (!alt || currentModalMealIndex < 0) return;
    
    var data = getData();
    var day = data.days[currentDay - 1];
    
    // Replace the meal
    day.meals[currentModalMealIndex] = JSON.parse(JSON.stringify(alt));
    
    // Save to Firebase
    saveAllPlansToFirebase();
    
    // Close modal and re-render
    closeModal();
    render();
}

document.getElementById("modal").addEventListener("click", function(e) {
    if (e.target === this) closeModal();
});

document.addEventListener("keydown", function(e) {
    if (e.key === "Escape") closeModal();
});

document.querySelectorAll(".toggle-btn").forEach(function(btn) {
    btn.addEventListener("click", function() {
        document.querySelectorAll(".toggle-btn").forEach(function(b) { b.classList.remove("active"); });
        this.classList.add("active");
        currentPerson = this.dataset.person;
        document.getElementById("goal-protein").textContent = getData().goals.protein;
        document.getElementById("goal-calories").textContent = getData().goals.calories;
        render();
    });
});

function render() {
    renderPlanSelector();
    renderProgress();
    renderCalendar();
    renderDayDetail();
}

render();
</script>
<script>
function toggleNav() {
    var h = document.getElementById('navHamburger');
    var o = document.getElementById('navOverlay');
    if (!h || !o) return;
    var isOpen = o.classList.contains('open');
    if (isOpen) {
        h.classList.remove('open');
        o.classList.remove('open');
        document.body.style.overflow = '';
    } else {
        h.classList.add('open');
        o.classList.add('open');
        document.body.style.overflow = 'hidden';
    }
}

// ===== TAB SWITCHING =====
function switchTab(tab) {
    document.querySelectorAll('.page-tab').forEach(function(t) { t.classList.remove('active'); });
    document.querySelectorAll('.tab-view').forEach(function(v) { v.classList.remove('active'); });
    document.querySelector('.page-tab[onclick*="' + tab + '"]').classList.add('active');
    document.getElementById(tab + '-view').classList.add('active');
    if (tab === 'recipes') renderRecipeBank();
    if (tab === 'generate') initGenerateView();
}

// ===== RECIPE BANK =====
var recipeBank = [];
var rbFilter = 'all';
var rbSearch = '';

function extractRecipesFromPlan() {
    var recipes = [];
    var seen = {};
    mealData.kasey.days.forEach(function(day) {
        day.meals.forEach(function(meal) {
            if (meal.name.indexOf('Melting Pot') !== -1) return;
            var key = meal.name;
            if (seen[key]) { seen[key].timesUsed++; return; }
            var proteinMatch = meal.portion.match(/(\d+)g protein/);
            var calMatch = meal.portion.match(/(\d+)\s*cal/);
            var timeMatch = (meal.portions || []).join(' ').match(/(\d+)\s*min/);
            var recipe = {
                id: 'r_' + recipes.length + '_' + Math.random().toString(36).substr(2,6),
                name: meal.name, type: meal.type,
                protein: proteinMatch ? parseInt(proteinMatch[1]) : 0,
                calories: calMatch ? parseInt(calMatch[1]) : 0,
                prepTime: timeMatch ? parseInt(timeMatch[1]) : 0,
                ingredients: meal.ingredients || [], steps: meal.steps || [],
                tip: meal.tip || '', portion: meal.portion || '',
                portions: meal.portions || [], color: meal.color || '#a3b899',
                cuisineTags: guessCuisine(meal.name, meal.ingredients),
                favorite: false, timesUsed: 1, source: 'original'
            };
            seen[key] = recipe;
            recipes.push(recipe);
        });
    });
    snackMenu.forEach(function(s, i) {
        recipes.push({
            id: 'r_s' + i + '_' + Math.random().toString(36).substr(2,6),
            name: s.name, type: 'Snack',
            protein: parseInt((s.portion || '').match(/(\d+)g/)?.[1] || 0),
            calories: parseInt((s.portion || '').match(/(\d+)\s*cal/)?.[1] || 0),
            prepTime: 0, ingredients: s.ingredients || [], steps: s.steps || [],
            tip: s.tip || '', portion: s.portion || '',
            portions: s.portions || [], color: s.color || '#7d8f76',
            cuisineTags: [], favorite: false, timesUsed: 0, source: 'original'
        });
    });
    return recipes;
}

function guessCuisine(name, ingredients) {
    var n = (name + ' ' + ingredients.join(' ')).toLowerCase();
    var tags = [];
    if (n.match(/chipotle|enchilada|burrito|taco|mexican|salsa|cumin/)) tags.push('Mexican');
    if (n.match(/asian|soy sauce|ginger|sesame/)) tags.push('Asian');
    if (n.match(/alfredo|orzo|marinara|italian|basil|parmesan|ricotta|mozzarella|bolognese/)) tags.push('Italian');
    if (n.match(/lemon|farro|olive oil|chickpea|mediterranean|feta/)) tags.push('Mediterranean');
    if (n.match(/smoothie|oats|parfait|muffin/)) tags.push('American');
    if (tags.length === 0) tags.push('American');
    return tags;
}

function saveCustomRecipe() {
    var name = document.getElementById('ar-name').value.trim();
    var type = document.getElementById('ar-type').value;
    var protein = parseInt(document.getElementById('ar-protein').value) || 0;
    var cal = parseInt(document.getElementById('ar-cal').value) || 0;
    var ingredientsRaw = document.getElementById('ar-ingredients').value.trim();
    var stepsRaw = document.getElementById('ar-steps').value.trim();
    var tip = document.getElementById('ar-tip').value.trim();
    
    if (!name) { alert('Please enter a recipe name.'); return; }
    if (!ingredientsRaw) { alert('Please enter at least one ingredient.'); return; }
    
    var ingredients = ingredientsRaw.split('\n').map(function(s) { return s.trim(); }).filter(Boolean);
    var steps = stepsRaw ? stepsRaw.split('\n').map(function(s) { return s.trim(); }).filter(Boolean) : ['Prepare as desired.'];
    
    var recipe = {
        id: 'r_custom_' + Date.now() + '_' + Math.random().toString(36).substr(2,6),
        name: name,
        type: type,
        protein: protein,
        calories: cal,
        prepTime: 0,
        ingredients: ingredients,
        steps: steps,
        tip: tip || '',
        portion: protein + 'g protein - ' + cal + ' cal',
        portions: [protein + 'g protein', cal + ' cal'],
        color: type === 'Dessert' ? '#c4a882' : '#a3b899',
        cuisineTags: guessCuisine(name, ingredients),
        favorite: false,
        timesUsed: 0,
        source: 'custom'
    };
    
    recipeBank.push(recipe);
    saveRecipeBankToFirebase();
    renderRecipeBank();
    
    // Clear form
    document.getElementById('ar-name').value = '';
    document.getElementById('ar-protein').value = '';
    document.getElementById('ar-cal').value = '';
    document.getElementById('ar-ingredients').value = '';
    document.getElementById('ar-steps').value = '';
    document.getElementById('ar-tip').value = '';
    document.getElementById('add-recipe-form').style.display = 'none';
}

function setRecipeFilter(filter, btn) {
    rbFilter = filter;
    document.querySelectorAll('.rb-filter').forEach(function(f) { f.classList.remove('active'); });
    btn.classList.add('active');
    renderRecipeBank();
}

function filterRecipes() {
    rbSearch = document.getElementById('rb-search').value.toLowerCase();
    renderRecipeBank();
}

function renderRecipeBank() {
    var grid = document.getElementById('rb-grid');
    var count = document.getElementById('rb-count');
    grid.innerHTML = '';
    
    var filtered = recipeBank.filter(function(r) {
        if (rbFilter === 'favorites' && !r.favorite) return false;
        if (rbFilter !== 'all' && rbFilter !== 'favorites' && r.type !== rbFilter) return false;
        if (rbSearch && r.name.toLowerCase().indexOf(rbSearch) === -1 && 
            r.cuisineTags.join(' ').toLowerCase().indexOf(rbSearch) === -1 &&
            r.ingredients.join(' ').toLowerCase().indexOf(rbSearch) === -1) return false;
        return true;
    });
    
    filtered.sort(function(a, b) {
        if (a.favorite && !b.favorite) return -1;
        if (!a.favorite && b.favorite) return 1;
        return a.name.localeCompare(b.name);
    });
    
    count.textContent = filtered.length + ' recipe' + (filtered.length !== 1 ? 's' : '');
    
    if (filtered.length === 0) {
        grid.innerHTML = '<div class="rb-empty">No recipes found</div>';
        return;
    }
    
    filtered.forEach(function(r) {
        var card = document.createElement('div');
        card.className = 'rb-card';
        card.onclick = function(e) {
            if (e.target.closest('.rb-card-fav')) return;
            openModal({ name: r.name, color: r.color, portions: r.portions, ingredients: r.ingredients, steps: r.steps, tip: r.tip });
        };
        var tagClass = 'rb-tag-' + r.type.toLowerCase();
        var cuisineHtml = r.cuisineTags.map(function(t) { return '<span class="rb-tag rb-tag-cuisine">' + t + '</span>'; }).join('');
        card.innerHTML = '<div class="rb-card-top">' +
            '<span class="rb-card-name">' + r.name + '</span>' +
            '<button class="rb-card-fav ' + (r.favorite ? 'favorited' : '') + '" onclick="toggleFavorite(\'' + r.id + '\')">' + (r.favorite ? '♥' : '♡') + '</button>' +
            '</div>' +
            '<div class="rb-card-meta"><span>' + r.protein + 'g protein</span><span>' + r.calories + ' cal</span>' + (r.prepTime ? '<span>' + r.prepTime + ' min</span>' : '') + '</div>' +
            '<div class="rb-card-tags"><span class="rb-tag ' + tagClass + '">' + r.type + '</span>' + cuisineHtml + '</div>';
        grid.appendChild(card);
    });
}

function toggleFavorite(id) {
    recipeBank.forEach(function(r) { if (r.id === id) r.favorite = !r.favorite; });
    saveRecipeBankToFirebase();
    renderRecipeBank();
}

// ===== FIREBASE FOR RECIPE BANK =====
var fbReady = false;

function saveRecipeBankToFirebase() {
    if (!window.fbReady) { localStorage.setItem('mealplan_recipes', JSON.stringify(recipeBank)); return; }
    try {
        var imports = window.firestoreImports;
        imports.setDoc(imports.doc(window.db, 'mealPlanData', 'recipeBank'), {
            recipes: JSON.stringify(recipeBank), updatedAt: new Date().toISOString()
        });
    } catch(e) { localStorage.setItem('mealplan_recipes', JSON.stringify(recipeBank)); }
}

function loadRecipeBankFromFirebase(callback) {
    if (!window.fbReady) {
        var saved = localStorage.getItem('mealplan_recipes');
        if (saved) recipeBank = JSON.parse(saved);
        callback();
        return;
    }
    try {
        var imports = window.firestoreImports;
        imports.getDoc(imports.doc(window.db, 'mealPlanData', 'recipeBank')).then(function(snap) {
            if (snap.exists() && snap.data().recipes) recipeBank = JSON.parse(snap.data().recipes);
            callback();
        }).catch(function() { callback(); });
    } catch(e) { callback(); }
}

function savePlanToFirebase(planObj) {
    if (!window.fbReady) { localStorage.setItem('mealplan_current', JSON.stringify(planObj)); return; }
    try {
        var imports = window.firestoreImports;
        imports.setDoc(imports.doc(window.db, 'mealPlanData', 'currentPlan'), {
            plan: JSON.stringify(planObj), updatedAt: new Date().toISOString()
        });
    } catch(e) { localStorage.setItem('mealplan_current', JSON.stringify(planObj)); }
}

function initRecipeBank() {
    loadRecipeBankFromFirebase(function() {
        if (recipeBank.length === 0) {
            recipeBank = extractRecipesFromPlan();
            saveRecipeBankToFirebase();
        }
    });
}

// ===== GENERATE PLAN =====
// ===== DIETARY REMINDERS =====
var dietaryReminders = [
    "Anti-cancer Mediterranean focus",
    "No avocado (except choc mousse)",
    "No peanut butter",
    "No mushrooms",
    "No raw tomatoes",
    "No cilantro",
    "No turmeric",
    "Bell peppers as supporting only",
    "Heavily glazed fish only",
    "Love spice"
];

function loadDietaryReminders() {
    var saved = localStorage.getItem('mealplan_diet_reminders');
    if (saved) {
        try { dietaryReminders = JSON.parse(saved); } catch(e) {}
    }
}
loadDietaryReminders();

function saveDietaryReminders() {
    localStorage.setItem('mealplan_diet_reminders', JSON.stringify(dietaryReminders));
}

function renderDietTags() {
    var container = document.getElementById('diet-tags');
    if (!container) return;
    container.innerHTML = dietaryReminders.map(function(tag, i) {
        return '<span class="diet-tag">' + tag + '<button onclick="removeDietTag(' + i + ')">×</button></span>';
    }).join('');
}

function addDietTag() {
    var input = document.getElementById('diet-tag-input');
    var val = input.value.trim();
    if (!val) return;
    dietaryReminders.push(val);
    saveDietaryReminders();
    renderDietTags();
    input.value = '';
}

function removeDietTag(index) {
    dietaryReminders.splice(index, 1);
    saveDietaryReminders();
    renderDietTags();
}

function getDietaryRestrictionsForPrompt() {
    return dietaryReminders.join('. ') + '.';
}

// ===== DAY NOTES =====
var dayNotesSaveTimer = null;
function saveDayNotesToFirebase() {
    clearTimeout(dayNotesSaveTimer);
    dayNotesSaveTimer = setTimeout(function() {
        if (!window.db) return;
        // Collect all day notes from localStorage
        var allNotes = {};
        for (var i = 0; i < localStorage.length; i++) {
            var key = localStorage.key(i);
            if (key.indexOf('dayNote_') === 0) {
                allNotes[key] = localStorage.getItem(key);
            }
        }
        try {
            var imports = window.firestoreImports;
            imports.setDoc(imports.doc(window.db, 'mealPlanData', 'dayNotes'), { notes: allNotes });
        } catch(e) { console.error('Day notes save error:', e); }
    }, 1500); // Debounce 1.5s
}

function loadDayNotesFromFirebase() {
    if (!window.db) return;
    try {
        var imports = window.firestoreImports;
        imports.getDoc(imports.doc(window.db, 'mealPlanData', 'dayNotes')).then(function(snap) {
            if (snap.exists() && snap.data().notes) {
                var notes = snap.data().notes;
                Object.keys(notes).forEach(function(key) {
                    if (!localStorage.getItem(key)) {
                        localStorage.setItem(key, notes[key]);
                    }
                });
            }
        });
    } catch(e) { console.error('Day notes load error:', e); }
}

// ===== GROCERY LIST =====
var groceryData = [];

var GROCERY_CATEGORIES = {
    'Produce': ['spinach','baby spinach','onion','garlic','lemon','lime','carrots','carrot','strawberries','strawberry','blueberries','blueberry','berries','banana','apple','mango','pineapple','avocado','cilantro','parsley','basil','ginger','jalapeño','tomato','tomatoes','lettuce','arugula','kale','zucchini','cucumber','celery','bell pepper','broccoli','cauliflower','sweet potato','potato','green onion','scallion','fresh'],
    'Protein': ['chicken','turkey','beef','salmon','shrimp','fish','egg','eggs','ground turkey','ground beef','chicken breast','pork','steak','tuna','sausage','bacon'],
    'Dairy': ['cheese','yogurt','greek yogurt','milk','almond milk','sour cream','cream','butter','feta','parmesan','mozzarella','string cheese','coconut milk','cream cheese'],
    'Grains & Bread': ['rice','brown rice','oats','rolled oats','farro','quinoa','tortilla','tortillas','bread','spaghetti','pasta','noodle','pita','wrap','bun'],
    'Canned & Jarred': ['black beans','cannellini','chickpeas','beans','marinara','salsa','chipotle','adobo','roasted red pepper','tomato sauce','broth','coconut milk','olives','corn'],
    'Frozen': ['frozen berries','frozen blueberries','frozen mixed berries','riced cauliflower','frozen'],
    'Spices & Oils': ['olive oil','cumin','chili powder','garlic powder','oregano','cinnamon','paprika','red pepper flakes','italian seasoning','salt','pepper','cayenne','turmeric','nutmeg','vanilla','honey','maple syrup','soy sauce','hot sauce','vinegar','sesame oil','mct oil'],
    'Baking & Snacks': ['chocolate','dark chocolate','walnuts','almonds','chia seeds','flaxseed','hemp hearts','cocoa','cacao','protein powder','whey','collagen','peanut butter','almond butter','trail mix'],
    'Supplements': ['collagen','l-glutamine','mct oil','vital proteins','whey']
};

function categorizeIngredient(text) {
    var lower = text.toLowerCase();
    // Skip section headers
    if (lower.indexOf('---') !== -1) return null;
    // Skip prep references
    if (lower.indexOf('from prep') !== -1 || lower.indexOf('from batch') !== -1 || lower.indexOf('from session') !== -1) {
        // Still include but mark it
    }
    // Check each category
    var scores = {};
    Object.keys(GROCERY_CATEGORIES).forEach(function(cat) {
        scores[cat] = 0;
        GROCERY_CATEGORIES[cat].forEach(function(keyword) {
            if (lower.indexOf(keyword) !== -1) {
                scores[cat] += keyword.length; // longer match = more specific
            }
        });
    });
    var best = 'Other';
    var bestScore = 0;
    Object.keys(scores).forEach(function(cat) {
        if (scores[cat] > bestScore) {
            bestScore = scores[cat];
            best = cat;
        }
    });
    return best;
}

function generateGroceryList() {
    // ===== SMART GROCERY LIST GENERATOR =====
    // Parses quantities, normalizes ingredient names, and combines totals
    // Uses prep session amounts (already scaled for 2 people) as primary source
    // Adds fresh-cook ingredients for non-prepped meals
    
    // ── Parse "2 cups brown rice" → { qty: 2, unit: "cup", item: "brown rice" } ──
    function parseIngredient(text) {
        text = text.trim();
        if (!text || text.indexOf('---') !== -1) return null;
        // Strip parenthetical notes like "(from prep)", "(from batch)", "(leftover from...)"
        var skipPatterns = ['from prep', 'from batch', 'from session', 'leftover from', 'already included', 'set aside', 'from freezer', 'already prepped', 'from day'];
        var lower = text.toLowerCase();
        for (var i = 0; i < skipPatterns.length; i++) {
            if (lower.indexOf(skipPatterns[i]) !== -1) return null; // skip prepped items
        }
        if (lower === 'reservations' || lower === 'good vibes') return null;
        
        // Clean up common prefixes
        var clean = text
            .replace(/^~/, '')
            .replace(/\(.*?\)/g, '')
            .replace(/,?\s*(or more|or less|optional|to taste|as needed|if desired|for topping|for serving|for dipping|on the side|baked in)\s*/gi, '')
            .trim();
        
        // Parse: number unit item
        // Handles: "2 cups", "1/2 cup", "1.5 tbsp", "3-4 cloves", "1 14oz can"
        var qtyMatch = clean.match(/^(\d+[\.\d]*(?:\s*[-–]\s*\d+[\.\d]*)?(?:\s*\/\s*\d+)?)\s*(.*)/);
        if (!qtyMatch) {
            // No quantity — just an item name (e.g. "Hot sauce", "Salt & pepper")
            return { qty: 0, unit: '', item: clean, raw: text };
        }
        
        var qtyStr = qtyMatch[1];
        var rest = qtyMatch[2].trim();
        
        // Parse qty: handle fractions and ranges
        var qty = 0;
        if (qtyStr.indexOf('/') !== -1) {
            var parts = qtyStr.split('/');
            qty = parseFloat(parts[0]) / parseFloat(parts[1]);
        } else if (qtyStr.match(/[-–]/)) {
            var range = qtyStr.split(/[-–]/);
            qty = (parseFloat(range[0]) + parseFloat(range[1])) / 2;
        } else {
            qty = parseFloat(qtyStr);
        }
        if (isNaN(qty)) qty = 1;
        
        // Parse unit from rest
        var unitMap = {
            'cup': 'cup', 'cups': 'cup',
            'tbsp': 'tbsp', 'tablespoon': 'tbsp', 'tablespoons': 'tbsp',
            'tsp': 'tsp', 'teaspoon': 'tsp', 'teaspoons': 'tsp',
            'oz': 'oz', 'ounce': 'oz', 'ounces': 'oz',
            'lb': 'lb', 'lbs': 'lb', 'pound': 'lb', 'pounds': 'lb',
            'can': 'can', 'cans': 'can',
            'jar': 'jar', 'jars': 'jar',
            'clove': 'clove', 'cloves': 'clove',
            'scoop': 'scoop', 'scoops': 'scoop',
            'slice': 'slice', 'slices': 'slice',
            'medium': 'medium', 'large': 'large', 'small': 'small',
            'bunch': 'bunch', 'head': 'head', 'bag': 'bag'
        };
        
        var unit = '';
        var item = rest;
        var unitMatch = rest.match(/^(\w+)\s+(.*)/);
        if (unitMatch && unitMap[unitMatch[1].toLowerCase()]) {
            unit = unitMap[unitMatch[1].toLowerCase()];
            item = unitMatch[2];
        }
        
        // Clean item name
        item = item.replace(/,\s*$/, '').replace(/^\s*of\s+/i, '').trim();
        
        return { qty: qty, unit: unit, item: item, raw: text };
    }
    
    // ── Normalize ingredient names to combine similar items ──
    var ITEM_ALIASES = {
        // Proteins
        'chicken breast': ['chicken breast cutlet', 'chicken breast sliced', 'chicken breast diced', 'chicken breast seasoned', 'grilled chicken', 'shredded chicken', 'diced chicken', 'chicken breast seasoned and grilled'],
        'ground turkey 93% lean': ['ground turkey', 'seasoned ground turkey', 'ground turkey 93 lean'],
        'eggs': ['egg', 'eggs'],
        // Dairy
        'greek yogurt': ['nonfat greek yogurt', 'oikos triple zero vanilla greek yogurt', 'oikos triple zero greek yogurt', 'greek yogurt for topping'],
        'mexican blend shredded cheese': ['mexican blend cheese', 'shredded cheese'],
        'shredded parmesan': ['parmesan', 'grated parmesan'],
        'shredded mozzarella': ['mozzarella'],
        'almond milk': ['unsweetened almond milk'],
        'coconut milk': ['simple truth light coconut milk', 'light coconut milk'],
        // Grains
        'rolled oats': ['oats'],
        'brown rice': ['cooked brown rice'],
        'mission carb balance tortillas': ['mission carb balance tortilla', 'carb balance tortilla', 'carb balance tortillas'],
        'protein spaghetti': ['kroger protein grain legume spaghetti', 'kroger protein spaghetti', 'protein grain legume spaghetti'],
        // Produce
        'garlic': ['garlic minced', 'garlic cloves', 'cloves garlic', 'cloves garlic minced'],
        'baby spinach': ['spinach', 'baby spinach chopped', 'chopped spinach'],
        'onion': ['diced onion', 'onion diced', 'yellow onion'],
        'lemon': ['lemon juice', 'juice of lemon', 'juice of 1 lemon', 'squeeze of lemon'],
        'lime': ['squeeze of lime', 'lime juice'],
        'fresh strawberries': ['strawberries', 'strawberries sliced', 'fresh strawberries sliced'],
        'frozen mixed berries': ['frozen berries', 'mixed berries frozen', 'frozen mixed berries thawed', 'mixed berries'],
        'frozen blueberries': ['blueberries'],
        'carrots': ['diced carrots', 'roasted carrots', 'roasted carrots and green beans'],
        'fresh basil': ['basil', 'basil dried'],
        'fresh parsley': ['parsley'],
        'cilantro': ['fresh cilantro'],
        // Canned/Jarred
        'black beans': ['black beans drained'],
        'cannellini beans': ['cannellini beans drained', 'white beans'],
        'chickpeas': ['chickpeas drained'],
        'marinara sauce': ['marinara'],
        'chipotle peppers in adobo': ['chipotle in adobo', 'chipotle in adobo minced', 'chipotle peppers in adobo minced'],
        'enchilada sauce': ['enchilada sauce'],
        'roasted red peppers': ['roasted red peppers jarred'],
        // Supplements & Baking  
        'vital proteins chocolate collagen': ['vital proteins collagen', 'collagen'],
        'on gold standard banana cream whey': ['whey protein', 'protein powder', 'whey'],
        'cacao powder': ['cacao powder not dutch-processed', 'cacao powder not dutchprocessed', 'cocoa powder'],
        'dark chocolate 70%+': ['dark chocolate', 'dark chocolate chips', 'mini dark chocolate chips'],
        'walnuts': ['walnuts chopped', 'chopped walnuts'],
        'honey': ['honey drizzle'],
        'olive oil': ['extra virgin olive oil']
    };
    
    function normalizeItemName(item) {
        var lower = item.toLowerCase()
            .replace(/[^a-z0-9 ]/g, '')
            .replace(/\s+/g, ' ')
            .trim();
        // Check aliases
        for (var canonical in ITEM_ALIASES) {
            if (lower === canonical.toLowerCase().replace(/[^a-z0-9 ]/g, '').replace(/\s+/g, ' ')) return canonical;
            var aliases = ITEM_ALIASES[canonical];
            for (var i = 0; i < aliases.length; i++) {
                var aliasClean = aliases[i].toLowerCase().replace(/[^a-z0-9 ]/g, '').replace(/\s+/g, ' ');
                if (lower === aliasClean || lower.indexOf(aliasClean) !== -1 || aliasClean.indexOf(lower) !== -1) {
                    return canonical;
                }
            }
        }
        // Title case the original
        return item.replace(/\b\w/g, function(c) { return c.toUpperCase(); }).replace(/\b(Of|And|Or|In|On|The|A|An|For|To|With)\b/g, function(w) { return w.toLowerCase(); });
    }
    
    // ── Convert units for clean display ──
    // First, normalize to base units for combining
    function toBaseUnit(qty, unit) {
        // Convert everything to smallest sensible unit for combining
        // Weight: everything to oz
        if (unit === 'lb') return { qty: qty * 16, unit: 'oz' };
        // Volume: everything to tbsp (for small) or cup (for large)
        if (unit === 'tsp') return { qty: qty / 3, unit: 'tbsp' };
        if (unit === 'cup') return { qty: qty * 16, unit: 'tbsp' };
        return { qty: qty, unit: unit };
    }
    
    function convertForDisplay(qty, unit) {
        // oz → lbs when >= 16
        if (unit === 'oz' && qty >= 16) {
            return { qty: Math.round(qty / 16 * 10) / 10, unit: 'lb' };
        }
        // tbsp → cup when >= 8
        if (unit === 'tbsp' && qty >= 8) {
            return { qty: Math.round(qty / 16 * 4) / 4, unit: 'cup' };
        }
        return { qty: qty, unit: unit };
    }
    
    function formatQty(qty) {
        if (qty === 0) return '';
        // Clean fractions
        var whole = Math.floor(qty);
        var frac = qty - whole;
        if (frac < 0.1) return whole.toString();
        if (Math.abs(frac - 0.25) < 0.05) return (whole ? whole + ' ' : '') + '¼';
        if (Math.abs(frac - 0.33) < 0.05) return (whole ? whole + ' ' : '') + '⅓';
        if (Math.abs(frac - 0.5) < 0.05) return (whole ? whole + ' ' : '') + '½';
        if (Math.abs(frac - 0.67) < 0.05) return (whole ? whole + ' ' : '') + '⅔';
        if (Math.abs(frac - 0.75) < 0.05) return (whole ? whole + ' ' : '') + '¾';
        return (Math.round(qty * 10) / 10).toString();
    }
    
    function pluralUnit(unit, qty) {
        if (!unit || qty <= 1) return unit;
        var plurals = { cup: 'cups', can: 'cans', lb: 'lbs', clove: 'cloves', scoop: 'scoops', slice: 'slices', jar: 'jars', bunch: 'bunches', head: 'heads', bag: 'bags', medium: 'medium', large: 'large', small: 'small' };
        return plurals[unit] || unit;
    }
    
    // ===== MAIN: Collect & combine =====
    var combined = {}; // key: normalized name → { qty, unit, category, name }
    
    // Scale factor: meals are Kasey-sized, Charlie eats ~1.5x avg
    var BOTH_SCALE = 2.3; // rough multiplier: Kasey (1x) + Charlie (~1.3x)
    
    // Helper to add an ingredient
    function addIngredient(text, scale) {
        var parsed = parseIngredient(text);
        if (!parsed) return;
        var name = normalizeItemName(parsed.item || parsed.raw);
        var key = name.toLowerCase();
        
        // Normalize to base unit before adding
        var normalized = (parsed.qty && parsed.unit) ? toBaseUnit(parsed.qty * scale, parsed.unit) : { qty: (parsed.qty || 0) * scale, unit: parsed.unit || '' };
        
        if (!combined[key]) {
            combined[key] = { name: name, qty: normalized.qty, unit: normalized.unit, category: categorizeIngredient(text), items: [] };
        } else {
            // If units match (after normalization), add quantities
            if (combined[key].unit === normalized.unit) {
                combined[key].qty += normalized.qty;
            } else if (!combined[key].unit && normalized.unit) {
                // Existing has no unit, new one does — adopt unit and add
                combined[key].unit = normalized.unit;
                combined[key].qty += normalized.qty;
            } else if (combined[key].unit && !normalized.unit) {
                // New has no unit, just add count
                combined[key].qty += normalized.qty;
            } else {
                // Units don't match and both exist — try normalizing both to same base
                var existBase = toBaseUnit(combined[key].qty, combined[key].unit);
                var newBase = toBaseUnit(normalized.qty, normalized.unit);
                if (existBase.unit === newBase.unit) {
                    combined[key].qty = existBase.qty + newBase.qty;
                    combined[key].unit = existBase.unit;
                } else {
                    // Truly incompatible units (e.g., oz weight vs cups volume) — just add as separate
                    combined[key].qty += normalized.qty;
                }
            }
        }
        combined[key].items.push(text);
    }
    
    var data = getData();
    
    // ── Detect if a meal is prepped (ingredients already in prep sessions) ──
    function isMealPrepped(meal) {
        var stepsStr = (meal.steps || []).join(' ').toLowerCase();
        var tipStr = (meal.tip || '').toLowerCase();
        var ingStr = (meal.ingredients || []).join(' ').toLowerCase();
        var all = stepsStr + ' ' + tipStr + ' ' + ingStr;
        
        // Direct prep references
        if (all.indexOf('from prep') !== -1) return true;
        if (all.indexOf('from batch') !== -1) return true;
        if (all.indexOf('from session') !== -1) return true;
        if (all.indexOf('grab from fridge') !== -1 || all.indexOf('grab from the fridge') !== -1) return true;
        if (all.indexOf('grab from freezer') !== -1 || all.indexOf('grab from the freezer') !== -1) return true;
        if (all.indexOf('you made this') !== -1) return true;
        if (all.indexOf('already prepped') !== -1 && all.indexOf('if not prepped already') === -1 && all.indexOf('not prepped already') === -1) return true;
        if (all.indexOf('should already be prepped') !== -1) return true;
        if (all.indexOf('reheat prepped') !== -1) return true;
        if (all.indexOf('reheat a portion of the prepped') !== -1) return true;
        // "Prepped on Day X" or "Prepped last night" or "Prepped —" (as a label)
        if (all.match(/prepped\s+(on|last|—|-)/)) return true;
        
        return false;
    }
    
    // 1. Add prep session ingredients (already scaled for both people)
    Object.keys(prepSessions).forEach(function(dayKey) {
        var session = prepSessions[dayKey];
        session.ingredients.forEach(function(ing) {
            if (ing.indexOf('---') !== -1) return;
            if (ing.toLowerCase().indexOf('already included') !== -1) return;
            if (ing.toLowerCase().indexOf('set aside') !== -1) return;
            addIngredient(ing, 1); // already for both people
        });
    });
    
    // 2. Add individual meal ingredients for NON-prepped meals (scaled for both)
    data.days.forEach(function(day) {
        day.meals.forEach(function(meal) {
            if (!meal.ingredients) return;
            
            // If meal uses prepped ingredients, skip it (already in prep sessions)
            if (isMealPrepped(meal)) return;
            
            // Fresh meal — add ingredients scaled for both people
            meal.ingredients.forEach(function(ing) {
                addIngredient(ing, BOTH_SCALE);
            });
        });
    });
    
    // 3. Finalize: convert units and round up
    var finalItems = [];
    Object.keys(combined).forEach(function(key) {
        var item = combined[key];
        if (item.qty > 0) {
            var converted = convertForDisplay(item.qty, item.unit);
            item.qty = converted.qty;
            item.unit = converted.unit;
            // Round up to reasonable shopping amounts
            item.qty = Math.ceil(item.qty * 4) / 4; // round to nearest quarter
        }
        finalItems.push(item);
    });
    
    // Group by category
    var grouped = {};
    finalItems.forEach(function(item) {
        var cat = item.category || 'Other';
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(item);
    });
    
    // Sort & render
    var categoryOrder = ['Produce', 'Protein', 'Dairy', 'Grains & Bread', 'Canned & Jarred', 'Frozen', 'Spices & Oils', 'Baking & Snacks', 'Supplements', 'Other'];
    
    groceryData = [];
    var html = '<div style="padding:8px 0 4px;opacity:0.5;font-size:0.65rem;text-align:center;">Amounts calculated for both of you for the full plan</div>';
    categoryOrder.forEach(function(cat) {
        if (!grouped[cat] || grouped[cat].length === 0) return;
        var items = grouped[cat];
        items.sort(function(a, b) { return a.name.localeCompare(b.name); });
        
        html += '<div class="grocery-category">';
        html += '<div class="grocery-cat-header" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display===\'none\'?\'block\':\'none\'">';
        html += '<h4>' + cat + '</h4>';
        html += '<span>' + items.length + ' items</span>';
        html += '</div>';
        html += '<div class="grocery-cat-items">';
        items.forEach(function(item) {
            var idx = groceryData.length;
            var displayText = '';
            if (item.qty > 0) {
                displayText = formatQty(item.qty) + (item.unit ? ' ' + pluralUnit(item.unit, item.qty) : '') + ' ' + item.name;
            } else {
                displayText = item.name;
            }
            groceryData.push({ text: displayText, checked: false, category: cat });
            html += '<div class="grocery-item" id="gi-' + idx + '">';
            html += '<input type="checkbox" onchange="toggleGroceryItem(' + idx + ')">';
            html += '<span>' + displayText + '</span>';
            html += '<button class="grocery-remove" onclick="removeGroceryItem(' + idx + ')">×</button>';
            html += '</div>';
        });
        html += '</div></div>';
    });
    
    document.getElementById('grocery-list-content').innerHTML = html;
    document.getElementById('grocery-send-bar').style.display = 'block';
}

function toggleGroceryItem(idx) {
    groceryData[idx].checked = !groceryData[idx].checked;
    var el = document.getElementById('gi-' + idx);
    if (el) el.classList.toggle('checked');
}

function removeGroceryItem(idx) {
    var el = document.getElementById('gi-' + idx);
    if (el) el.remove();
    groceryData[idx] = null;
}

function sendGroceryToHomeHub() {
    // Build items in the format the index page expects: { text, completed: false }
    var items = [];
    var categoryOrder = ['Produce', 'Protein', 'Dairy', 'Grains & Bread', 'Canned & Jarred', 'Frozen', 'Spices & Oils', 'Baking & Snacks', 'Supplements', 'Other'];
    
    categoryOrder.forEach(function(cat) {
        var catItems = groceryData.filter(function(item) {
            return item && !item.checked && item.category === cat;
        });
        if (catItems.length > 0) {
            // Add category header
            items.push({ text: '── ' + cat.toUpperCase() + ' ──', completed: false });
            catItems.forEach(function(item) {
                items.push({ text: item.text.replace('(prep) ', ''), completed: false });
            });
        }
    });
    
    // Save to localStorage (same key the index page uses)
    localStorage.setItem('groceries', JSON.stringify(items));
    
    // Also save to Firebase if available
    if (window.db) {
        try {
            var setDoc = window.firestoreImports.setDoc;
            var doc = window.firestoreImports.doc;
            setDoc(doc(window.db, 'groceries', 'data'), { items: items })
                .then(function() { console.log('Groceries synced to Firebase'); })
                .catch(function(e) { console.error('Firebase grocery sync error:', e); });
        } catch(e) {
            console.error('Firebase grocery error:', e);
        }
    }
    
    // Visual feedback
    var btn = document.querySelector('#grocery-send-bar button');
    btn.textContent = '✓ Sent to Home Hub!';
    btn.style.background = '#7d8f76';
    setTimeout(function() {
        btn.textContent = 'Send to Home Hub Grocery List';
        btn.style.background = '#a3b899';
    }, 2500);
}

function initGenerateView() {
    var startInput = document.getElementById('gen-start-date');
    if (!startInput.value) {
        var latestEnd = new Date(PLAN_START);
        latestEnd.setDate(latestEnd.getDate() + PLAN_DAYS);
        savedPlans.forEach(function(p) {
            var pEnd = new Date(p.startDate + 'T00:00:00');
            pEnd.setDate(pEnd.getDate() + p.days);
            if (pEnd > latestEnd) latestEnd = pEnd;
        });
        startInput.value = latestEnd.toISOString().split('T')[0];
    }
    renderDietTags();
    var tagInput = document.getElementById('diet-tag-input');
    if (tagInput) {
        tagInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') { e.preventDefault(); addDietTag(); }
        });
    }
    
    // Dessert: "Skip" unchecks others, and checking others unchecks "Skip"
    var skipEl = document.getElementById('gen-d-skip');
    var otherDesserts = ['gen-d-light', 'gen-d-protein', 'gen-d-treat'];
    if (skipEl && !skipEl._listenerAdded) {
        skipEl.addEventListener('change', function() {
            if (this.checked) {
                otherDesserts.forEach(function(id) { document.getElementById(id).checked = false; });
            }
        });
        skipEl._listenerAdded = true;
    }
    otherDesserts.forEach(function(id) {
        var el = document.getElementById(id);
        if (el && !el._listenerAdded) {
            el.addEventListener('change', function() {
                if (this.checked) skipEl.checked = false;
            });
            el._listenerAdded = true;
        }
    });
}

function buildSkeletonPrompt(startDate, duration, recipeSummary, opts) {
    // Spice level instruction
    var spiceText = { mild: 'Keep spice levels mild — no hot sauce, minimal red pepper flakes.', medium: 'Medium spice — some heat is good but not every meal.', hot: 'We love spicy food — generous red pepper flakes, hot sauce, chipotle, jalapeño.', extra: 'MAX SPICE — every dinner should have real heat. Chipotle, gochujang, habanero, sriracha, cayenne.' };
    
    // Cuisine labels
    var cuisineLabels = { mediterranean: 'Mediterranean', mexican: 'Mexican/Tex-Mex', asian: 'Asian-inspired', italian: 'Italian', comfort: 'Comfort food', indian: 'Indian', korean: 'Korean', middleeastern: 'Middle Eastern', mixed: 'Mixed variety' };
    var cuisineStr = opts.cuisines.map(function(c) { return cuisineLabels[c] || c; }).join(', ');
    var cuisineInstruction = opts.cuisines.length >= 4 ? 'Wide variety of cuisines including: ' + cuisineStr + '. Mix them throughout the week.' :
        opts.cuisines.length === 1 && opts.cuisines[0] === 'mixed' ? 'Mix cuisines throughout the week — Mediterranean, Mexican, Asian, Italian, comfort food.' :
        'Focus on these cuisines: ' + cuisineStr + '. Distribute them across the plan.';
    
    // Effort level
    var effortText = { quick: 'All dinners must be 20 min or less — one-pot, sheet pan, or assembly meals only.', normal: 'Dinners should be 20-35 min with simple techniques.', involved: 'Dinners can take up to 45 min — stuffed dishes, baked meals, multi-step recipes are fine.' };
    
    // Grocery strategy
    var groceryText = { minimal: 'IMPORTANT: Reuse the same core ingredients across multiple days to minimize the grocery list. Overlap proteins, grains, and produce.', moderate: 'Some ingredient overlap is fine but mix it up enough to keep things interesting.', variety: 'Maximize variety — different proteins, grains, and flavors each day.' };
    
    // Dessert styles
    var dessertLabels = { light: 'light & healthy (under 200 cal, fruit/yogurt based)', protein: 'protein-packed (chia pudding, protein bark, yogurt bowls)', treat: 'real treats (chocolate mousse, baked crumbles, warm brownies, under 300 cal)' };
    var skipDessert = opts.skipDessert;
    var dessertInstruction = '';
    if (skipDessert) {
        dessertInstruction = 'NO desserts. Only Breakfast, Lunch, and Dinner.';
    } else {
        var dessertStyles = opts.desserts.filter(function(d) { return d !== 'skip'; }).map(function(d) { return dessertLabels[d] || d; });
        if (dessertStyles.length > 1) {
            dessertInstruction = 'Mix dessert styles throughout the week: ' + dessertStyles.join('; ') + '.';
        } else if (dessertStyles.length === 1) {
            dessertInstruction = 'Desserts should be ' + dessertStyles[0] + '.';
        } else {
            dessertInstruction = 'Include a light dessert each day — under 200 cal.';
        }
    }
    
    var prompt = 'Generate a ' + duration + '-day meal plan skeleton. Output ONLY meal names and daily totals.\n\n' +
        'TARGETS: Kasey: 140-165g protein, ~1,500-1,700 cal/day. Charlie: 180-210g protein, ~2,200-2,500 cal/day.\n' +
        'RESTRICTIONS: ' + getDietaryRestrictionsForPrompt() + '\n' +
        'STRUCTURE: Breakfast (grab-and-go or prepped), Lunch (batch prep), Dinner (fresh cook)' + (skipDessert ? '' : ', Dessert') + '\n\n' +
        '--- PREFERENCES ---\n' +
        (spiceText[opts.spice] || spiceText.hot) + '\n' +
        cuisineInstruction + '\n' +
        (effortText[opts.effort] || effortText.normal) + '\n' +
        (groceryText[opts.groceryRuns] || groceryText.minimal) + '\n' +
        dessertInstruction + '\n' +
        (opts.noRepeat ? 'No same meal on consecutive days.\n' : '') +
        (opts.favorFavs ? 'Prioritize FAV recipes from the bank.\n' : '') +
        (opts.prepDays ? 'Mark 2 prep days per week.\n' : '') +
        (opts.newRecipes ? '~70% from bank, ~30% new creative ideas (mark with isNew:true). New recipes should fit the cuisine/spice preferences. Include protein and calories in portion.\n' : 'Use ONLY recipes from bank.\n') +
        (opts.special ? '\nSPECIAL REQUEST: ' + opts.special + '\n' : '') +
        '\nRECIPE BANK:\n' + recipeSummary + '\n\n' +
        'START: ' + startDate + ', ' + duration + ' days.\n\n' +
        'Return ONLY a JSON array. No markdown. No backticks. COMPACT format:\n' +
        '[{"day":1,"theme":"Italian","protein":"148g","calories":"1,560","prep":null,' +
        '"meals":[{"type":"Breakfast","name":"Exact Recipe Name From Bank","portion":"42g protein - 420 cal","isNew":false},' +
        '{"type":"Lunch","name":"Name","portion":"38g protein - 450 cal","isNew":false},' +
        '{"type":"Dinner","name":"Name","portion":"48g protein - 520 cal","isNew":false}' +
        (skipDessert ? '' : ',{"type":"Dessert","name":"Name","portion":"8g protein - 150 cal","isNew":false}') +
        ']}]\n\n' +
        'IMPORTANT: Use EXACT recipe names from the bank for bank recipes. Only include type, name, portion, and isNew per meal. Nothing else.';
    
    return prompt;
}


async function callAI(prompt) {
    var response;
    try {
        response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                model: 'claude-sonnet-4-20250514',
                max_tokens: 8000,
                system: 'You are a meal plan generator. You ONLY output raw JSON — no markdown, no backticks, no explanation. Just the JSON array.',
                messages: [{ role: 'user', content: prompt }]
            })
        });
    } catch(netErr) {
        throw new Error('Network error — this feature only works inside the Claude.ai artifact viewer. If you downloaded this file, open it through Claude instead. (' + netErr.message + ')');
    }
    
    var rawText;
    try {
        rawText = await response.text();
    } catch(readErr) {
        throw new Error('Could not read API response: ' + readErr.message);
    }
    
    if (!response.ok) {
        // Try to extract a useful error message
        try {
            var errData = JSON.parse(rawText);
            throw new Error('API error (' + response.status + '): ' + (errData.error?.message || rawText.substring(0, 200)));
        } catch(parseErr) {
            if (parseErr.message.indexOf('API error') === 0) throw parseErr;
            throw new Error('API error (' + response.status + '): ' + rawText.substring(0, 200));
        }
    }
    
    var data;
    try {
        data = JSON.parse(rawText);
    } catch(jsonErr) {
        throw new Error('Invalid JSON from API: ' + rawText.substring(0, 200));
    }
    
    if (!data.content || !data.content[0]) {
        throw new Error('Empty response from AI. Try again.');
    }
    
    var text = data.content.map(function(c) { return c.text || ''; }).join('');
    text = text.replace(/```json|```/g, '').trim();
    
    // Try to extract JSON from the response even if there's text around it
    var jsonStart = text.indexOf('[');
    var jsonEnd = text.lastIndexOf(']');
    if (jsonStart === -1 || jsonEnd === -1) {
        // Try object format
        jsonStart = text.indexOf('{');
        jsonEnd = text.lastIndexOf('}');
    }
    if (jsonStart !== -1 && jsonEnd !== -1 && jsonEnd > jsonStart) {
        text = text.substring(jsonStart, jsonEnd + 1);
    }
    
    try {
        return JSON.parse(text);
    } catch(parseErr) {
        console.error('AI response text:', text.substring(0, 500));
        throw new Error('Could not parse AI response as JSON. The AI may have returned text instead of data. Try again.');
    }
}

function hydrateSkeletonWithRecipes(skeleton) {
    // Build lookup from recipe bank
    var lookup = {};
    recipeBank.forEach(function(r) {
        lookup[r.name.toLowerCase()] = r;
    });
    
    // Color map for meal types
    var typeColors = {
        'Breakfast': '#a3b899',
        'Lunch': '#c4a882',
        'Dinner': '#b4828c',
        'Dessert': '#a08cb4'
    };
    var typeIcons = {
        'Breakfast': '\u2600\uFE0F',
        'Lunch': '\uD83C\uDF5C',
        'Dinner': '\uD83C\uDF73',
        'Dessert': '\uD83C\uDF53'
    };
    
    return skeleton.map(function(day) {
        day.meals = day.meals.map(function(m) {
            var bankRecipe = lookup[m.name.toLowerCase()];
            
            if (bankRecipe) {
                // Fill from recipe bank
                m.icon = typeIcons[m.type] || '';
                m.color = bankRecipe.color || typeColors[m.type] || '#a3b899';
                m.ingredients = bankRecipe.ingredients || [];
                m.steps = bankRecipe.steps || [];
                m.tip = bankRecipe.tip || '';
                m.portions = bankRecipe.portions || [m.portion];
                if (!m.portion) m.portion = bankRecipe.portion;
            } else {
                // New recipe or unmatched — mark for AI detail pass
                m.icon = typeIcons[m.type] || '';
                m.color = typeColors[m.type] || '#a3b899';
                m.ingredients = m.ingredients || [];
                m.steps = m.steps || [];
                m.tip = m.tip || '';
                m.portions = m.portions || [m.portion];
                m.isNew = true;
                m.needsDetails = true;
            }
            return m;
        });
        return day;
    });
}

async function fillNewRecipeDetails(days, statusEl) {
    // Collect all meals that need details
    var newMeals = [];
    days.forEach(function(day) {
        day.meals.forEach(function(m) {
            if (m.needsDetails && !newMeals.some(function(x) { return x.name === m.name; })) {
                newMeals.push({ name: m.name, type: m.type, portion: m.portion });
            }
        });
    });
    
    if (newMeals.length === 0) return days;
    
    statusEl.innerHTML = '<span class="gen-spinner"></span> Generating ' + newMeals.length + ' new recipe details...';
    
    var prompt = 'Create recipe details for these meals. Anti-cancer Mediterranean focus. RESTRICTIONS: ' + getDietaryRestrictionsForPrompt() + '\n\n' +
        'Meals:\n' + newMeals.map(function(m, i) { return (i+1) + '. ' + m.name + ' (' + m.type + ', ' + m.portion + ')'; }).join('\n') + '\n\n' +
        'Return ONLY a JSON array. No backticks. Each recipe:\n' +
        '[{"name":"Exact Name","ingredients":["item1","item2"],"steps":["Step 1","Step 2"],"tip":"anti-cancer tip","portions":["42g protein","420 cal","8g fiber","25 min"]}]';
    
    try {
        var details = await callAI(prompt);
        if (!Array.isArray(details)) details = [details];
        
        var detailLookup = {};
        details.forEach(function(d) { detailLookup[d.name.toLowerCase()] = d; });
        
        // Apply details back to days
        days.forEach(function(day) {
            day.meals.forEach(function(m) {
                if (m.needsDetails) {
                    var detail = detailLookup[m.name.toLowerCase()];
                    if (detail) {
                        m.ingredients = detail.ingredients || [];
                        m.steps = detail.steps || [];
                        m.tip = detail.tip || '';
                        m.portions = detail.portions || [m.portion];
                    }
                    delete m.needsDetails;
                }
            });
        });
    } catch(e) {
        console.warn('Could not fetch new recipe details:', e);
        // Leave them without details — still usable
        days.forEach(function(day) {
            day.meals.forEach(function(m) { delete m.needsDetails; });
        });
    }
    
    return days;
}

async function generatePlan() {
    var btn = document.getElementById('gen-btn');
    var status = document.getElementById('gen-status');
    var preview = document.getElementById('gen-preview');
    
    btn.disabled = true;
    btn.style.display = 'block';
    status.style.display = 'block';
    preview.style.display = 'none';
    
    // Make sure recipe bank is populated
    if (recipeBank.length === 0) {
        status.innerHTML = '<span class="gen-spinner"></span> Building recipe bank...';
        recipeBank = extractRecipesFromPlan();
        if (recipeBank.length === 0) {
            status.innerHTML = 'Error: No recipes found in the current plan. Cannot generate.';
            btn.disabled = false;
            return;
        }
    }
    
    var startDate = document.getElementById('gen-start-date').value;
    var duration = parseInt(document.getElementById('gen-duration').value);
    // Read multi-select cuisines
    var cuisineIds = ['gen-c-med','gen-c-mex','gen-c-asian','gen-c-ital','gen-c-comfort','gen-c-indian','gen-c-korean','gen-c-me'];
    var cuisines = cuisineIds.map(function(id) {
        var el = document.getElementById(id);
        return el && el.checked ? el.value : null;
    }).filter(Boolean);
    
    // Read multi-select dessert styles
    var dessertIds = ['gen-d-light','gen-d-protein','gen-d-treat','gen-d-skip'];
    var desserts = dessertIds.map(function(id) {
        var el = document.getElementById(id);
        return el && el.checked ? el.value : null;
    }).filter(Boolean);
    
    var opts = {
        favorFavs: document.getElementById('gen-favor-favs').checked,
        newRecipes: document.getElementById('gen-new-recipes').checked,
        noRepeat: document.getElementById('gen-no-repeat').checked,
        prepDays: document.getElementById('gen-prep-days').checked,
        spice: document.getElementById('gen-spice').value,
        cuisines: cuisines.length > 0 ? cuisines : ['mixed'],
        effort: document.getElementById('gen-effort').value,
        groceryRuns: document.getElementById('gen-grocery-runs').value,
        desserts: desserts,
        skipDessert: desserts.indexOf('skip') !== -1,
        special: (document.getElementById('gen-special').value || '').trim()
    };
    
    var recipeSummary = recipeBank.filter(function(r) { return r.type !== 'Snack'; }).map(function(r) {
        return r.type + ': ' + r.name + ' (' + r.protein + 'g/' + r.calories + 'cal' + 
            (r.favorite ? ' FAV' : '') + ')';
    }).join('\n');
    
    try {
        // Phase 1: Get lightweight skeleton from AI
        status.innerHTML = '<span class="gen-spinner"></span> Planning meals (' + recipeBank.length + ' recipes in bank)...';
        var prompt = buildSkeletonPrompt(startDate, duration, recipeSummary, opts);
        var skeleton = await callAI(prompt);
        
        if (!Array.isArray(skeleton)) {
            if (skeleton.days && Array.isArray(skeleton.days)) skeleton = skeleton.days;
            else throw new Error('Unexpected response format');
        }
        
        // Phase 2: Fill in recipe details from bank
        status.innerHTML = '<span class="gen-spinner"></span> Filling in recipes...';
        var hydrated = hydrateSkeletonWithRecipes(skeleton);
        
        // Phase 3: Get details for any new recipes
        hydrated = await fillNewRecipeDetails(hydrated, status);
        
        var plan = {
            planName: duration + '-Day Anti-Cancer Mediterranean Plan',
            startDate: startDate,
            days: hydrated
        };
        
        status.innerHTML = 'Plan generated! Review below.';
        showPlanPreview(plan);
        
    } catch(e) {
        console.error('Generation error:', e);
        var errorMsg = e.message || 'Unknown error';
        status.innerHTML = '<div style="color:#d4919e;margin-bottom:12px;">⚠ ' + errorMsg + '</div>' +
            '<button class="gen-btn gen-btn-secondary" onclick="generatePlan()" style="width:auto;padding:10px 20px;">Try Again</button>';
        btn.disabled = false;
    }
}

function showPlanPreview(plan) {
    var preview = document.getElementById('gen-preview');
    var btn = document.getElementById('gen-btn');
    preview.style.display = 'block';
    
    var html = '<div class="gen-section"><h3>' + (plan.planName || 'New Meal Plan') + '</h3>';
    
    var sd = new Date(plan.startDate + 'T00:00:00');
    var dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    var monthNames = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    
    plan.days.forEach(function(day) {
        var dayDate = new Date(sd);
        dayDate.setDate(dayDate.getDate() + day.day - 1);
        var dateStr = dayNames[dayDate.getDay()] + ' ' + monthNames[dayDate.getMonth()] + ' ' + dayDate.getDate();
        
        html += '<div class="gen-preview-day">';
        html += '<h4>' + dateStr + ' — ' + day.theme + (day.prep ? '' : '') + '</h4>';
        html += '<div style="font-size:0.65rem;color:rgba(224,210,208,0.35);margin-bottom:6px;">' + day.protein + ' protein • ' + day.calories + ' cal</div>';
        day.meals.forEach(function(m) {
            var newBadge = m.isNew ? ' <span style="color:#a3b899;">NEW</span>' : '';
            html += '<div class="gen-preview-meal">' + m.icon + ' <strong>' + m.name + '</strong>' + newBadge + ' <span style="opacity:0.4;">— ' + m.portion + '</span></div>';
        });
        html += '</div>';
    });
    
    html += '</div>';
    html += '<div style="display:flex;gap:8px;flex-direction:column;">';
    html += '<button class="gen-btn" onclick="acceptPlan()">Use This Plan</button>';
    html += '<button class="gen-btn gen-btn-secondary" onclick="regenPlan()">Regenerate</button>';
    html += '</div>';
    
    preview.innerHTML = html;
    btn.disabled = false;
    btn.style.display = 'none';
    
    window._pendingPlan = plan;
}

function regenPlan() {
    document.getElementById('gen-btn').style.display = 'block';
    document.getElementById('gen-preview').style.display = 'none';
    generatePlan();
}

function acceptPlan() {
    var plan = window._pendingPlan;
    if (!plan) return;
    
    // Build Kasey's days
    var kaseyDays = plan.days.map(function(d) {
        return {
            day: d.day, theme: d.theme, protein: d.protein, calories: d.calories,
            prep: d.prep || null,
            meals: d.meals.map(function(m) {
                return { type: m.type, icon: m.icon, name: m.name, portion: m.portion,
                    color: m.color || '#a3b899', ingredients: m.ingredients, steps: m.steps,
                    tip: m.tip, portions: m.portions };
            })
        };
    });
    
    // Build Charlie's scaled meals (Kasey ~1350cal/140-165g → Charlie ~2300cal/180-210g)
    var CHARLIE_PROTEIN_MULT = 1.3;
    var CHARLIE_CAL_MULT = 1.7;
    var charlieDays = kaseyDays.map(function(day) {
        var cDay = JSON.parse(JSON.stringify(day));
        var kProtein = parseInt(day.protein); var kCal = parseInt(day.calories.replace(",", ""));
        cDay.protein = Math.round(kProtein * CHARLIE_PROTEIN_MULT) + "g";
        cDay.calories = (Math.round(kCal * CHARLIE_CAL_MULT / 100) * 100).toLocaleString();
        cDay.meals = cDay.meals.map(function(m) {
            var origProtein = parseInt(m.portion); var calM = m.portion.match(/(\d+) cal/); var origCal = calM ? parseInt(calM[1]) : 0;
            if (isNaN(origProtein) || origCal === 0) return m;
            m.portion = Math.round(origProtein * CHARLIE_PROTEIN_MULT) + "g protein - " + Math.round(origCal * CHARLIE_CAL_MULT) + " cal";
            m.portions = m.portions.map(function(p) {
                if (p.indexOf("protein") !== -1) return Math.round(origProtein * CHARLIE_PROTEIN_MULT) + "g protein";
                if (p.indexOf("cal") !== -1) return Math.round(origCal * CHARLIE_CAL_MULT) + " cal";
                if (p.indexOf("fiber") !== -1) return Math.round(parseInt(p) * 1.2) + "g fiber";
                return p;
            });
            if (m.type === "Dinner" && m.tip) m.tip += "\n\nCHARLIE: Add extra protein (side of chicken/eggs) and larger grain portions to hit your targets.";
            return m;
        });
        return cDay;
    });
    
    // Create date label
    var sd = new Date(plan.startDate + 'T00:00:00');
    var ed = new Date(sd); ed.setDate(ed.getDate() + plan.days.length - 1);
    var mo = SHORT_MONTHS;
    var label = mo[sd.getMonth()] + ' ' + sd.getDate() + '\u2013' + (sd.getMonth() === ed.getMonth() ? '' : mo[ed.getMonth()] + ' ') + ed.getDate();
    
    // Add new plan to saved plans
    var newPlan = {
        id: 'plan_' + Date.now(),
        label: label,
        startDate: plan.startDate,
        days: plan.days.length,
        kaseyDays: kaseyDays,
        charlieDays: charlieDays
    };
    savedPlans.push(newPlan);
    
    // Add new recipes to bank
    plan.days.forEach(function(day) {
        day.meals.forEach(function(m) {
            if (m.isNew) {
                var exists = recipeBank.some(function(r) { return r.name === m.name; });
                if (!exists) {
                    var pm = m.portion.match(/(\d+)g protein/); var cm = m.portion.match(/(\d+)\s*cal/);
                    recipeBank.push({
                        id: 'r_ai_' + Math.random().toString(36).substr(2,8),
                        name: m.name, type: m.type,
                        protein: pm ? parseInt(pm[1]) : 0, calories: cm ? parseInt(cm[1]) : 0,
                        prepTime: 0, ingredients: m.ingredients, steps: m.steps,
                        tip: m.tip, portion: m.portion, portions: m.portions,
                        color: m.color || '#a3b899',
                        cuisineTags: guessCuisine(m.name, m.ingredients),
                        favorite: false, timesUsed: 1, source: 'ai-generated'
                    });
                }
            }
        });
    });
    saveRecipeBankToFirebase();
    saveAllPlansToFirebase();
    
    // Switch to the new plan
    document.getElementById('gen-btn').style.display = 'block';
    document.getElementById('gen-btn').disabled = false;
    document.getElementById('gen-preview').style.display = 'none';
    document.getElementById('gen-status').innerHTML = 'Plan saved! Switching to it now...';
    
    setTimeout(function() {
        switchPlan(savedPlans.length - 1);
        switchTab('plan');
    }, 800);
}

// Init recipe bank on load
initRecipeBank();

// URL param support: ?day=X jumps to that day
(function() {
 var params = new URLSearchParams(window.location.search);
 var dayParam = parseInt(params.get('day'));
 if (dayParam && dayParam >= 1 && dayParam <= PLAN_DAYS) {
 currentDay = dayParam;
 selectDay(currentDay);
 }
})();
</script>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

try {
    const firebaseConfig = {
        apiKey: "AIzaSyCDda9sPwSY-RQ5rrM5THOvcLtHvcPRYd4",
        authDomain: "our-habit-hub.firebaseapp.com",
        projectId: "our-habit-hub",
        storageBucket: "our-habit-hub.firebasestorage.app",
        messagingSenderId: "78555830496",
        appId: "1:78555830496:web:3e457e54729cc11b825885"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db;
    window.firestoreImports = { doc, setDoc, getDoc };
    window.fbReady = true;
    
    // Reload data now that Firebase is ready
    if (typeof window.initRecipeBank === 'function') window.initRecipeBank();
    if (typeof window.loadAllPlansFromFirebase === 'function') {
        window.loadAllPlansFromFirebase(function() {
            if (typeof window.renderPlanSelector === 'function') window.renderPlanSelector();
        });
    }
    if (typeof window.loadDayNotesFromFirebase === 'function') window.loadDayNotesFromFirebase();
} catch(e) {
    console.log('Firebase init failed, using localStorage fallback', e);
}
</script>
</body>
</html>
