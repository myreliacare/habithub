<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Our Life Together</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Philosopher:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            width: 100%;
            touch-action: pan-y;
            background: #3d2f31;
        }

        body {
            font-family: 'Philosopher', Georgia, serif;
            background: #3d2f31 !important;
            min-height: 100vh;
            padding: 80px 16px 16px 16px;
            color: #4a3a3c;
            position: relative;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #b59197;
            color: #4a3a3c;
            border-color: #b59197;
        }

        .page-header {
            text-align: center;
            margin-bottom: 32px;
            margin-top: 24px;
        }

        .page-title {
            font-family: 'Dancing Script', cursive;
            background: linear-gradient(135deg, #b59197 0%, #7ba886 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.8rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #7a6668;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            font-style: italic;
        }

        .section-nav-dropdown {
            margin-bottom: 20px;
            text-align: center;
        }

        #sectionSelect {
            width: auto;
            background: #EBE0D6;
            border: 1px solid #7ba886;
            color: #7ba886;
            padding: 10px 36px 10px 14px;
            font-size: 0.9rem;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            letter-spacing: 0.05em;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237ba886' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
        }

        #sectionSelect:hover {
            background-color: #333;
            border-color: #b59197;
        }

        #sectionSelect:focus {
            outline: none;
            border-color: #b59197;
        }

        #sectionSelect option {
            background: #EBE0D6;
            color: #4a3a3c;
            padding: 8px;
        }

        .dreams-tab {
            display: none;
        }

        .dreams-tab.active {
            display: block;
        }

        .section {
            background: #EBE0D6;
            border: 1px solid #b59197;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 400;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #b59197;
            margin-bottom: 20px;
        }

        .dream-list {
            margin-bottom: 16px;
        }

        .dream-list-toggle {
            background: #EBE0D6;
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #d4b5b8;
            margin-bottom: 0;
            transition: background 0.2s;
        }

        .dream-list-toggle:hover {
            background: #252525;
        }

        .dream-list-toggle-text {
            color: #7ba886;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .dream-list-arrow {
            color: #7a6668;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .dream-list.expanded .dream-list-arrow {
            transform: rotate(180deg);
        }

        .dream-list-content {
            display: none;
            padding-top: 12px;
        }

        .dream-list.expanded .dream-list-content {
            display: block;
        }

        .dream-item {
            background: #EBE0D6;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 3px solid #b59197;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
        }

        .dream-item.achieved {
            opacity: 0.6;
            border-left-color: #7ba886;
        }

        .dream-item-content {
            flex: 1;
        }

        .dream-item-title {
            color: #4a3a3c;
            font-size: 1rem;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .dream-item.achieved .dream-item-title {
            text-decoration: line-through;
        }

        .dream-item-details {
            color: #7a6668;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .dream-item-image {
            width: 100%;
            max-width: 300px;
            margin-top: 12px;
            margin-bottom: 8px;
            border: 1px solid #d4b5b8;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .dream-item-image:hover {
            transform: scale(1.02);
        }

        .image-upload-preview {
            max-width: 200px;
            margin-top: 10px;
            border: 1px solid #d4b5b8;
        }

        .image-upload-label {
            display: inline-block;
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            margin-top: 6px;
        }

        .image-upload-label:hover {
            background: #b59197;
            color: #4a3a3c;
            border-color: #b59197;
        }

        .image-upload-input {
            display: none;
        }

        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .lightbox.show {
            display: flex;
        }

        .lightbox-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #4a3a3c;
            font-size: 2rem;
            cursor: pointer;
            background: none;
            border: none;
            padding: 10px;
        }

        .dream-item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .dream-tag {
            background: #E0D5CB;
            color: #b59197;
            padding: 4px 10px;
            font-size: 0.7rem;
            border: 1px solid #d4b5b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .dream-tag.priority-high {
            background: #4a2a2a;
            color: #ff9999;
            border-color: #ff9999;
        }

        .dream-tag.priority-soon {
            background: #3a3a2a;
            color: #ffcc99;
            border-color: #ffcc99;
        }

        .dream-tag.priority-friends {
            background: #2a3a3a;
            color: #99ccff;
            border-color: #99ccff;
        }

        .dream-tag.occasion-date-night {
            background: #3a2a3a;
            color: #ffb3d9;
            border-color: #ffb3d9;
        }

        .dream-tag.occasion-friends {
            background: #2a3a3a;
            color: #99ccff;
            border-color: #99ccff;
        }

        .dream-tag.occasion-special {
            background: #3a3a2a;
            color: #ffd699;
            border-color: #ffd699;
        }

        .dream-item-actions {
            display: flex;
            gap: 6px;
            flex-direction: column;
        }

        .icon-btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s ease;
            font-family: inherit;
            min-width: 60px;
            position: relative;
        }

        .icon-btn.saving {
            pointer-events: none;
            color: transparent;
            border-color: #7ba886;
        }

        .icon-btn.saving::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            margin: -6px 0 0 -6px;
            border: 2px solid rgba(123, 168, 134, 0.3);
            border-top-color: #7ba886;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        .icon-btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .icon-btn.achieved {
            border-color: #7ba886;
            color: #7ba886;
        }

        .icon-btn.achieved:hover {
            background: #7ba886;
            color: #4a3a3c;
        }

        .add-dream-btn {
            width: 100%;
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 10px;
            cursor: pointer;
            font-size: 0.82rem;
            transition: all 0.2s ease;
            font-family: inherit;
            margin-top: 6px;
        }

        .add-dream-btn:hover {
            background: #b59197;
            color: #4a3a3c;
            border-color: #b59197;
        }

        .dream-form {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .dream-form.active {
            display: flex;
        }

        .dream-form form {
            background: #EBE0D6;
            padding: 28px 24px;
            border: 1px solid #b59197;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            color: #7a6668;
            font-size: 0.8rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            background: #EBE0D6;
            border: 1px solid #d4b5b8;
            color: #4a3a3c;
            padding: 9px 10px;
            font-size: 0.88rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #7ba886;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.82rem;
            text-transform: none;
            color: #4a3a3c;
            padding: 6px 8px;
            background: #EBE0D6;
            border: 1px solid #d4b5b8;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: #252525;
            border-color: #7ba886;
        }

        .checkbox-label input[type="checkbox"]:checked + span {
            color: #7ba886;
            font-weight: 600;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-actions button[type="submit"] {
            border: 1px solid #b59197;
            color: #b59197;
            background: transparent;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            position: relative;
            min-width: 70px;
        }

        .form-actions button[type="submit"]:hover {
            background: #b59197;
            color: #4a3a3c;
        }

        .form-actions button[type="submit"].saving {
            pointer-events: none;
            color: transparent;
            border-color: #7ba886;
            background: rgba(123, 168, 134, 0.1);
        }

        .form-actions button[type="submit"].saving::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid rgba(123, 168, 134, 0.3);
            border-top-color: #7ba886;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .save-success {
            text-align: center;
            color: #7ba886;
            font-size: 0.85rem;
            padding: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-style: italic;
        }

        .save-success.visible {
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            color: #5a4a4c;
            padding: 40px 20px;
            font-style: italic;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #EBE0D6;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            text-align: center;
            display: none;
            z-index: 1000;
            border: 2px solid #b59197;
            max-width: 90%;
        }

        .random-choice {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #EBE0D6;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            text-align: center;
            display: none;
            z-index: 1000;
            border: 2px solid #7ba886;
            max-width: 90%;
            min-width: 300px;
        }

        .random-choice.show {
            display: block;
        }

        .random-choice h2 {
            background: linear-gradient(135deg, #7ba886 0%, #b59197 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .random-choice-title {
            color: #4a3a3c;
            font-size: 1.8rem;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .random-choice-details {
            color: #7a6668;
            margin-bottom: 24px;
            line-height: 1.6;
            font-size: 1rem;
        }

        .random-choice-image {
            max-width: 100%;
            max-height: 300px;
            margin-bottom: 20px;
            border: 1px solid #d4b5b8;
        }

        .random-choice-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .celebration.show {
            display: block;
        }

        .celebration h2 {
            background: linear-gradient(135deg, #b59197 0%, #7ba886 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .celebration p {
            color: #7a6668;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .dream-item {
                flex-direction: column;
            }

            .dream-item-actions {
                flex-direction: row;
                width: 100%;
            }

            .icon-btn {
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 80px 12px 12px 12px;
            }

            .page-title {
                font-size: 2rem;
            }

            .dream-form {
                padding: 12px;
            }

            .dream-form form {
                padding: 20px 16px;
                max-height: 85vh;
            }

            .checkbox-grid {
                gap: 6px;
            }

            .checkbox-label {
                padding: 5px 6px;
                font-size: 0.78rem;
            }
        }

        /* ===== NAV BAR ===== */
        .top-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: #2a1f21;
            border-bottom: 1px solid rgba(163, 184, 153, 0.2);
            z-index: 9999;
            padding: 0 24px;
            font-family: 'Philosopher', Georgia, serif;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
        }
        .nav-logo {
            font-size: 1.1rem;
            font-weight: 700;
            color: #a3b899;
            text-decoration: none;
            white-space: nowrap;
        }
        .nav-links { display: flex; gap: 28px; align-items: center; }
        .nav-link {
            color: rgba(242, 235, 224, 0.6);
            text-decoration: none;
            font-size: 0.88rem;
            font-weight: 500;
            white-space: nowrap;
            transition: color 0.2s;
        }
        .nav-link:hover { color: #f2ebe0; }
        .nav-link.active { color: #a3b899; }
        .nav-hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            z-index: 10001;
        }
        .nav-hamburger span {
            display: block; width: 24px; height: 2px;
            background: #a3b899; margin: 5px 0;
            transition: all 0.3s ease;
        }
        .nav-hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .nav-hamburger.open span:nth-child(2) { opacity: 0; }
        .nav-hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }
        .nav-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #2a1f21;
            z-index: 10000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0;
        }
        .nav-overlay.open { display: flex; }
        .nav-link-mobile {
            color: rgba(242, 235, 224, 0.7);
            text-decoration: none;
            font-size: 1.05rem;
            font-family: 'Philosopher', Georgia, serif;
            font-weight: 500;
            padding: 12px 40px;
            transition: color 0.2s;
            display: block;
            width: 100%;
            text-align: center;
        }
        .nav-link-mobile:hover { color: #f2ebe0; }
        .nav-link-mobile.active { color: #a3b899; }
        @media (max-width: 768px) {
            .nav-hamburger { display: block; }
            .nav-links { display: none; }
        }
    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">Our Life Hub</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="kasey-hub.html" class="nav-link">Kasey</a>
                <a href="charlie-hub.html" class="nav-link">Charlie</a>
                <a href="our-dreams.html" class="nav-link active">Us ♡</a>
                <a href="meal-plan.html" class="nav-link">Meals</a>
                <a href="settings.html" class="nav-link">Settings</a>
            </div>
            <button class="nav-hamburger" id="navHamburger" onclick="toggleNav()" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>
    <div class="nav-overlay" id="navOverlay" onclick="toggleNav()">
        <a href="index.html" class="nav-link-mobile">Home</a>
        <a href="kasey-hub.html" class="nav-link-mobile">Kasey</a>
        <a href="charlie-hub.html" class="nav-link-mobile">Charlie</a>
        <a href="our-dreams.html" class="nav-link-mobile active">Us ♡</a>
        <a href="meal-plan.html" class="nav-link-mobile">Meals</a>
        <a href="settings.html" class="nav-link-mobile">Settings</a>
    </div>
    
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Our Life Together</h1>
            <p class="page-subtitle">Dreams, goals, ideas & all the things we want to do</p>
        </div>

        <div class="section-nav-dropdown">
            <select id="sectionSelect" onchange="switchToSection(this.value)">
                <option value="restaurants">Restaurants</option>
                <option value="places">Places to Go</option>
                <option value="wishlists">Wishlists</option>
                <option value="travel">Travel</option>
                <option value="shows-movies">TV Shows & Movies</option>
                <option value="bucket">Bucket List</option>
                <option value="home">Dream Home</option>
                <option value="pets">Future Pets</option>
                <option value="traditions">Traditions</option>
            </select>
        </div>

        <!-- RESTAURANTS TAB -->
        <div id="restaurants-tab" class="dreams-tab active">
            <div class="section">
                <h2 class="section-title">Restaurants We Want to Try</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('restaurants')" style="flex: 1;">+ Add Restaurant</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('restaurants')" style="flex: 1; border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>
                
                <div class="dream-form" id="restaurants-form">
                    <form onsubmit="addDream(event, 'restaurants'); return false;">
                        <div class="form-group">
                            <label>Restaurant Name</label>
                            <input type="text" name="title" required placeholder="Name of the place">
                        </div>
                        <div class="form-group">
                            <label>Type (Select all that apply)</label>
                            <div class="checkbox-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="breakfast">
                                    <span>Breakfast</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="brunch">
                                    <span>Brunch</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="lunch">
                                    <span>Lunch</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="dinner">
                                    <span>Dinner</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="cafe">
                                    <span>Cafe</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="bar">
                                    <span>Bar</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="bakery">
                                    <span>Bakery</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="dessert">
                                    <span>Dessert</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Location & Details</label>
                            <textarea name="details" placeholder="Where is it? What kind of food? What do you want to try?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="restaurants-image" accept="image/*" onchange="previewImage(event, 'restaurants')">
                            <label for="restaurants-image" class="image-upload-label">Choose Image</label>
                            <div id="restaurants-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Occasion</label>
                            <select name="occasion">
                                <option value="">Casual</option>
                                <option value="date-night">Date Night</option>
                                <option value="friends">Go with Friends</option>
                                <option value="special">Special Occasion</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Try</option>
                                <option value="soon">I'd Love to Try</option>
                                <option value="high">We Have to Go!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('restaurants')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="restaurants-list">
                    <div class="empty-state">No restaurants yet. Where should you go for date night?</div>
                </div>
            </div>
        </div>

        <!-- PLACES TAB -->
        <div id="places-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Places We Want to Go</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('places')" style="flex: 1;">+ Add Place</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('places')" style="flex: 1; border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>
                
                <div class="dream-form" id="places-form">
                    <form onsubmit="addDream(event, 'places'); return false;">
                        <div class="form-group">
                            <label>Place Name</label>
                            <input type="text" name="title" required placeholder="Where do you want to go?">
                        </div>
                        <div class="form-group">
                            <label>Type (Select all that apply)</label>
                            <div class="checkbox-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="museum">
                                    <span>Museum</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="park">
                                    <span>Park</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="thrift-shop">
                                    <span>Thrift Shop</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="metaphysical-shop">
                                    <span>Metaphysical Shop</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="bookstore">
                                    <span>Bookstore</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="concert">
                                    <span>Concert</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="festival">
                                    <span>Festival</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="market">
                                    <span>Market</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="nature">
                                    <span>Nature Spot</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="entertainment">
                                    <span>Entertainment</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="placeType" value="historic">
                                    <span>Historic Site</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="What is it? What do you want to do there?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="places-image" accept="image/*" onchange="previewImage(event, 'places')">
                            <label for="places-image" class="image-upload-label">Choose Image</label>
                            <div id="places-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Go</option>
                                <option value="soon">I'd Love to Go</option>
                                <option value="high">We Have to Go!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('places')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="places-list">
                    <div class="empty-state">No places yet. Where do you want to go?</div>
                </div>
            </div>
        </div>

        <!-- WISHLISTS TAB -->
        <div id="wishlists-tab" class="dreams-tab">
            <div class="section" style="margin-bottom: 24px;">
                <h2 class="section-title">Kasey's Wishlist</h2>
                
                <button class="add-dream-btn" onclick="showForm('kasey-wishlist')">+ Add to Kasey's List</button>
                
                <div class="dream-form" id="kasey-wishlist-form">
                    <form onsubmit="addDream(event, 'kasey-wishlist'); return false;">
                        <div class="form-group">
                            <label>Item or Experience</label>
                            <input type="text" name="title" required placeholder="What does Kasey want?">
                        </div>
                        <div class="form-group">
                            <label>Details / Link</label>
                            <textarea name="details" placeholder="Where to find it, price, why you want it..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="kasey-wishlist-image" accept="image/*" onchange="previewImage(event, 'kasey-wishlist')">
                            <label for="kasey-wishlist-image" class="image-upload-label">Choose Image</label>
                            <div id="kasey-wishlist-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">Nice to Have</option>
                                <option value="soon">Really Want</option>
                                <option value="high">Top of List</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('kasey-wishlist')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="kasey-wishlist-list">
                    <div class="empty-state">Kasey's wishlist is empty</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Charlie's Wishlist</h2>
                
                <button class="add-dream-btn" onclick="showForm('charlie-wishlist')">+ Add to Charlie's List</button>
                
                <div class="dream-form" id="charlie-wishlist-form">
                    <form onsubmit="addDream(event, 'charlie-wishlist'); return false;">
                        <div class="form-group">
                            <label>Item or Experience</label>
                            <input type="text" name="title" required placeholder="What does Charlie want?">
                        </div>
                        <div class="form-group">
                            <label>Details / Link</label>
                            <textarea name="details" placeholder="Where to find it, price, why you want it..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="charlie-wishlist-image" accept="image/*" onchange="previewImage(event, 'charlie-wishlist')">
                            <label for="charlie-wishlist-image" class="image-upload-label">Choose Image</label>
                            <div id="charlie-wishlist-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">Nice to Have</option>
                                <option value="soon">Really Want</option>
                                <option value="high">Top of List</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('charlie-wishlist')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="charlie-wishlist-list">
                    <div class="empty-state">Charlie's wishlist is empty</div>
                </div>
            </div>
        </div>

        <!-- TRAVEL TAB -->
        <div id="travel-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Places We Want to Travel</h2>
                
                <button class="add-dream-btn" onclick="showForm('travel')">+ Add Travel Dream</button>
                
                <div class="dream-form" id="travel-form">
                    <form onsubmit="addDream(event, 'travel'); return false;">
                        <div class="form-group">
                            <label>Destination</label>
                            <input type="text" name="title" required placeholder="Where do you want to go?">
                        </div>
                        <div class="form-group">
                            <label>Why / What to Do There</label>
                            <textarea name="details" placeholder="What draws you to this place?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="travel-image" accept="image/*" onchange="previewImage(event, 'travel')">
                            <label for="travel-image" class="image-upload-label">Choose Image</label>
                            <div id="travel-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Go</option>
                                <option value="soon">I'd Love to Go</option>
                                <option value="high">Top of My List!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('travel')">Cancel</button>
                            <button type="submit" class="btn">Save Dream</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="travel-list">
                    <div class="empty-state">No travel dreams yet. Where do you want to go?</div>
                </div>
            </div>
        </div>

        <!-- TV SHOWS & MOVIES TAB -->
        <div id="shows-movies-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">TV Shows & Movies to Watch Together</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('shows-movies')" style="flex: 1;">+ Add Show or Movie</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('shows-movies')" style="flex: 1; border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>
                
                <div class="dream-form" id="shows-movies-form">
                    <form onsubmit="addDream(event, 'shows-movies'); return false;">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" name="title" required placeholder="Name of the show or movie">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="Where to watch? Genre? Why you want to see it?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="shows-movies-image" accept="image/*" onchange="previewImage(event, 'shows-movies')">
                            <label for="shows-movies-image" class="image-upload-label">Choose Image</label>
                            <div id="shows-movies-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Watch</option>
                                <option value="soon">I'd Love to Watch</option>
                                <option value="high">We Have to Watch!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('shows-movies')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="shows-movies-list">
                    <div class="empty-state">No shows or movies yet. What do you want to watch together?</div>
                </div>
            </div>
        </div>

        <!-- BUCKET LIST TAB -->
        <div id="bucket-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Our Bucket List</h2>
                
                <button class="add-dream-btn" onclick="showForm('bucket')">+ Add to Bucket List</button>
                
                <div class="dream-form" id="bucket-form">
                    <form onsubmit="addDream(event, 'bucket'); return false;">
                        <div class="form-group">
                            <label>Experience or Goal</label>
                            <input type="text" name="title" required placeholder="What do you want to do together?">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="Any specifics or ideas?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="bucket-image" accept="image/*" onchange="previewImage(event, 'bucket')">
                            <label for="bucket-image" class="image-upload-label">Choose Image</label>
                            <div id="bucket-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Do</option>
                                <option value="soon">I'd Love to Do</option>
                                <option value="high">We Have to Do!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('bucket')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="bucket-list">
                    <div class="empty-state">Start building your bucket list together!</div>
                </div>
            </div>
        </div>

        <!-- DREAM HOME TAB -->
        <div id="home-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Dream Home Features</h2>
                
                <button class="add-dream-btn" onclick="showForm('home')">+ Add Home Feature</button>
                
                <div class="dream-form" id="home-form">
                    <form onsubmit="addDream(event, 'home'); return false;">
                        <div class="form-group">
                            <label>Feature or Room</label>
                            <input type="text" name="title" required placeholder="What do you want in your dream home?">
                        </div>
                        <div class="form-group">
                            <label>Details / Vision</label>
                            <textarea name="details" placeholder="Describe how you imagine it..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="home-image" accept="image/*" onchange="previewImage(event, 'home')">
                            <label for="home-image" class="image-upload-label">Choose Image</label>
                            <div id="home-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Importance</label>
                            <select name="priority">
                                <option value="">Nice to Have</option>
                                <option value="soon">Really Want</option>
                                <option value="high">Must Have</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('home')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="home-list">
                    <div class="empty-state">What does your dream home look like?</div>
                </div>
            </div>
        </div>

        <!-- PETS TAB -->
        <div id="pets-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Future Pets & Animal Dreams</h2>
                
                <button class="add-dream-btn" onclick="showForm('pets')">+ Add Pet Dream</button>
                
                <div class="dream-form" id="pets-form">
                    <form onsubmit="addDream(event, 'pets'); return false;">
                        <div class="form-group">
                            <label>Pet Type or Name Idea</label>
                            <input type="text" name="title" required placeholder="What kind of pet?">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="Breed, personality, care needs, name ideas..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="pets-image" accept="image/*" onchange="previewImage(event, 'pets')">
                            <label for="pets-image" class="image-upload-label">Choose Image</label>
                            <div id="pets-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Timeline</label>
                            <select name="priority">
                                <option value="">Someday</option>
                                <option value="soon">Within a Year</option>
                                <option value="high">Ready Now</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('pets')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="pets-list">
                    <div class="empty-state">Dream about your future fur (or scale, or feather) babies!</div>
                </div>
            </div>
        </div>

        <!-- TRADITIONS TAB -->
        <div id="traditions-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Traditions We Want to Start</h2>
                
                <button class="add-dream-btn" onclick="showForm('traditions')">+ Add Tradition Idea</button>
                
                <div class="dream-form" id="traditions-form">
                    <form onsubmit="addDream(event, 'traditions'); return false;">
                        <div class="form-group">
                            <label>Tradition Name</label>
                            <input type="text" name="title" required placeholder="What tradition do you want to start?">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="When? How often? What would it look like?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="traditions-image" accept="image/*" onchange="previewImage(event, 'traditions')">
                            <label for="traditions-image" class="image-upload-label">Choose Image</label>
                            <div id="traditions-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">Future Idea</option>
                                <option value="soon">Start Soon</option>
                                <option value="high">Start This Year</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('traditions')">Cancel</button>
                            <button type="submit" class="btn">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="traditions-list">
                    <div class="empty-state">What traditions do you want to create together?</div>
                </div>
            </div>
        </div>
    </div>

    <div class="random-choice" id="randomChoice">
        <h2>WE CHOOSE...</h2>
        <div class="random-choice-title" id="randomChoiceTitle"></div>
        <div class="random-choice-details" id="randomChoiceDetails"></div>
        <img class="random-choice-image" id="randomChoiceImage" src="" alt="" style="display: none;">
        <div class="random-choice-buttons">
            <button class="btn" onclick="closeRandomChoice()">Let's Do It!</button>
            <button class="btn" onclick="pickAnotherRandom()">Pick Another</button>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <h2>DREAM ACHIEVED!</h2>
        <p id="celebrationText">Amazing! You made it happen!</p>
        <button class="btn" onclick="closeCelebration()">Continue Dreaming</button>
    </div>

    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <img class="lightbox-image" id="lightboxImage" src="" alt="">
    </div>

    <script>
        // Global variables — available immediately
        var categories = ['restaurants', 'places', 'kasey-wishlist', 'charlie-wishlist', 'travel', 'bucket', 'home', 'pets', 'traditions', 'shows-movies'];
        var dreams = {};
        var isConnected = false;
        var currentImageData = {};
        var database = null;
        var firebaseRef = null;
        var firebasePush = null;
        var firebaseRemove = null;
        var firebaseUpdate = null;
        var currentRandomCategory = '';

        // Initialize dreams object
        categories.forEach(function(cat) { dreams[cat] = []; });

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function saveToLocal(category) {
            try { localStorage.setItem('dreams_' + category, JSON.stringify(dreams[category])); } catch(e) {}
        }

        function loadFromLocal(category) {
            try {
                var data = localStorage.getItem('dreams_' + category);
                return data ? JSON.parse(data) : [];
            } catch(e) { return []; }
        }

        // === UI FUNCTIONS (work immediately) ===

        window.previewImage = function(event, category) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData[category] = e.target.result;
                    var preview = document.getElementById(category + '-preview');
                    preview.innerHTML = '<img src="' + e.target.result + '" class="image-upload-preview" alt="Preview">';
                };
                reader.readAsDataURL(file);
            }
        };

        window.openLightbox = function(imageSrc) {
            document.getElementById('lightboxImage').src = imageSrc;
            document.getElementById('lightbox').classList.add('show');
        };

        window.closeLightbox = function() {
            document.getElementById('lightbox').classList.remove('show');
        };

        window.switchToSection = function(section) {
            document.querySelectorAll('.dreams-tab').forEach(function(t) { t.classList.remove('active'); });
            document.getElementById(section + '-tab').classList.add('active');
        };

        window.showForm = function(category) {
            var formEl = document.getElementById(category + '-form');
            formEl.classList.add('active');
            document.body.style.overflow = 'hidden';
            // Close on backdrop click
            formEl._backdropHandler = function(e) {
                if (e.target === formEl) {
                    window.hideForm(category);
                }
            };
            formEl.addEventListener('click', formEl._backdropHandler);
        };

        window.hideForm = function(category) {
            var form = document.getElementById(category + '-form');
            form.classList.remove('active');
            form.querySelector('form').reset();
            var preview = document.getElementById(category + '-preview');
            if (preview) preview.innerHTML = '';
            delete currentImageData[category];
            document.body.style.overflow = '';
            if (form._backdropHandler) {
                form.removeEventListener('click', form._backdropHandler);
                delete form._backdropHandler;
            }
        };

        window.addDream = async function(e, category) {
            e.preventDefault();
            var form = e.target;
            var submitBtn = form.querySelector('button[type="submit"]');
            var cancelBtn = form.querySelector('button[type="button"]');
            var originalText = submitBtn.textContent;

            // Show saving state
            submitBtn.classList.add('saving');
            if (cancelBtn) cancelBtn.style.pointerEvents = 'none';

            var formData = new FormData(form);

            var dream = {
                id: Date.now(),
                title: formData.get('title'),
                details: formData.get('details') || '',
                priority: formData.get('priority') || '',
                achieved: false,
                dateAdded: new Date().toISOString(),
                image: currentImageData[category] || null
            };

            if (category === 'restaurants') {
                dream.occasion = formData.get('occasion') || '';
                var types = formData.getAll('restaurantType');
                if (types.length > 0) dream.restaurantTypes = types;
            }

            if (category === 'places') {
                var ptypes = formData.getAll('placeType');
                if (ptypes.length > 0) dream.placeTypes = ptypes;
            }

            var savedToFirebase = false;

            // Try Firebase first with timeout, fall back to localStorage
            if (database && firebaseRef && firebasePush) {
                try {
                    var dreamsRef = firebaseRef(database, 'dreams/' + category);
                    var pushPromise = firebasePush(dreamsRef, dream);
                    var timeoutPromise = new Promise(function(_, reject) {
                        setTimeout(function() { reject(new Error('timeout')); }, 5000);
                    });
                    await Promise.race([pushPromise, timeoutPromise]);
                    savedToFirebase = true;
                } catch (error) { /* fall through to local */ }
            }

            // localStorage fallback
            if (!savedToFirebase) {
                dream.firebaseId = 'local_' + dream.id;
                if (!dreams[category]) dreams[category] = [];
                dreams[category].push(dream);
                saveToLocal(category);
                renderDreams(category);
            }

            // Show saved confirmation briefly
            submitBtn.classList.remove('saving');
            submitBtn.textContent = 'Saved!';
            submitBtn.style.borderColor = '#7ba886';
            submitBtn.style.color = '#7ba886';

            // Auto-expand the list so user sees their new item
            var listEl = document.getElementById(category + '-list');
            if (listEl) {
                listEl.classList.add('expanded');
                localStorage.setItem('dreamListExpanded_' + category, 'true');
            }

            setTimeout(function() {
                submitBtn.textContent = originalText;
                submitBtn.style.borderColor = '';
                submitBtn.style.color = '';
                if (cancelBtn) cancelBtn.style.pointerEvents = '';
                window.hideForm(category);
            }, 800);
        };

        window.toggleDreamList = function(category) {
            var list = document.getElementById(category + '-list');
            list.classList.toggle('expanded');
            var isExpanded = list.classList.contains('expanded');
            localStorage.setItem('dreamListExpanded_' + category, isExpanded);
        };

        window.toggleAchieved = async function(category, firebaseId, newAchievedState, btn) {
            if (btn) btn.classList.add('saving');

            if (firebaseId.startsWith('local_')) {
                var dream = dreams[category].find(function(d) { return d.firebaseId === firebaseId; });
                if (dream) {
                    dream.achieved = newAchievedState;
                    saveToLocal(category);
                    renderDreams(category);
                    if (newAchievedState) showCelebration(dream.title);
                }
            } else if (database && firebaseRef && firebaseUpdate) {
                try {
                    var dreamRef = firebaseRef(database, 'dreams/' + category + '/' + firebaseId);
                    var updatePromise = firebaseUpdate(dreamRef, { achieved: newAchievedState });
                    var timeoutPromise = new Promise(function(_, reject) {
                        setTimeout(function() { reject(new Error('timeout')); }, 5000);
                    });
                    await Promise.race([updatePromise, timeoutPromise]);
                } catch(error) {
                    var d = dreams[category].find(function(x) { return x.firebaseId === firebaseId; });
                    if (d) { d.achieved = newAchievedState; saveToLocal(category); renderDreams(category); }
                }
                if (newAchievedState) {
                    var d = dreams[category].find(function(x) { return x.firebaseId === firebaseId; });
                    if (d) showCelebration(d.title);
                }
            }

            if (btn) btn.classList.remove('saving');
        };

        window.deleteDream = async function(category, firebaseId, btn) {
            if (confirm('Delete this dream?')) {
                if (btn) btn.classList.add('saving');

                if (firebaseId.startsWith('local_')) {
                    dreams[category] = dreams[category].filter(function(d) { return d.firebaseId !== firebaseId; });
                    saveToLocal(category);
                    renderDreams(category);
                } else if (database && firebaseRef && firebaseRemove) {
                    try {
                        var dreamRef = firebaseRef(database, 'dreams/' + category + '/' + firebaseId);
                        var removePromise = firebaseRemove(dreamRef);
                        var timeoutPromise = new Promise(function(_, reject) {
                            setTimeout(function() { reject(new Error('timeout')); }, 5000);
                        });
                        await Promise.race([removePromise, timeoutPromise]);
                    } catch(error) {
                        dreams[category] = dreams[category].filter(function(d) { return d.firebaseId !== firebaseId; });
                        saveToLocal(category);
                        renderDreams(category);
                    }
                }
            }
        };

        window.closeCelebration = function() {
            document.getElementById('celebration').classList.remove('show');
        };

        window.chooseRandomDream = function(category) {
            currentRandomCategory = category;
            var unachievedDreams = dreams[category].filter(function(d) { return !d.achieved; });
            if (unachievedDreams.length === 0) {
                alert('No items to choose from yet! Add some first.');
                return;
            }
            var randomDream = unachievedDreams[Math.floor(Math.random() * unachievedDreams.length)];
            showRandomChoice(randomDream);
        };

        function showRandomChoice(dream) {
            document.getElementById('randomChoiceTitle').textContent = dream.title;
            document.getElementById('randomChoiceDetails').textContent = dream.details || '';
            var img = document.getElementById('randomChoiceImage');
            if (dream.image) {
                img.src = dream.image;
                img.style.display = 'block';
            } else {
                img.style.display = 'none';
            }
            document.getElementById('randomChoice').classList.add('show');
        }

        window.closeRandomChoice = function() {
            document.getElementById('randomChoice').classList.remove('show');
            currentRandomCategory = '';
        };

        window.pickAnotherRandom = function() {
            document.getElementById('randomChoice').classList.remove('show');
            setTimeout(function() {
                window.chooseRandomDream(currentRandomCategory);
            }, 200);
        };

        function showCelebration(dreamTitle) {
            document.getElementById('celebrationText').textContent = 'You achieved: "' + dreamTitle + '"';
            document.getElementById('celebration').classList.add('show');
            createConfetti();
        }

        function createConfetti() {
            var colors = ['#b59197', '#7ba886', '#d4a5ae', '#ff9999', '#ffcc99', '#a8e6cf', '#95c9b4'];
            for (var i = 0; i < 100; i++) {
                (function(idx) {
                    setTimeout(function() {
                        var confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.top = '-10px';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        var size = Math.random() * 8 + 6;
                        confetti.style.width = size + 'px';
                        confetti.style.height = size + 'px';
                        var duration = Math.random() * 2 + 2;
                        confetti.style.animationDuration = duration + 's';
                        document.body.appendChild(confetti);
                        setTimeout(function() { confetti.remove(); }, duration * 1000);
                    }, idx * 30);
                })(i);
            }
        }

        function renderDreams(category) {
            var listContainer = document.getElementById(category + '-list');
            if (!listContainer) return;

            if (!dreams[category] || dreams[category].length === 0) {
                var emptyMessages = {
                    restaurants: 'No restaurants yet. Where should you go for date night?',
                    places: 'No places yet. Where do you want to go?',
                    'kasey-wishlist': "Kasey's wishlist is empty",
                    'charlie-wishlist': "Charlie's wishlist is empty",
                    travel: 'No travel dreams yet. Where do you want to go?',
                    'shows-movies': 'No shows or movies yet. What do you want to watch together?',
                    bucket: 'Start building your bucket list together!',
                    home: 'What does your dream home look like?',
                    pets: 'Dream about your future fur (or scale, or feather) babies!',
                    traditions: 'What traditions do you want to create together?'
                };
                listContainer.innerHTML = '<div class="empty-state">' + (emptyMessages[category] || '') + '</div>';
                listContainer.classList.remove('expanded');
                return;
            }

            var sorted = dreams[category].slice().sort(function(a, b) {
                if (a.achieved !== b.achieved) return a.achieved ? 1 : -1;
                var priorityOrder = { high: 0, soon: 1, friends: 2, '': 3 };
                return (priorityOrder[a.priority] || 3) - (priorityOrder[b.priority] || 3);
            });

            var html = '<div class="dream-list-toggle" onclick="toggleDreamList(\'' + category + '\')">' +
                '<span class="dream-list-toggle-text">View List (' + sorted.length + ' item' + (sorted.length !== 1 ? 's' : '') + ')</span>' +
                '<span class="dream-list-arrow">&#9660;</span></div><div class="dream-list-content">';

            sorted.forEach(function(dream) {
                var priorityTag = '';
                if (dream.priority === 'high') priorityTag = '<span class="dream-tag priority-high">High Priority</span>';
                else if (dream.priority === 'soon') priorityTag = '<span class="dream-tag priority-soon">Soon</span>';
                else if (dream.priority === 'friends') priorityTag = '<span class="dream-tag priority-friends">Go with Friends</span>';

                var occasionTag = '';
                if (dream.occasion === 'date-night') occasionTag = '<span class="dream-tag occasion-date-night">Date Night</span>';
                else if (dream.occasion === 'friends') occasionTag = '<span class="dream-tag occasion-friends">Go with Friends</span>';
                else if (dream.occasion === 'special') occasionTag = '<span class="dream-tag occasion-special">Special Occasion</span>';

                var restaurantTypeTags = '';
                if (dream.restaurantTypes && Array.isArray(dream.restaurantTypes)) {
                    restaurantTypeTags = dream.restaurantTypes.map(function(type) {
                        return '<span class="dream-tag">' + type.charAt(0).toUpperCase() + type.slice(1) + '</span>';
                    }).join('');
                } else if (dream.restaurantType) {
                    restaurantTypeTags = '<span class="dream-tag">' + dream.restaurantType.charAt(0).toUpperCase() + dream.restaurantType.slice(1) + '</span>';
                }

                var placeTypeTags = '';
                if (dream.placeTypes && Array.isArray(dream.placeTypes)) {
                    placeTypeTags = dream.placeTypes.map(function(type) {
                        return '<span class="dream-tag">' + type.split('-').map(function(w) { return w.charAt(0).toUpperCase() + w.slice(1); }).join(' ') + '</span>';
                    }).join('');
                }

                var allTags = '';
                if (restaurantTypeTags || placeTypeTags || occasionTag || priorityTag) {
                    allTags = '<div class="dream-item-meta">' + restaurantTypeTags + placeTypeTags + occasionTag + priorityTag + '</div>';
                }

                html += '<div class="dream-item ' + (dream.achieved ? 'achieved' : '') + '">' +
                    '<div class="dream-item-content">' +
                    '<div class="dream-item-title">' + escapeHtml(dream.title) + '</div>' +
                    (dream.details ? '<div class="dream-item-details">' + escapeHtml(dream.details) + '</div>' : '') +
                    (dream.image ? '<img src="' + dream.image + '" class="dream-item-image" onclick="openLightbox(this.src)" alt="' + escapeHtml(dream.title) + '">' : '') +
                    allTags + '</div>' +
                    '<div class="dream-item-actions">' +
                    '<button class="icon-btn ' + (dream.achieved ? 'achieved' : '') + '" onclick="toggleAchieved(\'' + category + '\', \'' + dream.firebaseId + '\', ' + !dream.achieved + ', this)">' +
                    (dream.achieved ? '&#10004; Done' : 'Mark Done') + '</button>' +
                    '<button class="icon-btn" onclick="deleteDream(\'' + category + '\', \'' + dream.firebaseId + '\', this)">' + 'Delete</button>' +
                    '</div></div>';
            });

            html += '</div>';
            listContainer.innerHTML = html;

            var expandedState = localStorage.getItem('dreamListExpanded_' + category);
            if (expandedState === 'true') {
                listContainer.classList.add('expanded');
            } else {
                listContainer.classList.remove('expanded');
            }
        }

        // === LOAD LOCAL DATA IMMEDIATELY ===
        categories.forEach(function(cat) {
            dreams[cat] = loadFromLocal(cat);
            renderDreams(cat);
        });

        // === LOAD FIREBASE IN BACKGROUND ===
        (async function() {
            try {
                var appModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                var dbModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js');

                var firebaseConfig = {
                    apiKey: "AIzaSyCDda9sPwSY-RQ5rrM5THOvcLtHvcPRYd4",
                    authDomain: "our-habit-hub.firebaseapp.com",
                    databaseURL: "https://our-habit-hub-default-rtdb.firebaseio.com",
                    projectId: "our-habit-hub",
                    storageBucket: "our-habit-hub.firebasestorage.app",
                    messagingSenderId: "78555830496",
                    appId: "1:78555830496:web:3e457e54729cc11b825885"
                };

                var app = appModule.initializeApp(firebaseConfig);
                database = dbModule.getDatabase(app);
                firebaseRef = dbModule.ref;
                firebasePush = dbModule.push;
                firebaseRemove = dbModule.remove;
                firebaseUpdate = dbModule.update;

                // Set up real-time listeners
                categories.forEach(function(category) {
                    var dreamsRef = dbModule.ref(database, 'dreams/' + category);
                    dbModule.onValue(dreamsRef, function(snapshot) {
                        var data = snapshot.val();
                        dreams[category] = [];
                        if (data) {
                            Object.keys(data).forEach(function(key) {
                                dreams[category].push(Object.assign({ firebaseId: key }, data[key]));
                            });
                        }
                        // Sync local-only items up to Firebase
                        var localItems = loadFromLocal(category);
                        localItems.forEach(function(item) {
                            if (item.firebaseId && item.firebaseId.indexOf('local_') === 0) {
                                dbModule.push(dbModule.ref(database, 'dreams/' + category), item).then(function() {
                                    var remaining = loadFromLocal(category).filter(function(l) { return l.id !== item.id; });
                                    localStorage.setItem('dreams_' + category, JSON.stringify(remaining));
                                }).catch(function() {});
                            }
                        });
                        saveToLocal(category);
                        renderDreams(category);
                        isConnected = true;
                    }, function(error) {
                        // Firebase error — keep using local data
                    });
                });

            } catch(e) {
                // Firebase failed to load — local storage still works
            }
        })();
    </script>
<script>
function toggleNav() {
    var h = document.getElementById('navHamburger');
    var o = document.getElementById('navOverlay');
    if (!h || !o) return;
    var isOpen = o.classList.contains('open');
    if (isOpen) {
        h.classList.remove('open');
        o.classList.remove('open');
        document.body.style.overflow = '';
    } else {
        h.classList.add('open');
        o.classList.add('open');
        document.body.style.overflow = 'hidden';
    }
}
</script>
</body>
</html>
