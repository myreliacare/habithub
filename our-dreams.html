<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Our Life Together</title>
    <script>
    /* Life Hub Settings Engine v3 - Independent Secondary + Firebase Sync */
    (function(){
        if(window._lhEngineLoaded) return; window._lhEngineLoaded=true;

        function h2r(h){h=h.replace('#','');return[parseInt(h.substring(0,2),16),parseInt(h.substring(2,4),16),parseInt(h.substring(4,6),16)];}
        function r2h(r,g,b){return'#'+((1<<24)+(r<<16)+(g<<8)+b).toString(16).slice(1);}
        function clamp(v){return Math.max(0,Math.min(255,Math.round(v)));}
        function lighten(hex,pct){var c=h2r(hex);return r2h(clamp(c[0]+(255-c[0])*pct),clamp(c[1]+(255-c[1])*pct),clamp(c[2]+(255-c[2])*pct));}
        function darken(hex,pct){var c=h2r(hex);return r2h(clamp(c[0]*(1-pct)),clamp(c[1]*(1-pct)),clamp(c[2]*(1-pct)));}
        function rgbStr(hex){var c=h2r(hex);return c[0]+','+c[1]+','+c[2];}

        var accentHexMap={sage:'#a3b899',blush:'#d4919e',cream:'#e8ddd0',periwinkle:'#8e9cc7',dustylilac:'#c3a6c9',powderblue:'#a4c2d8',softmint:'#a8d8c4',moss:'#8a9c6b',burntsienna:'#c97856',dustyteal:'#6d9e9e',petalpink:'#e8b4b8',apricot:'#e8b088',palejade:'#8ec4a8',raspberry:'#b0607a',denim:'#6888a8',nude:'#d4b8a8',obsidian:'#181818',darkplum:'#3d2f31',storm:'#252830'};
        var defaultSecMap={sage:'petalpink',blush:'sage',cream:'petalpink',periwinkle:'petalpink',dustylilac:'petalpink',powderblue:'petalpink',softmint:'petalpink',moss:'petalpink',burntsienna:'sage',petalpink:'sage',dustyteal:'petalpink',apricot:'sage',palejade:'petalpink',raspberry:'sage',denim:'petalpink',nude:'sage',obsidian:'petalpink',darkplum:'sage',storm:'petalpink'};
        var bgMap={dark:'#3d2f31',forest:'#1f2e2a',espresso:'#2b2220',storm:'#252830',midnight:'#141420',warmcocoa:'#362a28',deepteal:'#1a2e2e',warmlinen:'#f0e8dc',dustymauve:'#332830',obsidian:'#181818',softblush:'#f0d4da',bordeaux:'#301820'};
        var bgDkMap={dark:'#2a1f21',forest:'#15231f',espresso:'#1e1816',storm:'#1b1d24',midnight:'#0d0d16',warmcocoa:'#281e1c',deepteal:'#122020',warmlinen:'#e4dace',dustymauve:'#261c24',obsidian:'#101010',softblush:'#e5c8cf',bordeaux:'#221018'};
        var tcMap={dark:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},forest:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},espresso:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},storm:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},midnight:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},warmcocoa:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},deepteal:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},warmlinen:{t:'#3d2f31',m:'rgba(61,47,49,0.65)',f:'rgba(61,47,49,0.4)'},dustymauve:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},obsidian:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'},softblush:{t:'#3d2f31',m:'rgba(61,47,49,0.65)',f:'rgba(61,47,49,0.4)'},bordeaux:{t:'#e0d2d0',m:'rgba(242,235,224,0.6)',f:'rgba(242,235,224,0.4)'}};
        var fontMap={philosopher:"'Philosopher',Georgia,serif",cormorant:"'Cormorant Garamond',Georgia,serif",worksans:"'Work Sans',sans-serif",baloo:"'Baloo 2',cursive",lora:"'Lora',Georgia,serif",cardo:"'Cardo',Georgia,serif",playfair:"'Playfair Display',Georgia,serif",kalam:"'Kalam',cursive",lobster:"'Lobster',cursive",indieflower:"'Indie Flower',cursive",gilda:"'Gilda Display',Georgia,serif",cormorantinfant:"'Cormorant Infant',Georgia,serif",dmserif:"'DM Serif Display',Georgia,serif",tenor:"'Tenor Sans',sans-serif",dancing:"'Dancing Script',cursive",satisfy:"'Satisfy',cursive",greatvibes:"'Great Vibes',cursive",abril:"'Abril Fatface',Georgia,serif"};

        // Read settings
        var ac=localStorage.getItem('accentColor')||'sage';
        var sc=localStorage.getItem('secondaryColor')||defaultSecMap[ac]||'petalpink';
        // Migrate removed color keys
        if(ac==='rosegold'){ac='petalpink';localStorage.setItem('accentColor','petalpink');}
        if(sc==='rosegold'){sc='petalpink';localStorage.setItem('secondaryColor','petalpink');}

        var bc=localStorage.getItem('bgColor')||'dark';
        var ff=localStorage.getItem('fontFamily')||'philosopher';
        var hf=localStorage.getItem('headingFont')||'philosopher';
        var fs=parseInt(localStorage.getItem('fontSize')||'100',10);
        var appName=localStorage.getItem('appName')||'Our Life Hub';
        var names;try{names=JSON.parse(localStorage.getItem('userNames')||'{}');}catch(e){names={};}
        names.name1=names.name1||'Kasey'; names.name2=names.name2||'Charlie';
        var archivedPages;try{archivedPages=JSON.parse(localStorage.getItem('archivedPages')||'[]');}catch(e){archivedPages=[];}

        // Resolve colors
        var pa=accentHexMap[ac]||accentHexMap.sage;
        var secHex=accentHexMap[sc]||accentHexMap.rose;
        var bg=bgMap[bc]||bgMap.dark;
        var bgDk=bgDkMap[bc]||bgDkMap.dark;
        var tc=tcMap[bc]||tcMap.dark;
        var font=fontMap[ff]||fontMap.philosopher;
        var hFont=fontMap[hf]||fontMap.philosopher;
        var basePx=Math.round(16*fs/100);

        // Apply CSS custom properties immediately
        var r=document.documentElement;
        r.style.setProperty('--lh-accent',pa);
        r.style.setProperty('--lh-accent-hover',lighten(pa,0.12));
        r.style.setProperty('--lh-accent-muted','rgba('+rgbStr(pa)+',0.2)');
        r.style.setProperty('--lh-accent-border','rgba('+rgbStr(pa)+',0.3)');
        r.style.setProperty('--lh-accent-text','rgba('+rgbStr(pa)+',0.6)');
        r.style.setProperty('--lh-bg',bg);
        r.style.setProperty('--lh-bg-darker',bgDk);
        r.style.setProperty('--lh-secondary',secHex);
        var sR=parseInt(secHex.slice(1,3),16),sG=parseInt(secHex.slice(3,5),16),sB=parseInt(secHex.slice(5,7),16);
        r.style.setProperty('--lh-secondary-muted','rgba('+sR+','+sG+','+sB+',0.15)');
        r.style.setProperty('--lh-secondary-border','rgba('+sR+','+sG+','+sB+',0.3)');
        r.style.setProperty('--lh-text',tc.t);
        r.style.setProperty('--lh-text-muted',tc.m);
        r.style.setProperty('--lh-text-faint',tc.f);
        r.style.setProperty('--lh-font',font);
        r.style.setProperty('--lh-heading-font',hFont);
        r.style.setProperty('--lh-font-size',basePx+'px');
        r.style.background=bg; r.style.fontSize=basePx+'px';

        // Load fonts if not already present
        var neededFonts=[];
        var fontUrls={philosopher:'Philosopher:ital,wght@0,400;0,700;1,400',cormorant:'Cormorant+Garamond:wght@300;400;500;600;700',worksans:'Work+Sans:wght@400;500;600;700;800',baloo:'Baloo+2:wght@400;500;600;700;800',lora:'Lora:ital,wght@0,400;0,500;0,600;0,700;1,400',cardo:'Cardo:ital,wght@0,400;0,700;1,400',playfair:'Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400',kalam:'Kalam:wght@300;400;700',lobster:'Lobster',indieflower:'Indie+Flower',gilda:'Gilda+Display',cormorantinfant:'Cormorant+Infant:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400',dmserif:'DM+Serif+Display:ital@0;1',tenor:'Tenor+Sans',dancing:'Dancing+Script:wght@400;500;600;700',satisfy:'Satisfy',greatvibes:'Great+Vibes',abril:'Abril+Fatface'};
        [ff,hf].forEach(function(f){if(fontUrls[f]&&neededFonts.indexOf(fontUrls[f])===-1)neededFonts.push(fontUrls[f]);});
        if(neededFonts.length){var link=document.createElement('link');link.rel='stylesheet';link.href='https://fonts.googleapis.com/css2?'+neededFonts.map(function(f){return'family='+f;}).join('&')+'&display=swap';document.head.appendChild(link);}

        // Heading font override
        // Heading font - always apply
        var hfSt=document.createElement('style');hfSt.textContent='body{font-family:'+font+'!important} .top-nav,.nav-link,.nav-link-mobile{font-family:'+font+'!important} .nav-logo,.page-title,.home-title,.main-title{font-family:'+hFont+'!important}';(document.head||r).appendChild(hfSt);

        // Archive nav links
        var pageHrefs={home:'index.html',person1:'kasey-hub.html',person2:'charlie-hub.html',dreams:'our-dreams.html',meals:'meal-plan.html',settings:'settings.html'};
        var archCSS='';archivedPages.forEach(function(k){var h=pageHrefs[k];if(h)archCSS+='a.nav-link[href="'+h+'"],a.nav-link-mobile[href="'+h+'"]{display:none!important}\n';});
        if(archCSS){var st=document.createElement('style');st.textContent=archCSS;(document.head||r).appendChild(st);}

        // Expose globally
        window.LifeHubSettings={current:{appName:appName,names:names,accentColor:ac,secondaryColor:sc,bgColor:bc,fontFamily:ff,headingFont:hf,fontSize:fs,archivedPages:archivedPages},getName:function(p){return p===1||p==='person1'?names.name1:names.name2;},accentHexMap:accentHexMap,defaultSecMap:defaultSecMap};

        function onReady(fn){if(document.readyState!=='loading')fn();else document.addEventListener('DOMContentLoaded',fn);}
        onReady(function(){
            // Names
            document.querySelectorAll('.nav-logo').forEach(function(el){el.textContent=appName;});
            document.querySelectorAll('.nav-link,.nav-link-mobile').forEach(function(lnk){
                var href=lnk.getAttribute('href')||'';
                if(href==='kasey-hub.html')lnk.textContent=names.name1;
                if(href==='charlie-hub.html')lnk.textContent=names.name2;
            });
            document.querySelectorAll('[data-lh-name="app"]').forEach(function(el){el.textContent=appName;});
            document.querySelectorAll('[data-lh-name="person1"]').forEach(function(el){el.textContent=names.name1;});
            document.querySelectorAll('[data-lh-name="person2"]').forEach(function(el){el.textContent=names.name2;});
            var title=document.title;
            if(title.indexOf('Our Life Hub')!==-1)document.title=title.replace('Our Life Hub',appName);
            if(title.indexOf("Kasey's")!==-1)document.title=title.replace("Kasey's",names.name1+"'s");
            else if(title.indexOf('Kasey')!==-1)document.title=title.replace('Kasey',names.name1);
            if(title.indexOf("Charlie's")!==-1)document.title=title.replace("Charlie's",names.name2+"'s");
            else if(title.indexOf('Charlie')!==-1)document.title=title.replace('Charlie',names.name2);

            // Skip rewriting if all defaults
            if(ac==='sage'&&sc===(defaultSecMap.sage||'petalpink')&&bc==='dark')return;

            // Build computed variant families
            var A={vdark:darken(pa,0.45),dark:darken(pa,0.30),mdark:darken(pa,0.15),base:pa,light:lighten(pa,0.15),vlight:lighten(pa,0.30),xlight:lighten(pa,0.50)};
            var S={vdark:darken(secHex,0.45),dark:darken(secHex,0.30),mdark:darken(secHex,0.15),base:secHex,light:lighten(secHex,0.10),vlight:lighten(secHex,0.25),xlight:lighten(secHex,0.40),redish:darken(secHex,0.10)};
            var bgMid=lighten(bg,0.15);

            var reps=[];
            var aRgb=rgbStr(A.base),sRgb=rgbStr(S.base);

            if(ac!=='sage'){
                // PRIMARY ACCENT hex (green family → new accent)
                reps.push(['#4a5c3f',A.vdark],['#4a6a3e',A.vdark],['#4A5C3F',A.vdark],['#4A6A3E',A.vdark]);
                reps.push(['#6d8a5e',A.dark],['#5a7a4a',A.dark],['#6D8A5E',A.dark],['#5A7A4A',A.dark]);
                reps.push(['#7d8f76',A.mdark],['#8fa87a',A.mdark],['#8fa882',A.mdark],['#7a9b6a',A.mdark]);
                reps.push(['#7D8F76',A.mdark],['#8FA87A',A.mdark],['#8FA882',A.mdark],['#7A9B6A',A.mdark]);
                reps.push(['#a3b899',A.base],['#A3B899',A.base],['#7ba886',A.base],['#7BA886',A.base]);
                reps.push(['#b4c9aa',A.light],['#B4C9AA',A.light],['#b5c9a8',A.light],['#B5C9A8',A.light]);
                reps.push(['#a8c99b',A.light],['#A8C99B',A.light],['#b8c9ad',A.light],['#B8C9AD',A.light]);
                reps.push(['#b5d4a4',A.vlight],['#B5D4A4',A.vlight],['#c4d9b5',A.vlight],['#C4D9B5',A.vlight]);
                // TEAL
                reps.push(['#3d6b6b',A.dark],['#3D6B6B',A.dark],['#4a7a7a',A.mdark],['#4A7A7A',A.mdark],['#5a9a9a',A.base],['#5A9A9A',A.base]);
                // GOLD/BROWN accents
                reps.push(['#c4a882',A.light],['#C4A882',A.light],['#d4a882',A.light],['#D4A882',A.light]);
                reps.push(['#8a7a2e',A.dark],['#8A7A2E',A.dark],['#b5a33d',A.mdark],['#B5A33D',A.mdark]);
                reps.push(['#c9b84a',A.base],['#C9B84A',A.base]);
                reps.push(['#edecd5',A.xlight],['#EDECD5',A.xlight]);
                // PASTELS
                reps.push(['#a8e6cf',lighten(A.base,0.40)],['#98d8c8',lighten(A.base,0.35)],['#b4f8c8',lighten(A.base,0.50)]);
                reps.push(['#4ecdc4',A.base],['#45b7d1',A.mdark],['#95c9b4',A.light]);
                // rgba green family
                reps.push([/rgba\(\s*163,\s*184,\s*153,\s*([0-9.]+)\s*\)/g,'rgba('+aRgb+',$1)']);
                reps.push([/rgba\(\s*122,\s*138,\s*110,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);
                reps.push([/rgba\(\s*168,\s*201,\s*155,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.light)+',$1)']);
                reps.push([/rgba\(\s*123,\s*168,\s*134,\s*([0-9.]+)\s*\)/g,'rgba('+aRgb+',$1)']);
                reps.push([/rgba\(\s*109,\s*138,\s*94,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);
                reps.push([/rgba\(\s*125,\s*143,\s*118,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.mdark)+',$1)']);
                reps.push([/rgba\(\s*61,\s*107,\s*107,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.dark)+',$1)']);
                reps.push([/rgba\(\s*201,\s*184,\s*74,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.mdark)+',$1)']);
                reps.push([/rgba\(\s*196,\s*168,\s*130,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(A.light)+',$1)']);
            }

            // SECONDARY always remap if different from default rose
            if(sc!=='petalpink'||ac!=='sage'){
                reps.push(['#5a4345',S.vdark],['#5a4a4c',S.vdark],['#5A4345',S.vdark],['#5A4A4C',S.vdark]);
                reps.push(['#6b5a5e',S.dark],['#7a6668',S.dark],['#6B5A5E',S.dark],['#7A6668',S.dark]);
                reps.push(['#9a7a80',S.mdark],['#a57f85',S.mdark],['#9A7A80',S.mdark],['#A57F85',S.mdark]);
                reps.push(['#b4828c',S.mdark],['#B4828C',S.mdark]);
                reps.push(['#b59197',S.base],['#B59197',S.base]);
                reps.push(['#c5a1a7',S.light],['#c9a9a6',S.light],['#c8b8bb',S.light]);
                reps.push(['#C5A1A7',S.light],['#C9A9A6',S.light],['#C8B8BB',S.light]);
                reps.push(['#d4b5b8',S.vlight],['#d4b5ba',S.vlight],['#d4a5a5',S.vlight],['#d4a5ae',S.vlight]);
                reps.push(['#D4B5B8',S.vlight],['#D4B5BA',S.vlight],['#D4A5A5',S.vlight],['#D4A5AE',S.vlight]);
                reps.push(['#e8d5d8',S.xlight],['#E8D5D8',S.xlight]);
                reps.push(['#c97a7a',S.redish],['#C97A7A',S.redish],['#d67373',S.redish],['#D67373',S.redish]);
                reps.push(['#8a7a6d',S.dark],['#8A7A6D',S.dark]);
                reps.push(['#a08cb4',S.light],['#A08CB4',S.light]);
                reps.push(['#c7ceea',S.xlight],['#C7CEEA',S.xlight]);
                // rgba rose family
                reps.push([/rgba\(\s*181,\s*145,\s*151,\s*([0-9.]+)\s*\)/g,'rgba('+sRgb+',$1)']);
                reps.push([/rgba\(\s*201,\s*169,\s*166,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.light)+',$1)']);
                reps.push([/rgba\(\s*180,\s*130,\s*140,\s*([0-9.]+)\s*\)/g,'rgba('+sRgb+',$1)']);
                reps.push([/rgba\(\s*201,\s*122,\s*122,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.redish)+',$1)']);
                reps.push([/rgba\(\s*160,\s*140,\s*180,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(S.light)+',$1)']);
            }

            if(bc!=='dark'){
                var isLight=(bc==='warmlinen'||bc==='softblush');
                if(isLight){
                    var cardBgSolid='#ffffff';
                    reps.push(['#3d2f31',cardBgSolid],['#3D2F31',cardBgSolid],['#3c2f31',cardBgSolid],['#3C2F31',cardBgSolid]);
                    reps.push(['#2a1f21',cardBgSolid],['#2A1F21',cardBgSolid]);
                    reps.push(['#4a3a3c',cardBgSolid],['#4A3A3C',cardBgSolid],['#4a3b3e',cardBgSolid],['#4A3B3E',cardBgSolid]);
                } else {
                    reps.push(['#3d2f31',bg],['#3D2F31',bg],['#3c2f31',bg],['#3C2F31',bg]);
                    reps.push(['#2a1f21',bgDk],['#2A1F21',bgDk]);
                    reps.push(['#4a3a3c',bgMid],['#4A3A3C',bgMid],['#4a3b3e',bgMid],['#4A3B3E',bgMid]);
                }
                reps.push([/rgba\(\s*61,\s*47,\s*49,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bg)+',$1)']);
                reps.push([/rgba\(\s*60,\s*47,\s*49,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bg)+',$1)']);
                reps.push([/rgba\(\s*42,\s*31,\s*33,\s*([0-9.]+)\s*\)/g,'rgba('+rgbStr(bgDk)+',$1)']);
            }
            if(bc==='warmlinen'||bc==='softblush'){
                reps.push(['#f2ebe0',tc.t],['#F2EBE0',tc.t],['#e0d2d0',tc.t],['#E0D2D0',tc.t]);
                reps.push(['#EBE0D6',tc.t],['#ebe0d6',tc.t],['#f5ede6',tc.t],['#F5EDE6',tc.t]);
                reps.push(['#f5f0ed',tc.t],['#F5F0ED',tc.t],['#f0ebe6',tc.t],['#F0EBE6',tc.t]);
                reps.push(['#f0efe8',tc.t],['#F0EFE8',tc.t],['#faf8f6',tc.t],['#FAF8F6',tc.t]);
                reps.push(['#f7ebf0',tc.t],['#F7EBEF',tc.t]);
                reps.push(['#e3d6cc',tc.m],['#E3D6CC',tc.m],['#e0d5cb',tc.m],['#E0D5CB',tc.m]);
                reps.push([/rgba\(\s*242,\s*235,\s*224,\s*([0-9.]+)\s*\)/g,tc.m]);
                reps.push([/rgba\(\s*224,\s*210,\s*208,\s*([0-9.]+)\s*\)/g,tc.m]);
                reps.push(['#fff',tc.t],['#FFF',tc.t]);
            }

            function applyReps(text){reps.forEach(function(pair){if(pair[0] instanceof RegExp)text=text.replace(pair[0],pair[1]);else text=text.split(pair[0]).join(pair[1]);});return text;}
            document.querySelectorAll('style').forEach(function(s){var css=s.textContent,orig=css;css=applyReps(css);if(css!==orig)s.textContent=css;});
            document.querySelectorAll('[style]').forEach(function(el){var st=el.getAttribute('style'),orig=st;st=applyReps(st);if(st!==orig)el.setAttribute('style',st);});
            var ov=document.createElement('style');
            ov.textContent=':root{--dark-bg:'+bg+'!important;--card-bg:'+bgDk+'!important;--sage-green:'+A.base+'!important;--muted-sage:'+A.mdark+'!important;--light-text:'+tc.t+'!important;--cream:'+tc.t+'!important;--border-color:rgba('+aRgb+',0.2)!important}';
            document.head.appendChild(ov);
            // Light background comprehensive override
            if(bc==='warmlinen'||bc==='softblush'){
                var lo=document.createElement('style');
                var navBg=darken(bg,0.55);
                var navBgDk=darken(bg,0.62);
                lo.textContent=[
                    'html,body{background:'+bg+'!important;color:'+tc.t+'!important}',
                    '.top-nav{background:'+navBg+'!important;border-bottom:1px solid rgba(0,0,0,0.1)!important}',
                    '.nav-overlay{background:'+navBgDk+'!important}',
                    '.section,.card{background:rgba(255,255,255,0.88)!important;border:1px solid rgba(0,0,0,0.08)!important;box-shadow:0 1px 4px rgba(0,0,0,0.06)!important}',
                    '.section-title,.card-title{color:'+tc.t+'!important}',
                    '.nav-hamburger span{background:'+tc.t+'!important}',
                    '.sync-status{background:rgba(255,255,255,0.9)!important;border-color:rgba(0,0,0,0.1)!important}',
                    'input,textarea,select{background:rgba(255,255,255,0.7)!important;color:'+tc.t+'!important;border-color:rgba(0,0,0,0.12)!important}',
                    'button{color:'+tc.t+'}',
                    '.nav-refresh{color:rgba(255,255,255,0.7)!important}'
                ].join('\n');
                document.head.appendChild(lo);
            }
        });

        // ── Firebase Settings Sync ──
        // After Firebase initializes, check for remote settings
        window._lhSyncSettings = function() {
            if (!window.db || !window.firestoreImports) return;
            var fs = window.firestoreImports;
            fs.getDoc(fs.doc(window.db, 'settings', 'global')).then(function(snap) {
                if (!snap.exists()) return;
                var remote = snap.data();
                var localTs = parseInt(localStorage.getItem('_settingsLastSaved') || '0', 10);
                var remoteTs = remote._lastUpdated || 0;
                if (typeof remoteTs === 'string') remoteTs = new Date(remoteTs).getTime() || 0;
                if (localTs > 0 && localTs >= remoteTs) return;
                var changed = false;
                var keys = ['accentColor','secondaryColor','bgColor','fontFamily','headingFont','fontSize','appName','userNames','archivedPages','archivedSections','pageLabels','features','customHabits_person1','customHabits_person2','customPrompts','customChallenges','timezone','weekStart','mealSettings','person1Appearance','person2Appearance'];
                keys.forEach(function(key) {
                    if (remote[key] !== undefined) {
                        var local = localStorage.getItem(key);
                        var remoteVal = typeof remote[key] === 'object' ? JSON.stringify(remote[key]) : String(remote[key]);
                        if (local !== remoteVal) {
                            localStorage.setItem(key, remoteVal);
                            changed = true;
                        }
                    }
                });
                if (changed) { localStorage.setItem('_settingsLastSaved', remoteTs.toString()); location.reload(); }
            }).catch(function(e) { console.log('Settings sync check failed:', e); });
        };
        // Hook into firebaseReady event
        if (window.firebaseReady) { window._lhSyncSettings(); }
        else { window.addEventListener('firebaseReady', function() { window._lhSyncSettings(); }, { once: true }); }
    })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&family=Philosopher:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            width: 100%;
            background: #3d2f31;
            overflow-x: hidden;
            overflow-y: scroll;
            overscroll-behavior: none;
            min-height: 100%;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Philosopher', Georgia, serif;
            background: #3d2f31 !important;
            min-height: 100%;
            min-height: 100dvh;
            padding: 80px 16px 16px 16px;
            color: #4a3a3c;
            position: relative;
            width: 100%;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            background: #b59197;
            color: #4a3a3c;
            border-color: #b59197;
        }

        .page-header {
            text-align: center;
            margin-bottom: 32px;
            margin-top: 24px;
        }

        .page-title {
            font-family: 'Dancing Script', cursive;
            background: linear-gradient(135deg, #b59197 0%, #7ba886 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.8rem;
            font-weight: 400;
            letter-spacing: 0.02em;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #7a6668;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            font-style: italic;
        }

        .section-nav-dropdown {
            margin-bottom: 20px;
            text-align: center;
        }

        #sectionSelect {
            width: auto;
            background: #EBE0D6;
            border: 1px solid #7ba886;
            color: #7ba886;
            padding: 8px 12px;
            font-size: 0.85rem;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            letter-spacing: 0.05em;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237ba886' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 14px;
            padding-right: 30px;
        }

        #sectionSelect:hover {
            background-color: #e8d5d8;
            border-color: #b59197;
        }

        #sectionSelect:focus {
            outline: none;
            border-color: #b59197;
        }

        #sectionSelect option {
            background: #EBE0D6;
            color: #4a3a3c;
            padding: 8px;
        }

        .dreams-tab {
            display: none;
        }

        .dreams-tab.active {
            display: block;
        }

        .section {
            background: #EBE0D6;
            border: 1px solid #b59197;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 0.75rem;
            font-weight: 400;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #b59197;
            margin-bottom: 20px;
        }

        .dream-list {
            margin-bottom: 16px;
        }

        .dream-list-toggle {
            background: #EBE0D6;
            padding: 12px 16px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #d4b5b8;
            margin-bottom: 0;
            transition: background 0.2s;
        }

        .dream-list-toggle:hover {
            background: #e3d6cc;
        }

        .dream-list-toggle-text {
            color: #7ba886;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 500;
        }

        .dream-list-arrow {
            color: #7a6668;
            transition: transform 0.2s;
            font-size: 0.9rem;
        }

        .dream-list.expanded .dream-list-arrow {
            transform: rotate(180deg);
        }

        .dream-list-content {
            display: none;
            padding-top: 12px;
        }

        .dream-list.expanded .dream-list-content {
            display: block;
        }

        .dream-item {
            background: #EBE0D6;
            padding: 12px 14px;
            margin-bottom: 2px;
            border-left: 3px solid #b59197;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .dream-item:hover {
            background: #e3d6cc;
        }

        .dream-item.achieved {
            opacity: 0.5;
            border-left-color: #7ba886;
        }

        .dream-item-content {
            flex: 1;
            min-width: 0;
        }

        .dream-item-title {
            color: #4a3a3c;
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dream-item.achieved .dream-item-title {
            text-decoration: line-through;
        }

        .dream-item-indicators {
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }

        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .indicator-dot.high { background: #ff9999; }
        .indicator-dot.soon { background: #ffcc99; }
        .indicator-dot.has-image { background: #b59197; }

        .dream-item-chevron {
            color: #b59197;
            font-size: 0.7rem;
            flex-shrink: 0;
            opacity: 0.5;
        }

        /* Detail Popup */
        .detail-popup {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .detail-popup.active { display: flex; }
        .detail-popup-box {
            background: #EBE0D6;
            padding: 24px 20px;
            border: 1px solid #b59197;
            width: 100%;
            max-width: 460px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }
        .detail-popup-close {
            float: right;
            background: none;
            border: none;
            font-size: 1.3rem;
            color: #7a6668;
            cursor: pointer;
            padding: 0 4px;
            line-height: 1;
        }
        .detail-popup-close:hover { color: #4a3a3c; }
        .detail-popup-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: #4a3a3c;
            margin-bottom: 10px;
            padding-right: 24px;
        }
        .detail-popup-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }
        .detail-popup-details {
            color: #5a4a4c;
            font-size: 0.88rem;
            line-height: 1.6;
            margin-bottom: 14px;
        }
        .detail-popup-image {
            width: 100%;
            border: 1px solid #d4b5b8;
            margin-bottom: 14px;
            cursor: pointer;
        }
        .detail-popup-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .detail-popup-actions .icon-btn {
            flex: 1;
            min-width: 80px;
            text-align: center;
        }

        .image-upload-preview {
            max-width: 200px;
            margin-top: 10px;
            border: 1px solid #d4b5b8;
        }

        .image-upload-label {
            display: inline-block;
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            margin-top: 6px;
        }

        .image-upload-label:hover {
            background: #b59197;
            color: #4a3a3c;
            border-color: #b59197;
        }

        .image-upload-input {
            display: none;
        }

        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .lightbox.show {
            display: flex;
        }

        .lightbox-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #4a3a3c;
            font-size: 2rem;
            cursor: pointer;
            background: none;
            border: none;
            padding: 10px;
        }

        .dream-item-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .dream-tag {
            background: #E0D5CB;
            color: #b59197;
            padding: 4px 10px;
            font-size: 0.7rem;
            border: 1px solid #d4b5b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .dream-tag.priority-high {
            background: #4a2a2a;
            color: #ff9999;
            border-color: #ff9999;
        }

        .dream-tag.priority-soon {
            background: #3a3a2a;
            color: #ffcc99;
            border-color: #ffcc99;
        }

        .dream-tag.priority-friends {
            background: #2a3a3a;
            color: #99ccff;
            border-color: #99ccff;
        }

        .dream-tag.occasion-date-night {
            background: #3a2a3a;
            color: #ffb3d9;
            border-color: #ffb3d9;
        }

        .dream-tag.occasion-friends {
            background: #2a3a3a;
            color: #99ccff;
            border-color: #99ccff;
        }

        .dream-tag.occasion-special {
            background: #3a3a2a;
            color: #ffd699;
            border-color: #ffd699;
        }

        .dream-item-actions {
            display: flex;
            gap: 6px;
            flex-direction: column;
        }

        .icon-btn {
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s ease;
            font-family: inherit;
            min-width: 60px;
            position: relative;
        }

        .icon-btn.saving {
            pointer-events: none;
            color: transparent;
            border-color: #7ba886;
        }

        .icon-btn.saving::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            margin: -6px 0 0 -6px;
            border: 2px solid rgba(123, 168, 134, 0.3);
            border-top-color: #7ba886;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        .icon-btn:hover {
            background: #7ba886;
            color: #4a3a3c;
            border-color: #7ba886;
        }

        .icon-btn.achieved {
            border-color: #7ba886;
            color: #7ba886;
        }

        .icon-btn.achieved:hover {
            background: #7ba886;
            color: #4a3a3c;
        }

        /* Tried It Modal */
        .tried-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .tried-modal.active { display: flex; }
        .tried-modal-box {
            background: #EBE0D6;
            padding: 28px 24px;
            border: 1px solid #b59197;
            width: 100%;
            max-width: 380px;
            text-align: center;
        }
        .tried-modal-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4a3a3c;
            margin-bottom: 6px;
        }
        .tried-modal-name {
            font-size: 0.95rem;
            color: #7ba886;
            margin-bottom: 20px;
            font-style: italic;
        }
        .tried-modal-buttons {
            display: flex;
            gap: 10px;
        }
        .tried-modal-buttons button {
            flex: 1;
            padding: 10px 12px;
            font-size: 0.85rem;
            font-family: inherit;
            font-weight: 500;
            cursor: pointer;
            border: 1px solid;
            background: transparent;
            transition: all 0.2s;
        }
        .tried-btn-again {
            border-color: #7ba886 !important;
            color: #7ba886;
        }
        .tried-btn-again:hover { background: #7ba886; color: #fff; }
        .tried-btn-pass {
            border-color: #b59197 !important;
            color: #b59197;
        }
        .tried-btn-pass:hover { background: #b59197; color: #fff; }
        .tried-btn-cancel {
            border-color: #999 !important;
            color: #999;
        }
        .tried-btn-cancel:hover { background: #999; color: #fff; }

        /* Section divider */
        .section-divider {
            border: none;
            height: 3px;
            background: linear-gradient(to right, transparent, #b59197, #7ba886, transparent);
            margin: 36px 0 28px;
        }

        /* "Our favorites" sub-sections get a distinct look */
        .our-favorites-block {
            background: rgba(123, 168, 134, 0.08);
            border: 1px solid rgba(123, 168, 134, 0.25);
            border-radius: 8px;
            padding: 20px;
            margin-top: 8px;
        }
        .our-favorites-block .section-title {
            color: #7ba886;
        }
        .our-favorites-block .add-dream-btn {
            border-color: #7ba886;
            color: #7ba886;
        }

        .add-dream-btn {
            width: auto;
            display: inline-block;
            background: transparent;
            border: 1px solid #d4b5b8;
            color: #7a6668;
            padding: 8px 18px;
            cursor: pointer;
            font-size: 0.82rem;
            transition: all 0.2s ease;
            font-family: inherit;
            margin-top: 6px;
        }

        .add-dream-btn:hover {
            background: #b59197;
            color: #4a3a3c;
            border-color: #b59197;
        }

        .dream-form {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .dream-form.active {
            display: flex;
        }

        .dream-form form {
            background: #EBE0D6;
            padding: 28px 24px;
            border: 1px solid #b59197;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            color: #7a6668;
            font-size: 0.8rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            background: #EBE0D6;
            border: 1px solid #d4b5b8;
            color: #4a3a3c;
            padding: 9px 10px;
            font-size: 0.88rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        .form-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #7ba886;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.82rem;
            text-transform: none;
            color: #4a3a3c;
            padding: 6px 8px;
            background: #EBE0D6;
            border: 1px solid #d4b5b8;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: #252525;
            border-color: #7ba886;
        }

        .checkbox-label input[type="checkbox"]:checked + span {
            color: #7ba886;
            font-weight: 600;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-actions .save-btn {
            border: 1px solid #b59197;
            color: #b59197;
            background: transparent;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            font-family: inherit;
            position: relative;
            min-width: 70px;
        }

        .form-actions .save-btn:hover {
            background: #b59197;
            color: #4a3a3c;
        }

        .form-actions .save-btn.saving {
            pointer-events: none;
            color: transparent;
            border-color: #7ba886;
            background: rgba(123, 168, 134, 0.1);
        }

        .form-actions .save-btn.saving::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid rgba(123, 168, 134, 0.3);
            border-top-color: #7ba886;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .save-success {
            text-align: center;
            color: #7ba886;
            font-size: 0.85rem;
            padding: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-style: italic;
        }

        .save-success.visible {
            opacity: 1;
        }

        .empty-state {
            text-align: center;
            color: #5a4a4c;
            padding: 40px 20px;
            font-style: italic;
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #EBE0D6;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            text-align: center;
            display: none;
            z-index: 1000;
            border: 2px solid #b59197;
            max-width: 90%;
        }

        .random-choice {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #EBE0D6;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            text-align: center;
            display: none;
            z-index: 1000;
            border: 2px solid #7ba886;
            max-width: 90%;
            min-width: 300px;
        }

        .random-choice.show {
            display: block;
        }

        .random-choice h2 {
            background: linear-gradient(135deg, #7ba886 0%, #b59197 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .random-choice-title {
            color: #4a3a3c;
            font-size: 1.8rem;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .random-choice-details {
            color: #7a6668;
            margin-bottom: 24px;
            line-height: 1.6;
            font-size: 1rem;
        }

        .random-choice-image {
            max-width: 100%;
            max-height: 300px;
            margin-bottom: 20px;
            border: 1px solid #d4b5b8;
        }

        .random-choice-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .celebration.show {
            display: block;
        }

        .celebration h2 {
            background: linear-gradient(135deg, #b59197 0%, #7ba886 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.1em;
        }

        .celebration p {
            color: #7a6668;
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .detail-popup-actions {
                flex-direction: row;
            }
            .detail-popup-actions .icon-btn {
                font-size: 0.72rem;
                padding: 8px 6px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 80px 12px 12px 12px;
            }

            .page-title {
                font-size: 2rem;
            }

            .dream-form {
                padding: 12px;
            }

            .dream-form form {
                padding: 20px 16px;
                max-height: 85vh;
            }

            .checkbox-grid {
                gap: 6px;
            }

            .checkbox-label {
                padding: 5px 6px;
                font-size: 0.78rem;
            }
        }

        /* ===== NAV BAR ===== */
        .top-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: #2a1f21;
            border-bottom: 1px solid rgba(163, 184, 153, 0.2);
            z-index: 9999;
            padding: 0 24px;
            font-family: 'Philosopher', Georgia, serif;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 56px;
        }
        .nav-logo {
            font-size: 1.1rem;
            font-weight: 700;
            color: #a3b899;
            text-decoration: none;
            white-space: nowrap;
        }
        .nav-links { display: flex; gap: 28px; align-items: center; }
        .nav-link {
            color: rgba(242, 235, 224, 0.6);
            text-decoration: none;
            font-size: 0.88rem;
            font-weight: 500;
            white-space: nowrap;
            transition: color 0.2s;
        }
        .nav-link:hover { color: #f2ebe0; }
        .nav-link.active { color: #a3b899; }
        .nav-refresh {
        display: block;
        background: none;
        border: none;
        color: #b59197;
        font-size: 1.4rem;
        cursor: pointer;
        padding: 2px 0;
        z-index: 10001;
        line-height: 1;
    }
    .nav-refresh:active {
        transform: rotate(180deg);
        transition: transform 0.3s;
    }
    .nav-hamburger {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            z-index: 10001;
        }
        .nav-hamburger span {
            display: block; width: 24px; height: 2px;
            background: #a3b899; margin: 5px 0;
            transition: all 0.3s ease;
        }
        .nav-hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
        .nav-hamburger.open span:nth-child(2) { opacity: 0; }
        .nav-hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }
        .nav-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #2a1f21;
            z-index: 10000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0;
        }
        .nav-overlay.open { display: flex; }
        .nav-link-mobile {
            color: rgba(242, 235, 224, 0.7);
            text-decoration: none;
            font-size: 1.05rem;
            font-family: 'Philosopher', Georgia, serif;
            font-weight: 500;
            padding: 12px 40px;
            transition: color 0.2s;
            display: block;
            width: 100%;
            text-align: center;
        }
        .nav-link-mobile:hover { color: #f2ebe0; }
        .nav-link-mobile.active { color: #a3b899; }
        @media (max-width: 768px) {
            .nav-hamburger { display: block; }
            .nav-links { display: none; }
        }
        /* ===== MOBILE OPTIMIZATION ===== */
        /* Prevent iOS auto-zoom on input focus */
        @media screen and (max-width: 768px) {
            input, textarea, select {
                font-size: 16px !important;
            }
        }
        /* ===== END MOBILE OPTIMIZATION ===== */

        /* ===== LANDING HOME VIEW ===== */
        .landing-tiles {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        .landing-tile {
            background: transparent;
            border: 1px solid #b59197;
            color: #7ba886;
            padding: 12px 6px;
            font-family: inherit;
            font-size: 0.8rem;
            font-weight: 600;
            letter-spacing: 0.03em;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .tile-icon {
            width: 22px;
            height: 22px;
            color: #b59197;
            flex-shrink: 0;
        }
        .landing-tile:hover {
            background: #e8d5d8;
            border-color: #b59197;
        }
        .landing-section-title {
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            color: #7ba886;
            margin-bottom: 10px;
        }
        .landing-prompt-question {
            font-style: italic;
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 16px;
            color: inherit;
        }
        .landing-prompt-answers {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        .landing-prompt-person {
            padding-bottom: 10px;
        }
        .landing-prompt-name {
            font-weight: 600;
            font-size: 0.85rem;
            color: #b59197;
            margin-bottom: 6px;
        }
        .landing-prompt-textarea {
            width: 100%;
            padding: 8px 10px;
            font-family: inherit;
            font-size: 0.85rem;
            border: 1px solid rgba(123, 168, 134, 0.25);
            background: transparent;
            color: inherit;
            resize: vertical;
            min-height: 40px;
        }
        .landing-prompt-textarea:focus { outline: none; border-color: #7ba886; }
        .landing-prompt-save {
            margin-top: 6px;
            padding: 5px 14px;
            font-family: inherit;
            font-size: 0.78rem;
            background: transparent;
            border: 1px solid #7ba886;
            color: #7ba886;
            cursor: pointer;
        }
        .landing-prompt-save:hover { background: #7ba886; color: #fff; }
        .landing-prompt-display {
            font-size: 0.88rem;
            line-height: 1.5;
            padding: 8px 10px;
            border: 1px solid rgba(123, 168, 134, 0.1);
            color: inherit;
            cursor: pointer;
            min-height: 36px;
        }
        .landing-prompt-display:hover { border-color: rgba(123, 168, 134, 0.3); }
        .landing-prompt-hint {
            font-size: 0.7rem;
            color: #7a6668;
            font-style: italic;
            margin-top: 2px;
        }
        .landing-challenge-month {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #7a6668;
            margin-bottom: 6px;
        }
        .landing-challenge-text {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 14px;
            color: inherit;
        }
        .landing-challenge-status {
            margin-bottom: 12px;
        }
        .landing-challenge-check {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            color: inherit;
        }
        .landing-challenge-check input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #7ba886;
        }
        .landing-challenge-notes-toggle {
            font-size: 0.8rem;
            color: #7a6668;
            cursor: pointer;
            user-select: none;
            padding: 4px 0;
        }
        .landing-challenge-notes-toggle:hover { color: #7ba886; }
        .landing-past-toggle {
            font-size: 0.8rem;
            color: #7a6668;
            cursor: pointer;
            user-select: none;
            padding: 12px 0 4px;
            margin-top: 8px;
            border-top: 1px solid rgba(123, 168, 134, 0.1);
        }
        .landing-past-toggle:hover { color: #7ba886; }
        .landing-past-list {
            margin-top: 10px;
        }
        .landing-past-entry {
            padding: 10px 0;
            border-bottom: 1px solid rgba(123, 168, 134, 0.08);
        }
        .landing-past-entry:last-child { border-bottom: none; }
        .landing-past-week {
            font-size: 0.7rem;
            color: #7a6668;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            margin-bottom: 4px;
        }
        .landing-past-question {
            font-size: 0.85rem;
            font-style: italic;
            color: inherit;
            margin-bottom: 6px;
        }
        .landing-past-answer {
            font-size: 0.82rem;
            color: inherit;
            padding-left: 10px;
            border-left: 2px solid rgba(123, 168, 134, 0.2);
            margin-bottom: 4px;
        }
        .landing-past-answer-name {
            font-size: 0.72rem;
            font-weight: 600;
            color: #b59197;
            margin-bottom: 1px;
        }
        .landing-past-empty {
            font-size: 0.82rem;
            color: #7a6668;
            font-style: italic;
            padding: 6px 0;
        }
        .landing-challenge-notes-body {
            margin-top: 8px;
        }
        .landing-challenge-notes-text {
            font-size: 0.88rem;
            line-height: 1.5;
            color: inherit;
            padding: 6px 0;
        }
        /* ===== END LANDING HOME VIEW ===== */

        /* ===== WELLNESS TRACKER ===== */
        .wellness-subsection {
            margin-bottom: 28px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(123, 168, 134, 0.15);
        }
        .wellness-subsection:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .wellness-subsection.no-border { border-bottom: none; padding-bottom: 8px; }
        .wellness-subtitle {
            color: inherit;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 12px;
            letter-spacing: 0.02em;
        }
        .wellness-add-row {
            display: flex;
            gap: 8px;
            margin-bottom: 14px;
            flex-wrap: wrap;
            align-items: center;
        }
        .wellness-input {
            padding: 8px 6px;
            font-size: 0.72rem;
            font-family: inherit;
            color: inherit;
        }
        .wellness-input-wide { flex: 2; min-width: 140px; }
        .wellness-input:focus { outline: none; }
        .wellness-add-btn {
            padding: 8px 14px !important;
            font-size: 0.8rem !important;
            white-space: nowrap;
            width: auto !important;
        }
        /* Non-measure rows: stack inputs, button stays compact at end */
        .wellness-add-row:not(.wellness-measure-row) .wellness-input {
            flex: 1 1 120px;
            min-width: 120px;
        }
        /* Measurement rows: all inputs on one line, tiny and equal */
        .wellness-measure-row {
            flex-wrap: wrap;
        }
        .wellness-measure-row .wellness-input {
            flex: 1 1 0;
            min-width: 60px;
        }
        input.wellness-input, select.wellness-input {
            font-size: 0.75rem !important;
        }
        .wellness-table-wrap {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .wellness-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .wellness-table th {
            color: #7ba886;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 6px 10px;
            text-align: left;
            border-bottom: 1px solid rgba(123, 168, 134, 0.25);
            white-space: nowrap;
        }
        .wellness-table td {
            color: inherit;
            padding: 8px 10px;
            border-bottom: 1px solid rgba(123, 168, 134, 0.08);
            white-space: nowrap;
        }
        .wellness-table tr:hover td {
            background: rgba(123, 168, 134, 0.06);
        }
        .wellness-delete-btn {
            background: none;
            border: none;
            color: #b59197;
            cursor: pointer;
            font-size: 1rem;
            padding: 2px 6px;
            line-height: 1;
            opacity: 0.5;
        }
        .wellness-delete-btn:hover { opacity: 1; }
        .wellness-change-pos { color: #7ba886; font-size: 0.8rem; }
        .wellness-change-neg { color: #b59197; font-size: 0.8rem; }
        .wellness-change-zero { color: #7a6668; font-size: 0.8rem; }
        .wellness-empty { color: #7a6668; font-style: italic; padding: 12px 0; font-size: 0.85rem; }
        .wellness-history-divider {
            border: none;
            border-top: 1px solid rgba(123, 168, 134, 0.3);
            margin: 0 0 28px;
            text-align: center;
        }
        .wellness-history-divider::after {
            content: 'History';
            display: inline-block;
            position: relative;
            top: 0.6em;
            padding: 0 14px;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: #7a6668;
            font-weight: 600;
        }
        @media (max-width: 480px) {
            .wellness-table { font-size: 0.78rem; }
            .wellness-table th, .wellness-table td { padding: 6px 6px; }
        }
        /* ===== END WELLNESS TRACKER ===== */
    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">Our Life Hub</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="kasey-hub.html" class="nav-link">Kasey</a>
                <a href="charlie-hub.html" class="nav-link">Charlie</a>
                <a href="our-dreams.html" class="nav-link active">Us ♡</a>
                <a href="meal-plan.html" class="nav-link">Meals</a>
                <a href="settings.html" class="nav-link">Settings</a>
            </div>
            <div style="display:flex;align-items:center;gap:2px;"><button class="nav-refresh" onclick="location.reload(true)" aria-label="Refresh" title="Refresh page">↻</button>
            <button class="nav-hamburger" id="navHamburger" onclick="toggleNav()" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button></div>
        </div>
    </nav>
    <div class="nav-overlay" id="navOverlay" onclick="toggleNav()">
        <a href="index.html" class="nav-link-mobile">Home</a>
        <a href="kasey-hub.html" class="nav-link-mobile">Kasey</a>
        <a href="charlie-hub.html" class="nav-link-mobile">Charlie</a>
        <a href="our-dreams.html" class="nav-link-mobile active">Us ♡</a>
        <a href="meal-plan.html" class="nav-link-mobile">Meals</a>
        <a href="settings.html" class="nav-link-mobile">Settings</a>
    </div>
    
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Our Life Together ♡</h1>
            <p class="page-subtitle">Dreams, goals, ideas & all the things we want to do</p>
        </div>

        <!-- DROPDOWN NAV (hidden on home, shown on section pages) -->
        <div class="section-nav-dropdown" id="sectionNavDropdown" style="display:none;">
            <select id="sectionSelect" onchange="switchToSection(this.value)">
                <option value="landing">← Home</option>
                <option value="restaurants">Restaurants</option>
                <option value="places">Places to Go</option>
                <option value="wishlists">Wishlists</option>
                <option value="travel">Travel</option>
                <option value="shows-movies">TV Shows & Movies</option>
                <option value="bucket">Bucket List</option>
                <option value="home">Dream Home</option>
                <option value="pets">Future Pets</option>
                <option value="wellness">Wellness</option>
            </select>
        </div>

        <!-- ═══ LANDING HOME VIEW ═══ -->
        <div id="landing-tab" class="dreams-tab active">

            <!-- Section Tiles -->
            <div class="landing-tiles">
                <button class="landing-tile" onclick="switchToSection('restaurants')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="2" x2="8" y2="22"/><path d="M5 2v5c0 1.7 1.3 3 3 3s3-1.3 3-3V2"/><line x1="16" y1="2" x2="16" y2="8"/><path d="M16 8c0 0 2.5-.5 2.5-3S16 2 16 2"/><line x1="16" y1="8" x2="16" y2="22"/></svg>Restaurants</button>
                <button class="landing-tile" onclick="switchToSection('places')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/><circle cx="12" cy="9" r="2.5"/></svg>Places to Go</button>
                <button class="landing-tile" onclick="switchToSection('wishlists')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="10" width="18" height="11" rx="1"/><rect x="2" y="7" width="20" height="3" rx="1"/><line x1="12" y1="7" x2="12" y2="21"/><path d="M12 7c0 0-1-2-3.5-2C6.5 5 5.5 6 5.5 7"/><path d="M12 7c0 0 1-2 3.5-2 2 0 3 1 3 2"/></svg>Wishlists</button>
                <button class="landing-tile" onclick="switchToSection('travel')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16v-2l-8-5V3.5a1.5 1.5 0 0 0-3 0V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>Travel</button>
                <button class="landing-tile" onclick="switchToSection('shows-movies')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2"/><polygon points="10,7 10,14 16,10.5"/><line x1="7" y1="21" x2="17" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>TV & Movies</button>
                <button class="landing-tile" onclick="switchToSection('bucket')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.9 5.8 6.5.9-4.7 4.6 1.1 6.5L12 17l-5.8 2.8 1.1-6.5L2.6 8.7l6.5-.9z"/></svg>Bucket List</button>
                <button class="landing-tile" onclick="switchToSection('home')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 10.5L12 3l9 7.5"/><path d="M5 10v9a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-9"/><path d="M10 20v-6h4v6"/></svg>Dream Home</button>
                <button class="landing-tile" onclick="switchToSection('pets')"><svg class="tile-icon" viewBox="0 0 24 24" fill="currentColor" stroke="none"><ellipse cx="6.5" cy="9.5" rx="2.2" ry="3" transform="rotate(-15 6.5 9.5)"/><ellipse cx="11" cy="7" rx="2" ry="3" transform="rotate(-5 11 7)"/><ellipse cx="15.5" cy="7.5" rx="2" ry="2.8" transform="rotate(10 15.5 7.5)"/><ellipse cx="19" cy="11" rx="2" ry="2.7" transform="rotate(25 19 11)"/><path d="M7 16.5c0-3 2-5.5 5.5-5.5s5.5 2.5 5.5 5.5c0 3-2.5 4.5-5.5 4.5S7 19.5 7 16.5z"/></svg>Future Pets</button>
                <button class="landing-tile" onclick="switchToSection('wellness')"><svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/><path d="M8 11h3M9.5 9.5v3M14 11h2"/></svg>Wellness</button>
            </div>

            <!-- Weekly Relationship Prompt -->
            <div class="section" style="margin-top: 24px;">
                <div class="landing-section-title">Weekly Prompt</div>
                <p class="landing-prompt-question" id="weeklyPromptQuestion"></p>
                <div class="landing-prompt-answers">
                    <div class="landing-prompt-person">
                        <div class="landing-prompt-name" data-lh-name="person1">Kasey</div>
                        <div id="prompt1Display" class="landing-prompt-display" style="display:none;" onclick="editPromptAnswer('person1')"></div>
                        <div id="prompt1Hint" class="landing-prompt-hint" style="display:none;">tap to edit</div>
                        <div id="prompt1Input" class="landing-prompt-input-wrap">
                            <textarea id="prompt1Textarea" class="landing-prompt-textarea" placeholder="Your answer..." rows="2"></textarea>
                            <button class="landing-prompt-save" onclick="savePromptAnswer('person1')">Save</button>
                        </div>
                    </div>
                    <div class="landing-prompt-person">
                        <div class="landing-prompt-name" data-lh-name="person2">Charlie</div>
                        <div id="prompt2Display" class="landing-prompt-display" style="display:none;" onclick="editPromptAnswer('person2')"></div>
                        <div id="prompt2Hint" class="landing-prompt-hint" style="display:none;">tap to edit</div>
                        <div id="prompt2Input" class="landing-prompt-input-wrap">
                            <textarea id="prompt2Textarea" class="landing-prompt-textarea" placeholder="Your answer..." rows="2"></textarea>
                            <button class="landing-prompt-save" onclick="savePromptAnswer('person2')">Save</button>
                        </div>
                    </div>
                </div>

                <!-- Past Prompts -->
                <div class="landing-past-toggle" onclick="togglePastPrompts()">
                    Past Prompts <span id="pastPromptsIcon" style="font-size:0.7rem;">▶</span>
                </div>
                <div id="pastPromptsContent" style="display:none;">
                    <div id="pastPromptsList" class="landing-past-list"></div>
                </div>
            </div>

            <!-- Monthly Couples Challenge -->
            <div class="section" style="margin-top: 16px;">
                <div style="display:flex; align-items:baseline; gap:10px;">
                    <div class="landing-section-title" style="margin-bottom:0;">Monthly Challenge</div>
                    <div class="landing-challenge-month" id="challengeMonthLabel" style="margin-bottom:0;"></div>
                </div>
                <p class="landing-challenge-text" id="challengeText" style="margin-top:10px;"></p>
                <div class="landing-challenge-status" style="display:flex; align-items:center; justify-content:space-between;">
                    <label class="landing-challenge-check">
                        <input type="checkbox" id="challengeComplete" onchange="toggleChallengeComplete()">
                        <span id="challengeStatusLabel">Not completed</span>
                    </label>
                    <div class="landing-challenge-notes-toggle" onclick="toggleChallengeNotes()">
                        Notes <span id="challengeNotesToggleIcon" style="font-size:0.7rem;">▶</span>
                    </div>
                </div>
                <div class="landing-challenge-notes">
                    <div id="challengeNotesContent" class="landing-challenge-notes-body" style="display:none;">
                        <div id="challengeNotesDisplayWrap" style="display:none;" onclick="editChallengeNotes()">
                            <p id="challengeNotesDisplay" class="landing-challenge-notes-text"></p>
                            <span style="font-size:0.7rem; color:#7a6668; font-style:italic;">tap to edit</span>
                        </div>
                        <div id="challengeNotesEditWrap">
                            <textarea id="challengeNotesInput" class="landing-prompt-textarea" placeholder="How's it going? Any notes..." rows="3"></textarea>
                            <button class="landing-prompt-save" onclick="saveChallengeNotes()">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESTAURANTS TAB -->
        <div id="restaurants-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Restaurants We Want to Try</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('restaurants')">+ Add Restaurant</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('restaurants')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>
                
                <div class="dream-form" id="restaurants-form">
                    <form data-category="restaurants">
                        <div class="form-group">
                            <label>Restaurant Name</label>
                            <input type="text" name="title" required placeholder="Name of the place">
                        </div>
                        <div class="form-group">
                            <label>Type (Select all that apply)</label>
                            <div class="checkbox-grid">
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="breakfast">
                                    <span>Breakfast</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="brunch">
                                    <span>Brunch</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="lunch">
                                    <span>Lunch</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="dinner">
                                    <span>Dinner</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="cafe">
                                    <span>Cafe</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="bar">
                                    <span>Bar</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="bakery">
                                    <span>Bakery</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" name="restaurantType" value="dessert">
                                    <span>Dessert</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Location & Details</label>
                            <textarea name="details" placeholder="Where is it? What kind of food? What do you want to try?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="restaurants-image" accept="image/*" onchange="previewImage(event, 'restaurants')">
                            <label for="restaurants-image" class="image-upload-label">Choose Image</label>
                            <div id="restaurants-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Occasion</label>
                            <select name="occasion">
                                <option value="">Casual</option>
                                <option value="date-night">Date Night</option>
                                <option value="friends">Go with Friends</option>
                                <option value="special">Special Occasion</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Try</option>
                                <option value="soon">I'd Love to Try</option>
                                <option value="high">We Have to Go!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('restaurants')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="restaurants-list">
                    <div class="empty-state">No restaurants yet. Where should you go for date night?</div>
                </div>

                <hr class="section-divider">

                <div class="our-favorites-block">
                <!-- OUR RESTAURANTS -->
                <h2 class="section-title">Our Restaurants</h2>
                <p style="font-size: 0.8rem; color: rgba(123,168,134,0.7); margin-bottom: 12px;">Places we love and would go back to</p>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('our-restaurants')">+ Add a Favorite</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('our-restaurants')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>

                <div class="dream-form" id="our-restaurants-form">
                    <form data-category="our-restaurants">
                        <div class="form-group">
                            <label>Restaurant Name</label>
                            <input type="text" name="title" required placeholder="Name of the place">
                        </div>
                        <div class="form-group">
                            <label>Type (Select all that apply)</label>
                            <div class="checkbox-grid">
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="breakfast"><span>Breakfast</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="brunch"><span>Brunch</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="lunch"><span>Lunch</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="dinner"><span>Dinner</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="cafe"><span>Cafe</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="bar"><span>Bar</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="bakery"><span>Bakery</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="restaurantType" value="dessert"><span>Dessert</span></label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Location & Details</label>
                            <textarea name="details" placeholder="Where is it? What do we love about it?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="our-restaurants-image" accept="image/*" onchange="previewImage(event, 'our-restaurants')">
                            <label for="our-restaurants-image" class="image-upload-label">Choose Image</label>
                            <div id="our-restaurants-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Occasion</label>
                            <select name="occasion">
                                <option value="">Casual</option>
                                <option value="date-night">Date Night</option>
                                <option value="friends">Go with Friends</option>
                                <option value="special">Special Occasion</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('our-restaurants')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="our-restaurants-list">
                    <div class="empty-state">No favorites yet!</div>
                </div>
                </div><!-- end our-favorites-block -->
            </div>
        </div>

        <!-- PLACES TAB -->
        <div id="places-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Places We Want to Go</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('places')">+ Add Place</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('places')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>
                
                <div class="dream-form" id="places-form">
                    <form data-category="places">
                        <div class="form-group">
                            <label>Place Name</label>
                            <input type="text" name="title" required placeholder="Where do you want to go?">
                        </div>
                        <div class="form-group">
                            <label>Type (Select all that apply)</label>
                            <div class="checkbox-grid">
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="museum"><span>Museum</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="park"><span>Park</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="thrift-shop"><span>Thrift Shop</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="metaphysical-shop"><span>Metaphysical Shop</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="bookstore"><span>Bookstore</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="concert"><span>Concert</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="festival"><span>Festival</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="market"><span>Market</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="nature"><span>Nature Spot</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="entertainment"><span>Entertainment</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="historic"><span>Historic Site</span></label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="What is it? What do you want to do there?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="places-image" accept="image/*" onchange="previewImage(event, 'places')">
                            <label for="places-image" class="image-upload-label">Choose Image</label>
                            <div id="places-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Go</option>
                                <option value="soon">I'd Love to Go</option>
                                <option value="high">We Have to Go!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('places')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="places-list">
                    <div class="empty-state">No places yet. Where do you want to go?</div>
                </div>

                <hr class="section-divider">

                <div class="our-favorites-block">
                <h2 class="section-title">Our Places</h2>
                <p style="font-size: 0.8rem; color: rgba(123,168,134,0.7); margin-bottom: 12px;">Spots we love and would go back to</p>

                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('our-places')">+ Add a Favorite</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('our-places')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>

                <div class="dream-form" id="our-places-form">
                    <form data-category="our-places">
                        <div class="form-group">
                            <label>Place Name</label>
                            <input type="text" name="title" required placeholder="Name of the place">
                        </div>
                        <div class="form-group">
                            <label>Type (Select all that apply)</label>
                            <div class="checkbox-grid">
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="museum"><span>Museum</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="park"><span>Park</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="thrift-shop"><span>Thrift Shop</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="metaphysical-shop"><span>Metaphysical Shop</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="bookstore"><span>Bookstore</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="concert"><span>Concert</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="festival"><span>Festival</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="market"><span>Market</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="nature"><span>Nature Spot</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="entertainment"><span>Entertainment</span></label>
                                <label class="checkbox-label"><input type="checkbox" name="placeType" value="historic"><span>Historic Site</span></label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="What do we love about this place?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="our-places-image" accept="image/*" onchange="previewImage(event, 'our-places')">
                            <label for="our-places-image" class="image-upload-label">Choose Image</label>
                            <div id="our-places-preview"></div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('our-places')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="our-places-list">
                    <div class="empty-state">No favorites yet!</div>
                </div>
                </div><!-- end our-favorites-block -->
            </div>
        </div>

        <!-- WISHLISTS TAB -->
        <div id="wishlists-tab" class="dreams-tab">
            <div class="section" style="margin-bottom: 24px;">
                <h2 class="section-title">Kasey's Wishlist</h2>
                
                <button class="add-dream-btn" onclick="showForm('kasey-wishlist')">+ Add to Kasey's List</button>
                
                <div class="dream-form" id="kasey-wishlist-form">
                    <form data-category="kasey-wishlist">
                        <div class="form-group">
                            <label>Item or Experience</label>
                            <input type="text" name="title" required placeholder="What does Kasey want?">
                        </div>
                        <div class="form-group">
                            <label>Details / Link</label>
                            <textarea name="details" placeholder="Where to find it, price, why you want it..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="kasey-wishlist-image" accept="image/*" onchange="previewImage(event, 'kasey-wishlist')">
                            <label for="kasey-wishlist-image" class="image-upload-label">Choose Image</label>
                            <div id="kasey-wishlist-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">Nice to Have</option>
                                <option value="soon">Really Want</option>
                                <option value="high">Top of List</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('kasey-wishlist')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="kasey-wishlist-list">
                    <div class="empty-state">Kasey's wishlist is empty</div>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">Charlie's Wishlist</h2>
                
                <button class="add-dream-btn" onclick="showForm('charlie-wishlist')">+ Add to Charlie's List</button>
                
                <div class="dream-form" id="charlie-wishlist-form">
                    <form data-category="charlie-wishlist">
                        <div class="form-group">
                            <label>Item or Experience</label>
                            <input type="text" name="title" required placeholder="What does Charlie want?">
                        </div>
                        <div class="form-group">
                            <label>Details / Link</label>
                            <textarea name="details" placeholder="Where to find it, price, why you want it..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="charlie-wishlist-image" accept="image/*" onchange="previewImage(event, 'charlie-wishlist')">
                            <label for="charlie-wishlist-image" class="image-upload-label">Choose Image</label>
                            <div id="charlie-wishlist-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">Nice to Have</option>
                                <option value="soon">Really Want</option>
                                <option value="high">Top of List</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('charlie-wishlist')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="charlie-wishlist-list">
                    <div class="empty-state">Charlie's wishlist is empty</div>
                </div>
            </div>
        </div>

        <!-- TRAVEL TAB -->
        <div id="travel-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Places We Want to Travel</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('travel')">+ Add Travel Dream</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('travel')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>
                
                <div class="dream-form" id="travel-form">
                    <form data-category="travel">
                        <div class="form-group">
                            <label>Destination</label>
                            <input type="text" name="title" required placeholder="Where do you want to go?">
                        </div>
                        <div class="form-group">
                            <label>Why / What to Do There</label>
                            <textarea name="details" placeholder="What draws you to this place?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="travel-image" accept="image/*" onchange="previewImage(event, 'travel')">
                            <label for="travel-image" class="image-upload-label">Choose Image</label>
                            <div id="travel-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Go</option>
                                <option value="soon">I'd Love to Go</option>
                                <option value="high">Top of My List!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('travel')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="travel-list">
                    <div class="empty-state">No travel dreams yet. Where do you want to go?</div>
                </div>

                <hr class="section-divider">

                <div class="our-favorites-block">
                <h2 class="section-title">Where We've Been</h2>
                <p style="font-size: 0.8rem; color: rgba(123,168,134,0.7); margin-bottom: 12px;">Places we loved and would visit again</p>

                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('our-travel')">+ Add a Favorite</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('our-travel')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>

                <div class="dream-form" id="our-travel-form">
                    <form data-category="our-travel">
                        <div class="form-group">
                            <label>Destination</label>
                            <input type="text" name="title" required placeholder="Where did you go?">
                        </div>
                        <div class="form-group">
                            <label>Details & Memories</label>
                            <textarea name="details" placeholder="What did you love about it?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="our-travel-image" accept="image/*" onchange="previewImage(event, 'our-travel')">
                            <label for="our-travel-image" class="image-upload-label">Choose Image</label>
                            <div id="our-travel-preview"></div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('our-travel')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="our-travel-list">
                    <div class="empty-state">No favorite trips yet!</div>
                </div>
                </div><!-- end our-favorites-block -->
            </div>
        </div>

        <!-- TV SHOWS & MOVIES TAB -->
        <div id="shows-movies-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Shows & Movies to Watch</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('shows-movies')">+ Add Show or Movie</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('shows-movies')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>
                
                <div class="dream-form" id="shows-movies-form">
                    <form data-category="shows-movies">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" name="title" required placeholder="Name of the show or movie">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="Where to watch? Genre? Why you want to see it?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="shows-movies-image" accept="image/*" onchange="previewImage(event, 'shows-movies')">
                            <label for="shows-movies-image" class="image-upload-label">Choose Image</label>
                            <div id="shows-movies-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Watch</option>
                                <option value="soon">I'd Love to Watch</option>
                                <option value="high">We Have to Watch!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('shows-movies')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="shows-movies-list">
                    <div class="empty-state">No shows or movies yet. What do you want to watch together?</div>
                </div>

                <hr class="section-divider">

                <div class="our-favorites-block">
                <h2 class="section-title">What We've Watched</h2>
                <p style="font-size: 0.8rem; color: rgba(123,168,134,0.7); margin-bottom: 12px;">Shows & movies we loved</p>

                <div style="display: flex; gap: 10px; margin-bottom: 16px;">
                    <button class="add-dream-btn" onclick="showForm('our-shows-movies')">+ Add a Favorite</button>
                    <button class="add-dream-btn" onclick="chooseRandomDream('our-shows-movies')" style="border: 2px solid #7ba886; color: #7ba886; background: transparent;">Choose for Us</button>
                </div>

                <div class="dream-form" id="our-shows-movies-form">
                    <form data-category="our-shows-movies">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" name="title" required placeholder="Name of the show or movie">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="Where to watch? What did we love about it?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="our-shows-movies-image" accept="image/*" onchange="previewImage(event, 'our-shows-movies')">
                            <label for="our-shows-movies-image" class="image-upload-label">Choose Image</label>
                            <div id="our-shows-movies-preview"></div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('our-shows-movies')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="our-shows-movies-list">
                    <div class="empty-state">No favorites yet!</div>
                </div>
                </div><!-- end our-favorites-block -->
            </div>
        </div>

        <!-- BUCKET LIST TAB -->
        <div id="bucket-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Our Bucket List</h2>
                
                <button class="add-dream-btn" onclick="showForm('bucket')">+ Add to Bucket List</button>
                
                <div class="dream-form" id="bucket-form">
                    <form data-category="bucket">
                        <div class="form-group">
                            <label>Experience or Goal</label>
                            <input type="text" name="title" required placeholder="What do you want to do together?">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="Any specifics or ideas?"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="bucket-image" accept="image/*" onchange="previewImage(event, 'bucket')">
                            <label for="bucket-image" class="image-upload-label">Choose Image</label>
                            <div id="bucket-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Priority</label>
                            <select name="priority">
                                <option value="">I'd Like to Do</option>
                                <option value="soon">I'd Love to Do</option>
                                <option value="high">We Have to Do!</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('bucket')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="bucket-list">
                    <div class="empty-state">Start building your bucket list together!</div>
                </div>
            </div>
        </div>

        <!-- DREAM HOME TAB -->
        <div id="home-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Dream Home Features</h2>
                
                <button class="add-dream-btn" onclick="showForm('home')">+ Add Home Feature</button>
                
                <div class="dream-form" id="home-form">
                    <form data-category="home">
                        <div class="form-group">
                            <label>Feature or Room</label>
                            <input type="text" name="title" required placeholder="What do you want in your dream home?">
                        </div>
                        <div class="form-group">
                            <label>Details / Vision</label>
                            <textarea name="details" placeholder="Describe how you imagine it..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="home-image" accept="image/*" onchange="previewImage(event, 'home')">
                            <label for="home-image" class="image-upload-label">Choose Image</label>
                            <div id="home-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Importance</label>
                            <select name="priority">
                                <option value="">Nice to Have</option>
                                <option value="soon">Really Want</option>
                                <option value="high">Must Have</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('home')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="home-list">
                    <div class="empty-state">What does your dream home look like?</div>
                </div>
            </div>
        </div>

        <!-- PETS TAB -->
        <div id="pets-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Future Pets & Animal Dreams</h2>
                
                <button class="add-dream-btn" onclick="showForm('pets')">+ Add Pet Dream</button>
                
                <div class="dream-form" id="pets-form">
                    <form data-category="pets">
                        <div class="form-group">
                            <label>Pet Type or Name Idea</label>
                            <input type="text" name="title" required placeholder="What kind of pet?">
                        </div>
                        <div class="form-group">
                            <label>Details</label>
                            <textarea name="details" placeholder="Breed, personality, care needs, name ideas..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Add Image (Optional)</label>
                            <input type="file" class="image-upload-input" id="pets-image" accept="image/*" onchange="previewImage(event, 'pets')">
                            <label for="pets-image" class="image-upload-label">Choose Image</label>
                            <div id="pets-preview"></div>
                        </div>
                        <div class="form-group">
                            <label>Timeline</label>
                            <select name="priority">
                                <option value="">Someday</option>
                                <option value="soon">Within a Year</option>
                                <option value="high">Ready Now</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn" onclick="hideForm('pets')">Cancel</button>
                            <button type="button" class="btn save-btn" onclick="addDream(this)">Save</button>
                        </div>
                    </form>
                </div>

                <div class="dream-list" id="pets-list">
                    <div class="empty-state">Dream about your future fur (or scale, or feather) babies!</div>
                </div>
            </div>
        </div>

        <!-- WELLNESS TAB -->
        <div id="wellness-tab" class="dreams-tab">
            <div class="section">
                <h2 class="section-title">Wellness Tracker</h2>

                <!-- ═══ ALL ENTRY FORMS ═══ -->
                <div class="wellness-subsection">
                    <h3 class="wellness-subtitle">Log Injection</h3>
                    <div class="wellness-add-row">
                        <input type="date" id="injectionDate" class="wellness-input">
                        <input type="text" id="injectionDose" class="wellness-input" placeholder="Dose (e.g. 0.25mg)">
                        <input type="text" id="injectionNotes" class="wellness-input wellness-input-wide" placeholder="Notes (optional)">
                        <button class="add-dream-btn wellness-add-btn" onclick="addInjection()">+ Add</button>
                    </div>
                </div>

                <div class="wellness-subsection">
                    <h3 class="wellness-subtitle">Log Weigh-In</h3>
                    <div class="wellness-add-row">
                        <input type="date" id="weightDate" class="wellness-input">
                        <input type="number" id="weightKasey" class="wellness-input" placeholder="Kasey (lbs)" step="0.1" data-lh-name="person1">
                        <input type="number" id="weightCharlie" class="wellness-input" placeholder="Charlie (lbs)" step="0.1" data-lh-name="person2">
                        <button class="add-dream-btn wellness-add-btn" onclick="addWeight()">+ Add</button>
                    </div>
                </div>

                <div class="wellness-subsection">
                    <h3 class="wellness-subtitle"><span data-lh-name="person1">Kasey's</span> Measurements</h3>
                    <div class="wellness-add-row wellness-measure-row">
                        <input type="date" id="measureDate1" class="wellness-input">
                        <input type="number" id="measureBust1" class="wellness-input" placeholder="Bust" step="0.1">
                        <input type="number" id="measureWaist1" class="wellness-input" placeholder="Waist" step="0.1">
                        <input type="number" id="measureHips1" class="wellness-input" placeholder="Hips" step="0.1">
                        <input type="number" id="measureArm1" class="wellness-input" placeholder="Arm" step="0.1">
                        <input type="number" id="measureThigh1" class="wellness-input" placeholder="Thigh" step="0.1">
                        <button class="add-dream-btn wellness-add-btn" onclick="addMeasurement('person1')">+ Add</button>
                    </div>
                </div>

                <div class="wellness-subsection no-border">
                    <h3 class="wellness-subtitle"><span data-lh-name="person2">Charlie's</span> Measurements</h3>
                    <div class="wellness-add-row wellness-measure-row">
                        <input type="date" id="measureDate2" class="wellness-input">
                        <input type="number" id="measureChest2" class="wellness-input" placeholder="Chest" step="0.1">
                        <input type="number" id="measureWaist2" class="wellness-input" placeholder="Waist" step="0.1">
                        <input type="number" id="measureHips2" class="wellness-input" placeholder="Hips" step="0.1">
                        <input type="number" id="measureArm2" class="wellness-input" placeholder="Arm" step="0.1">
                        <input type="number" id="measureThigh2" class="wellness-input" placeholder="Thigh" step="0.1">
                        <button class="add-dream-btn wellness-add-btn" onclick="addMeasurement('person2')">+ Add</button>
                    </div>
                </div>

                <!-- ═══ ALL HISTORY ═══ -->
                <div class="wellness-history-divider"></div>

                <div class="wellness-subsection">
                    <h3 class="wellness-subtitle">Injection History</h3>
                    <div id="injectionList" class="wellness-table-wrap">
                        <table class="wellness-table">
                            <thead><tr><th>Date</th><th>Dose</th><th>Notes</th><th></th></tr></thead>
                            <tbody id="injectionBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="wellness-subsection">
                    <h3 class="wellness-subtitle">Weight History</h3>
                    <div id="weightList" class="wellness-table-wrap">
                        <table class="wellness-table">
                            <thead><tr><th>Date</th><th data-lh-name="person1">Kasey</th><th data-lh-name="person2">Charlie</th><th>Change</th><th></th></tr></thead>
                            <tbody id="weightBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="wellness-subsection">
                    <h3 class="wellness-subtitle"><span data-lh-name="person1">Kasey's</span> Measurement History</h3>
                    <div id="measureList1" class="wellness-table-wrap">
                        <table class="wellness-table wellness-table-wide">
                            <thead><tr><th>Date</th><th>Bust</th><th>Waist</th><th>Hips</th><th>Arm</th><th>Thigh</th><th></th></tr></thead>
                            <tbody id="measureBody1"></tbody>
                        </table>
                    </div>
                </div>

                <div class="wellness-subsection">
                    <h3 class="wellness-subtitle"><span data-lh-name="person2">Charlie's</span> Measurement History</h3>
                    <div id="measureList2" class="wellness-table-wrap">
                        <table class="wellness-table wellness-table-wide">
                            <thead><tr><th>Date</th><th>Chest</th><th>Waist</th><th>Hips</th><th>Arm</th><th>Thigh</th><th></th></tr></thead>
                            <tbody id="measureBody2"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="random-choice" id="randomChoice">
        <h2>WE CHOOSE...</h2>
        <div class="random-choice-title" id="randomChoiceTitle"></div>
        <div class="random-choice-details" id="randomChoiceDetails"></div>
        <img class="random-choice-image" id="randomChoiceImage" src="" alt="" style="display: none;">
        <div class="random-choice-buttons">
            <button class="btn" onclick="closeRandomChoice()">Let's Do It!</button>
            <button class="btn" onclick="pickAnotherRandom()">Pick Another</button>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <h2>DREAM ACHIEVED!</h2>
        <p id="celebrationText">Amazing! You made it happen!</p>
        <button class="btn" onclick="closeCelebration()">Continue Dreaming</button>
    </div>

    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <img class="lightbox-image" id="lightboxImage" src="" alt="">
    </div>

    <!-- Detail Popup -->
    <div class="detail-popup" id="detailPopup" onclick="if(event.target===this)closeDetail()">
        <div class="detail-popup-box">
            <button class="detail-popup-close" onclick="closeDetail()">&times;</button>
            <div class="detail-popup-title" id="detailTitle"></div>
            <div class="detail-popup-meta" id="detailMeta"></div>
            <div class="detail-popup-details" id="detailDetails"></div>
            <img class="detail-popup-image" id="detailImage" src="" alt="" style="display:none;" onclick="openLightbox(this.src)">
            <div class="detail-popup-actions" id="detailActions"></div>
        </div>
    </div>

    <!-- Tried It / Done Modal -->
    <div class="tried-modal" id="triedModal" onclick="if(event.target===this)closeTriedModal()">
        <div class="tried-modal-box">
            <div class="tried-modal-title" id="triedModalTitle">We tried it!</div>
            <div class="tried-modal-name" id="triedModalName"></div>
            <div class="tried-modal-buttons">
                <button class="tried-btn-again" id="triedBtnAgain" onclick="keepItem()">Again</button>
                <button class="tried-btn-pass" onclick="passItem()">Pass</button>
                <button class="tried-btn-cancel" onclick="closeTriedModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="dream-form" id="edit-form">
        <form data-category="edit">
            <h3 style="color: #4a3a3c; margin-bottom: 16px; font-size: 1rem;">Edit Entry</h3>
            <input type="hidden" id="editFirebaseId">
            <input type="hidden" id="editCategory">
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="editTitle" placeholder="Name">
            </div>
            <div class="form-group">
                <label>Details</label>
                <textarea id="editDetails" placeholder="Details"></textarea>
            </div>
            <div class="form-group" id="editTypeGroup" style="display:none;">
                <label>Type</label>
                <div class="checkbox-grid" id="editTypeCheckboxes">
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="breakfast"><span>Breakfast</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="brunch"><span>Brunch</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="lunch"><span>Lunch</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="dinner"><span>Dinner</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="cafe"><span>Cafe</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="bar"><span>Bar</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="bakery"><span>Bakery</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editType" value="dessert"><span>Dessert</span></label>
                </div>
            </div>
            <div class="form-group" id="editPlaceTypeGroup" style="display:none;">
                <label>Type</label>
                <div class="checkbox-grid" id="editPlaceTypeCheckboxes">
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="museum"><span>Museum</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="park"><span>Park</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="thrift-shop"><span>Thrift Shop</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="metaphysical-shop"><span>Metaphysical Shop</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="bookstore"><span>Bookstore</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="concert"><span>Concert</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="festival"><span>Festival</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="market"><span>Market</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="nature"><span>Nature Spot</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="entertainment"><span>Entertainment</span></label>
                    <label class="checkbox-label"><input type="checkbox" name="editPlaceType" value="historic"><span>Historic Site</span></label>
                </div>
            </div>
            <div class="form-group" id="editOccasionGroup" style="display:none;">
                <label>Occasion</label>
                <select id="editOccasion">
                    <option value="">Casual</option>
                    <option value="date-night">Date Night</option>
                    <option value="friends">Go with Friends</option>
                    <option value="special">Special Occasion</option>
                </select>
            </div>
            <div class="form-group" id="editPriorityGroup">
                <label>Priority</label>
                <select id="editPriority">
                    <option value="">Normal</option>
                    <option value="soon">Soon</option>
                    <option value="high">High Priority</option>
                </select>
            </div>
            <div class="form-actions">
                <button type="button" class="btn" onclick="closeEditForm()">Cancel</button>
                <button type="button" class="btn save-btn" onclick="saveEdit()">Save Changes</button>
            </div>
        </form>
    </div>

    <script>
        // Global variables -- available immediately
        var categories = ['restaurants', 'our-restaurants', 'places', 'our-places', 'kasey-wishlist', 'charlie-wishlist', 'travel', 'our-travel', 'bucket', 'home', 'pets', 'shows-movies', 'our-shows-movies'];
        var dreams = {};
        var isConnected = false;
        var currentImageData = {};
        var currentRandomCategory = '';
        var triedItData = { category: '', firebaseId: '' };

        // Initialize dreams object
        categories.forEach(function(cat) { dreams[cat] = []; });

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function saveToLocal(category) {
            try { localStorage.setItem('dreams_' + category, JSON.stringify(dreams[category])); } catch(e) {}
        }

        // Sync category to Firestore (non-blocking, strips large images)
        function syncToFirestore(category) {
            if (window.dreamsDb && window.fsModule) {
                try {
                    var deduped = dedup(dreams[category]);
                    var itemsForSync = deduped.map(function(d) {
                        var copy = Object.assign({}, d);
                        if (copy.image && copy.image.length > 50000) {
                            copy.image = null;
                        }
                        return copy;
                    });
                    var docRef = window.fsModule.doc(window.dreamsDb, 'dreams', category);
                    window.fsModule.setDoc(docRef, { items: itemsForSync }).catch(function(err) {});
                } catch(e) {}
            }
        }

        // Deduplicate items by firebaseId (keep last occurrence)
        function dedup(items) {
            if (!items || !Array.isArray(items)) return [];
            var seen = {};
            var result = [];
            for (var i = items.length - 1; i >= 0; i--) {
                var key = items[i].firebaseId || ('no_id_' + i);
                if (!seen[key]) {
                    seen[key] = true;
                    result.unshift(items[i]);
                }
            }
            return result;
        }

        function loadFromLocal(category) {
            try {
                var data = localStorage.getItem('dreams_' + category);
                return data ? dedup(JSON.parse(data)) : [];
            } catch(e) { return []; }
        }

        // === UI FUNCTIONS (work immediately) ===

        window.previewImage = function(event, category) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    currentImageData[category] = e.target.result;
                    var preview = document.getElementById(category + '-preview');
                    preview.innerHTML = '<img src="' + e.target.result + '" class="image-upload-preview" alt="Preview">';
                };
                reader.readAsDataURL(file);
            }
        };

        window.openLightbox = function(imageSrc) {
            document.getElementById('lightboxImage').src = imageSrc;
            document.getElementById('lightbox').classList.add('show');
        };

        window.closeLightbox = function() {
            document.getElementById('lightbox').classList.remove('show');
        };

        window.switchToSection = function(section) {
            document.querySelectorAll('.dreams-tab').forEach(function(t) { t.classList.remove('active'); });
            var dropdown = document.getElementById('sectionNavDropdown');
            if (section === 'landing') {
                document.getElementById('landing-tab').classList.add('active');
                dropdown.style.display = 'none';
            } else {
                document.getElementById(section + '-tab').classList.add('active');
                dropdown.style.display = '';
                document.getElementById('sectionSelect').value = section;
            }
            window.scrollTo(0, 0);
        };

        window.showForm = function(category) {
            var formEl = document.getElementById(category + '-form');
            formEl.classList.add('active');
            document.body.style.overflow = 'hidden';
            // Close on backdrop click
            formEl._backdropHandler = function(e) {
                if (e.target === formEl) {
                    window.hideForm(category);
                }
            };
            formEl.addEventListener('click', formEl._backdropHandler);
        };

        window.hideForm = function(category) {
            var form = document.getElementById(category + '-form');
            form.classList.remove('active');
            form.querySelector('form').reset();
            var preview = document.getElementById(category + '-preview');
            if (preview) preview.innerHTML = '';
            delete currentImageData[category];
            document.body.style.overflow = '';
            if (form._backdropHandler) {
                form.removeEventListener('click', form._backdropHandler);
                delete form._backdropHandler;
            }
        };

        window.addDream = function(btn) {
            try {
                // Walk up from button to find the form
                var form = btn.closest('form');
                if (!form) { alert('Could not find form'); return; }
                
                var category = form.getAttribute('data-category');
                if (!category) { alert('Could not find category'); return; }

                // Get form values directly from inputs
                var titleInput = form.querySelector('input[name="title"]');
                var title = titleInput ? titleInput.value.trim() : '';
                
                if (!title) {
                    alert('Please enter a name');
                    return;
                }

                var detailsInput = form.querySelector('[name="details"]');
                var priorityInput = form.querySelector('[name="priority"]');
                var occasionInput = form.querySelector('[name="occasion"]');

                var dream = {
                    id: Date.now(),
                    firebaseId: 'item_' + Date.now(),
                    title: title,
                    details: detailsInput ? detailsInput.value.trim() : '',
                    priority: priorityInput ? priorityInput.value : '',
                    achieved: false,
                    dateAdded: new Date().toISOString(),
                    image: currentImageData[category] || null
                };

                if (category === 'restaurants' || category === 'our-restaurants') {
                    dream.occasion = occasionInput ? occasionInput.value : '';
                    var checked = form.querySelectorAll('input[name="restaurantType"]:checked');
                    var types = [];
                    for (var i = 0; i < checked.length; i++) types.push(checked[i].value);
                    if (types.length > 0) dream.restaurantTypes = types;
                }

                if (category === 'places' || category === 'our-places') {
                    var pchecked = form.querySelectorAll('input[name="placeType"]:checked');
                    var ptypes = [];
                    for (var i = 0; i < pchecked.length; i++) ptypes.push(pchecked[i].value);
                    if (ptypes.length > 0) dream.placeTypes = ptypes;
                }

                // Save to array + localStorage
                if (!dreams[category]) dreams[category] = [];
                dreams[category].push(dream);
                saveToLocal(category);
                renderDreams(category);

                // Sync to Firestore in background
                syncToFirestore(category);

                // Expand list so user sees their item
                var listEl = document.getElementById(category + '-list');
                if (listEl) {
                    listEl.classList.add('expanded');
                    localStorage.setItem('dreamListExpanded_' + category, 'true');
                }

                // Reset and close form
                form.reset();
                var preview = document.getElementById(category + '-preview');
                if (preview) preview.innerHTML = '';
                delete currentImageData[category];
                window.hideForm(category);

            } catch(err) {
                alert('Error: ' + err.message);
                try { saveToLocal(category); renderDreams(category); } catch(x) {}
            }
        };

        window.toggleDreamList = function(category) {
            var list = document.getElementById(category + '-list');
            list.classList.toggle('expanded');
            var isExpanded = list.classList.contains('expanded');
            localStorage.setItem('dreamListExpanded_' + category, isExpanded);
        };

        window.toggleAchieved = function(category, firebaseId, newAchievedState, btn) {
            if (btn) btn.classList.add('saving');

            try {
                var dream = dreams[category].find(function(d) { return d.firebaseId === firebaseId; });
                if (dream) {
                    dream.achieved = newAchievedState;
                    saveToLocal(category);
                    renderDreams(category);
                    
                    // Sync to Firestore in background
                    syncToFirestore(category);
                    
                    if (newAchievedState) showCelebration(dream.title);
                }
            } catch(err) {
                try { saveToLocal(category); renderDreams(category); } catch(e) {}
            }

            if (btn) btn.classList.remove('saving');
        };

        window.deleteDream = function(category, firebaseId, btn) {
            // Tap once = "Sure?", tap again = delete
            if (btn && btn.dataset.confirmDelete === 'yes') {
                try {
                    dreams[category] = dreams[category].filter(function(d) { return d.firebaseId !== firebaseId; });
                    saveToLocal(category);
                    renderDreams(category);
                    syncToFirestore(category);
                } catch(err) {
                    try { saveToLocal(category); renderDreams(category); } catch(e) {}
                }
            } else if (btn) {
                btn.dataset.confirmDelete = 'yes';
                btn.textContent = 'Sure?';
                btn.style.color = '#c0392b';
                btn.style.borderColor = '#c0392b';
                // Reset after 3 seconds if not confirmed
                setTimeout(function() {
                    if (btn && btn.parentNode) {
                        btn.dataset.confirmDelete = '';
                        btn.textContent = 'Delete';
                        btn.style.color = '';
                        btn.style.borderColor = '';
                    }
                }, 3000);
            }
        };

        // === TRIED IT / DONE (generic for restaurants, places, travel, shows-movies) ===
        // Maps source category --> destination "our" category
        var triedItMap = {
            'restaurants': { dest: 'our-restaurants', title: 'We tried it!', keep: 'Eat Again' },
            'places': { dest: 'our-places', title: 'We went!', keep: 'Go Again' },
            'travel': { dest: 'our-travel', title: 'We traveled!', keep: 'Visit Again' },
            'shows-movies': { dest: 'our-shows-movies', title: 'We watched it!', keep: 'Watch Again' }
        };

        window.triedIt = function(category, firebaseId) {
            var dream = dreams[category].find(function(d) { return d.firebaseId === firebaseId; });
            if (!dream) return;
            var config = triedItMap[category];
            if (!config) return;
            triedItData.category = category;
            triedItData.firebaseId = firebaseId;
            document.getElementById('triedModalTitle').textContent = config.title;
            document.getElementById('triedModalName').textContent = dream.title;
            document.getElementById('triedBtnAgain').textContent = config.keep;
            document.getElementById('triedModal').classList.add('active');
        };

        window.closeTriedModal = function() {
            document.getElementById('triedModal').classList.remove('active');
            triedItData = { category: '', firebaseId: '' };
        };

        window.keepItem = function() {
            try {
                var srcCat = triedItData.category;
                var config = triedItMap[srcCat];
                if (!config) { closeTriedModal(); return; }
                var destCat = config.dest;

                var dream = dreams[srcCat].find(function(d) { return d.firebaseId === triedItData.firebaseId; });
                if (!dream) { closeTriedModal(); return; }

                // Copy to "our" list
                var favorite = Object.assign({}, dream);
                favorite.id = Date.now();
                favorite.firebaseId = 'item_' + favorite.id;
                favorite.achieved = false;
                delete favorite.priority;

                if (!dreams[destCat]) dreams[destCat] = [];
                dreams[destCat].push(favorite);
                saveToLocal(destCat);
                syncToFirestore(destCat);
                renderDreams(destCat);

                // Remove from want-to-try list
                dreams[srcCat] = dreams[srcCat].filter(function(d) { return d.firebaseId !== triedItData.firebaseId; });
                saveToLocal(srcCat);
                syncToFirestore(srcCat);
                renderDreams(srcCat);

                // Auto-expand the "our" list
                var listEl = document.getElementById(destCat + '-list');
                if (listEl) {
                    listEl.classList.add('expanded');
                    localStorage.setItem('dreamListExpanded_' + destCat, 'true');
                }

                closeTriedModal();
            } catch(err) {
                alert('Error: ' + err.message);
                closeTriedModal();
            }
        };

        window.passItem = function() {
            try {
                var srcCat = triedItData.category;
                dreams[srcCat] = dreams[srcCat].filter(function(d) { return d.firebaseId !== triedItData.firebaseId; });
                saveToLocal(srcCat);
                syncToFirestore(srcCat);
                renderDreams(srcCat);
                closeTriedModal();
            } catch(err) {
                alert('Error: ' + err.message);
                closeTriedModal();
            }
        };

        // === EDIT DREAM ===
        window.editDream = function(category, firebaseId) {
            var dream = dreams[category].find(function(d) { return d.firebaseId === firebaseId; });
            if (!dream) return;

            document.getElementById('editFirebaseId').value = firebaseId;
            document.getElementById('editCategory').value = category;
            document.getElementById('editTitle').value = dream.title || '';
            document.getElementById('editDetails').value = dream.details || '';
            document.getElementById('editPriority').value = dream.priority || '';

            var isRestaurant = (category === 'restaurants' || category === 'our-restaurants');
            var isPlace = (category === 'places' || category === 'our-places');
            var isOurList = (category.indexOf('our-') === 0);

            // Show/hide category-specific fields
            document.getElementById('editTypeGroup').style.display = isRestaurant ? '' : 'none';
            document.getElementById('editPlaceTypeGroup').style.display = isPlace ? '' : 'none';
            document.getElementById('editOccasionGroup').style.display = isRestaurant ? '' : 'none';
            document.getElementById('editPriorityGroup').style.display = isOurList ? 'none' : '';

            // Set restaurant type checkboxes
            if (isRestaurant) {
                var types = dream.restaurantTypes || [];
                var checkboxes = document.querySelectorAll('#editTypeCheckboxes input[name="editType"]');
                for (var i = 0; i < checkboxes.length; i++) {
                    checkboxes[i].checked = types.indexOf(checkboxes[i].value) !== -1;
                }
                document.getElementById('editOccasion').value = dream.occasion || '';
            }

            // Set place type checkboxes
            if (isPlace) {
                var ptypes = dream.placeTypes || [];
                var pcheckboxes = document.querySelectorAll('#editPlaceTypeCheckboxes input[name="editPlaceType"]');
                for (var i = 0; i < pcheckboxes.length; i++) {
                    pcheckboxes[i].checked = ptypes.indexOf(pcheckboxes[i].value) !== -1;
                }
            }

            var formEl = document.getElementById('edit-form');
            formEl.classList.add('active');
            document.body.style.overflow = 'hidden';
            formEl._backdropHandler = function(e) {
                if (e.target === formEl) closeEditForm();
            };
            formEl.addEventListener('click', formEl._backdropHandler);
        };

        window.closeEditForm = function() {
            var formEl = document.getElementById('edit-form');
            formEl.classList.remove('active');
            document.body.style.overflow = '';
            if (formEl._backdropHandler) {
                formEl.removeEventListener('click', formEl._backdropHandler);
                delete formEl._backdropHandler;
            }
        };

        window.saveEdit = function() {
            try {
                var firebaseId = document.getElementById('editFirebaseId').value;
                var category = document.getElementById('editCategory').value;

                var dream = dreams[category].find(function(d) { return d.firebaseId === firebaseId; });
                if (!dream) { closeEditForm(); return; }

                dream.title = document.getElementById('editTitle').value.trim();
                dream.details = document.getElementById('editDetails').value.trim();
                dream.priority = document.getElementById('editPriority').value;

                var isRestaurant = (category === 'restaurants' || category === 'our-restaurants');
                var isPlace = (category === 'places' || category === 'our-places');

                if (isRestaurant) {
                    var checked = document.querySelectorAll('#editTypeCheckboxes input[name="editType"]:checked');
                    var types = [];
                    for (var i = 0; i < checked.length; i++) types.push(checked[i].value);
                    dream.restaurantTypes = types;
                    dream.occasion = document.getElementById('editOccasion').value;
                }

                if (isPlace) {
                    var pchecked = document.querySelectorAll('#editPlaceTypeCheckboxes input[name="editPlaceType"]:checked');
                    var ptypes = [];
                    for (var i = 0; i < pchecked.length; i++) ptypes.push(pchecked[i].value);
                    dream.placeTypes = ptypes;
                }

                saveToLocal(category);
                syncToFirestore(category);
                renderDreams(category);
                closeEditForm();
            } catch(err) {
                alert('Error: ' + err.message);
            }
        };

        window.closeCelebration = function() {
            document.getElementById('celebration').classList.remove('show');
        };

        window.chooseRandomDream = function(category) {
            currentRandomCategory = category;
            var unachievedDreams = dreams[category].filter(function(d) { return !d.achieved; });
            if (unachievedDreams.length === 0) {
                alert('No items to choose from yet! Add some first.');
                return;
            }
            var randomDream = unachievedDreams[Math.floor(Math.random() * unachievedDreams.length)];
            showRandomChoice(randomDream);
        };

        function showRandomChoice(dream) {
            document.getElementById('randomChoiceTitle').textContent = dream.title;
            document.getElementById('randomChoiceDetails').textContent = dream.details || '';
            var img = document.getElementById('randomChoiceImage');
            if (dream.image) {
                img.src = dream.image;
                img.style.display = 'block';
            } else {
                img.style.display = 'none';
            }
            document.getElementById('randomChoice').classList.add('show');
        }

        window.closeRandomChoice = function() {
            document.getElementById('randomChoice').classList.remove('show');
            currentRandomCategory = '';
        };

        window.pickAnotherRandom = function() {
            document.getElementById('randomChoice').classList.remove('show');
            setTimeout(function() {
                window.chooseRandomDream(currentRandomCategory);
            }, 200);
        };

        function showCelebration(dreamTitle) {
            document.getElementById('celebrationText').textContent = 'You achieved: "' + dreamTitle + '"';
            document.getElementById('celebration').classList.add('show');
            createConfetti();
        }

        function createConfetti() {
            var colors = ['#b59197', '#7ba886', '#d4a5ae', '#ff9999', '#ffcc99', '#a8e6cf', '#95c9b4'];
            for (var i = 0; i < 100; i++) {
                (function(idx) {
                    setTimeout(function() {
                        var confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.top = '-10px';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        var size = Math.random() * 8 + 6;
                        confetti.style.width = size + 'px';
                        confetti.style.height = size + 'px';
                        var duration = Math.random() * 2 + 2;
                        confetti.style.animationDuration = duration + 's';
                        document.body.appendChild(confetti);
                        setTimeout(function() { confetti.remove(); }, duration * 1000);
                    }, idx * 30);
                })(i);
            }
        }

        // === DETAIL POPUP ===
        window.openDetail = function(category, firebaseId) {
            var dream = dreams[category].find(function(d) { return d.firebaseId === firebaseId; });
            if (!dream) return;

            document.getElementById('detailTitle').textContent = dream.title;

            // Build tags
            var tags = '';
            if (dream.priority === 'high') tags += '<span class="dream-tag priority-high">High Priority</span>';
            else if (dream.priority === 'soon') tags += '<span class="dream-tag priority-soon">Soon</span>';

            if (dream.occasion === 'date-night') tags += '<span class="dream-tag occasion-date-night">Date Night</span>';
            else if (dream.occasion === 'friends') tags += '<span class="dream-tag occasion-friends">Go with Friends</span>';
            else if (dream.occasion === 'special') tags += '<span class="dream-tag occasion-special">Special Occasion</span>';

            if (dream.restaurantTypes && Array.isArray(dream.restaurantTypes)) {
                dream.restaurantTypes.forEach(function(t) {
                    tags += '<span class="dream-tag">' + t.charAt(0).toUpperCase() + t.slice(1) + '</span>';
                });
            }
            if (dream.placeTypes && Array.isArray(dream.placeTypes)) {
                dream.placeTypes.forEach(function(t) {
                    tags += '<span class="dream-tag">' + t.split('-').map(function(w) { return w.charAt(0).toUpperCase() + w.slice(1); }).join(' ') + '</span>';
                });
            }
            document.getElementById('detailMeta').innerHTML = tags;
            document.getElementById('detailMeta').style.display = tags ? '' : 'none';

            // Details text
            var detailEl = document.getElementById('detailDetails');
            detailEl.textContent = dream.details || '';
            detailEl.style.display = dream.details ? '' : 'none';

            // Image
            var imgEl = document.getElementById('detailImage');
            if (dream.image) {
                imgEl.src = dream.image;
                imgEl.style.display = '';
            } else {
                imgEl.style.display = 'none';
            }

            // Action buttons
            var triedItCategories = ['restaurants', 'places', 'travel', 'shows-movies'];
            var ourCategories = ['our-restaurants', 'our-places', 'our-travel', 'our-shows-movies'];
            var triedLabels = {
                'restaurants': 'We Tried It!',
                'places': 'We Went!',
                'travel': 'We Traveled!',
                'shows-movies': 'We Watched It!'
            };

            var btns = '';
            if (triedItCategories.indexOf(category) !== -1) {
                btns =
                    '<button class="icon-btn" onclick="closeDetail();triedIt(\'' + category + '\', \'' + firebaseId + '\')">' + triedLabels[category] + '</button>' +
                    '<button class="icon-btn" onclick="closeDetail();editDream(\'' + category + '\', \'' + firebaseId + '\')">Edit</button>' +
                    '<button class="icon-btn" onclick="deleteDreamAndClose(\'' + category + '\', \'' + firebaseId + '\')">Delete</button>';
            } else if (ourCategories.indexOf(category) !== -1) {
                btns =
                    '<button class="icon-btn" onclick="closeDetail();editDream(\'' + category + '\', \'' + firebaseId + '\')">Edit</button>' +
                    '<button class="icon-btn" onclick="deleteDreamAndClose(\'' + category + '\', \'' + firebaseId + '\')">Delete</button>';
            } else {
                btns =
                    '<button class="icon-btn ' + (dream.achieved ? 'achieved' : '') + '" onclick="toggleAchievedAndClose(\'' + category + '\', \'' + firebaseId + '\', ' + !dream.achieved + ')">' +
                    (dream.achieved ? '&#10004; Done' : 'Mark Done') + '</button>' +
                    '<button class="icon-btn" onclick="closeDetail();editDream(\'' + category + '\', \'' + firebaseId + '\')">Edit</button>' +
                    '<button class="icon-btn" onclick="deleteDreamAndClose(\'' + category + '\', \'' + firebaseId + '\')">Delete</button>';
            }
            document.getElementById('detailActions').innerHTML = btns;

            document.getElementById('detailPopup').classList.add('active');
            document.body.style.overflow = 'hidden';
        };

        window.closeDetail = function() {
            document.getElementById('detailPopup').classList.remove('active');
            document.body.style.overflow = '';
        };

        window.deleteDreamAndClose = function(category, firebaseId) {
            // Tap-twice inside the popup
            var btn = event.target;
            if (btn && btn.dataset.confirmDelete === 'yes') {
                try {
                    dreams[category] = dreams[category].filter(function(d) { return d.firebaseId !== firebaseId; });
                    saveToLocal(category);
                    renderDreams(category);
                    syncToFirestore(category);
                } catch(err) {}
                closeDetail();
            } else if (btn) {
                btn.dataset.confirmDelete = 'yes';
                btn.textContent = 'Sure?';
                btn.style.color = '#c0392b';
                btn.style.borderColor = '#c0392b';
                setTimeout(function() {
                    if (btn && btn.parentNode) {
                        btn.dataset.confirmDelete = '';
                        btn.textContent = 'Delete';
                        btn.style.color = '';
                        btn.style.borderColor = '';
                    }
                }, 3000);
            }
        };

        window.toggleAchievedAndClose = function(category, firebaseId, newState) {
            try {
                var dream = dreams[category].find(function(d) { return d.firebaseId === firebaseId; });
                if (dream) {
                    dream.achieved = newState;
                    saveToLocal(category);
                    renderDreams(category);
                    syncToFirestore(category);
                    if (newState) showCelebration(dream.title);
                }
            } catch(err) {}
            closeDetail();
        };

        function renderDreams(category) {
            var listContainer = document.getElementById(category + '-list');
            if (!listContainer) return;

            if (!dreams[category] || dreams[category].length === 0) {
                var emptyMessages = {
                    restaurants: 'No restaurants yet. Where should you go for date night?',
                    'our-restaurants': 'No favorites yet! Add places you already love.',
                    places: 'No places yet. Where do you want to go?',
                    'our-places': 'No favorite spots yet!',
                    'kasey-wishlist': "Kasey's wishlist is empty",
                    'charlie-wishlist': "Charlie's wishlist is empty",
                    travel: 'No travel dreams yet. Where do you want to go?',
                    'our-travel': 'No favorite trips yet!',
                    'shows-movies': 'No shows or movies yet. What do you want to watch together?',
                    'our-shows-movies': 'No favorites yet!',
                    bucket: 'Start building your bucket list together!',
                    home: 'What does your dream home look like?',
                    pets: 'Dream about your future fur (or scale, or feather) babies!'
                };
                listContainer.innerHTML = '<div class="empty-state">' + (emptyMessages[category] || '') + '</div>';
                listContainer.classList.remove('expanded');
                return;
            }

            var sorted = dreams[category].slice().sort(function(a, b) {
                if (a.achieved !== b.achieved) return a.achieved ? 1 : -1;
                var priorityOrder = { high: 0, soon: 1, friends: 2, '': 3 };
                return (priorityOrder[a.priority] || 3) - (priorityOrder[b.priority] || 3);
            });

            var html = '<div class="dream-list-toggle" onclick="toggleDreamList(\'' + category + '\')">' +
                '<span class="dream-list-toggle-text">View List (' + sorted.length + ' item' + (sorted.length !== 1 ? 's' : '') + ')</span>' +
                '<span class="dream-list-arrow">&#9660;</span></div><div class="dream-list-content">';

            sorted.forEach(function(dream) {
                // Compact row: title + indicators + chevron
                var indicators = '';
                if (dream.priority === 'high') indicators += '<span class="indicator-dot high" title="High Priority"></span>';
                else if (dream.priority === 'soon') indicators += '<span class="indicator-dot soon" title="Soon"></span>';
                if (dream.image) indicators += '<span class="indicator-dot has-image" title="Has photo"></span>';

                html += '<div class="dream-item ' + (dream.achieved ? 'achieved' : '') + '" onclick="openDetail(\'' + category + '\', \'' + dream.firebaseId + '\')">' +
                    '<div class="dream-item-content"><div class="dream-item-title">' + escapeHtml(dream.title) + '</div></div>' +
                    '<div class="dream-item-indicators">' + indicators + '</div>' +
                    '<span class="dream-item-chevron">&#9654;</span>' +
                    '</div>';
            });

            html += '</div>';
            listContainer.innerHTML = html;

            var expandedState = localStorage.getItem('dreamListExpanded_' + category);
            if (expandedState === 'true') {
                listContainer.classList.add('expanded');
            } else {
                listContainer.classList.remove('expanded');
            }
        }

        // ===== WELLNESS TRACKER =====
        var wellnessData = { injections: [], weights: [], measurements: [] };

        function loadWellnessLocal() {
            try {
                var d = localStorage.getItem('dreams_wellness');
                if (d) wellnessData = JSON.parse(d);
            } catch(e) {}
            // Ensure arrays exist
            if (!wellnessData.injections) wellnessData.injections = [];
            if (!wellnessData.weights) wellnessData.weights = [];
            if (!wellnessData.measurements_person1) wellnessData.measurements_person1 = wellnessData.measurements || [];
            if (!wellnessData.measurements_person2) wellnessData.measurements_person2 = [];
            delete wellnessData.measurements; // migrate old key
        }

        function saveWellnessLocal() {
            try { localStorage.setItem('dreams_wellness', JSON.stringify(wellnessData)); } catch(e) {}
        }

        function syncWellnessToFirestore() {
            if (window.dreamsDb && window.fsModule) {
                try {
                    var docRef = window.fsModule.doc(window.dreamsDb, 'dreams', 'wellness');
                    window.fsModule.setDoc(docRef, wellnessData).catch(function(err) {});
                } catch(e) {}
            }
        }

        function saveWellness() {
            saveWellnessLocal();
            syncWellnessToFirestore();
        }

        function fmtDate(dateStr) {
            if (!dateStr) return '';
            var d = new Date(dateStr + 'T00:00:00');
            return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function todayStr() {
            var d = new Date();
            return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
        }

        // --- Injections ---
        window.addInjection = function() {
            var dateInput = document.getElementById('injectionDate');
            var doseInput = document.getElementById('injectionDose');
            var notesInput = document.getElementById('injectionNotes');
            var date = dateInput.value || todayStr();
            var dose = doseInput.value.trim();
            if (!dose) { doseInput.focus(); return; }
            wellnessData.injections.unshift({ id: Date.now().toString(), date: date, dose: dose, notes: notesInput.value.trim() });
            wellnessData.injections.sort(function(a,b) { return b.date.localeCompare(a.date); });
            saveWellness();
            renderInjections();
            dateInput.value = ''; doseInput.value = ''; notesInput.value = '';
        };

        window.deleteInjection = function(id) {
            wellnessData.injections = wellnessData.injections.filter(function(r) { return r.id !== id; });
            saveWellness();
            renderInjections();
        };

        function renderInjections() {
            var tbody = document.getElementById('injectionBody');
            if (!wellnessData.injections.length) {
                tbody.innerHTML = '<tr><td colspan="4" class="wellness-empty">No injections logged yet</td></tr>';
                return;
            }
            tbody.innerHTML = wellnessData.injections.map(function(r) {
                return '<tr><td>' + fmtDate(r.date) + '</td><td>' + escapeHtml(r.dose) + '</td><td>' + escapeHtml(r.notes || '') + '</td><td><button class="wellness-delete-btn" onclick="deleteInjection(\'' + r.id + '\')">&times;</button></td></tr>';
            }).join('');
        }

        // --- Weights ---
        window.addWeight = function() {
            var dateInput = document.getElementById('weightDate');
            var k = document.getElementById('weightKasey');
            var c = document.getElementById('weightCharlie');
            var date = dateInput.value || todayStr();
            var kv = k.value ? parseFloat(k.value) : null;
            var cv = c.value ? parseFloat(c.value) : null;
            if (kv === null && cv === null) { k.focus(); return; }
            wellnessData.weights.unshift({ id: Date.now().toString(), date: date, kasey: kv, charlie: cv });
            wellnessData.weights.sort(function(a,b) { return b.date.localeCompare(a.date); });
            saveWellness();
            renderWeights();
            dateInput.value = ''; k.value = ''; c.value = '';
        };

        window.deleteWeight = function(id) {
            wellnessData.weights = wellnessData.weights.filter(function(r) { return r.id !== id; });
            saveWellness();
            renderWeights();
        };

        function weightChange(entries, index, person) {
            if (index >= entries.length - 1) return '';
            var current = entries[index][person];
            var prev = entries[index + 1][person];
            if (current === null || prev === null) return '';
            var diff = current - prev;
            if (diff === 0) return '<span class="wellness-change-zero">0</span>';
            var sign = diff > 0 ? '+' : '';
            var cls = diff < 0 ? 'wellness-change-neg' : 'wellness-change-pos';
            return '<span class="' + cls + '">' + sign + diff.toFixed(1) + '</span>';
        }

        function renderWeights() {
            var tbody = document.getElementById('weightBody');
            var names = window.LifeHubSettings ? window.LifeHubSettings.current.names : { name1: 'Kasey', name2: 'Charlie' };
            // Update header names
            document.querySelectorAll('#weightList th[data-lh-name="person1"]').forEach(function(el) { el.textContent = names.name1; });
            document.querySelectorAll('#weightList th[data-lh-name="person2"]').forEach(function(el) { el.textContent = names.name2; });
            if (!wellnessData.weights.length) {
                tbody.innerHTML = '<tr><td colspan="5" class="wellness-empty">No weigh-ins logged yet</td></tr>';
                return;
            }
            tbody.innerHTML = wellnessData.weights.map(function(r, i) {
                var kStr = r.kasey !== null ? r.kasey.toFixed(1) : '—';
                var cStr = r.charlie !== null ? r.charlie.toFixed(1) : '—';
                var changeK = weightChange(wellnessData.weights, i, 'kasey');
                var changeC = weightChange(wellnessData.weights, i, 'charlie');
                var changeStr = '';
                if (changeK || changeC) changeStr = (changeK || '') + (changeK && changeC ? ' / ' : '') + (changeC || '');
                return '<tr><td>' + fmtDate(r.date) + '</td><td>' + kStr + '</td><td>' + cStr + '</td><td>' + changeStr + '</td><td><button class="wellness-delete-btn" onclick="deleteWeight(\'' + r.id + '\')">&times;</button></td></tr>';
            }).join('');
        }

        // --- Measurements (per person) ---
        window.addMeasurement = function(person) {
            var suffix = person === 'person1' ? '1' : '2';
            var key = 'measurements_' + person;
            var dateInput = document.getElementById('measureDate' + suffix);
            var date = dateInput.value || todayStr();
            var fieldIds = person === 'person1'
                ? ['measureBust1','measureWaist1','measureHips1','measureArm1','measureThigh1']
                : ['measureChest2','measureWaist2','measureHips2','measureArm2','measureThigh2'];
            var fieldKeys = person === 'person1'
                ? ['bust','waist','hips','arm','thigh']
                : ['chest','waist','hips','arm','thigh'];
            var entry = { id: Date.now().toString(), date: date };
            var hasValue = false;
            fieldKeys.forEach(function(fk, i) {
                var el = document.getElementById(fieldIds[i]);
                entry[fk] = el.value ? parseFloat(el.value) : null;
                if (entry[fk] !== null) hasValue = true;
            });
            if (!hasValue) { document.getElementById(fieldIds[0]).focus(); return; }
            wellnessData[key].unshift(entry);
            wellnessData[key].sort(function(a,b) { return b.date.localeCompare(a.date); });
            saveWellness();
            renderMeasurements(person);
            dateInput.value = '';
            fieldIds.forEach(function(id) { document.getElementById(id).value = ''; });
        };

        window.deleteMeasurement = function(person, id) {
            var key = 'measurements_' + person;
            wellnessData[key] = wellnessData[key].filter(function(r) { return r.id !== id; });
            saveWellness();
            renderMeasurements(person);
        };

        function measureChange(entries, index, field) {
            if (index >= entries.length - 1) return '';
            var current = entries[index][field];
            var prev = entries[index + 1][field];
            if (current === null || current === undefined || prev === null || prev === undefined) return '';
            var diff = current - prev;
            if (diff === 0) return '';
            var sign = diff > 0 ? '+' : '';
            var cls = diff < 0 ? 'wellness-change-neg' : 'wellness-change-pos';
            return ' <span class="' + cls + '">(' + sign + diff.toFixed(1) + ')</span>';
        }

        function renderMeasurements(person) {
            var suffix = person === 'person1' ? '1' : '2';
            var key = 'measurements_' + person;
            var tbody = document.getElementById('measureBody' + suffix);
            var data = wellnessData[key] || [];
            var fields = person === 'person1' ? ['bust','waist','hips','arm','thigh'] : ['chest','waist','hips','arm','thigh'];
            if (!data.length) {
                tbody.innerHTML = '<tr><td colspan="7" class="wellness-empty">No measurements logged yet</td></tr>';
                return;
            }
            tbody.innerHTML = data.map(function(r, i) {
                var cells = fields.map(function(f) {
                    var val = r[f] !== null && r[f] !== undefined ? r[f].toFixed(1) + '"' + measureChange(data, i, f) : '—';
                    return '<td>' + val + '</td>';
                }).join('');
                return '<tr><td>' + fmtDate(r.date) + '</td>' + cells + '<td><button class="wellness-delete-btn" onclick="deleteMeasurement(\'' + person + '\',\'' + r.id + '\')">&times;</button></td></tr>';
            }).join('');
        }

        function renderAllWellness() {
            renderInjections();
            renderWeights();
            renderMeasurements('person1');
            renderMeasurements('person2');
        }
        // ===== END WELLNESS TRACKER =====

        // ===== WEEKLY PROMPT & MONTHLY CHALLENGE =====
        var weeklyPrompts = [
            "What's one thing I did this week that made you smile?",
            "What's your favorite memory of us from this past month?",
            "What's one way I can support you better this week?",
            "What's something you're grateful for about our relationship?",
            "What's a goal you have for us as a couple?",
            "What's one thing you admire about me?",
            "What's your favorite thing we do together?",
            "What's something new you'd like to try together?",
            "What's a challenge we've overcome together that you're proud of?",
            "What makes you feel most loved by me?",
            "What's something you've learned about yourself through our relationship?",
            "What's a small gesture I do that means a lot to you?",
            "What's your favorite quality about our relationship?",
            "What's something you're excited about for our future?",
            "What's one way we've grown together recently?",
            "What's a tradition you'd like to start with us?",
            "What's something I do that makes you laugh?",
            "What's your favorite way to spend quality time together?",
            "What's something you want to accomplish together this year?",
            "What's one thing about our relationship that makes you feel secure?",
            "What's a moment when you felt really connected to me?",
            "What's something you appreciate about how we handle disagreements?",
            "What's your favorite inside joke or moment between us?",
            "What's one way our relationship has changed you for the better?",
            "What's something you'd like more of in our relationship?",
            "What's a compliment you wish you heard more often?",
            "What's your favorite physical gesture of affection from me?",
            "What's something I do that helps you feel understood?",
            "What's a dream you have for us that we haven't talked about yet?",
            "What's one thing that always brightens your day when I do it?",
            "What's something about me that surprised you when you first got to know me?",
            "What's a way we could be more intentional about our time together?",
            "What's a song, show, or movie that reminds you of us?",
            "What's one thing you're looking forward to doing together this season?",
            "How do you feel about where we are right now as a couple?",
            "What's something silly or small that you love about our routine?",
            "What's a way I've helped you grow as a person?",
            "What's one thing you never want to change about us?",
            "What's a place you'd love to visit together someday?",
            "What does home feel like to you when we're together?",
            "What's a hard conversation we've had that made us stronger?",
            "What's a quality I bring to our relationship that balances you out?",
            "What's something about our relationship that you're proud of?",
            "What's one thing you wish we did more often?",
            "When do you feel most at peace with me?",
            "What's a memory of us that you think about when you're having a bad day?",
            "What's something I do that makes you feel taken care of?",
            "What would you want our life to look like in five years?",
            "What's one area where we make a really good team?",
            "What's something you'd love to learn or experience together?",
            "What's one thing about us that you think other people admire?",
            "What's a way I've shown you love that really stuck with you?"
        ];

        var monthlyChallenges = [
            "Write each other a love letter and read them aloud together",
            "Go on a walk together at least 3 times this week",
            "Try a new restaurant or cafe you've never been to",
            "Have a technology-free evening once a week",
            "Learn something new together — a skill, hobby, or topic",
            "Do a random act of kindness for each other every week",
            "Plan and execute a surprise date for each other",
            "Start a new tradition together",
            "Declutter and organize one space in your home together",
            "Take photos together once a week to capture memories",
            "Cook a new recipe together that neither of you has tried",
            "Create something together — art, craft, garden, whatever"
        ];

        var promptData = { week: '', person1: '', person2: '' };
        var promptHistory = [];
        var challengeData = { month: '', completed: false, notes: '' };

        function getWeekKey() {
            var d = new Date();
            var jan1 = new Date(d.getFullYear(), 0, 1);
            var weekNum = Math.ceil(((d - jan1) / 86400000 + jan1.getDay() + 1) / 7);
            return d.getFullYear() + '-W' + weekNum;
        }

        function getMonthKey() {
            var d = new Date();
            return d.getFullYear() + '-' + d.getMonth();
        }

        function loadPromptLocal() {
            try { var d = localStorage.getItem('dreams_weeklyPrompt'); if (d) promptData = JSON.parse(d); } catch(e) {}
            try { var h = localStorage.getItem('dreams_promptHistory'); if (h) promptHistory = JSON.parse(h); } catch(e) {}
        }
        function savePromptLocal() {
            try { localStorage.setItem('dreams_weeklyPrompt', JSON.stringify(promptData)); } catch(e) {}
            try { localStorage.setItem('dreams_promptHistory', JSON.stringify(promptHistory)); } catch(e) {}
        }
        function loadChallengeLocal() {
            try { var d = localStorage.getItem('dreams_monthlyChallenge'); if (d) challengeData = JSON.parse(d); } catch(e) {}
        }
        function saveChallengeLocal() {
            try { localStorage.setItem('dreams_monthlyChallenge', JSON.stringify(challengeData)); } catch(e) {}
        }

        function syncPromptToFirestore() {
            if (window.dreamsDb && window.fsModule) {
                try {
                    var docRef = window.fsModule.doc(window.dreamsDb, 'dreams', 'weeklyPrompt');
                    window.fsModule.setDoc(docRef, promptData).catch(function(err) {});
                } catch(e) {}
            }
        }
        function syncPromptHistoryToFirestore() {
            if (window.dreamsDb && window.fsModule) {
                try {
                    var docRef = window.fsModule.doc(window.dreamsDb, 'dreams', 'promptHistory');
                    window.fsModule.setDoc(docRef, { entries: promptHistory }).catch(function(err) {});
                } catch(e) {}
            }
        }
        function syncChallengeToFirestore() {
            if (window.dreamsDb && window.fsModule) {
                try {
                    var docRef = window.fsModule.doc(window.dreamsDb, 'dreams', 'monthlyChallenge');
                    window.fsModule.setDoc(docRef, challengeData).catch(function(err) {});
                } catch(e) {}
            }
        }

        function initWeeklyPrompt() {
            var weekKey = getWeekKey();
            var weekNum = parseInt(weekKey.split('W')[1], 10);
            var promptIndex = weekNum % weeklyPrompts.length;
            document.getElementById('weeklyPromptQuestion').textContent = weeklyPrompts[promptIndex];

            if (promptData.week && promptData.week !== weekKey) {
                // Archive the old prompt before resetting
                if (promptData.person1 || promptData.person2) {
                    var oldWeekNum = parseInt(promptData.week.split('W')[1], 10);
                    var oldQuestion = weeklyPrompts[oldWeekNum % weeklyPrompts.length];
                    promptHistory.unshift({
                        week: promptData.week,
                        question: oldQuestion,
                        person1: promptData.person1,
                        person2: promptData.person2
                    });
                    // Keep last 52 weeks max
                    if (promptHistory.length > 52) promptHistory = promptHistory.slice(0, 52);
                    savePromptLocal();
                    syncPromptHistoryToFirestore();
                }
                promptData = { week: weekKey, person1: '', person2: '' };
                savePromptLocal();
                syncPromptToFirestore();
            } else if (!promptData.week) {
                promptData.week = weekKey;
                savePromptLocal();
                syncPromptToFirestore();
            }
            renderPromptAnswers();
            renderPastPrompts();
        }

        function renderPromptAnswers() {
            ['person1', 'person2'].forEach(function(p) {
                var suffix = p === 'person1' ? '1' : '2';
                var display = document.getElementById('prompt' + suffix + 'Display');
                var hint = document.getElementById('prompt' + suffix + 'Hint');
                var inputWrap = document.getElementById('prompt' + suffix + 'Input');
                if (promptData[p]) {
                    display.textContent = promptData[p];
                    display.style.display = 'block';
                    hint.style.display = 'block';
                    inputWrap.style.display = 'none';
                } else {
                    display.style.display = 'none';
                    hint.style.display = 'none';
                    inputWrap.style.display = 'block';
                }
            });
        }

        window.savePromptAnswer = function(person) {
            var suffix = person === 'person1' ? '1' : '2';
            var val = document.getElementById('prompt' + suffix + 'Textarea').value.trim();
            if (!val) return;
            promptData[person] = val;
            promptData.week = getWeekKey();
            savePromptLocal();
            syncPromptToFirestore();
            renderPromptAnswers();
        };

        window.editPromptAnswer = function(person) {
            var suffix = person === 'person1' ? '1' : '2';
            document.getElementById('prompt' + suffix + 'Textarea').value = promptData[person] || '';
            document.getElementById('prompt' + suffix + 'Display').style.display = 'none';
            document.getElementById('prompt' + suffix + 'Hint').style.display = 'none';
            document.getElementById('prompt' + suffix + 'Input').style.display = 'block';
            document.getElementById('prompt' + suffix + 'Textarea').focus();
        };

        window.togglePastPrompts = function() {
            var body = document.getElementById('pastPromptsContent');
            var icon = document.getElementById('pastPromptsIcon');
            if (body.style.display === 'none') {
                body.style.display = 'block';
                icon.textContent = '▼';
            } else {
                body.style.display = 'none';
                icon.textContent = '▶';
            }
        };

        function renderPastPrompts() {
            var container = document.getElementById('pastPromptsList');
            if (!promptHistory.length) {
                container.innerHTML = '<div class="landing-past-empty">Past prompts will appear here after each week.</div>';
                return;
            }
            var names = window.LifeHubSettings ? window.LifeHubSettings.current.names : { name1: 'Kasey', name2: 'Charlie' };
            var html = '';
            promptHistory.forEach(function(entry) {
                html += '<div class="landing-past-entry">';
                html += '<div class="landing-past-week">' + entry.week + '</div>';
                html += '<div class="landing-past-question">' + entry.question + '</div>';
                if (entry.person1) {
                    html += '<div class="landing-past-answer"><div class="landing-past-answer-name">' + names.name1 + '</div>' + entry.person1 + '</div>';
                }
                if (entry.person2) {
                    html += '<div class="landing-past-answer"><div class="landing-past-answer-name">' + names.name2 + '</div>' + entry.person2 + '</div>';
                }
                html += '</div>';
            });
            container.innerHTML = html;
        }

        function initMonthlyChallenge() {
            var monthKey = getMonthKey();
            var d = new Date();
            var monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
            document.getElementById('challengeMonthLabel').textContent = monthNames[d.getMonth()] + ' ' + d.getFullYear();
            var challengeIndex = d.getMonth() % monthlyChallenges.length;
            document.getElementById('challengeText').textContent = monthlyChallenges[challengeIndex];

            if (challengeData.month !== monthKey) {
                challengeData = { month: monthKey, completed: false, notes: '' };
                saveChallengeLocal();
                syncChallengeToFirestore();
            }
            document.getElementById('challengeComplete').checked = challengeData.completed;
            document.getElementById('challengeStatusLabel').textContent = challengeData.completed ? 'Completed!' : 'Not completed';
            renderChallengeNotes();
        }

        window.toggleChallengeComplete = function() {
            challengeData.completed = document.getElementById('challengeComplete').checked;
            challengeData.month = getMonthKey();
            document.getElementById('challengeStatusLabel').textContent = challengeData.completed ? 'Completed!' : 'Not completed';
            saveChallengeLocal();
            syncChallengeToFirestore();
        };

        window.toggleChallengeNotes = function() {
            var body = document.getElementById('challengeNotesContent');
            var icon = document.getElementById('challengeNotesToggleIcon');
            if (body.style.display === 'none') {
                body.style.display = 'block';
                icon.textContent = '▼';
            } else {
                body.style.display = 'none';
                icon.textContent = '▶';
            }
        };

        window.saveChallengeNotes = function() {
            var val = document.getElementById('challengeNotesInput').value.trim();
            challengeData.notes = val;
            challengeData.month = getMonthKey();
            saveChallengeLocal();
            syncChallengeToFirestore();
            renderChallengeNotes();
        };

        window.editChallengeNotes = function() {
            document.getElementById('challengeNotesInput').value = challengeData.notes || '';
            document.getElementById('challengeNotesDisplayWrap').style.display = 'none';
            document.getElementById('challengeNotesEditWrap').style.display = 'block';
            document.getElementById('challengeNotesInput').focus();
        };

        function renderChallengeNotes() {
            if (challengeData.notes) {
                document.getElementById('challengeNotesDisplay').textContent = challengeData.notes;
                document.getElementById('challengeNotesDisplayWrap').style.display = 'block';
                document.getElementById('challengeNotesEditWrap').style.display = 'none';
            } else {
                document.getElementById('challengeNotesDisplayWrap').style.display = 'none';
                document.getElementById('challengeNotesEditWrap').style.display = 'block';
            }
        }
        // ===== END PROMPT & CHALLENGE =====

        // === LOAD LOCAL DATA IMMEDIATELY ===
        categories.forEach(function(cat) {
            dreams[cat] = loadFromLocal(cat);
            // Save deduped version back to localStorage to clean up any corruption
            saveToLocal(cat);
            renderDreams(cat);
        });

        // Load wellness tracker data
        loadWellnessLocal();
        renderAllWellness();

        // Load prompt & challenge
        loadPromptLocal();
        loadChallengeLocal();
        initWeeklyPrompt();
        initMonthlyChallenge();

        // === LOAD FIREBASE (FIRESTORE) IN BACKGROUND ===
        (async function() {
            try {
                var appModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
                var fsModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

                var firebaseConfig = {
                    apiKey: "AIzaSyCDda9sPwSY-RQ5rrM5THOvcLtHvcPRYd4",
                    authDomain: "our-habit-hub.firebaseapp.com",
                    projectId: "our-habit-hub",
                    storageBucket: "our-habit-hub.firebasestorage.app",
                    messagingSenderId: "78555830496",
                    appId: "1:78555830496:web:3e457e54729cc11b825885"
                };

                var app;
                try {
                    app = appModule.initializeApp(firebaseConfig);
                } catch(initErr) {
                    // App might already be initialized
                    app = appModule.getApp ? appModule.getApp() : null;
                }
                if (!app) return;
                
                var db = fsModule.getFirestore(app);
                window.dreamsDb = db;
                window.fsModule = fsModule;
                isConnected = true;

                // Save helper
                window.saveDreamsToFirebase = function(category) {
                    syncToFirestore(category);
                };

                // Set up real-time listeners for each category
                categories.forEach(function(category) {
                    var docRef = fsModule.doc(db, 'dreams', category);
                    var ignoreNext = false;

                    fsModule.onSnapshot(docRef, function(snapshot) {
                        if (ignoreNext) { ignoreNext = false; return; }

                        if (snapshot.exists()) {
                            var data = snapshot.data();
                            if (data && data.items) {
                                // Deduplicate Firestore data
                                var firestoreItems = dedup(data.items);
                                var hadDuplicates = firestoreItems.length < data.items.length;

                                // Merge: keep local images that Firestore stripped
                                var localItems = dreams[category] || [];
                                var localImageMap = {};
                                localItems.forEach(function(item) {
                                    if (item.image && item.firebaseId) localImageMap[item.firebaseId] = item.image;
                                });

                                firestoreItems.forEach(function(item) {
                                    if (!item.image && localImageMap[item.firebaseId]) {
                                        item.image = localImageMap[item.firebaseId];
                                    }
                                });

                                dreams[category] = firestoreItems;
                                saveToLocal(category);
                                renderDreams(category);

                                // Push cleaned data back to Firestore if it had dupes
                                if (hadDuplicates) {
                                    ignoreNext = true;
                                    syncToFirestore(category);
                                }
                            }
                        } else {
                            // No data in Firestore yet -- push local data up
                            if (dreams[category] && dreams[category].length > 0) {
                                ignoreNext = true;
                                syncToFirestore(category);
                            }
                        }
                    }, function(error) {
                        // Firestore error -- keep using local data
                    });
                });

                // Wellness tracker real-time listener
                (function() {
                    var wellnessRef = fsModule.doc(db, 'dreams', 'wellness');
                    var ignoreWellness = false;
                    fsModule.onSnapshot(wellnessRef, function(snapshot) {
                        if (ignoreWellness) { ignoreWellness = false; return; }
                        if (snapshot.exists()) {
                            var data = snapshot.data();
                            if (data.injections) wellnessData.injections = data.injections;
                            if (data.weights) wellnessData.weights = data.weights;
                            if (data.measurements_person1) wellnessData.measurements_person1 = data.measurements_person1;
                            else if (data.measurements) wellnessData.measurements_person1 = data.measurements; // migrate
                            if (data.measurements_person2) wellnessData.measurements_person2 = data.measurements_person2;
                            saveWellnessLocal();
                            renderAllWellness();
                        } else {
                            // No data in Firestore yet -- push local up
                            if (wellnessData.injections.length || wellnessData.weights.length || wellnessData.measurements_person1.length || wellnessData.measurements_person2.length) {
                                ignoreWellness = true;
                                syncWellnessToFirestore();
                            }
                        }
                    }, function(error) {});
                })();

                // Weekly prompt real-time listener
                (function() {
                    var promptRef = fsModule.doc(db, 'dreams', 'weeklyPrompt');
                    var ignorePrompt = false;
                    fsModule.onSnapshot(promptRef, function(snapshot) {
                        if (ignorePrompt) { ignorePrompt = false; return; }
                        if (snapshot.exists()) {
                            var data = snapshot.data();
                            promptData = data;
                            savePromptLocal();
                            initWeeklyPrompt();
                        } else if (promptData.week) {
                            ignorePrompt = true;
                            syncPromptToFirestore();
                        }
                    }, function(error) {});
                })();

                // Prompt history real-time listener
                (function() {
                    var histRef = fsModule.doc(db, 'dreams', 'promptHistory');
                    var ignoreHist = false;
                    fsModule.onSnapshot(histRef, function(snapshot) {
                        if (ignoreHist) { ignoreHist = false; return; }
                        if (snapshot.exists()) {
                            var data = snapshot.data();
                            promptHistory = data.entries || [];
                            try { localStorage.setItem('dreams_promptHistory', JSON.stringify(promptHistory)); } catch(e) {}
                            renderPastPrompts();
                        } else if (promptHistory.length) {
                            ignoreHist = true;
                            syncPromptHistoryToFirestore();
                        }
                    }, function(error) {});
                })();

                // Monthly challenge real-time listener
                (function() {
                    var chalRef = fsModule.doc(db, 'dreams', 'monthlyChallenge');
                    var ignoreChallenge = false;
                    fsModule.onSnapshot(chalRef, function(snapshot) {
                        if (ignoreChallenge) { ignoreChallenge = false; return; }
                        if (snapshot.exists()) {
                            var data = snapshot.data();
                            challengeData = data;
                            saveChallengeLocal();
                            initMonthlyChallenge();
                        } else if (challengeData.month) {
                            ignoreChallenge = true;
                            syncChallengeToFirestore();
                        }
                    }, function(error) {});
                })();

            } catch(e) {
                // Firebase failed to load -- local storage still works
            }
        })();
    </script>
<script>
function toggleNav() {
    var h = document.getElementById('navHamburger');
    var o = document.getElementById('navOverlay');
    if (!h || !o) return;
    var isOpen = o.classList.contains('open');
    if (isOpen) {
        h.classList.remove('open');
        o.classList.remove('open');
        document.body.style.overflow = '';
    } else {
        h.classList.add('open');
        o.classList.add('open');
        document.body.style.overflow = 'hidden';
    }
}
</script>
</body>
</html>
