<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Settings - Our Life Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Philosopher:ital,wght@0,400;0,700;1,400&family=Cormorant:wght@300;400;500;600;700&family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
    // Inline engine fallback — ensures settings page works even if external JS fails
    (function(){
        if (window.LifeHubSettings) return; // engine loaded fine

        var palettes = {
            sage:       { accent: '#a3b899', accentHover: '#b4c9aa', accentMuted: 'rgba(163,184,153,0.2)', accentBorder: 'rgba(163,184,153,0.3)', accentText: 'rgba(163,184,153,0.6)' },
            rose:       { accent: '#c9a9a6', accentHover: '#d9bfbd', accentMuted: 'rgba(201,169,166,0.2)', accentBorder: 'rgba(201,169,166,0.3)', accentText: 'rgba(201,169,166,0.6)' },
            lavender:   { accent: '#b4a7d6', accentHover: '#c7bde3', accentMuted: 'rgba(180,167,214,0.2)', accentBorder: 'rgba(180,167,214,0.3)', accentText: 'rgba(180,167,214,0.6)' },
            teal:       { accent: '#7ba8a1', accentHover: '#92bab4', accentMuted: 'rgba(123,168,161,0.2)', accentBorder: 'rgba(123,168,161,0.3)', accentText: 'rgba(123,168,161,0.6)' },
            peach:      { accent: '#d4a59a', accentHover: '#e0b8af', accentMuted: 'rgba(212,165,154,0.2)', accentBorder: 'rgba(212,165,154,0.3)', accentText: 'rgba(212,165,154,0.6)' },
            gold:       { accent: '#c9b77c', accentHover: '#d6c894', accentMuted: 'rgba(201,183,124,0.2)', accentBorder: 'rgba(201,183,124,0.3)', accentText: 'rgba(201,183,124,0.6)' },
            cream:      { accent: '#e8ddd0', accentHover: '#f2ebe0', accentMuted: 'rgba(232,221,208,0.2)', accentBorder: 'rgba(232,221,208,0.3)', accentText: 'rgba(232,221,208,0.6)' },
            blush:      { accent: '#d4919e', accentHover: '#e0a5b0', accentMuted: 'rgba(212,145,158,0.2)', accentBorder: 'rgba(212,145,158,0.3)', accentText: 'rgba(212,145,158,0.6)' },
            coral:      { accent: '#d98a7e', accentHover: '#e4a195', accentMuted: 'rgba(217,138,126,0.2)', accentBorder: 'rgba(217,138,126,0.3)', accentText: 'rgba(217,138,126,0.6)' },
            mauve:      { accent: '#b8879e', accentHover: '#cba0b4', accentMuted: 'rgba(184,135,158,0.2)', accentBorder: 'rgba(184,135,158,0.3)', accentText: 'rgba(184,135,158,0.6)' },
            berry:      { accent: '#9c6b82', accentHover: '#b08295', accentMuted: 'rgba(156,107,130,0.2)', accentBorder: 'rgba(156,107,130,0.3)', accentText: 'rgba(156,107,130,0.6)' },
            periwinkle: { accent: '#8e9cc7', accentHover: '#a3afd6', accentMuted: 'rgba(142,156,199,0.2)', accentBorder: 'rgba(142,156,199,0.3)', accentText: 'rgba(142,156,199,0.6)' },
            seafoam:    { accent: '#7bbfb0', accentHover: '#93cec1', accentMuted: 'rgba(123,191,176,0.2)', accentBorder: 'rgba(123,191,176,0.3)', accentText: 'rgba(123,191,176,0.6)' },
            terracotta: { accent: '#c4836a', accentHover: '#d49880', accentMuted: 'rgba(196,131,106,0.2)', accentBorder: 'rgba(196,131,106,0.3)', accentText: 'rgba(196,131,106,0.6)' },
            honey:      { accent: '#d4b870', accentHover: '#e0c988', accentMuted: 'rgba(212,184,112,0.2)', accentBorder: 'rgba(212,184,112,0.3)', accentText: 'rgba(212,184,112,0.6)' }
        };
        var secondaryPalettes = {
            sage:'#b59197', rose:'#a3b899', lavender:'#c9a9a6', teal:'#b59197',
            peach:'#a3b899', gold:'#b59197', cream:'#b59197', blush:'#a3b899',
            coral:'#b4a7d6', mauve:'#a3b899', berry:'#c9b77c', periwinkle:'#c9a9a6',
            seafoam:'#d4a59a', terracotta:'#a3b899', honey:'#b59197'
        };
        var bgColors = {
            dark:'#3d2f31', charcoal:'#1a1a1a', navy:'#1e2638', forest:'#1f2e2a',
            cream:'#f5f0e8', wine:'#2d1f2b', slate:'#2a2d35', espresso:'#2b2220', storm:'#252830'
        };
        var bgDarker = {
            dark:'#2a1f21', charcoal:'#111111', navy:'#141c2a', forest:'#15231f',
            cream:'#ebe4d9', wine:'#211520', slate:'#1f2229', espresso:'#1e1816', storm:'#1b1d24'
        };
        var textColors = {
            dark:     { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' },
            charcoal: { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' },
            navy:     { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' },
            forest:   { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' },
            cream:    { text:'#3d2f31', textMuted:'rgba(61,47,49,0.65)',    textFaint:'rgba(61,47,49,0.4)' },
            wine:     { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' },
            slate:    { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' },
            espresso: { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' },
            storm:    { text:'#e0d2d0', textMuted:'rgba(242,235,224,0.6)', textFaint:'rgba(242,235,224,0.4)' }
        };
        var fontStacks = { philosopher:"'Philosopher',Georgia,serif", cormorant:"'Cormorant',Georgia,'Times New Roman',serif", worksans:"'Work Sans',sans-serif", georgia:"Georgia,serif", arial:"Arial,sans-serif" };

        var s;
        try {
            s = {
                appName: localStorage.getItem('appName') || 'Our Life Hub',
                names: JSON.parse(localStorage.getItem('userNames') || '{"name1":"Kasey","name2":"Charlie"}'),
                accentColor: localStorage.getItem('accentColor') || 'sage',
                bgColor: localStorage.getItem('bgColor') || 'dark',
                fontFamily: localStorage.getItem('fontFamily') || 'philosopher',
                fontSize: parseInt(localStorage.getItem('fontSize') || '100', 10),
                archivedPages: JSON.parse(localStorage.getItem('archivedPages') || '[]'),
                archivedSections: JSON.parse(localStorage.getItem('archivedSections') || '{}'),
                features: JSON.parse(localStorage.getItem('features') || '{}'),
                pageLabels: JSON.parse(localStorage.getItem('pageLabels') || '{}')
            };
        } catch(e) {
            s = { appName:'Our Life Hub', names:{name1:'Kasey',name2:'Charlie'}, accentColor:'sage', bgColor:'dark', fontFamily:'philosopher', fontSize:100, archivedPages:[], archivedSections:{}, features:{}, pageLabels:{} };
        }

        // Apply CSS custom properties
        var p = palettes[s.accentColor] || palettes.sage;
        var bg = bgColors[s.bgColor] || bgColors.dark;
        var bgDk = bgDarker[s.bgColor] || bgDarker.dark;
        var sec = secondaryPalettes[s.accentColor] || '#b59197';
        var tc = textColors[s.bgColor] || textColors.dark;
        var font = fontStacks[s.fontFamily] || fontStacks.philosopher;
        var basePx = Math.round(16 * s.fontSize / 100);
        var root = document.documentElement;
        root.style.setProperty('--lh-accent', p.accent);
        root.style.setProperty('--lh-accent-hover', p.accentHover);
        root.style.setProperty('--lh-accent-muted', p.accentMuted);
        root.style.setProperty('--lh-accent-border', p.accentBorder);
        root.style.setProperty('--lh-accent-text', p.accentText);
        root.style.setProperty('--lh-secondary', sec);
        root.style.setProperty('--lh-bg', bg);
        root.style.setProperty('--lh-bg-darker', bgDk);
        root.style.setProperty('--lh-text', tc.text);
        root.style.setProperty('--lh-text-muted', tc.textMuted);
        root.style.setProperty('--lh-text-faint', tc.textFaint);
        root.style.setProperty('--lh-font', font);
        root.style.setProperty('--lh-font-size', basePx + 'px');
        root.style.background = bg;
        root.style.fontSize = basePx + 'px';

        // Page archiving CSS
        var pageMap = { home:'index.html', person1:'kasey-hub.html', person2:'charlie-hub.html', dreams:'our-dreams.html', meals:'meal-plan.html', settings:'settings.html' };
        var archiveCSS = '';
        s.archivedPages.forEach(function(k){ var h=pageMap[k]; if(h) archiveCSS += 'a.nav-link[href="'+h+'"],a.nav-link-mobile[href="'+h+'"]{display:none!important}\n'; });
        if (archiveCSS) { var st=document.createElement('style'); st.textContent=archiveCSS; (document.head||document.documentElement).appendChild(st); }

        window.LifeHubSettings = {
            current: s,
            palettes: palettes,
            bgColors: bgColors,
            bgDarker: bgDarker,
            fontStacks: fontStacks,
            secondaryPalettes: secondaryPalettes,
            textColors: textColors,
            getName: function(person) { return person===1||person==='person1' ? s.names.name1 : s.names.name2; },
            isPageArchived: function(k) { return s.archivedPages.indexOf(k)!==-1; },
            isSectionArchived: function(pk,sk) { var a=s.archivedSections[pk]; return a?a.indexOf(sk)!==-1:false; },
            getPageLabel: function(k,fb) { return s.pageLabels[k]||fb; }
        };

        // Apply names on DOM ready
        function onReady(fn){ if(document.readyState!=='loading') fn(); else document.addEventListener('DOMContentLoaded',fn); }
        onReady(function(){
            document.querySelectorAll('.nav-logo').forEach(function(el){ el.textContent=s.appName; });
            document.querySelectorAll('.nav-link,.nav-link-mobile').forEach(function(link){
                var href=link.getAttribute('href')||'';
                if(href==='kasey-hub.html') link.textContent=s.names.name1;
                if(href==='charlie-hub.html') link.textContent=s.names.name2;
            });
            var title=document.title;
            if(title.indexOf('Our Life Hub')!==-1) document.title=title.replace('Our Life Hub',s.appName);
        });
    })();
    </script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html { background: var(--lh-bg, #3d2f31) !important; }
        
        body {
            background: var(--lh-bg, #3d2f31) !important;
            color: var(--lh-text, #e0d2d0);
            font-family: var(--lh-font, 'Philosopher', Georgia, serif);
            font-weight: 500;
            min-height: 100vh;
            line-height: 1.6;
            padding-top: 76px;
        }

        /* ===== NAV — GOLD STANDARD ===== */
        .top-nav {
            position: fixed !important;
            top: 0 !important; left: 0 !important; right: 0 !important;
            background: var(--lh-bg-darker, #2a1f21) !important;
            border-bottom: 1px solid var(--lh-accent-border, rgba(163,184,153,0.2)) !important;
            z-index: 9999 !important;
            padding: 0 24px !important;
            font-family: var(--lh-font, 'Philosopher', Georgia, serif) !important;
        }
        .nav-container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            height: 56px !important;
        }
        .nav-logo {
            font-size: 1.1rem !important;
            font-weight: 700 !important;
            color: var(--lh-accent, #a3b899) !important;
            text-decoration: none !important;
            white-space: nowrap !important;
        }
        .nav-links { display: flex !important; gap: 28px !important; align-items: center !important; }
        .nav-link {
            color: var(--lh-text-muted, rgba(242,235,224,0.6)) !important;
            text-decoration: none !important;
            font-size: 0.88rem !important;
            font-weight: 500 !important;
            white-space: nowrap !important;
            transition: color 0.2s !important;
        }
        .nav-link:hover { color: var(--lh-text, #f2ebe0) !important; }
        .nav-link.active { color: var(--lh-accent, #a3b899) !important; }
        .nav-refresh {
            display: block; background: none; border: none;
            color: var(--lh-secondary, #b59197); font-size: 1.4rem;
            cursor: pointer; padding: 2px 0; z-index: 10001; line-height: 1;
        }
        .nav-refresh:active { transform: rotate(180deg); transition: transform 0.3s; }
        .nav-hamburger {
            display: none !important; background: none !important; border: none !important;
            cursor: pointer !important; padding: 10px !important; z-index: 10001 !important;
        }
        .nav-hamburger span {
            display: block !important; width: 24px !important; height: 2px !important;
            background: var(--lh-accent, #a3b899) !important; margin: 5px 0 !important;
            transition: all 0.3s ease !important;
        }
        .nav-hamburger.open span:nth-child(1) { transform: rotate(45deg) translate(5px,5px) !important; }
        .nav-hamburger.open span:nth-child(2) { opacity: 0 !important; }
        .nav-hamburger.open span:nth-child(3) { transform: rotate(-45deg) translate(5px,-5px) !important; }
        .nav-overlay {
            display: none !important; position: fixed !important;
            top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important;
            background: var(--lh-bg-darker, #2a1f21) !important; z-index: 10000 !important;
            flex-direction: column !important; align-items: center !important;
            justify-content: center !important; gap: 0 !important;
        }
        .nav-overlay.open { display: flex !important; }
        .nav-link-mobile {
            color: var(--lh-text-muted, rgba(242,235,224,0.7)) !important; text-decoration: none !important;
            font-size: 1.05rem !important; font-family: var(--lh-font, 'Philosopher', Georgia, serif) !important;
            font-weight: 500 !important; padding: 12px 40px !important;
            display: block !important; width: 100% !important; text-align: center !important;
        }
        .nav-link-mobile:hover { color: var(--lh-text, #f2ebe0) !important; }
        .nav-link-mobile.active { color: var(--lh-accent, #a3b899) !important; }
        @media (max-width: 768px) {
            .nav-hamburger { display: block !important; }
            .nav-links { display: none !important; }
        }
        /* ===== END NAV ===== */

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 24px 24px 80px;
        }

        .page-header { margin-bottom: 40px; }
        .page-title {
            font-size: 2.5rem;
            color: var(--lh-accent, #a3b899);
            margin-bottom: 8px;
        }
        .page-subtitle {
            color: var(--lh-text-muted, rgba(242,235,224,0.6));
            font-size: 1rem;
        }

        /* Settings Sections */
        .settings-section {
            background: var(--lh-bg-darker, #2a1f21);
            border: 1px solid var(--lh-accent-border, rgba(163,184,153,0.2));
            padding: 28px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--lh-accent, #a3b899);
            margin-bottom: 20px;
            font-weight: 700;
        }

        .section-description {
            color: var(--lh-text-muted, rgba(242,235,224,0.5));
            font-size: 0.85rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .setting-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--lh-accent-border, rgba(163,184,153,0.1));
        }
        .setting-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .setting-label {
            display: block;
            color: var(--lh-text, #f2ebe0);
            font-size: 1rem;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .setting-description {
            color: var(--lh-text-muted, rgba(242,235,224,0.5));
            font-size: 0.85rem;
            margin-bottom: 12px;
        }

        .setting-input {
            width: 100%;
            background: rgba(61,47,49,0.3);
            border: 1px solid var(--lh-accent-border, rgba(163,184,153,0.25));
            color: var(--lh-text, #f2ebe0);
            padding: 12px 16px;
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.2s;
        }
        .setting-input:focus {
            outline: none;
            border-color: var(--lh-accent, #a3b899);
            background: rgba(61,47,49,0.5);
        }

        .setting-select {
            width: 100%;
            background: rgba(61,47,49,0.3);
            border: 1px solid var(--lh-accent-border, rgba(163,184,153,0.25));
            color: var(--lh-text, #f2ebe0);
            padding: 12px 16px;
            font-size: 0.95rem;
            font-family: inherit;
            cursor: pointer;
        }
        .setting-select:focus {
            outline: none;
            border-color: var(--lh-accent, #a3b899);
        }

        textarea.setting-input {
            min-height: 100px;
            resize: vertical;
        }

        /* Buttons */
        .btn {
            background: var(--lh-accent, #a3b899);
            border: 1px solid var(--lh-accent, #a3b899);
            color: #1c1c1c;
            padding: 12px 24px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }
        .btn:hover { background: var(--lh-accent-hover, #b4c9aa); border-color: var(--lh-accent-hover, #b4c9aa); }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--lh-accent-border, rgba(163,184,153,0.4));
            color: var(--lh-accent, #a3b899);
        }
        .btn-secondary:hover { background: var(--lh-accent-muted, rgba(163,184,153,0.1)); }

        .btn-danger {
            background: transparent;
            border: 1px solid rgba(201,169,166,0.4);
            color: #c9a9a6;
        }
        .btn-danger:hover { background: rgba(201,169,166,0.1); }

        .btn-small { padding: 6px 14px; font-size: 0.8rem; }

        .btn-inline { margin-top: 8px; }

        /* Info / Warning Boxes */
        .info-box {
            background: var(--lh-accent-muted, rgba(163,184,153,0.1));
            padding: 12px 16px;
            border-left: 3px solid var(--lh-accent, #a3b899);
            font-size: 0.9rem;
            color: var(--lh-text, rgba(242,235,224,0.8));
        }

        .warning-box {
            background: rgba(201,169,166,0.1);
            padding: 12px 16px;
            border-left: 3px solid #c9a9a6;
            font-size: 0.9rem;
            color: var(--lh-text, rgba(242,235,224,0.8));
        }

        /* Color Grid */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 12px;
        }
        .color-option {
            border: 2px solid transparent;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(61,47,49,0.3);
            text-align: center;
        }
        .color-option:hover { background: rgba(61,47,49,0.5); }
        .color-option.selected {
            border-color: var(--lh-accent, #a3b899);
            background: var(--lh-accent-muted, rgba(163,184,153,0.1));
        }
        .color-swatch {
            width: 100%; height: 36px; margin-bottom: 6px;
            border: 1px solid rgba(242,235,224,0.2);
        }
        .color-name { font-size: 0.8rem; color: var(--lh-text, #f2ebe0); }

        /* Toggle Switch */
        .setting-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .toggle-switch {
            position: relative;
            width: 50px; height: 26px;
            background: rgba(163,184,153,0.2);
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
            flex-shrink: 0;
        }
        .toggle-switch.active { background: var(--lh-accent, #a3b899); }
        .toggle-slider {
            position: absolute; top: 3px; left: 3px;
            width: 20px; height: 20px;
            background: #f2ebe0; border-radius: 50%;
            transition: transform 0.3s;
        }
        .toggle-switch.active .toggle-slider { transform: translateX(24px); }

        /* Habit List */
        .habit-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--lh-accent-border, rgba(163,184,153,0.2));
            padding: 12px;
            margin-top: 12px;
            background: rgba(61,47,49,0.3);
        }
        .habit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(61,47,49,0.5);
            border-left: 2px solid var(--lh-accent, #a3b899);
        }
        .habit-text { flex: 1; color: var(--lh-text, #f2ebe0); font-size: 0.9rem; }
        .habit-actions { display: flex; gap: 8px; }

        /* Archive Grid */
        .archive-grid {
            display: grid;
            gap: 8px;
            margin-top: 12px;
        }
        .archive-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: rgba(61,47,49,0.3);
            border: 1px solid var(--lh-accent-border, rgba(163,184,153,0.15));
            transition: all 0.2s;
        }
        .archive-item.archived {
            opacity: 0.5;
            border-style: dashed;
        }
        .archive-item-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }
        .archive-item-icon {
            font-size: 1rem;
            width: 28px;
            text-align: center;
            flex-shrink: 0;
        }
        .archive-item-name {
            color: var(--lh-text, #f2ebe0);
            font-size: 0.9rem;
            font-weight: 600;
        }
        .archive-item-desc {
            color: var(--lh-text-faint, rgba(242,235,224,0.4));
            font-size: 0.8rem;
        }
        .archive-toggle-btn {
            background: none;
            border: 1px solid var(--lh-accent-border, rgba(163,184,153,0.3));
            color: var(--lh-accent, #a3b899);
            padding: 6px 14px;
            font-size: 0.8rem;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .archive-toggle-btn:hover {
            background: var(--lh-accent-muted, rgba(163,184,153,0.1));
        }
        .archive-toggle-btn.restore {
            border-color: rgba(201,169,166,0.3);
            color: #c9a9a6;
        }
        .archive-toggle-btn.restore:hover {
            background: rgba(201,169,166,0.1);
        }

        /* Section Groups in Archive */
        .archive-group {
            margin-bottom: 20px;
        }
        .archive-group-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: var(--lh-text-faint, rgba(242,235,224,0.4));
            margin-bottom: 8px;
            padding-left: 4px;
        }

        /* Save indicator */
        .save-flash {
            display: inline-block;
            color: var(--lh-accent, #a3b899);
            font-size: 0.85rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.3s;
            margin-left: 12px;
        }
        .save-flash.show { opacity: 1; }

        /* ===== MOBILE ===== */
        html, body { overflow-x: hidden !important; max-width: 100vw !important; }
        @media screen and (max-width: 768px) {
            input, textarea, select { font-size: 16px !important; }
            .container { padding: 16px 16px 60px; }
            .settings-section { padding: 20px 16px; }
            .page-title { font-size: 1.8rem; }
            .color-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media screen and (max-width: 380px) {
            .container { padding: 12px 10px 60px; }
            .settings-section { padding: 16px 12px; }
            .setting-label { font-size: 0.9rem; }
            .color-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">Our Life Hub</a>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="kasey-hub.html" class="nav-link">Kasey</a>
                <a href="charlie-hub.html" class="nav-link">Charlie</a>
                <a href="our-dreams.html" class="nav-link">Us ♡</a>
                <a href="meal-plan.html" class="nav-link">Meals</a>
                <a href="settings.html" class="nav-link active">Settings</a>
            </div>
            <div style="display:flex;align-items:center;gap:2px;">
                <button class="nav-refresh" onclick="location.reload(true)" aria-label="Refresh" title="Refresh page">↻</button>
                <button class="nav-hamburger" id="navHamburger" onclick="toggleNav()" aria-label="Menu">
                    <span></span><span></span><span></span>
                </button>
            </div>
        </div>
    </nav>
    <div class="nav-overlay" id="navOverlay" onclick="toggleNav()">
        <a href="index.html" class="nav-link-mobile">Home</a>
        <a href="kasey-hub.html" class="nav-link-mobile">Kasey</a>
        <a href="charlie-hub.html" class="nav-link-mobile">Charlie</a>
        <a href="our-dreams.html" class="nav-link-mobile">Us ♡</a>
        <a href="meal-plan.html" class="nav-link-mobile">Meals</a>
        <a href="settings.html" class="nav-link-mobile active">Settings</a>
    </div>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Settings</h1>
            <p class="page-subtitle">Customize your Life Hub experience</p>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 1. BRANDING & IDENTITY -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Branding & Identity</h2>

            <div class="setting-item">
                <label class="setting-label">App Name</label>
                <p class="setting-description">Displayed in the navigation bar and page titles across all pages</p>
                <input type="text" id="appName" class="setting-input" placeholder="Our Life Hub">
                <button class="btn btn-inline" onclick="saveAppName()">Save App Name</button>
                <span class="save-flash" id="appNameFlash">✓ Saved</span>
            </div>

            <div class="setting-item">
                <label class="setting-label">Person 1 Name</label>
                <p class="setting-description">Used for the first person's hub, nav link, wishlists, and meal plan</p>
                <input type="text" id="name1" class="setting-input" placeholder="Kasey">
            </div>

            <div class="setting-item">
                <label class="setting-label">Person 2 Name</label>
                <p class="setting-description">Used for the second person's hub, nav link, wishlists, and meal plan</p>
                <input type="text" id="name2" class="setting-input" placeholder="Charlie">
                <button class="btn btn-inline" onclick="saveNames()">Save Names</button>
                <span class="save-flash" id="namesFlash">✓ Saved</span>
            </div>

            <div class="setting-item">
                <label class="setting-label">Page Labels</label>
                <p class="setting-description">Rename how pages appear in the navigation (leave blank for defaults)</p>
                <div style="display: grid; grid-template-columns: 100px 1fr; gap: 8px; align-items: center; margin-top: 8px;">
                    <span class="setting-description" style="margin-bottom: 0;">Home:</span>
                    <input type="text" id="labelHome" class="setting-input" placeholder="Home" style="padding: 8px 12px;">
                    <span class="setting-description" style="margin-bottom: 0;">Dreams:</span>
                    <input type="text" id="labelDreams" class="setting-input" placeholder="Us ♡" style="padding: 8px 12px;">
                    <span class="setting-description" style="margin-bottom: 0;">Meals:</span>
                    <input type="text" id="labelMeals" class="setting-input" placeholder="Meals" style="padding: 8px 12px;">
                    <span class="setting-description" style="margin-bottom: 0;">Settings:</span>
                    <input type="text" id="labelSettings" class="setting-input" placeholder="Settings" style="padding: 8px 12px;">
                </div>
                <button class="btn btn-inline" onclick="savePageLabels()">Save Labels</button>
                <span class="save-flash" id="labelsFlash">✓ Saved</span>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 2. APPEARANCE -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Appearance</h2>

            <div class="setting-item">
                <label class="setting-label">Accent Color</label>
                <p class="setting-description">Primary color used for buttons, links, and highlights across the app</p>
                <div class="color-grid" id="accentColorGrid"></div>
                <div class="info-box" style="margin-top: 12px;">
                    Current: <span id="currentColor" style="font-weight: 600;">Sage Green</span>
                </div>
            </div>

            <div class="setting-item">
                <label class="setting-label">Background Color</label>
                <p class="setting-description">Background color for all pages</p>
                <div class="color-grid" id="bgColorGrid"></div>
                <div class="info-box" style="margin-top: 12px;">
                    Current: <span id="currentBgColor" style="font-weight: 600;">Dark Plum</span>
                </div>
            </div>

            <div class="setting-item">
                <label class="setting-label">Font Family</label>
                <p class="setting-description">Primary font used throughout the app</p>
                <select id="fontFamily" class="setting-select" onchange="setFontFamily()">
                    <option value="philosopher">Philosopher (Default)</option>
                    <option value="cormorant">Cormorant (Elegant Serif)</option>
                    <option value="worksans">Work Sans (Modern Sans)</option>
                    <option value="georgia">Georgia (Classic Serif)</option>
                    <option value="arial">Arial (Clean Sans)</option>
                </select>
            </div>

            <div class="setting-item">
                <label class="setting-label">Font Size</label>
                <p class="setting-description">Adjust the base font size for readability</p>
                <div style="display: flex; align-items: center; gap: 16px; margin-top: 12px;">
                    <button class="btn-secondary btn btn-small" onclick="adjustFontSize(-1)">A−</button>
                    <span id="fontSizeDisplay" style="color: var(--lh-accent); font-weight: 600; min-width: 40px; text-align: center;">100%</span>
                    <button class="btn-secondary btn btn-small" onclick="adjustFontSize(1)">A+</button>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 3. PAGE MANAGEMENT (Archive pages) -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Page Management</h2>
            <p class="section-description">Archive pages to hide them from the navigation. Archived pages keep all their data intact and can be restored at any time. The Settings page cannot be archived.</p>

            <div class="archive-grid" id="pageArchiveGrid"></div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 4. SECTION MANAGEMENT (Archive sections) -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Section Management</h2>
            <p class="section-description">Archive individual sections within each page. Archived sections are hidden from view but their data is preserved.</p>

            <div id="sectionArchiveContainer"></div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 5. HABIT CUSTOMIZATION -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Habit Customization</h2>

            <div class="setting-item">
                <label class="setting-label" id="habits1Label">Person 1 Habits</label>
                <p class="setting-description">Customize the habit bingo card for the first person</p>
                <div id="habits1List" class="habit-list"></div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                    <input type="text" id="newHabit1" class="setting-input" placeholder="Add new habit..." style="flex: 1;" onkeypress="if(event.key==='Enter') addHabit('person1')">
                    <button class="btn" onclick="addHabit('person1')">Add</button>
                </div>
            </div>

            <div class="setting-item">
                <label class="setting-label" id="habits2Label">Person 2 Habits</label>
                <p class="setting-description">Customize the habit bingo card for the second person</p>
                <div id="habits2List" class="habit-list"></div>
                <div style="display: flex; gap: 8px; margin-top: 12px;">
                    <input type="text" id="newHabit2" class="setting-input" placeholder="Add new habit..." style="flex: 1;" onkeypress="if(event.key==='Enter') addHabit('person2')">
                    <button class="btn" onclick="addHabit('person2')">Add</button>
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 6. CONTENT CUSTOMIZATION -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Content Customization</h2>

            <div class="setting-item">
                <label class="setting-label">Custom Daily Prompts</label>
                <p class="setting-description">Relationship prompts shown on the home page (one per line, minimum 10)</p>
                <textarea id="customPrompts" class="setting-input" placeholder="What's one thing I did today that made you smile?&#10;What's your favorite memory of us from this past month?&#10;What's one way I can support you better this week?"></textarea>
                <button class="btn btn-inline" onclick="saveCustomPrompts()">Save Prompts</button>
                <span class="save-flash" id="promptsFlash">✓ Saved</span>
                <div class="info-box" style="margin-top: 8px;">
                    <span id="promptCount">0</span> custom prompts saved
                </div>
            </div>

            <div class="setting-item">
                <label class="setting-label">Custom Monthly Challenges</label>
                <p class="setting-description">One challenge per line, exactly 12 (one for each month)</p>
                <textarea id="customChallenges" class="setting-input" placeholder="Write each other a love letter&#10;Go on a walk together 3 times per week&#10;Try a new restaurant"></textarea>
                <button class="btn btn-inline" onclick="saveCustomChallenges()">Save Challenges</button>
                <span class="save-flash" id="challengesFlash">✓ Saved</span>
                <div class="info-box" style="margin-top: 8px;">
                    <span id="challengeCount">0</span> custom challenges saved
                </div>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 7. MEAL PLAN SETTINGS -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Meal Plan Settings</h2>
            <p class="section-description">Configure nutritional targets for each person. These values are used for meal planning and grocery list generation.</p>

            <div class="setting-item">
                <label class="setting-label" id="mealPerson1Label">Person 1 Targets</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 8px;">
                    <div>
                        <span class="setting-description" style="display: block; margin-bottom: 4px;">Calories/day</span>
                        <input type="text" id="meal1Calories" class="setting-input" placeholder="1,350-1,700" style="padding: 8px 12px;">
                    </div>
                    <div>
                        <span class="setting-description" style="display: block; margin-bottom: 4px;">Protein/day</span>
                        <input type="text" id="meal1Protein" class="setting-input" placeholder="140-165g" style="padding: 8px 12px;">
                    </div>
                </div>
            </div>

            <div class="setting-item">
                <label class="setting-label" id="mealPerson2Label">Person 2 Targets</label>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 8px;">
                    <div>
                        <span class="setting-description" style="display: block; margin-bottom: 4px;">Calories/day</span>
                        <input type="text" id="meal2Calories" class="setting-input" placeholder="2,200-2,500" style="padding: 8px 12px;">
                    </div>
                    <div>
                        <span class="setting-description" style="display: block; margin-bottom: 4px;">Protein/day</span>
                        <input type="text" id="meal2Protein" class="setting-input" placeholder="180-210g" style="padding: 8px 12px;">
                    </div>
                </div>
                <button class="btn btn-inline" onclick="saveMealSettings()">Save Meal Settings</button>
                <span class="save-flash" id="mealsFlash">✓ Saved</span>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 8. PREFERENCES -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Preferences</h2>

            <div class="setting-item">
                <label class="setting-label">Time Zone</label>
                <p class="setting-description">Used for accurate date and time display</p>
                <select id="timezone" class="setting-select" onchange="saveTimezone()">
                    <option value="America/New_York">Eastern (ET)</option>
                    <option value="America/Chicago">Central (CT)</option>
                    <option value="America/Denver">Mountain (MT)</option>
                    <option value="America/Los_Angeles">Pacific (PT)</option>
                    <option value="America/Anchorage">Alaska (AKT)</option>
                    <option value="Pacific/Honolulu">Hawaii (HST)</option>
                </select>
            </div>

            <div class="setting-item">
                <label class="setting-label">Week Start Day</label>
                <p class="setting-description">Which day your week starts on for calendar views</p>
                <select id="weekStart" class="setting-select" onchange="saveWeekStart()">
                    <option value="0">Sunday</option>
                    <option value="1">Monday</option>
                </select>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 9. DATA MANAGEMENT -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">Data Management</h2>

            <div class="setting-item">
                <label class="setting-label">Export All Data</label>
                <p class="setting-description">Download a complete backup of all your Life Hub data and settings</p>
                <button class="btn-secondary btn" onclick="exportData()">Download Backup</button>
            </div>

            <div class="setting-item">
                <label class="setting-label">Import Data</label>
                <p class="setting-description">Restore from a previous backup file</p>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                <button class="btn-secondary btn" onclick="document.getElementById('importFile').click()">Import Backup</button>
            </div>

            <div class="setting-item">
                <label class="setting-label">Reset All Settings</label>
                <p class="setting-description">Reset customizations to defaults (keeps your habit data, calendar events, etc.)</p>
                <button class="btn-danger btn" onclick="resetSettings()">Reset to Defaults</button>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════ -->
        <!-- 10. ABOUT -->
        <!-- ═══════════════════════════════════════════ -->
        <div class="settings-section">
            <h2 class="section-title">About</h2>
            <div class="setting-item">
                <label class="setting-label" data-lh-name="app">Our Life Hub</label>
                <p class="setting-description">Version 2.0 — Fully Customizable</p>
                <div class="info-box">
                    Your personal habit tracking and life management system. All data is stored locally in your browser and synced to Firebase for backup and multi-device access. Customize everything from this settings page — no code required.
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCDda9sPwSY-RQ5rrM5THOvcLtHvcPRYd4",
            authDomain: "our-habit-hub.firebaseapp.com",
            projectId: "our-habit-hub",
            storageBucket: "our-habit-hub.firebasestorage.app",
            messagingSenderId: "78555830496",
            appId: "1:78555830496:web:3e457e54729cc11b825885"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;
        window.firestoreImports = { doc, setDoc, getDoc };
    </script>

    <script>
        // ══════════════════════════════════════════════
        // SETTINGS PAGE LOGIC
        // ══════════════════════════════════════════════

        const LH = window.LifeHubSettings;
        const S = LH.current;

        // ── Utility: flash a save indicator ──
        function flash(id) {
            const el = document.getElementById(id);
            if (!el) return;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 2000);
        }

        // ── Default Habits ──
        const defaultHabits = {
            person1: [
                "Drink 8 Glasses of Water", "Exercise 30+ Minutes", "Eat a Healthy Meal",
                "Read 10+ Pages", "Meditate", "Subliminals & Rampages", "Journal",
                "Walk 8k Steps", "Stretch", "Vibration Plate", "Take Vitamins & Supplements",
                "Morning Routine", "Evening Routine", "Do Laundry", "Altar Time",
                "Tidy Living Space", "Dry Brushing & Face Massage", "EFT Tapping",
                "Spend Time Outside", "No Social Media in the Morning"
            ],
            person2: [
                "Exercise 30+ Minutes", "Eat a Healthy Meal", "Read 10+ Pages",
                "Meditate", "Sleep 7+ Hours", "Journal", "Walk 10k Steps",
                "Vibration Plate", "Learn Something New", "Practice Gratitude",
                "Acupuncture Mat", "Tidy Living Space", "30 Mins of Guitar",
                "EFT Tapping", "Time in Nature", "Acts of Kindness"
            ]
        };

        // ── Color Definitions ──
        const colorDefs = {
            sage:       { name: 'Sage Green',    hex: '#a3b899' },
            rose:       { name: 'Dusty Rose',    hex: '#c9a9a6' },
            cream:      { name: 'Warm Cream',    hex: '#e8ddd0' },
            blush:      { name: 'Valentine Blush', hex: '#d4919e' },
            coral:      { name: 'Living Coral',  hex: '#d98a7e' },
            peach:      { name: 'Soft Peach',    hex: '#d4a59a' },
            mauve:      { name: 'Mauve Dream',   hex: '#b8879e' },
            berry:      { name: 'Wild Berry',    hex: '#9c6b82' },
            lavender:   { name: 'Lavender',      hex: '#b4a7d6' },
            periwinkle: { name: 'Periwinkle',    hex: '#8e9cc7' },
            teal:       { name: 'Soft Teal',     hex: '#7ba8a1' },
            seafoam:    { name: 'Seafoam',       hex: '#7bbfb0' },
            gold:       { name: 'Warm Gold',     hex: '#c9b77c' },
            honey:      { name: 'Honey',         hex: '#d4b870' },
            terracotta: { name: 'Terracotta',    hex: '#c4836a' }
        };

        const bgColorDefs = {
            dark:     { name: 'Dark Plum',     hex: '#3d2f31' },
            wine:     { name: 'Wine',          hex: '#2d1f2b' },
            espresso: { name: 'Espresso',      hex: '#2b2220' },
            charcoal: { name: 'Charcoal',      hex: '#1a1a1a' },
            navy:     { name: 'Deep Navy',     hex: '#1e2638' },
            storm:    { name: 'Stormy Night',  hex: '#252830' },
            slate:    { name: 'Cool Slate',    hex: '#2a2d35' },
            forest:   { name: 'Forest',        hex: '#1f2e2a' },
            cream:    { name: 'Warm Cream',    hex: '#f5f0e8' }
        };

        // ── Page & Section Definitions ──
        const pageDefs = [
            { key: 'home',    icon: '⌂', name: 'Home Page',       desc: 'Calendar, reminders, grocery list, phone book' },
            { key: 'person1', icon: '♡', name: S.names.name1 + "'s Hub", desc: 'Habits, wellness, journal, resources' },
            { key: 'person2', icon: '♡', name: S.names.name2 + "'s Hub", desc: 'Habits, wellness, journal, resources' },
            { key: 'dreams',  icon: '✧', name: 'Dreams & Goals',  desc: 'Restaurants, places, wishlists, bucket list' },
            { key: 'meals',   icon: '⚘', name: 'Meal Plan',      desc: 'Weekly meals, grocery sync, prep sessions' }
        ];

        const sectionDefs = {
            home: [
                { key: 'reminders',  name: 'Reminders' },
                { key: 'calendar',   name: 'Calendar' },
                { key: 'grocery',    name: 'Grocery List' },
                { key: 'phonebook',  name: 'Phone Book' }
            ],
            person1: [
                { key: 'bingo',     name: 'Habits & Wellness' },
                { key: 'todo',      name: 'To-Do List' },
                { key: 'resources', name: 'Resources' },
                { key: 'videos',    name: 'Video Hub' },
                { key: 'journal',   name: 'Journal' },
                { key: 'prompt',    name: 'Daily Prompt' },
                { key: 'spellbook', name: 'Spell Book' }
            ],
            person2: [
                { key: 'bingo',     name: 'Habits & Wellness' },
                { key: 'resources', name: 'Resources' },
                { key: 'videos',    name: 'Video Hub' },
                { key: 'todos',     name: 'To-Do List' },
                { key: 'journal',   name: 'Journal' },
                { key: 'prompt',    name: 'Daily Prompt' }
            ],
            dreams: [
                { key: 'restaurants',  name: 'Restaurants' },
                { key: 'places',       name: 'Places to Go' },
                { key: 'wishlists',    name: 'Wishlists' },
                { key: 'travel',       name: 'Travel' },
                { key: 'shows-movies', name: 'TV Shows & Movies' },
                { key: 'bucket',       name: 'Bucket List' },
                { key: 'home',         name: 'Dream Home' },
                { key: 'pets',         name: 'Future Pets' },
                { key: 'traditions',   name: 'Traditions' }
            ],
            meals: [
                { key: 'person1-meals', name: S.names.name1 + "'s Meals" },
                { key: 'person2-meals', name: S.names.name2 + "'s Meals" },
                { key: 'prep',          name: 'Prep Sessions' },
                { key: 'grocery-sync',  name: 'Grocery Sync' }
            ]
        };

        // ══════════════════════════════════════════════
        // BUILD UI
        // ══════════════════════════════════════════════

        function buildColorGrids() {
            // Accent colors
            const accentGrid = document.getElementById('accentColorGrid');
            accentGrid.innerHTML = Object.keys(colorDefs).map(key => {
                const c = colorDefs[key];
                const selected = S.accentColor === key ? ' selected' : '';
                return '<div class="color-option' + selected + '" data-color="' + key + '" onclick="setAccentColor(\'' + key + '\')">' +
                    '<div class="color-swatch" style="background: ' + c.hex + ';"></div>' +
                    '<div class="color-name">' + c.name + '</div></div>';
            }).join('');

            // Background colors
            const bgGrid = document.getElementById('bgColorGrid');
            bgGrid.innerHTML = Object.keys(bgColorDefs).map(key => {
                const c = bgColorDefs[key];
                const selected = S.bgColor === key ? ' selected' : '';
                return '<div class="color-option' + selected + '" data-bgcolor="' + key + '" onclick="setBackgroundColor(\'' + key + '\')">' +
                    '<div class="color-swatch" style="background: ' + c.hex + ';"></div>' +
                    '<div class="color-name">' + c.name + '</div></div>';
            }).join('');
        }

        function buildPageArchiveGrid() {
            const grid = document.getElementById('pageArchiveGrid');
            const archived = S.archivedPages;

            grid.innerHTML = pageDefs.map(p => {
                const isArchived = archived.indexOf(p.key) !== -1;
                return '<div class="archive-item' + (isArchived ? ' archived' : '') + '">' +
                    '<div class="archive-item-info">' +
                        '<span class="archive-item-icon">' + p.icon + '</span>' +
                        '<div><div class="archive-item-name">' + p.name + '</div>' +
                        '<div class="archive-item-desc">' + p.desc + '</div></div>' +
                    '</div>' +
                    '<button class="archive-toggle-btn' + (isArchived ? ' restore' : '') + '" onclick="togglePageArchive(\'' + p.key + '\')">' +
                        (isArchived ? 'Restore' : 'Archive') +
                    '</button></div>';
            }).join('');
        }

        function buildSectionArchiveContainer() {
            const container = document.getElementById('sectionArchiveContainer');
            const archived = S.archivedSections;

            const pageNames = {
                home: 'Home Page',
                person1: S.names.name1 + "'s Hub",
                person2: S.names.name2 + "'s Hub",
                dreams: 'Dreams & Goals',
                meals: 'Meal Plan'
            };

            let html = '';
            Object.keys(sectionDefs).forEach(pageKey => {
                const sections = sectionDefs[pageKey];
                const archivedSections = archived[pageKey] || [];

                html += '<div class="archive-group">';
                html += '<div class="archive-group-title">' + (pageNames[pageKey] || pageKey) + '</div>';
                html += '<div class="archive-grid">';

                sections.forEach(sec => {
                    const isArchived = archivedSections.indexOf(sec.key) !== -1;
                    html += '<div class="archive-item' + (isArchived ? ' archived' : '') + '">' +
                        '<div class="archive-item-info">' +
                            '<div class="archive-item-name">' + sec.name + '</div>' +
                        '</div>' +
                        '<button class="archive-toggle-btn' + (isArchived ? ' restore' : '') + '" onclick="toggleSectionArchive(\'' + pageKey + '\', \'' + sec.key + '\')">' +
                            (isArchived ? 'Restore' : 'Archive') +
                        '</button></div>';
                });

                html += '</div></div>';
            });

            container.innerHTML = html;
        }

        // ══════════════════════════════════════════════
        // SAVE FUNCTIONS
        // ══════════════════════════════════════════════

        // App Name
        window.saveAppName = function() {
            const val = document.getElementById('appName').value || 'Our Life Hub';
            localStorage.setItem('appName', val);
            flash('appNameFlash');
            document.querySelector('.nav-logo').textContent = val;
        };

        // Names
        window.saveNames = function() {
            const names = {
                name1: document.getElementById('name1').value || 'Kasey',
                name2: document.getElementById('name2').value || 'Charlie'
            };
            localStorage.setItem('userNames', JSON.stringify(names));
            flash('namesFlash');
            // Update nav links live
            document.querySelectorAll('.nav-link, .nav-link-mobile').forEach(link => {
                const href = link.getAttribute('href') || '';
                if (href === 'kasey-hub.html') link.textContent = names.name1;
                if (href === 'charlie-hub.html') link.textContent = names.name2;
            });
            // Update labels in this page
            document.getElementById('habits1Label').textContent = names.name1 + "'s Habits";
            document.getElementById('habits2Label').textContent = names.name2 + "'s Habits";
            document.getElementById('mealPerson1Label').textContent = names.name1 + "'s Targets";
            document.getElementById('mealPerson2Label').textContent = names.name2 + "'s Targets";
        };

        // Page Labels
        window.savePageLabels = function() {
            const labels = {};
            const home = document.getElementById('labelHome').value.trim();
            const dreams = document.getElementById('labelDreams').value.trim();
            const meals = document.getElementById('labelMeals').value.trim();
            const settings = document.getElementById('labelSettings').value.trim();
            if (home) labels.home = home;
            if (dreams) labels.dreams = dreams;
            if (meals) labels.meals = meals;
            if (settings) labels.settings = settings;
            localStorage.setItem('pageLabels', JSON.stringify(labels));
            flash('labelsFlash');
        };

        // Accent Color
        window.setAccentColor = function(key) {
            localStorage.setItem('accentColor', key);
            document.getElementById('currentColor').textContent = colorDefs[key].name;
            document.querySelectorAll('.color-option[data-color]').forEach(el => el.classList.remove('selected'));
            const selected = document.querySelector('[data-color="' + key + '"]');
            if (selected) selected.classList.add('selected');
            // Reload to apply across the page via engine
            location.reload();
        };

        // Background Color
        window.setBackgroundColor = function(key) {
            localStorage.setItem('bgColor', key);
            document.getElementById('currentBgColor').textContent = bgColorDefs[key].name;
            document.querySelectorAll('.color-option[data-bgcolor]').forEach(el => el.classList.remove('selected'));
            const selected = document.querySelector('[data-bgcolor="' + key + '"]');
            if (selected) selected.classList.add('selected');
            location.reload();
        };

        // Font
        window.setFontFamily = function() {
            const val = document.getElementById('fontFamily').value;
            localStorage.setItem('fontFamily', val);
            location.reload();
        };

        // Font Size
        window.adjustFontSize = function(direction) {
            let current = parseInt(localStorage.getItem('fontSize') || '100');
            current += (direction * 10);
            current = Math.max(80, Math.min(130, current));
            localStorage.setItem('fontSize', current.toString());
            document.getElementById('fontSizeDisplay').textContent = current + '%';
            document.documentElement.style.fontSize = (16 * current / 100) + 'px';
        };

        // Page Archive
        window.togglePageArchive = function(pageKey) {
            let archived = JSON.parse(localStorage.getItem('archivedPages') || '[]');
            const idx = archived.indexOf(pageKey);
            if (idx !== -1) {
                archived.splice(idx, 1);
            } else {
                archived.push(pageKey);
            }
            localStorage.setItem('archivedPages', JSON.stringify(archived));
            S.archivedPages = archived;
            buildPageArchiveGrid();
            // Live-update nav
            location.reload();
        };

        // Section Archive
        window.toggleSectionArchive = function(pageKey, sectionKey) {
            let archived = JSON.parse(localStorage.getItem('archivedSections') || '{}');
            if (!archived[pageKey]) archived[pageKey] = [];
            const idx = archived[pageKey].indexOf(sectionKey);
            if (idx !== -1) {
                archived[pageKey].splice(idx, 1);
                if (archived[pageKey].length === 0) delete archived[pageKey];
            } else {
                archived[pageKey].push(sectionKey);
            }
            localStorage.setItem('archivedSections', JSON.stringify(archived));
            S.archivedSections = archived;
            buildSectionArchiveContainer();
        };

        // Habits
        window.addHabit = function(person) {
            const input = document.getElementById(person === 'person1' ? 'newHabit1' : 'newHabit2');
            const text = input.value.trim();
            if (!text) { alert('Please enter a habit name'); return; }
            const habits = JSON.parse(localStorage.getItem('customHabits_' + person) || JSON.stringify(defaultHabits[person]));
            habits.push(text);
            localStorage.setItem('customHabits_' + person, JSON.stringify(habits));
            input.value = '';
            renderHabits(person);
        };

        window.deleteHabit = function(person, index) {
            if (!confirm('Delete this habit?')) return;
            const habits = JSON.parse(localStorage.getItem('customHabits_' + person) || JSON.stringify(defaultHabits[person]));
            habits.splice(index, 1);
            localStorage.setItem('customHabits_' + person, JSON.stringify(habits));
            renderHabits(person);
        };

        function renderHabits(person) {
            const listId = person === 'person1' ? 'habits1List' : 'habits2List';
            const habits = JSON.parse(localStorage.getItem('customHabits_' + person) || JSON.stringify(defaultHabits[person]));
            const list = document.getElementById(listId);
            list.innerHTML = habits.map((habit, i) =>
                '<div class="habit-item"><div class="habit-text">' + habit + '</div>' +
                '<div class="habit-actions"><button class="btn-danger btn btn-small" onclick="deleteHabit(\'' + person + '\',' + i + ')">Delete</button></div></div>'
            ).join('');
        }

        // Custom Prompts
        window.saveCustomPrompts = function() {
            const text = document.getElementById('customPrompts').value.trim();
            const arr = text.split('\n').filter(p => p.trim());
            if (arr.length < 10) { alert('Please enter at least 10 prompts (one per line)'); return; }
            localStorage.setItem('customPrompts', JSON.stringify(arr));
            document.getElementById('promptCount').textContent = arr.length;
            flash('promptsFlash');
        };

        // Custom Challenges
        window.saveCustomChallenges = function() {
            const text = document.getElementById('customChallenges').value.trim();
            const arr = text.split('\n').filter(c => c.trim());
            if (arr.length !== 12) { alert('Please enter exactly 12 challenges (one per line, for each month)'); return; }
            localStorage.setItem('customChallenges', JSON.stringify(arr));
            document.getElementById('challengeCount').textContent = arr.length;
            flash('challengesFlash');
        };

        // Meal Settings
        window.saveMealSettings = function() {
            const settings = {
                person1: {
                    calories: document.getElementById('meal1Calories').value || '1,350-1,700',
                    protein: document.getElementById('meal1Protein').value || '140-165g'
                },
                person2: {
                    calories: document.getElementById('meal2Calories').value || '2,200-2,500',
                    protein: document.getElementById('meal2Protein').value || '180-210g'
                }
            };
            localStorage.setItem('mealSettings', JSON.stringify(settings));
            flash('mealsFlash');
        };

        // Timezone
        window.saveTimezone = function() {
            localStorage.setItem('timezone', document.getElementById('timezone').value);
        };

        // Week Start
        window.saveWeekStart = function() {
            localStorage.setItem('weekStart', document.getElementById('weekStart').value);
        };

        // Export
        window.exportData = function() {
            const data = { version: '2.0', exportDate: new Date().toISOString(), localStorage: {} };
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                data.localStorage[key] = localStorage.getItem(key);
            }
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'lifehub-backup-' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
        };

        // Import
        window.importData = function(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (!data.localStorage) { alert('Invalid backup file format.'); return; }
                    if (confirm('This will replace all current data with the backup. Continue?')) {
                        localStorage.clear();
                        Object.keys(data.localStorage).forEach(key => {
                            localStorage.setItem(key, data.localStorage[key]);
                        });
                        alert('Data restored! The page will now reload.');
                        location.reload();
                    }
                } catch (err) {
                    alert('Error reading backup file: ' + err.message);
                }
            };
            reader.readAsText(file);
        };

        // Reset
        window.resetSettings = function() {
            if (!confirm('Reset all customizations to default? This will NOT delete your data (calendar, habits, etc.), only your appearance, archive, and feature settings.')) return;
            const keys = ['appName', 'userNames', 'accentColor', 'bgColor', 'fontFamily', 'fontSize',
                'features', 'customHabits_person1', 'customHabits_person2', 'customPrompts',
                'customChallenges', 'timezone', 'weekStart', 'archivedPages', 'archivedSections',
                'pageLabels', 'mealSettings'];
            keys.forEach(key => localStorage.removeItem(key));
            alert('Settings reset! The page will now reload.');
            location.reload();
        };

        // ══════════════════════════════════════════════
        // LOAD ALL SETTINGS ON PAGE LOAD
        // ══════════════════════════════════════════════
        function loadSettings() {
            // App name
            document.getElementById('appName').value = S.appName;

            // Names
            document.getElementById('name1').value = S.names.name1;
            document.getElementById('name2').value = S.names.name2;
            document.getElementById('habits1Label').textContent = S.names.name1 + "'s Habits";
            document.getElementById('habits2Label').textContent = S.names.name2 + "'s Habits";
            document.getElementById('mealPerson1Label').textContent = S.names.name1 + "'s Targets";
            document.getElementById('mealPerson2Label').textContent = S.names.name2 + "'s Targets";

            // Page labels
            const labels = S.pageLabels || {};
            document.getElementById('labelHome').value = labels.home || '';
            document.getElementById('labelDreams').value = labels.dreams || '';
            document.getElementById('labelMeals').value = labels.meals || '';
            document.getElementById('labelSettings').value = labels.settings || '';

            // Accent color
            document.getElementById('currentColor').textContent = (colorDefs[S.accentColor] || colorDefs.sage).name;

            // Background color
            document.getElementById('currentBgColor').textContent = (bgColorDefs[S.bgColor] || bgColorDefs.dark).name;

            // Font
            document.getElementById('fontFamily').value = S.fontFamily;

            // Font size
            document.getElementById('fontSizeDisplay').textContent = S.fontSize + '%';

            // Build grids
            buildColorGrids();
            buildPageArchiveGrid();
            buildSectionArchiveContainer();

            // Habits
            renderHabits('person1');
            renderHabits('person2');

            // Prompts
            const prompts = localStorage.getItem('customPrompts');
            if (prompts) {
                const arr = JSON.parse(prompts);
                document.getElementById('customPrompts').value = arr.join('\n');
                document.getElementById('promptCount').textContent = arr.length;
            }

            // Challenges
            const challenges = localStorage.getItem('customChallenges');
            if (challenges) {
                const arr = JSON.parse(challenges);
                document.getElementById('customChallenges').value = arr.join('\n');
                document.getElementById('challengeCount').textContent = arr.length;
            }

            // Meal settings
            const mealSettings = JSON.parse(localStorage.getItem('mealSettings') || '{}');
            if (mealSettings.person1) {
                document.getElementById('meal1Calories').value = mealSettings.person1.calories || '';
                document.getElementById('meal1Protein').value = mealSettings.person1.protein || '';
            }
            if (mealSettings.person2) {
                document.getElementById('meal2Calories').value = mealSettings.person2.calories || '';
                document.getElementById('meal2Protein').value = mealSettings.person2.protein || '';
            }

            // Timezone
            document.getElementById('timezone').value = localStorage.getItem('timezone') || 'America/New_York';

            // Week start
            document.getElementById('weekStart').value = localStorage.getItem('weekStart') || '0';
        }

        loadSettings();
    </script>

    <script>
        function toggleNav() {
            var h = document.getElementById('navHamburger');
            var o = document.getElementById('navOverlay');
            if (!h || !o) return;
            var isOpen = o.classList.contains('open');
            if (isOpen) {
                h.classList.remove('open');
                o.classList.remove('open');
                document.body.style.overflow = '';
            } else {
                h.classList.add('open');
                o.classList.add('open');
                document.body.style.overflow = 'hidden';
            }
        }
    </script>
</body>
</html>
